<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Machine Learning Project - Project Scope</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>


</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Machine Learning Project</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Project Scope</li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../images/lorip_square.jpg" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/02-train/notebooks/04_train.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Train Model</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/02-train/notebooks/05_get_best_model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Register Model</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/02-train/notebooks/06_design_experiment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sample Sizes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/02-train/notebooks/07_get_audience_cohorts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Get Audience</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/03-explore/notebooks/08_explore_best_model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Vital Features</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/04-upload/notebooks/09_upload.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Upload Audience</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/05-dash/notebooks/10_dash.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dashboard</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/02-train/notebooks/11_analyze_campaign_outputs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Post-Campaign</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/02-train/notebooks/12_cleanup_mlflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Clean MLFlow</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/07-cleanup/notebooks/13_cleanup_gcloud.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Clean GCloud</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="3">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#understanding-the-problem" id="toc-understanding-the-problem" class="nav-link active" data-scroll-target="#understanding-the-problem">Understanding the Problem</a>
  <ul class="collapse">
  <li><a href="#problem" id="toc-problem" class="nav-link" data-scroll-target="#problem">Problem</a></li>
  <li><a href="#impact-of-the-problem" id="toc-impact-of-the-problem" class="nav-link" data-scroll-target="#impact-of-the-problem">Impact of the Problem</a></li>
  <li><a href="#task" id="toc-task" class="nav-link" data-scroll-target="#task">Task</a></li>
  <li><a href="#current-approaches-to-solving-the-problem-today" id="toc-current-approaches-to-solving-the-problem-today" class="nav-link" data-scroll-target="#current-approaches-to-solving-the-problem-today">Current Approaches to Solving the Problem Today</a></li>
  </ul></li>
  <li><a href="#project-client-and-definition-of-objective" id="toc-project-client-and-definition-of-objective" class="nav-link" data-scroll-target="#project-client-and-definition-of-objective">Project Client and Definition of Objective</a>
  <ul class="collapse">
  <li><a href="#business-client" id="toc-business-client" class="nav-link" data-scroll-target="#business-client">Business Client</a></li>
  <li><a href="#project-goal" id="toc-project-goal" class="nav-link" data-scroll-target="#project-goal">Project Goal</a></li>
  </ul></li>
  <li><a href="#actions-that-need-to-be-taken" id="toc-actions-that-need-to-be-taken" class="nav-link" data-scroll-target="#actions-that-need-to-be-taken">Actions that Need to be Taken</a></li>
  <li><a href="#analysis" id="toc-analysis" class="nav-link" data-scroll-target="#analysis">Analysis</a>
  <ul class="collapse">
  <li><a href="#type-of-analysis" id="toc-type-of-analysis" class="nav-link" data-scroll-target="#type-of-analysis">Type of Analysis</a></li>
  <li><a href="#format-of-data" id="toc-format-of-data" class="nav-link" data-scroll-target="#format-of-data">Format of Data</a></li>
  <li><a href="#analysis-workflow-overview" id="toc-analysis-workflow-overview" class="nav-link" data-scroll-target="#analysis-workflow-overview">Analysis Workflow Overview</a></li>
  <li><a href="#timeframes-for-study" id="toc-timeframes-for-study" class="nav-link" data-scroll-target="#timeframes-for-study">Timeframes for Study</a></li>
  <li><a href="#notes" id="toc-notes" class="nav-link" data-scroll-target="#notes">Notes</a></li>
  </ul></li>
  <li><a href="#how-do-actions-follow-from-the-analysis" id="toc-how-do-actions-follow-from-the-analysis" class="nav-link" data-scroll-target="#how-do-actions-follow-from-the-analysis">How do Actions Follow From the Analysis</a></li>
  <li><a href="#validation" id="toc-validation" class="nav-link" data-scroll-target="#validation">Validation</a>
  <ul class="collapse">
  <li><a href="#during-development" id="toc-during-development" class="nav-link" data-scroll-target="#during-development">During Development</a></li>
  <li><a href="#during-production" id="toc-during-production" class="nav-link" data-scroll-target="#during-production">During Production</a></li>
  <li><a href="#differences-between-development-and-production" id="toc-differences-between-development-and-production" class="nav-link" data-scroll-target="#differences-between-development-and-production">Differences between Development and Production</a></li>
  <li><a href="#workflow-in-production" id="toc-workflow-in-production" class="nav-link" data-scroll-target="#workflow-in-production">Workflow in Production</a></li>
  <li><a href="#ml-evaluation-metric" id="toc-ml-evaluation-metric" class="nav-link" data-scroll-target="#ml-evaluation-metric">ML Evaluation Metric</a></li>
  </ul></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#analysis-notebooks" id="toc-analysis-notebooks" class="nav-link" data-scroll-target="#analysis-notebooks">Analysis Notebooks</a></li>
  <li><a href="#limitations" id="toc-limitations" class="nav-link" data-scroll-target="#limitations">Limitations</a>
  <ul class="collapse">
  <li><a href="#business-use-case" id="toc-business-use-case" class="nav-link" data-scroll-target="#business-use-case">Business Use Case</a></li>
  <li><a href="#data-1" id="toc-data-1" class="nav-link" data-scroll-target="#data-1">Data</a></li>
  <li><a href="#others" id="toc-others" class="nav-link" data-scroll-target="#others">Others</a></li>
  </ul></li>
  <li><a href="#assumptions" id="toc-assumptions" class="nav-link" data-scroll-target="#assumptions">Assumptions</a>
  <ul class="collapse">
  <li><a href="#business-use-case-1" id="toc-business-use-case-1" class="nav-link" data-scroll-target="#business-use-case-1">Business Use Case</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/elsdes3/market/edit/main/references/Scope.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/elsdes3/market/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Project Scope</h1>
<p class="subtitle lead">Intended use-case, data, analysis and suggested workflow</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="understanding-the-problem" class="level2">
<h2 class="anchored" data-anchor-id="understanding-the-problem">Understanding the Problem</h2>
<section id="problem" class="level3">
<h3 class="anchored" data-anchor-id="problem">Problem</h3>
<p>The <a href="https://www.googlemerchandisestore.com/">Google Merchandise store</a> is an e-commerce store that sells Google-branded products. Less than 5% of visitors make a purchase from the Google merchandise store on the Google Marketplace. So, a large number of visitors are not making a purchase. They are either just visiting the store once (their first and only visit) and leaving, or visiting multiple times and but not making a purchase on any of those visits. It goes without saying that customers, and not visitors alone, ensure the sustainability of an e-commerce business.</p>
<p>Considerable effort has been made by the web design team to build the store’s website to attract site traffic and make a good impression on first-time visitors to the store. This effort should not go to waste. However, approximately <a href="https://www.optimizely.com/optimization-glossary/online-marketing/">90% of purchases do not happen during an initial visit to an e-commerce website</a>. Furthermore, <a href="https://www.freshlime.com/returning-customers-spend-33-more-than-other-customers/">repeat customers spend 33% more with a brand than new customers do</a>. Only approximately 20% of existing customers account for approximately 80% of future profits. Getting visitors to return to a site is important, but is possibly of equal or greater importance to an e-commerce business to have these visitors make a purchase on a return visit. This underscores the importance of getting visitors to make a purchase on a subsequent visit to the store.</p>
<p>But, it is not just sufficient to ensure return visits occur. This is of no use to a business since they can’t grow customer revenue by relying visitors to return and make purchaes on their own volition. The visitor should be motivated between visits to return and make a purchase on one or more future visits, rather than just returning and browsing through the store as they did during a previous visit. Between August 1, 2016 and August 1, 2017, a little less than 2% of visitors made a purchase on a return visit to the Google merchandise store. One of the main reasons for visitors browsing an e-commerce store, rather than making a purchase, is because they are <a href="https://www.myaccountingcourse.com/accounting-dictionary/comparison-shopping">comparson-shopping</a> across multiple such websites looking for the lowest price for the same or a very similar product.</p>
<p>In summary, it will help the Google Merchandise store grow their customer base and increase revenue if some of these first-time visitors who have</p>
<ol type="1">
<li>not made a purchase during their first visit</li>
<li>made a purchase during their first visit</li>
</ol>
<p>to the store will make a purchase during a subsequent visit. In other words, it is desirable that first-time visitors to the store become customers or repeat customers.</p>
</section>
<section id="impact-of-the-problem" class="level3">
<h3 class="anchored" data-anchor-id="impact-of-the-problem">Impact of the Problem</h3>
<p>If the business can find ways to reach out to (interact with) visitors to the store after their first visit, and provide promotions, shipping offers, etc., then this could be one way to motivate these visitors to make a purchase on a return visit to the store. If the Google merchandise store management company can reach out to these first-time visitors based on the characteristics of their first visit to the store and get them to make a purchase on a return visit then this can not only grow the business’ customer base but also reduce the loss of customer revenue to a competitor.</p>
<p><a href="https://www.investopedia.com/articles/investing/081115/why-google-became-alphabet.asp">Alphabet is the parent company of Google</a>, but <a href="https://www.robertsonmarketing.com/">Robertson Marketing</a> is the company that <a href="https://shop.googlemerchandisestore.com/store-policies/frequently-asked-questions/#aboutrobertson">manages the Google Merchandise store</a>. The management company (Robertson Marketing) is impacted by the problem of low conversions or repeat customers among the pool of first-time visitors to the merchandise store and they would be interested in ways to turn such first-time visitors into one of the following</p>
<ol type="1">
<li>future customers (<a href="https://www.linkedin.com/pulse/visitors-customerswhich-one-do-you-want-cody-jensen">converting visitors into customers</a>, or <a href="https://sherpablog.marketingsherpa.com/marketing/conversion-defined/">conversions</a>)</li>
<li>repeat-customers (<a href="https://www.shopify.com/ca/blog/customer-retention-strategies">customer retention</a>)</li>
</ol>
</section>
<section id="task" class="level3">
<h3 class="anchored" data-anchor-id="task">Task</h3>
<p>The business (store management company, Robertson Marketing) has tasked its marketing team with growing</p>
<ol type="1">
<li>new customers (conversion)</li>
<li>repeat customers (getting customers to become repeat customers)</li>
</ol>
<p>from the pool of first-time visitors to the store.</p>
<p>For obvious reasons, not all first-time visitors to the merchandise store are alike and reaching out to visitors is a costly process. With this mind, the marketing team would like to design an appropriate marketing campaign to help achive the business’ objectives. With a strong preference to spend marketing funds (budget) wisely, the marketing team wants to interact with such first-time visitors through focused and relevant recommendations, reminders and other types of <a href="https://goldpromotion.com/marketing-vs-promotion-guidelines-for-success/">marketing promotions</a> after their first visit to the store.</p>
<p>A logical approach to developing targeted promotions to grow customers or repeat customers is to offer a promotion based on a visitor’s likelihood of making a purchase during a future visit to the merchandise store. Knowing this likelihood is useful in knowing which visitors the marketing team should be focused on and, subsequently, how much funding can be allocated to communicating with those visitors. Accordingly, the business can determine the type of promotion that should be offered. For example, a minimal discount could be offered to visitors with a high likelihood of making a future purchase. Similarly, more loyalty points, coupon giveaways or free shipping could be offered to visitors who are deemed less likely to make a future purchase from the store. These promotions can be offered after a visitor’s first visit to the store with the aim of persuading them to make a purchase during a future visit.</p>
</section>
<section id="current-approaches-to-solving-the-problem-today" class="level3">
<h3 class="anchored" data-anchor-id="current-approaches-to-solving-the-problem-today">Current Approaches to Solving the Problem Today</h3>
<p>Without knowing visitors’ likelihood of making a purchase on a return visit, it is not possible to segment visitors into audience groups (eg. visitors with a high, medium or low likelihood of making a purchase on a return visit) after their first visit. If these groups and cohorts were known, the marketing team could test how they respond to marketing strategies. Naive random guesses at visitor likelihood groupings are costly and unlikely to get buy-in for funding requests from business management. Furthermore, a test and control cohort is needed within each group in order to quantitatively determine how each group responds to the chosen marketing campaign (i.e.&nbsp;these cohorts are needed to evaluate the performance of the campaign).</p>
<p>We will assume that the marketing team has not yet designed any approaches to address this problem. With this in mind, both the size of the audience groups and the size of these cohorts are currently completely unknown.</p>
</section>
</section>
<section id="project-client-and-definition-of-objective" class="level2">
<h2 class="anchored" data-anchor-id="project-client-and-definition-of-objective">Project Client and Definition of Objective</h2>
<section id="business-client" class="level3">
<h3 class="anchored" data-anchor-id="business-client">Business Client</h3>
<p>The client for this project is a marketing team responsible for managing marketing campaigns related to the Google merchandise store.</p>
</section>
<section id="project-goal" class="level3">
<h3 class="anchored" data-anchor-id="project-goal">Project Goal</h3>
<p>This project exists to help the marketing team (client) interact with first-time visitors to the merchandise store, with the hopes of increasing the likelihood that these visitors will make a purchase (convert) or repeat-purchase during a future visit to the store. If this can be done, then it will help the team address the business’ objectives of growing new and repeat customers as mentioned above.</p>
<p>The objective of this project is to increase the number of first-time visitors to the merchandise store who are converted into new or repeat customers.</p>
</section>
</section>
<section id="actions-that-need-to-be-taken" class="level2">
<h2 class="anchored" data-anchor-id="actions-that-need-to-be-taken">Actions that Need to be Taken</h2>
<p>This project will facilitate develpoment of a proactive and targeted marketing strategy (eg. promotions) to grow new and repeat customers.</p>
</section>
<section id="analysis" class="level2">
<h2 class="anchored" data-anchor-id="analysis">Analysis</h2>
<section id="type-of-analysis" class="level3">
<h3 class="anchored" data-anchor-id="type-of-analysis">Type of Analysis</h3>
<p>We need to answer the important question: Which visitors should we prioritize through proactive marketing promotions. In orther words, we want to identify the visitors with a low, medium and high likelihood of making a purchase during a future (or return) visit to the store.</p>
<p>Since we want to intervene before a visitor’s next visit to the store, we would predict the likelihood of every first-time visitor making a purchase during a subsequent visit. These predictions will used to create audience groups based on the likelihood of making a future purchase and prioritize and focus the marketing strategy per group.</p>
<p>The analysis to be performed here is a prediction task. We need to predict the likelihood (or propensity) of a purchase during a future visit.</p>
</section>
<section id="format-of-data" class="level3">
<h3 class="anchored" data-anchor-id="format-of-data">Format of Data</h3>
<p>The analysis will be performed using machine learning (ML). A ML model will be trained using attributes (features) of the visitors’ first visit and it will predict visitors’ propensity to make a purchase on a return visit to the store. The best-performing trained ML model will be the one that can make this prediction with the highest accuracy or some other evaluation metric (this will be discussed later in the <a href="#evaluation-metric">Evaluation Metric</a> sub-section below). This application of ML is called <a href="https://www.expressanalytics.com/blog/propensity-modeling-to-predict-customer-behavior-using-machine-learning/">propensity modeling</a>. The outcome to be predicted is binary (there are only two possible outcomes)</p>
<ol type="1">
<li>the visitor will make a purchase on a return visit</li>
<li>the visitor will not make a purchase on a return visit</li>
</ol>
<p>In a ML context, this is a supervised learning problem. Attributes about the first visit made by visitors to the store site are retrieved from Google Analytics (GA) tracking data accumulated for visitors to the merchandise store. GA tracking code has been embeded in the store’s website in order to anonymously track visitor interactions on the site. These attributes, or characteristics, of visitors’ first visit are the independent variables or features in ML.</p>
<p>For the same visitors, the outcome (or label in ML) of return visits (whether a purchase on a return visit was made or not) is retrieved to determine if a purchase on a future visit was made by this visitor. This label is a forward-looking label since it references events from the future. By comparison, the features are from the past (historical data) since they reference attributes of the visitor’s first visit to the store. Both features and label refer to the same visitor.</p>
</section>
<section id="analysis-workflow-overview" class="level3">
<h3 class="anchored" data-anchor-id="analysis-workflow-overview">Analysis Workflow Overview</h3>
<p>With such a dataset of Google Analytics tracking data available for all visitors to the store between August 1, 2016 and August 1, 2017, a ML model will be trained to predict whether first-time visitors will make a purchase during a future (return) visit. The trained model then predicts probabilities (which are interpreted as likelihoods or propensities) for new visitors to make a purchase on a return (or future) visit to the store. These new visitors were not part of the model’s training data. The predicted probabilities are then used to generate marketing audience groups (low, medium and high propensity) and test (or treatment) and control cohorts within each group as described above.</p>
<p>In summary the steps of such a workflow are</p>
<ol type="1">
<li>train ML model using historical data for first visit of visitors
<ul>
<li>this is the training data</li>
</ul></li>
<li>use trained model to predict probabilities for first visit of visitors that are not part of the training data
<ul>
<li>this is the unseen data</li>
</ul></li>
<li>use predicted probabilities to assign audience cohorts (test or control) to all visitors in the unseen data</li>
<li>build a brief profile of the visitors in the test cohort in unseen data
<ul>
<li>when building a marketing strategy, we are not allowed to look at the control cohort and so the profile will be required for the test cohort only</li>
</ul></li>
<li>provide audience test cohorts and their associated profile summaries to the marketing team</li>
</ol>
</section>
<section id="timeframes-for-study" class="level3">
<h3 class="anchored" data-anchor-id="timeframes-for-study">Timeframes for Study</h3>
<ol type="1">
<li><p>In order to avoid <a href="https://en.wikipedia.org/wiki/Leakage_(machine_learning)">data leakage</a> (or <a href="https://www.investopedia.com/terms/l/lookaheadbias.asp">lookahead bias</a>), the data splits are created in chronological order</p>
<ul>
<li>training data
<ul>
<li>September 1, 2016 to December 31, 2016</li>
</ul></li>
<li>validation data
<ul>
<li>January 1 - 31, 2017</li>
</ul></li>
<li>test data
<ul>
<li>February 1 - 28, 2017</li>
</ul></li>
<li>unseen data
<ul>
<li>March 1 - 31, 2017</li>
</ul></li>
</ul></li>
<li><p>We will assume that</p>
<ul>
<li>the current date is March 1, 2017</li>
<li>ML model development can be performed between March 1 - 31, 2017</li>
</ul></li>
<li><p>The marketing team is interested in growing new and repeat customers from visitors who made their first visit to the store during March 1 - 31, 2017 (unseen data). With this in mind, they want to</p>
<ul>
<li>build their campaign around these visitors</li>
<li>launch their campaign on April 10, 2017</li>
</ul></li>
<li><p>There are two constraints facing the client (marketing team)</p>
<ul>
<li>the first visit data covering this period (unseen data) is only available on March 31, 2017 and this is close to the proposed campaign start date of April 10, 2017</li>
<li>designing a typical marketing campaign takes <a href="https://www.makeitactive.com/faq/marketing-faqs/how-long-does-it-take-to-complete-a-marketing-plan">1</a> - <a href="https://www.mktg-edge.com/how-long-does-it-take-to-create-a-marketing-plan/">12</a> weeks</li>
<li>campaign launch windows occur every month
<ul>
<li>campaigns can be launched on April 10, 2017, May 10, 2017, June 10, 2017, etc.</li>
</ul></li>
</ul>
<p>With this in mind, the marketing team wants to start designing their campaign today (March 1, 2017). They do not want to wait until March 31, 2017 to receive recommended audience cohorts from the data science team and begin their campaign design. So, instead of waiting until March 31, 2017, the marketing team will start their campaign design using the audience cohorts recommended by the data science team using the test data split, which covers February 1 - 28, 2017.</p>
<p>On March 31, 2017, the marketing team will receive the audience cohorts from the data science team for the visits who made their first visit to the store during March 1 - 31, 2017. Between April 1, 2017 and April 9, 2017, the marketing team will start making adjustments to the campaign strategy by using the audience cohorts recommended by the data science team using the unseen data period (covering March 1 - 31, 2017). This will allow the marketing team to meet the proposed campaign start date of April 10, 2017.</p>
<p>If the datascience team is unable to generate a sufficiently accurate ML model to meet the April 10, 2017 campaign launch date then they will need to improve their analysis in order to try to meet the next available launch date (May 10, 2017).</p></li>
</ol>
</section>
<section id="notes" class="level3">
<h3 class="anchored" data-anchor-id="notes">Notes</h3>
<ol type="1">
<li>Regarding ML labels (<code>y</code>)
<ul>
<li>as mentioned earlier, these are forward-looking labels
<ul>
<li>the ML features (<code>X</code>) are attributes of a visitor’s first visit to the store</li>
<li>the ML labels (<code>y</code>) are the outcome (whether a purchase occurred or not) of that same visitor’s future visits to the store
<ul>
<li>a purchase is allowed to occur during any future visit to the store, not just the next visit</li>
</ul></li>
</ul></li>
<li>in the period covering train, validation and test data splits, if a visitor has
<ul>
<li>made at least one purchase of a product during their return visit, then the label is set to <code>True</code> (or 1)</li>
<li>not made at least one purchase of a product during their return visit, then the label is set to <code>False</code> (or 0)</li>
</ul></li>
</ul></li>
<li>The data science team’s recommended audience cohorts (test and control) of visitors will be accepted by the marketing team if the ML model’s performance during evaluation (using the test data split) is better than that of a random model.</li>
</ol>
</section>
</section>
<section id="how-do-actions-follow-from-the-analysis" class="level2">
<h2 class="anchored" data-anchor-id="how-do-actions-follow-from-the-analysis">How do Actions Follow From the Analysis</h2>
<p>Based on visitors’ predicted likelihood of making a purchase on a future visit, marketing audience test and control groups (cohorts) will be created. Each group will contain a visitor ID as well as all the attributes of the visitor’s first visit that were used to predict the likelihood of a purchase during a return visit to the store.</p>
<p>These groups can be used by the marketing team to</p>
<ol type="1">
<li>design appropriate strategies that can be implemented during <a href="https://en.wikipedia.org/wiki/Marketing_activation">activation</a></li>
<li>estimate campaign costs</li>
</ol>
</section>
<section id="validation" class="level2">
<h2 class="anchored" data-anchor-id="validation">Validation</h2>
<section id="during-development" class="level3">
<h3 class="anchored" data-anchor-id="during-development">During Development</h3>
<p>Development covers September 1, 2016 - February 28, 2017.</p>
<p>Since the current date is assumed to be March 1, 2017 and the training, validation and test data splits end no later than February 28, 2017, ML model predictions during validation (using validation split) and evaluation (using test split) can be scored before March 31, 2017.</p>
<p>Scoring is performed using evalaution metrics discussed in the <a href="#ml-evaluation-metric">ML Evaluation Metric</a> sub-section below.</p>
</section>
<section id="during-production" class="level3">
<h3 class="anchored" data-anchor-id="during-production">During Production</h3>
<p>Production covers March 1 - 31, 2017.</p>
<p>The model’s predictions will be scored against the outcome (whether the visitor makes a purchase on their return/future visit to the store) at the end of the marketing campaign.</p>
</section>
<section id="differences-between-development-and-production" class="level3">
<h3 class="anchored" data-anchor-id="differences-between-development-and-production">Differences between Development and Production</h3>
<ol type="1">
<li>During production, the predictions are used to inform a marketing audience cohorts (test and control). By definition, the marketing strategy will be applied to the test cohort. It will not be applied to the control group. With this in mind, during the production period (March 1 - 31, 2017), we can only evaluate the predictions of the trained ML model that are associated with first-time visitors to the store during this period if those visitors are placed in the control cohort.</li>
<li>As mentioned earlier, the marketing team will only accept the data science team’s recommended audiente cohorts if the ML model outperforms a random model. At the same time, the data science team should also be checking for drift between attributes (features) of the first visit using the test split (development) and using the unseen data (production). If drift in features is observed outside a pre-defined threshold, then the data science team will need to repeat
<ul>
<li>ML model training using more training data (earlier start date than September 1, 2016)</li>
<li>evaluation using the test split</li>
<li>evaluation using the unseen data</li>
</ul>
until drift is no longer observed. Feature drift checking will need to be done on April 1, 2017, before marketing audience visitor cohorts are given to the marketing team.</li>
</ol>
</section>
<section id="workflow-in-production" class="level3">
<h3 class="anchored" data-anchor-id="workflow-in-production">Workflow in Production</h3>
<ol type="1">
<li>The trained model will make predictions of probability (propensity or likelihood) for all first-time visitors to the store during March 1 - 31, 2017. Predictions are used to identify marketing audience test (or treatment) and control cohorts.</li>
<li>A marketing strategy is applied to all first-time visitors in the test group</li>
<li>Length of marketing promotion campaign is to be determined by marketing team</li>
<li>At the end of the marketing campaign
<ul>
<li>we will know which visitors who were predicted to make a purchase on a return visit did actually make a purchase</li>
<li>we can evaluate the predictions made by the trained ML model on first visits that occurred during March 1 - 31, 2017</li>
<li>we can calculate a suitable KPI for this project
<ul>
<li>KPI = number of purchases made by visitors in the test cohort - number of purchases made by visitors in the control cohort
<ul>
<li>if this KPI is larger than zero, then we have successfully grown our customer base, which was the objective of the task that the business has given to the marketing team</li>
</ul></li>
<li>additional KPIs can also be considered</li>
</ul></li>
</ul></li>
</ol>
<p>We mentioned that scoring predictions of first visits that occurred during the unseen data period (production) of March 1 - 31, 2017 cannot be performed until the end of the marketing campaign. This was also mentioned in the <a href="#during-production">during production</a> sub-section above. It is worth emphasizing that until the end of the marketing campaign, we are unable to evalute the ML model’s predictions of data during the unseen data period (production). For this reason, it is improtant to check for drift in ML features between the unseen data (March 1 - 31, 2017) and test data (February 1 - 28, 2017) before the predictions are made and the audience cohorts are generated.</p>
<p>Generally, marketing campaigns run for approximately three months but this <a href="https://www.wfsbadvertising.com/blog/what-is-the-length-of-a-successful-marketing-campaign">depends on numerous factors including</a></p>
<ol type="1">
<li>message</li>
<li>call to action (<a href="https://www.investopedia.com/terms/c/call-action-cta.asp">CTA</a>)</li>
<li>funds available (marketing budget)</li>
<li>expectations (desired uplift, etc.)</li>
</ol>
<p>The duration, design and structure of the campaign will be determined by the marketing team starting on March 1, 2017 (today) and it will be finalized between April 1 - 9, 2019. On April 9, 2017, if it is determined that it is not feasible to design a campaign based on the audience cohorts recommended by the data science team (eg. cohorts are too large, etc.) then</p>
<ol type="1">
<li>the next available campaign launch window (May 10, 2017) will have to be targeted</li>
<li>the new unseen data (production) period will cover April 1 - 30, 2017</li>
<li>the datascience team will have to improve ML model performance between April 10 - 30, 2017</li>
</ol>
</section>
<section id="ml-evaluation-metric" class="level3">
<h3 class="anchored" data-anchor-id="ml-evaluation-metric">ML Evaluation Metric</h3>
<p>False negatives (tweets that should have been responded to but were predicted to not need a response) and false positives (tweets that did not need review by a team member but were predicted as requiring a review) are the most important types of errors. So the <a href="https://machinelearningmastery.com/tour-of-evaluation-metrics-for-imbalanced-classification/">candidate metrics to be used to assess ML model performance</a> are</p>
<ol type="1">
<li>F1-score (if false negatives and false positives are equally important)</li>
<li>F2-score (if false negatives are more important)</li>
<li>F0.5-score (if false positives are more important)</li>
</ol>
<p>For the current predicton task, there are two possible outcomes indicate whether a visitor did or did not make a purchase on a return visit to the store and these are</p>
<ol type="1">
<li>actual
<ul>
<li>is the true outcome</li>
<li>this is known after a visitor’s first visit to the store</li>
<li>this indicates that action that the marketing team should have taken</li>
</ul></li>
<li>predicted
<ul>
<li>is the predicted outcome</li>
<li>this is predicted after the visitor’s first visit to the store</li>
<li>this indicates that action that the marketing team was predicted to have taken</li>
</ul></li>
</ol>
<p>The four possible ML prediction scenarios are listed below for the prediction of the outcome [whether a first-time visitor will, or will not, make a purchase on a return (future) visit to the merchandise store]</p>
<ol type="1">
<li>TP: actual = makes purchase on return visit, predicted = makes purchase on return visit
<ul>
<li>predicted marketing strategy matches what should be the actual marketing strategy</li>
</ul></li>
<li>TN: actual = does not make purchase on return visit, predicted = does not make purchase on return visit
<ul>
<li>predicted marketing strategy matches what should be the actual marketing strategy</li>
</ul></li>
<li>FN: actual = makes purchase on return visit, predicted = does not make purchase on return visit
<ul>
<li>predicted marketing strategy
<ul>
<li>predicted to offer minimal promotion</li>
</ul></li>
<li>actual marketing strategy
<ul>
<li>actually should have offered a stronger promotion
<ul>
<li>eg. more loyalty points, more frequent free/shipping, etc.</li>
</ul></li>
</ul></li>
<li>these errors in prediction lead to missed opportunities to correctly target first-time visitors since the predicted promotion offered is an underestimate of the true promotion that the team should have offered to these visitors</li>
<li>these errors lead to underspending on promotions to first-time visitors who are likely to benefit from them</li>
</ul></li>
<li>FP: actual = does not make purchase on return visit, predicted = makes purchase on return visit
<ul>
<li>predicted marketing strategy
<ul>
<li>predicted to offer a stronger promotion</li>
</ul></li>
<li>actual marketing strategy
<ul>
<li>actually should have offered minimal promotion</li>
</ul></li>
<li>these errors lead to overspending on promotions to first-time visitors who are not likely to benefit from them</li>
<li>this is the most expensive type of prediction error</li>
<li>this scenario must be avoided</li>
</ul></li>
</ol>
<p>Since FP (false positives) are more costly than FN (false negatives), the scoring metric chosen to evaluate predictions made using the ML model is <a href="https://machinelearningmastery.com/fbeta-measure-for-machine-learning/">F0.5-score</a>.</p>
</section>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<p>An important factor that is driving propensity modeling in marketing is the need to do more with <a href="https://signal.co/resources/first-party-data/#whydoesitmatter">first-party customer data</a>. This is data that comes directly from the customer and not from third-party sources. For marketing use-cases, effective propensity models use customer attributes from online and offline first-party data sources, including site analytics (online) and CRM (offline) data.</p>
<p>Here, we have access to online data only Google Analytics tracking data (see the <a href="https://console.cloud.google.com/marketplace/product/obfuscated-ga360-data/obfuscated-ga360-data">dataset</a> and its <a href="https://support.google.com/analytics/answer/3437719?hl=en">documentation</a>). This will be used to build a ML model to predict visitors’ propensity to make a purchase during a future visit to the store.</p>
<p>Visit data for the merchandise store is available for the period of August 1, 2016 to August 1, 2017. This data provides information such as</p>
<ol type="1">
<li>visitor ID</li>
<li>visit <code>date</code></li>
<li>vist <code>datetime</code></li>
<li>actions performed during visit
<ul>
<li>add to cart</li>
<li>remove from cart</li>
<li>make purchase</li>
<li>view product details</li>
<li>etc.</li>
</ul></li>
<li>total time spent viewing pages during each visit</li>
<li>etc.</li>
</ol>
</section>
<section id="analysis-notebooks" class="level2">
<h2 class="anchored" data-anchor-id="analysis-notebooks">Analysis Notebooks</h2>
<ol type="1">
<li>Get data and EDA Part 1
<ul>
<li>connect to raw visit data generated by Google Analytics tracking embedded in the merchandise store’s site
<ul>
<li>data is stored as <a href="https://cloud.google.com/bigquery/public-data">Google BigQuery public dataset</a></li>
<li>use Python client to connect to dataset</li>
<li>get overview of the columns in the raw visit data</li>
</ul></li>
<li>understand underlying patterns and stats about the visit-level data</li>
<li>EDA part 1/2</li>
<li><code>01_get_data.ipynb</code></li>
</ul></li>
<li>EDA Part 2
<ul>
<li>EDA part 2/2</li>
<li><code>02_eda.ipynb</code></li>
</ul></li>
<li>Transform data
<ul>
<li><code>03_transform.ipynb</code></li>
<li>extract the first visit per visitor (features, or <code>X</code>) and align with whether they made a purchase on a return (future) visit to the store (labels, or <code>y</code>)</li>
</ul></li>
<li>Baseline model development
<ul>
<li>develop a baseline model to predict probability of purchase during future visit
<ul>
<li>this will be fast to train and will demonstrate the end-to-end project workflow, but will likely be over-simplified and so will underperform relative to a ML-based approach</li>
</ul></li>
<li><code>04_development.ipynb</code></li>
</ul></li>
<li>ML model development
<ul>
<li>repeat baseline model development, but use a ML model instead</li>
<li><code>05_dev_v2.ipynb</code></li>
</ul></li>
</ol>
</section>
<section id="limitations" class="level2">
<h2 class="anchored" data-anchor-id="limitations">Limitations</h2>
<section id="business-use-case" class="level3">
<h3 class="anchored" data-anchor-id="business-use-case">Business Use Case</h3>
<p>The analysis implemented here is only possible if Google Analytics tracking is embedded into an e-commerce website. Guides for embedding GA tracking code are documented below</p>
<ol type="1">
<li><a href="https://chartio.com/learn/marketing-analytics/how-to-add-google-analytics-tracking-to-a-website/">chartio blog post</a></li>
<li><a href="https://support.google.com/analytics/answer/9304153?hl=en">Google Support documentation</a></li>
</ol>
<p>For the current use-case, this was already done for the Google Merchandise store’s website and so valuable tracking data could be collected and used. However, if such a solution is to be adopted for other digital marketplaces, then the Google Analytics tracking code must be embedded into those websites.</p>
</section>
<section id="data-1" class="level3">
<h3 class="anchored" data-anchor-id="data-1">Data</h3>
<ol type="1">
<li>The analytics dataset used in this project is based on a version of <a href="https://marketingplatform.google.com/about/analytics-360/features/">Google Analytics (GA360)</a> that is <a href="https://support.google.com/analytics/answer/11583528?hl=en">deprecated as of July 1 2023 or 2024</a>.</li>
</ol>
</section>
<section id="others" class="level3">
<h3 class="anchored" data-anchor-id="others">Others</h3>
<p>For other limitations, please see the <strong>Limitations</strong> section in each notebook.</p>
</section>
</section>
<section id="assumptions" class="level2">
<h2 class="anchored" data-anchor-id="assumptions">Assumptions</h2>
<section id="business-use-case-1" class="level3">
<h3 class="anchored" data-anchor-id="business-use-case-1">Business Use Case</h3>
<ol type="1">
<li>For visitors who made a purchase on a return visit, we will include those who could have bought on their first as well. These are repeat customers, who we have assumed are one of the two types of visitors that we want to grow. For this reason, we will include their visits in the data.</li>
<li>The marketing team has does not have a preliminary idea as to the size of the audience groups (low, medium, high likelihood or propensity to make a purchase on a return visit) or cohorts and the strategy they will deploy as part of a campaign. As such, they have not yet designed any approaches to address this problem.</li>
<li>Deployment-related assumptions (see point 4. in <a href="#timeframes-for-study">Timeframes for Study</a>)
<ul>
<li>we have assumed that the current date is March 1, 2017</li>
<li>we have assumed that a trained ML model will make predictions for all first-time visitors to the store between March 1 - 31, 2017</li>
</ul></li>
</ol>
<p>For other assumptions, please see the <strong>Assumptions</strong> section in each notebook.</p>


</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp("^(?:http:|https:)\/\/www\.quarto\.org\/custom");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
</div> <!-- /content -->



<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>