[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Machine Learning for Propensity Modeling",
    "section": "",
    "text": "E-Commerce is important since it allows a business to reach customers across a larger footprint than a group of physical (brick-and-mortar) stores. Visitors to an e-commerce store can make a purchase at an time, in any location and in their choice of currency. The ability to attract such a diverse customer base is the main value of e-commerce to a business. While website traffic is a highly-tracked metric by e-commerce businesses, their hard work and efforts to attract visitors to their site should not go to waste. It is customers that every e-commerce site owner needs to sustain their business."
  },
  {
    "objectID": "index.html#welcome",
    "href": "index.html#welcome",
    "title": "Machine Learning for Propensity Modeling",
    "section": "",
    "text": "E-Commerce is important since it allows a business to reach customers across a larger footprint than a group of physical (brick-and-mortar) stores. Visitors to an e-commerce store can make a purchase at an time, in any location and in their choice of currency. The ability to attract such a diverse customer base is the main value of e-commerce to a business. While website traffic is a highly-tracked metric by e-commerce businesses, their hard work and efforts to attract visitors to their site should not go to waste. It is customers that every e-commerce site owner needs to sustain their business."
  },
  {
    "objectID": "index.html#problem-with-visitors-to-an-e-commerce-store",
    "href": "index.html#problem-with-visitors-to-an-e-commerce-store",
    "title": "Machine Learning for Propensity Modeling",
    "section": "Problem with Visitors to an E-Commerce Store",
    "text": "Problem with Visitors to an E-Commerce Store\nThe majority of visitors to an e-commerce site leave without performing a transaction (making a purchase) on their first visit. In the case of the the Google merchandise store’s site, the fraction of such visitors leaving is greater than 95%. Industry research shows that the majority of purchases by a visitor to such a site don’t occur on the visitor’s first visit. If they do purchase, then more often than not they will return later and make a purchase."
  },
  {
    "objectID": "index.html#why-market-to-return-users",
    "href": "index.html#why-market-to-return-users",
    "title": "Machine Learning for Propensity Modeling",
    "section": "Why Market to Return Users?",
    "text": "Why Market to Return Users?\nBeing able to identify such high-value visitors ahead of time can be of tremendous help to a marketing team to develop campaigns to grow the number of first-time visitors who make a purchase (converters) or a return purchase (repeat customers).\nThe marketing team can design and deploy a campaign after visitors’ first visit to improve their chances of making a purchase on a future visit."
  },
  {
    "objectID": "index.html#why-machine-learning",
    "href": "index.html#why-machine-learning",
    "title": "Machine Learning for Propensity Modeling",
    "section": "Why Machine Learning?",
    "text": "Why Machine Learning?\nThrough the use of machine learning (ML), we can scale this approach to capture all first-time visitors to the store and also improve their likelihood (or propensity) to make a future purchase while they search on a competitor’s site for the same or a similar product. Doing so is one way to help grow the base of converters and repeat customers."
  },
  {
    "objectID": "index.html#who-is-the-business-client",
    "href": "index.html#who-is-the-business-client",
    "title": "Machine Learning for Propensity Modeling",
    "section": "Who is the Business Client?",
    "text": "Who is the Business Client?\nThis project would be directly useful to Robertson Marketing, who is responsible for management of the Google merchandise store."
  },
  {
    "objectID": "index.html#what-is-this-project-about",
    "href": "index.html#what-is-this-project-about",
    "title": "Machine Learning for Propensity Modeling",
    "section": "What is This Project About?",
    "text": "What is This Project About?\nIn this project, ML predictions are used to select a marketing audience with a low, medium and high propensity to make a purchase on a return visit. Within each group, we also develop and briefly profile test (or treatment) and control cohorts in order to help facilitate deployment of a marketing campaign."
  },
  {
    "objectID": "references/Scope.html",
    "href": "references/Scope.html",
    "title": "Project Scope",
    "section": "",
    "text": "The Google Merchandise store is an e-commerce store that sells Google-branded products. Less than 5% of visitors make a purchase from the Google merchandise store on the Google Marketplace. So, a large number of visitors are not making a purchase. They are either just visiting the store once (their first and only visit) and leaving, or visiting multiple times and but not making a purchase on any of those visits. It goes without saying that customers, and not visitors alone, ensure the sustainability of an e-commerce business.\nConsiderable effort has been made by the web design team to build the store’s website to attract site traffic and make a good impression on first-time visitors to the store. This effort should not go to waste. However, approximately 90% of purchases do not happen during an initial visit to an e-commerce website. Furthermore, repeat customers spend 33% more with a brand than new customers do. Only approximately 20% of existing customers account for approximately 80% of future profits. Getting visitors to return to a site is important, but is possibly of equal or greater importance to an e-commerce business to have these visitors make a purchase on a return visit. This underscores the importance of getting visitors to make a purchase on a subsequent visit to the store.\nBut, it is not just sufficient to ensure return visits occur. This is of no use to a business since they can’t grow customer revenue by relying visitors to return and make purchaes on their own volition. The visitor should be motivated between visits to return and make a purchase on one or more future visits, rather than just returning and browsing through the store as they did during a previous visit. Between August 1, 2016 and August 1, 2017, a little less than 2% of visitors made a purchase on a return visit to the Google merchandise store. One of the main reasons for visitors browsing an e-commerce store, rather than making a purchase, is because they are comparson-shopping across multiple such websites looking for the lowest price for the same or a very similar product.\nIn summary, it will help the Google Merchandise store grow their customer base and increase revenue if some of these first-time visitors who have\n\nnot made a purchase during their first visit\nmade a purchase during their first visit\n\nto the store will make a purchase during a subsequent visit. In other words, it is desirable that first-time visitors to the store become customers or repeat customers.\n\n\n\nIf the business can find ways to reach out to (interact with) visitors to the store after their first visit, and provide promotions, shipping offers, etc., then this could be one way to motivate these visitors to make a purchase on a return visit to the store. If the Google merchandise store management company can reach out to these first-time visitors based on the characteristics of their first visit to the store and get them to make a purchase on a return visit then this can not only grow the business’ customer base but also reduce the loss of customer revenue to a competitor.\nAlphabet is the parent company of Google, but Robertson Marketing is the company that manages the Google Merchandise store. The management company (Robertson Marketing) is impacted by the problem of low conversions or repeat customers among the pool of first-time visitors to the merchandise store and they would be interested in ways to turn such first-time visitors into one of the following\n\nfuture customers (converting visitors into customers, or conversions)\nrepeat-customers (customer retention)\n\n\n\n\nThe business (store management company, Robertson Marketing) has tasked its marketing team with growing\n\nnew customers (conversion)\nrepeat customers (getting customers to become repeat customers)\n\nfrom the pool of first-time visitors to the store.\nFor obvious reasons, not all first-time visitors to the merchandise store are alike and reaching out to visitors is a costly process. With this mind, the marketing team would like to design an appropriate marketing campaign to help achive the business’ objectives. With a strong preference to spend marketing funds (budget) wisely, the marketing team wants to interact with such first-time visitors through focused and relevant recommendations, reminders and other types of marketing promotions after their first visit to the store.\nA logical approach to developing targeted promotions to grow customers or repeat customers is to offer a promotion based on a visitor’s likelihood of making a purchase during a future visit to the merchandise store. Knowing this likelihood is useful in knowing which visitors the marketing team should be focused on and, subsequently, how much funding can be allocated to communicating with those visitors. Accordingly, the business can determine the type of promotion that should be offered. For example, a minimal discount could be offered to visitors with a high likelihood of making a future purchase. Similarly, more loyalty points, coupon giveaways or free shipping could be offered to visitors who are deemed less likely to make a future purchase from the store. These promotions can be offered after a visitor’s first visit to the store with the aim of persuading them to make a purchase during a future visit.\n\n\n\nWithout knowing visitors’ likelihood of making a purchase on a return visit, it is not possible to segment visitors into audience groups (eg. visitors with a high, medium or low likelihood of making a purchase on a return visit) after their first visit. If these groups and cohorts were known, the marketing team could test how they respond to marketing strategies. Naive random guesses at visitor likelihood groupings are costly and unlikely to get buy-in for funding requests from business management. Furthermore, a test and control cohort is needed within each group in order to quantitatively determine how each group responds to the chosen marketing campaign (i.e. these cohorts are needed to evaluate the performance of the campaign).\nWe will assume that the marketing team has not yet designed any approaches to address this problem. With this in mind, both the size of the audience groups and the size of these cohorts are currently completely unknown."
  },
  {
    "objectID": "references/Scope.html#understanding-the-problem",
    "href": "references/Scope.html#understanding-the-problem",
    "title": "Project Scope",
    "section": "",
    "text": "The Google Merchandise store is an e-commerce store that sells Google-branded products. Less than 5% of visitors make a purchase from the Google merchandise store on the Google Marketplace. So, a large number of visitors are not making a purchase. They are either just visiting the store once (their first and only visit) and leaving, or visiting multiple times and but not making a purchase on any of those visits. It goes without saying that customers, and not visitors alone, ensure the sustainability of an e-commerce business.\nConsiderable effort has been made by the web design team to build the store’s website to attract site traffic and make a good impression on first-time visitors to the store. This effort should not go to waste. However, approximately 90% of purchases do not happen during an initial visit to an e-commerce website. Furthermore, repeat customers spend 33% more with a brand than new customers do. Only approximately 20% of existing customers account for approximately 80% of future profits. Getting visitors to return to a site is important, but is possibly of equal or greater importance to an e-commerce business to have these visitors make a purchase on a return visit. This underscores the importance of getting visitors to make a purchase on a subsequent visit to the store.\nBut, it is not just sufficient to ensure return visits occur. This is of no use to a business since they can’t grow customer revenue by relying visitors to return and make purchaes on their own volition. The visitor should be motivated between visits to return and make a purchase on one or more future visits, rather than just returning and browsing through the store as they did during a previous visit. Between August 1, 2016 and August 1, 2017, a little less than 2% of visitors made a purchase on a return visit to the Google merchandise store. One of the main reasons for visitors browsing an e-commerce store, rather than making a purchase, is because they are comparson-shopping across multiple such websites looking for the lowest price for the same or a very similar product.\nIn summary, it will help the Google Merchandise store grow their customer base and increase revenue if some of these first-time visitors who have\n\nnot made a purchase during their first visit\nmade a purchase during their first visit\n\nto the store will make a purchase during a subsequent visit. In other words, it is desirable that first-time visitors to the store become customers or repeat customers.\n\n\n\nIf the business can find ways to reach out to (interact with) visitors to the store after their first visit, and provide promotions, shipping offers, etc., then this could be one way to motivate these visitors to make a purchase on a return visit to the store. If the Google merchandise store management company can reach out to these first-time visitors based on the characteristics of their first visit to the store and get them to make a purchase on a return visit then this can not only grow the business’ customer base but also reduce the loss of customer revenue to a competitor.\nAlphabet is the parent company of Google, but Robertson Marketing is the company that manages the Google Merchandise store. The management company (Robertson Marketing) is impacted by the problem of low conversions or repeat customers among the pool of first-time visitors to the merchandise store and they would be interested in ways to turn such first-time visitors into one of the following\n\nfuture customers (converting visitors into customers, or conversions)\nrepeat-customers (customer retention)\n\n\n\n\nThe business (store management company, Robertson Marketing) has tasked its marketing team with growing\n\nnew customers (conversion)\nrepeat customers (getting customers to become repeat customers)\n\nfrom the pool of first-time visitors to the store.\nFor obvious reasons, not all first-time visitors to the merchandise store are alike and reaching out to visitors is a costly process. With this mind, the marketing team would like to design an appropriate marketing campaign to help achive the business’ objectives. With a strong preference to spend marketing funds (budget) wisely, the marketing team wants to interact with such first-time visitors through focused and relevant recommendations, reminders and other types of marketing promotions after their first visit to the store.\nA logical approach to developing targeted promotions to grow customers or repeat customers is to offer a promotion based on a visitor’s likelihood of making a purchase during a future visit to the merchandise store. Knowing this likelihood is useful in knowing which visitors the marketing team should be focused on and, subsequently, how much funding can be allocated to communicating with those visitors. Accordingly, the business can determine the type of promotion that should be offered. For example, a minimal discount could be offered to visitors with a high likelihood of making a future purchase. Similarly, more loyalty points, coupon giveaways or free shipping could be offered to visitors who are deemed less likely to make a future purchase from the store. These promotions can be offered after a visitor’s first visit to the store with the aim of persuading them to make a purchase during a future visit.\n\n\n\nWithout knowing visitors’ likelihood of making a purchase on a return visit, it is not possible to segment visitors into audience groups (eg. visitors with a high, medium or low likelihood of making a purchase on a return visit) after their first visit. If these groups and cohorts were known, the marketing team could test how they respond to marketing strategies. Naive random guesses at visitor likelihood groupings are costly and unlikely to get buy-in for funding requests from business management. Furthermore, a test and control cohort is needed within each group in order to quantitatively determine how each group responds to the chosen marketing campaign (i.e. these cohorts are needed to evaluate the performance of the campaign).\nWe will assume that the marketing team has not yet designed any approaches to address this problem. With this in mind, both the size of the audience groups and the size of these cohorts are currently completely unknown."
  },
  {
    "objectID": "references/Scope.html#project-client-and-definition-of-objective",
    "href": "references/Scope.html#project-client-and-definition-of-objective",
    "title": "Project Scope",
    "section": "Project Client and Definition of Objective",
    "text": "Project Client and Definition of Objective\n\nBusiness Client\nThe client for this project is a marketing team responsible for managing marketing campaigns related to the Google merchandise store.\n\n\nProject Goal\nThis project exists to help the marketing team (client) interact with first-time visitors to the merchandise store, with the hopes of increasing the likelihood that these visitors will make a purchase (convert) or repeat-purchase during a future visit to the store. If this can be done, then it will help the team address the business’ objectives of growing new and repeat customers as mentioned above.\nThe objective of this project is to increase the number of first-time visitors to the merchandise store who are converted into new or repeat customers."
  },
  {
    "objectID": "references/Scope.html#actions-that-need-to-be-taken",
    "href": "references/Scope.html#actions-that-need-to-be-taken",
    "title": "Project Scope",
    "section": "Actions that Need to be Taken",
    "text": "Actions that Need to be Taken\nThis project will facilitate develpoment of a proactive and targeted marketing strategy (eg. promotions) to grow new and repeat customers."
  },
  {
    "objectID": "references/Scope.html#analysis",
    "href": "references/Scope.html#analysis",
    "title": "Project Scope",
    "section": "Analysis",
    "text": "Analysis\n\nType of Analysis\nWe need to answer the important question: Which visitors should we prioritize through proactive marketing promotions. In orther words, we want to identify the visitors with a low, medium and high likelihood of making a purchase during a future (or return) visit to the store.\nSince we want to intervene before a visitor’s next visit to the store, we would predict the likelihood of every first-time visitor making a purchase during a subsequent visit. These predictions will used to create audience groups based on the likelihood of making a future purchase and prioritize and focus the marketing strategy per group.\nThe analysis to be performed here is a prediction task. We need to predict the likelihood (or propensity) of a purchase during a future visit.\n\n\nFormat of Data\nThe analysis will be performed using machine learning (ML). A ML model will be trained using attributes (features) of the visitors’ first visit and it will predict visitors’ propensity to make a purchase on a return visit to the store. The best-performing trained ML model will be the one that can make this prediction with the highest accuracy or some other evaluation metric (this will be discussed later in the Evaluation Metric sub-section below). This application of ML is called propensity modeling. The outcome to be predicted is binary (there are only two possible outcomes)\n\nthe visitor will make a purchase on a return visit\nthe visitor will not make a purchase on a return visit\n\nIn a ML context, this is a supervised learning problem. Attributes about the first visit made by visitors to the store site are retrieved from Google Analytics (GA) tracking data accumulated for visitors to the merchandise store. GA tracking code has been embeded in the store’s website in order to anonymously track visitor interactions on the site. These attributes, or characteristics, of visitors’ first visit are the independent variables or features in ML.\nFor the same visitors, the outcome (or label in ML) of return visits (whether a purchase on a return visit was made or not) is retrieved to determine if a purchase on a future visit was made by this visitor. This label is a forward-looking label since it references events from the future. By comparison, the features are from the past (historical data) since they reference attributes of the visitor’s first visit to the store. Both features and label refer to the same visitor.\n\n\nAnalysis Workflow Overview\nWith such a dataset of Google Analytics tracking data available for all visitors to the store between August 1, 2016 and August 1, 2017, a ML model will be trained to predict whether first-time visitors will make a purchase during a future (return) visit. The trained model then predicts probabilities (which are interpreted as likelihoods or propensities) for new visitors to make a purchase on a return (or future) visit to the store. These new visitors were not part of the model’s training data. The predicted probabilities are then used to generate marketing audience groups (low, medium and high propensity) and test (or treatment) and control cohorts within each group as described above.\nIn summary the steps of such a workflow are\n\ntrain ML model using historical data for first visit of visitors\n\nthis is the training data\n\nuse trained model to predict probabilities for first visit of visitors that are not part of the training data\n\nthis is the unseen data\n\nuse predicted probabilities to assign audience cohorts (test or control) to all visitors in the unseen data\nbuild a brief profile of the visitors in the test cohort in unseen data\n\nwhen building a marketing strategy, we are not allowed to look at the control cohort and so the profile will be required for the test cohort only\n\nprovide audience test cohorts and their associated profile summaries to the marketing team\n\n\n\nTimeframes for Study\n\nIn order to avoid data leakage (or lookahead bias), the data splits are created in chronological order\n\ntraining data\n\nSeptember 1, 2016 to December 31, 2016\n\nvalidation data\n\nJanuary 1 - 31, 2017\n\ntest data\n\nFebruary 1 - 28, 2017\n\nunseen data\n\nMarch 1 - 31, 2017\n\n\nWe will assume that\n\nthe current date is March 1, 2017\nML model development can be performed between March 1 - 31, 2017\n\nThe marketing team is interested in growing new and repeat customers from visitors who made their first visit to the store during March 1 - 31, 2017 (unseen data). With this in mind, they want to\n\nbuild their campaign around these visitors\nlaunch their campaign on April 10, 2017\n\nThere are two constraints facing the client (marketing team)\n\nthe first visit data covering this period (unseen data) is only available on March 31, 2017 and this is close to the proposed campaign start date of April 10, 2017\ndesigning a typical marketing campaign takes 1 - 12 weeks\ncampaign launch windows occur every month\n\ncampaigns can be launched on April 10, 2017, May 10, 2017, June 10, 2017, etc.\n\n\nWith this in mind, the marketing team wants to start designing their campaign today (March 1, 2017). They do not want to wait until March 31, 2017 to receive recommended audience cohorts from the data science team and begin their campaign design. So, instead of waiting until March 31, 2017, the marketing team will start their campaign design using the audience cohorts recommended by the data science team using the test data split, which covers February 1 - 28, 2017.\nOn March 31, 2017, the marketing team will receive the audience cohorts from the data science team for the visits who made their first visit to the store during March 1 - 31, 2017. Between April 1, 2017 and April 9, 2017, the marketing team will start making adjustments to the campaign strategy by using the audience cohorts recommended by the data science team using the unseen data period (covering March 1 - 31, 2017). This will allow the marketing team to meet the proposed campaign start date of April 10, 2017.\nIf the datascience team is unable to generate a sufficiently accurate ML model to meet the April 10, 2017 campaign launch date then they will need to improve their analysis in order to try to meet the next available launch date (May 10, 2017).\n\n\n\nNotes\n\nRegarding ML labels (y)\n\nas mentioned earlier, these are forward-looking labels\n\nthe ML features (X) are attributes of a visitor’s first visit to the store\nthe ML labels (y) are the outcome (whether a purchase occurred or not) of that same visitor’s future visits to the store\n\na purchase is allowed to occur during any future visit to the store, not just the next visit\n\n\nin the period covering train, validation and test data splits, if a visitor has\n\nmade at least one purchase of a product during their return visit, then the label is set to True (or 1)\nnot made at least one purchase of a product during their return visit, then the label is set to False (or 0)\n\n\nThe data science team’s recommended audience cohorts (test and control) of visitors will be accepted by the marketing team if the ML model’s performance during evaluation (using the test data split) is better than that of a random model."
  },
  {
    "objectID": "references/Scope.html#how-do-actions-follow-from-the-analysis",
    "href": "references/Scope.html#how-do-actions-follow-from-the-analysis",
    "title": "Project Scope",
    "section": "How do Actions Follow From the Analysis",
    "text": "How do Actions Follow From the Analysis\nBased on visitors’ predicted likelihood of making a purchase on a future visit, marketing audience test and control groups (cohorts) will be created. Each group will contain a visitor ID as well as all the attributes of the visitor’s first visit that were used to predict the likelihood of a purchase during a return visit to the store.\nThese groups can be used by the marketing team to\n\ndesign appropriate strategies that can be implemented during activation\nestimate campaign costs"
  },
  {
    "objectID": "references/Scope.html#validation",
    "href": "references/Scope.html#validation",
    "title": "Project Scope",
    "section": "Validation",
    "text": "Validation\n\nDuring Development\nDevelopment covers September 1, 2016 - February 28, 2017.\nSince the current date is assumed to be March 1, 2017 and the training, validation and test data splits end no later than February 28, 2017, ML model predictions during validation (using validation split) and evaluation (using test split) can be scored before March 31, 2017.\nScoring is performed using evalaution metrics discussed in the ML Evaluation Metric sub-section below.\n\n\nDuring Production\nProduction covers March 1 - 31, 2017.\nThe model’s predictions will be scored against the outcome (whether the visitor makes a purchase on their return/future visit to the store) at the end of the marketing campaign.\n\n\nDifferences between Development and Production\n\nDuring production, the predictions are used to inform a marketing audience cohorts (test and control). By definition, the marketing strategy will be applied to the test cohort. It will not be applied to the control group. With this in mind, during the production period (March 1 - 31, 2017), we can only evaluate the predictions of the trained ML model that are associated with first-time visitors to the store during this period if those visitors are placed in the control cohort.\nAs mentioned earlier, the marketing team will only accept the data science team’s recommended audiente cohorts if the ML model outperforms a random model. At the same time, the data science team should also be checking for drift between attributes (features) of the first visit using the test split (development) and using the unseen data (production). If drift in features is observed outside a pre-defined threshold, then the data science team will need to repeat\n\nML model training using more training data (earlier start date than September 1, 2016)\nevaluation using the test split\nevaluation using the unseen data\n\nuntil drift is no longer observed. Feature drift checking will need to be done on April 1, 2017, before marketing audience visitor cohorts are given to the marketing team.\n\n\n\nWorkflow in Production\n\nThe trained model will make predictions of probability (propensity or likelihood) for all first-time visitors to the store during March 1 - 31, 2017. Predictions are used to identify marketing audience test (or treatment) and control cohorts.\nA marketing strategy is applied to all first-time visitors in the test group\nLength of marketing promotion campaign is to be determined by marketing team\nAt the end of the marketing campaign\n\nwe will know which visitors who were predicted to make a purchase on a return visit did actually make a purchase\nwe can evaluate the predictions made by the trained ML model on first visits that occurred during March 1 - 31, 2017\nwe can calculate a suitable KPI for this project\n\nKPI = number of purchases made by visitors in the test cohort - number of purchases made by visitors in the control cohort\n\nif this KPI is larger than zero, then we have successfully grown our customer base, which was the objective of the task that the business has given to the marketing team\n\nadditional KPIs can also be considered\n\n\n\nWe mentioned that scoring predictions of first visits that occurred during the unseen data period (production) of March 1 - 31, 2017 cannot be performed until the end of the marketing campaign. This was also mentioned in the during production sub-section above. It is worth emphasizing that until the end of the marketing campaign, we are unable to evalute the ML model’s predictions of data during the unseen data period (production). For this reason, it is improtant to check for drift in ML features between the unseen data (March 1 - 31, 2017) and test data (February 1 - 28, 2017) before the predictions are made and the audience cohorts are generated.\nGenerally, marketing campaigns run for approximately three months but this depends on numerous factors including\n\nmessage\ncall to action (CTA)\nfunds available (marketing budget)\nexpectations (desired uplift, etc.)\n\nThe duration, design and structure of the campaign will be determined by the marketing team starting on March 1, 2017 (today) and it will be finalized between April 1 - 9, 2019. On April 9, 2017, if it is determined that it is not feasible to design a campaign based on the audience cohorts recommended by the data science team (eg. cohorts are too large, etc.) then\n\nthe next available campaign launch window (May 10, 2017) will have to be targeted\nthe new unseen data (production) period will cover April 1 - 30, 2017\nthe datascience team will have to improve ML model performance between April 10 - 30, 2017\n\n\n\nML Evaluation Metric\nFalse negatives (tweets that should have been responded to but were predicted to not need a response) and false positives (tweets that did not need review by a team member but were predicted as requiring a review) are the most important types of errors. So the candidate metrics to be used to assess ML model performance are\n\nF1-score (if false negatives and false positives are equally important)\nF2-score (if false negatives are more important)\nF0.5-score (if false positives are more important)\n\nFor the current predicton task, there are two possible outcomes indicate whether a visitor did or did not make a purchase on a return visit to the store and these are\n\nactual\n\nis the true outcome\nthis is known after a visitor’s first visit to the store\nthis indicates that action that the marketing team should have taken\n\npredicted\n\nis the predicted outcome\nthis is predicted after the visitor’s first visit to the store\nthis indicates that action that the marketing team was predicted to have taken\n\n\nThe four possible ML prediction scenarios are listed below for the prediction of the outcome [whether a first-time visitor will, or will not, make a purchase on a return (future) visit to the merchandise store]\n\nTP: actual = makes purchase on return visit, predicted = makes purchase on return visit\n\npredicted marketing strategy matches what should be the actual marketing strategy\n\nTN: actual = does not make purchase on return visit, predicted = does not make purchase on return visit\n\npredicted marketing strategy matches what should be the actual marketing strategy\n\nFN: actual = makes purchase on return visit, predicted = does not make purchase on return visit\n\npredicted marketing strategy\n\npredicted to offer minimal promotion\n\nactual marketing strategy\n\nactually should have offered a stronger promotion\n\neg. more loyalty points, more frequent free/shipping, etc.\n\n\nthese errors in prediction lead to missed opportunities to correctly target first-time visitors since the predicted promotion offered is an underestimate of the true promotion that the team should have offered to these visitors\nthese errors lead to underspending on promotions to first-time visitors who are likely to benefit from them\n\nFP: actual = does not make purchase on return visit, predicted = makes purchase on return visit\n\npredicted marketing strategy\n\npredicted to offer a stronger promotion\n\nactual marketing strategy\n\nactually should have offered minimal promotion\n\nthese errors lead to overspending on promotions to first-time visitors who are not likely to benefit from them\nthis is the most expensive type of prediction error\nthis scenario must be avoided\n\n\nSince FP (false positives) are more costly than FN (false negatives), the scoring metric chosen to evaluate predictions made using the ML model is F0.5-score."
  },
  {
    "objectID": "references/Scope.html#data",
    "href": "references/Scope.html#data",
    "title": "Project Scope",
    "section": "Data",
    "text": "Data\nAn important factor that is driving propensity modeling in marketing is the need to do more with first-party customer data. This is data that comes directly from the customer and not from third-party sources. For marketing use-cases, effective propensity models use customer attributes from online and offline first-party data sources, including site analytics (online) and CRM (offline) data.\nHere, we have access to online data only Google Analytics tracking data (see the dataset and its documentation). This will be used to build a ML model to predict visitors’ propensity to make a purchase during a future visit to the store.\nVisit data for the merchandise store is available for the period of August 1, 2016 to August 1, 2017. This data provides information such as\n\nvisitor ID\nvisit date\nvist datetime\nactions performed during visit\n\nadd to cart\nremove from cart\nmake purchase\nview product details\netc.\n\ntotal time spent viewing pages during each visit\netc."
  },
  {
    "objectID": "references/Scope.html#analysis-notebooks",
    "href": "references/Scope.html#analysis-notebooks",
    "title": "Project Scope",
    "section": "Analysis Notebooks",
    "text": "Analysis Notebooks\n\nGet data and EDA Part 1\n\nconnect to raw visit data generated by Google Analytics tracking embedded in the merchandise store’s site\n\ndata is stored as Google BigQuery public dataset\nuse Python client to connect to dataset\nget overview of the columns in the raw visit data\n\nunderstand underlying patterns and stats about the visit-level data\nEDA part 1/2\n01_get_data.ipynb\n\nEDA Part 2\n\nEDA part 2/2\n02_eda.ipynb\n\nTransform data\n\n03_transform.ipynb\nextract the first visit per visitor (features, or X) and align with whether they made a purchase on a return (future) visit to the store (labels, or y)\n\nBaseline model development\n\ndevelop a baseline model to predict probability of purchase during future visit\n\nthis will be fast to train and will demonstrate the end-to-end project workflow, but will likely be over-simplified and so will underperform relative to a ML-based approach\n\n04_development.ipynb\n\nML model development\n\nrepeat baseline model development, but use a ML model instead\n05_dev_v2.ipynb"
  },
  {
    "objectID": "references/Scope.html#limitations",
    "href": "references/Scope.html#limitations",
    "title": "Project Scope",
    "section": "Limitations",
    "text": "Limitations\n\nBusiness Use Case\nThe analysis implemented here is only possible if Google Analytics tracking is embedded into an e-commerce website. Guides for embedding GA tracking code are documented below\n\nchartio blog post\nGoogle Support documentation\n\nFor the current use-case, this was already done for the Google Merchandise store’s website and so valuable tracking data could be collected and used. However, if such a solution is to be adopted for other digital marketplaces, then the Google Analytics tracking code must be embedded into those websites.\n\n\nData\n\nThe analytics dataset used in this project is based on a version of Google Analytics (GA360) that is deprecated as of July 1 2023 or 2024.\n\n\n\nOthers\nFor other limitations, please see the Limitations section in each notebook."
  },
  {
    "objectID": "references/Scope.html#assumptions",
    "href": "references/Scope.html#assumptions",
    "title": "Project Scope",
    "section": "Assumptions",
    "text": "Assumptions\n\nBusiness Use Case\n\nFor visitors who made a purchase on a return visit, we will include those who could have bought on their first as well. These are repeat customers, who we have assumed are one of the two types of visitors that we want to grow. For this reason, we will include their visits in the data.\nThe marketing team has does not have a preliminary idea as to the size of the audience groups (low, medium, high likelihood or propensity to make a purchase on a return visit) or cohorts and the strategy they will deploy as part of a campaign. As such, they have not yet designed any approaches to address this problem.\nDeployment-related assumptions (see point 4. in Timeframes for Study)\n\nwe have assumed that the current date is March 1, 2017\nwe have assumed that a trained ML model will make predictions for all first-time visitors to the store between March 1 - 31, 2017\n\n\nFor other assumptions, please see the Assumptions section in each notebook."
  },
  {
    "objectID": "notebooks/02-train/notebooks/03_explore_raw_data.html",
    "href": "notebooks/02-train/notebooks/03_explore_raw_data.html",
    "title": "Explore Google Analytics Tracking Data",
    "section": "",
    "text": "Import necessary Python modules\nGet relative path to project root directory\nImport custom Python modules"
  },
  {
    "objectID": "notebooks/02-train/notebooks/03_explore_raw_data.html#about",
    "href": "notebooks/02-train/notebooks/03_explore_raw_data.html#about",
    "title": "Explore Google Analytics Tracking Data",
    "section": "About",
    "text": "About\nThis step explores the raw Google Analytics (GA 360) tracking data in order to build up a BigQuery SQL query that returns - attributes of the first visit to the store - whether a purchase was made during a return visit to the store\nBigQuery SQL is used to retrieve the following 1. how to extract the outcome of return visits - this is the label for machine learning 2. how to extract the number of products in a product list that were - viewed - clicked 3. etc."
  },
  {
    "objectID": "notebooks/02-train/notebooks/03_explore_raw_data.html#user-inputs",
    "href": "notebooks/02-train/notebooks/03_explore_raw_data.html#user-inputs",
    "title": "Explore Google Analytics Tracking Data",
    "section": "User Inputs",
    "text": "User Inputs\nDefine the following\n\nstart and end dates for train and test data to explore return visits\nend dates for train and test data to explore clickthrough rate by product and visitor\nlist of visit attributes that define a unique visit"
  },
  {
    "objectID": "notebooks/02-train/notebooks/03_explore_raw_data.html#authenticate-to-bigquery",
    "href": "notebooks/02-train/notebooks/03_explore_raw_data.html#authenticate-to-bigquery",
    "title": "Explore Google Analytics Tracking Data",
    "section": "Authenticate to BigQuery",
    "text": "Authenticate to BigQuery"
  },
  {
    "objectID": "notebooks/02-train/notebooks/03_explore_raw_data.html#explore-google-analytics-tracking-data",
    "href": "notebooks/02-train/notebooks/03_explore_raw_data.html#explore-google-analytics-tracking-data",
    "title": "Explore Google Analytics Tracking Data",
    "section": "Explore Google Analytics Tracking Data",
    "text": "Explore Google Analytics Tracking Data\n\nGet Return Visit Outcome\nGet the outcome of all return visits during September 2016\n\n\nQuery execution start time = 2023-07-02 12:43:55.233...done at 2023-07-02 12:43:58.086 (2.853 seconds).\nQuery returned 28,013 rows\nCPU times: user 612 ms, sys: 34.4 ms, total: 646 ms\nWall time: 2.86 s\n\n\n\n\n\n\n\n\n\nfullvisitorid\nvisitId\nvisitNumber\nvisitStartTime\nmade_purchase_on_future_visit\n\n\n\n\n0\n0000093957001069502\n1474985724\n1\n2016-09-27 07:15:24\nFalse\n\n\n1\n0000245437374675368\n1472862842\n1\n2016-09-02 17:34:02\nFalse\n\n\n2\n0000639845445148063\n1473694653\n1\n2016-09-12 08:37:33\nFalse\n\n\n3\n000139156957304532\n1473013369\n1\n2016-09-04 11:22:49\nFalse\n\n\n4\n0001601342180848204\n1474930306\n1\n2016-09-26 15:51:46\nFalse\n\n\n\n\n\n\n\nGet visitors who made multiple return visits\n\n\n\n\n\n\n\n\n\nfullvisitorid\nvisitId\nvisitNumber\nvisitStartTime\nmade_purchase_on_future_visit\n\n\n\n\n12\n0005884918507288420\n1474464720\n1\n2016-09-21 06:32:00\nFalse\n\n\n13\n0005884918507288420\n1474469723\n2\n2016-09-21 07:55:23\nFalse\n\n\n19\n0010286039787739137\n1475084026\n1\n2016-09-28 10:33:46\nFalse\n\n\n20\n0010286039787739137\n1475249827\n2\n2016-09-30 08:37:07\nFalse\n\n\n32\n0015065858137292339\n1473641554\n5\n2016-09-11 17:52:34\nFalse\n\n\n33\n0015065858137292339\n1472856937\n1\n2016-09-02 15:55:37\nFalse\n\n\n34\n0015065858137292339\n1473997381\n6\n2016-09-15 20:43:01\nFalse\n\n\n35\n0015065858137292339\n1473119040\n2\n2016-09-05 16:44:00\nFalse\n\n\n36\n0015065858137292339\n1473630321\n4\n2016-09-11 14:45:21\nFalse\n\n\n37\n0015065858137292339\n1473466324\n3\n2016-09-09 17:12:04\nFalse\n\n\n\n\n\n\n\nReturn visits are made up by two types of visitors\n\nthose that made a purchase\nthose that did not make a purchase\n\nThe number of visitors who did and did not make a purchase during a return visit are shown below\n\n\n\n\n\n\n\n\n\nmade_purchase_on_future_visit\ncount\nproportion\n\n\n\n\n0\nFalse\n10507\n0.955616\n\n\n1\nTrue\n488\n0.044384\n\n\n\n\n\n\n\n\n\n\n\n\n\nObservations\n\n\n\n\nOnly approximately 4.4% of all return visits in September 2016 resulted in a purchase.\n\n\n\n\n\nShow Frequency of Repeat Customers During Return Visits\nSome visitors made multiple return visits and a small subset of such visitors made multiple purchases. This is shown below.\nFirst, for each visitor, get the following\n\nwhether that vistor ever made a purchase on a return visit\nnumber of purchases made across all return visits\n\n\n\n\n\n\n\n\n\n\nfullvisitorid\nmade_purchase_on_future_visit_max\nmade_purchase_on_future_visit_sum\n\n\n\n\n0\n0005884918507288420\nFalse\n0\n\n\n1\n0010286039787739137\nFalse\n0\n\n\n2\n0015065858137292339\nFalse\n0\n\n\n3\n0026203741366904270\nTrue\n1\n\n\n4\n0027817676806595220\nFalse\n0\n\n\n...\n...\n...\n...\n\n\n3755\n9986848664463401272\nFalse\n0\n\n\n3756\n9990362099175067703\nFalse\n0\n\n\n3757\n999203594099745000\nFalse\n0\n\n\n3758\n9992704342633956099\nFalse\n0\n\n\n3759\n9993899288592473535\nFalse\n0\n\n\n\n\n3760 rows × 3 columns\n\n\n\nNext, get visitors who made a purchase on a return visit\n\n\n\n\n\n\n\n\n\nfullvisitorid\nmade_purchase_on_future_visit_max\nmade_purchase_on_future_visit_sum\n\n\n\n\n3\n0026203741366904270\nTrue\n1\n\n\n7\n0036417634769000138\nTrue\n1\n\n\n8\n0037518757923116572\nTrue\n1\n\n\n14\n0061519776091452595\nTrue\n1\n\n\n19\n0070976956518566605\nTrue\n1\n\n\n...\n...\n...\n...\n\n\n3709\n9891815404632176641\nTrue\n1\n\n\n3718\n9912185644936709935\nTrue\n1\n\n\n3725\n9941749289816017941\nTrue\n1\n\n\n3742\n9961396584113412108\nTrue\n1\n\n\n3746\n9975702176622548240\nTrue\n1\n\n\n\n\n423 rows × 3 columns\n\n\n\n\n\n\n\n\n\nNotes\n\n\n\n\nmade_purchase_on_future_visit indicates if a purchase was made during a return visit.\nmade_purchase_on_future_visit_max indicates whether a visitor who made a return visit to the store made a purchase during any such visit.\nmade_purchase_on_future_visit_sum shows the total number of purchases made by a visitor across all return visits.\n\n\n\nFinally, filter the occurrences of return visits during September 2016 to only capture all visitors who made a purchase on multiple return visits\nVisitors who made a purchase on multiple return visits are shown below\n\n\n\n\n\n\n\n\n\nfullvisitorid\nvisitId\nvisitNumber\nvisitStartTime\nmade_purchase_on_future_visit\nmade_purchase_on_future_visit_max\nmade_purchase_on_future_visit_sum\n\n\n\n\n316\n2074164338647079047\n1472735454\n16\n2016-09-01 06:10:54\nFalse\nTrue\n4\n\n\n317\n2074164338647079047\n1474373863\n23\n2016-09-20 05:17:43\nTrue\nTrue\n4\n\n\n318\n2074164338647079047\n1473196307\n19\n2016-09-06 14:11:47\nTrue\nTrue\n4\n\n\n319\n2074164338647079047\n1472746638\n18\n2016-09-01 09:17:18\nFalse\nTrue\n4\n\n\n320\n2074164338647079047\n1472739238\n17\n2016-09-01 07:13:58\nFalse\nTrue\n4\n\n\n321\n2074164338647079047\n1473792585\n21\n2016-09-13 11:49:45\nTrue\nTrue\n4\n\n\n322\n2074164338647079047\n1473446196\n20\n2016-09-09 11:36:36\nTrue\nTrue\n4\n\n\n323\n2074164338647079047\n1474310682\n22\n2016-09-19 11:44:42\nFalse\nTrue\n4\n\n\n535\n280738376597848400\n1473873900\n2\n2016-09-14 10:25:00\nTrue\nTrue\n3\n\n\n536\n280738376597848400\n1473903584\n5\n2016-09-14 18:39:44\nTrue\nTrue\n3\n\n\n537\n280738376597848400\n1473882095\n4\n2016-09-14 12:41:35\nTrue\nTrue\n3\n\n\n538\n280738376597848400\n1473878689\n3\n2016-09-14 11:44:49\nFalse\nTrue\n3\n\n\n549\n3033366073043100694\n1474033169\n36\n2016-09-16 06:39:29\nTrue\nTrue\n3\n\n\n550\n3033366073043100694\n1474588918\n38\n2016-09-22 17:01:58\nTrue\nTrue\n3\n\n\n551\n3033366073043100694\n1473344444\n35\n2016-09-08 07:20:44\nTrue\nTrue\n3\n\n\n\n\n\n\n\n\n\n\n\n\n\nObservations\n\n\n\n\nWe can see that these are the subset of return visitors who made a purchase on multiple return visits since the values in the made_purchase_on_future_visit_sum column that are larger than 1.\n\n\n\nFor visitors who who made a purchae on multiple return visits, show the number of visitors who made a purchase on a single such visit and those that made a purchase during multiple such visits\n\n\n\n\n\n\n\n\n\nmade_purchase_on_multiple_return_visits\ncount\nproportion\n\n\n\n\n0\nFalse\n1385\n0.835344\n\n\n1\nTrue\n273\n0.164656\n\n\n\n\n\n\n\n\n\n\n\n\n\nObservations\n\n\n\n\nMost visitors who made a purchae on multiple return visits during September 2016 only made a purchase during one of thse visits. Only approximately 16% of such visitors made a purchase during multiple such visits.\nThe SQL logic defined above is capturing repeat customers. These are visitors who made a purchase during more than one visit to the store. This is required per the scope of this project since the business wants to grow both repeat as well as new customers.\n\n\n\n\n\nProduct List Clickthrough Rate\nGet the following product-related actions performed per visit - productListName - productListPosition - isImpression - isClick\n\n\nQuery execution start time = 2023-07-02 12:43:58.244...done at 2023-07-02 12:44:09.040 (10.796 seconds).\nQuery returned 110,949 rows\n\n\n\n\n\n\n\n\n\nfullvisitorid\nvisitId\nvisitNumber\nvisitStartTime\nmedium\nchannelGrouping\nhits\nbounces\naction_type\npageviews\ntime_on_site\nbrowser\nos\ndeviceCategory\nproductListName\nproductListPosition\nisImpression\nisClick\n\n\n\n\n0\n2787909377637066215\n1472780448\n1\n2016-09-01 18:40:48\norganic\nOrganic Search\n5\n0\nUnknown\n5\n283\nChrome\nMacintosh\ndesktop\nNone\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n\n\n1\n2787909377637066215\n1472780448\n1\n2016-09-01 18:40:48\norganic\nOrganic Search\n5\n0\nUnknown\n5\n283\nChrome\nMacintosh\ndesktop\nNone\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n\n\n2\n2787909377637066215\n1472780448\n1\n2016-09-01 18:40:48\norganic\nOrganic Search\n5\n0\nUnknown\n5\n283\nChrome\nMacintosh\ndesktop\nNone\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n\n\n3\n2787909377637066215\n1472780448\n1\n2016-09-01 18:40:48\norganic\nOrganic Search\n5\n0\nUnknown\n5\n283\nChrome\nMacintosh\ndesktop\nNone\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n\n\n4\n2787909377637066215\n1472780448\n1\n2016-09-01 18:40:48\norganic\nOrganic Search\n5\n0\nUnknown\n5\n283\nChrome\nMacintosh\ndesktop\nNone\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n\n\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n\n\n110944\n639074571300803633\n1472795110\n1\n2016-09-01 22:45:10\norganic\nOrganic Search\n4\n0\nUnknown\n4\n151\nChrome\nWindows\ndesktop\nCategory\n17\nTrue\n&lt;NA&gt;\n\n\n110945\n639074571300803633\n1472795110\n1\n2016-09-01 22:45:10\norganic\nOrganic Search\n4\n0\nUnknown\n4\n151\nChrome\nWindows\ndesktop\nCategory\n18\nTrue\n&lt;NA&gt;\n\n\n110946\n639074571300803633\n1472795110\n1\n2016-09-01 22:45:10\norganic\nOrganic Search\n4\n0\nUnknown\n4\n151\nChrome\nWindows\ndesktop\nCategory\n19\nTrue\n&lt;NA&gt;\n\n\n110947\n639074571300803633\n1472795110\n1\n2016-09-01 22:45:10\norganic\nOrganic Search\n4\n0\nUnknown\n4\n151\nChrome\nWindows\ndesktop\nCategory\n20\nTrue\n&lt;NA&gt;\n\n\n110948\n639074571300803633\n1472795110\n1\n2016-09-01 22:45:10\norganic\nOrganic Search\n4\n0\nUnknown\n4\n151\nChrome\nWindows\ndesktop\nCategory\n21\nTrue\n&lt;NA&gt;\n\n\n\n\n110949 rows × 18 columns\n\n\n\nShow the number of unique values in the isImpression and isClick columns\n\n\nisImpression [&lt;NA&gt;, True]\nisClick [&lt;NA&gt;, True]\n\n\nShow all visits with a product click\n\n\n\n\n\n\n\n\n\nfullvisitorid\nvisitId\nvisitNumber\nvisitStartTime\nmedium\nchannelGrouping\nhits\nbounces\naction_type\npageviews\ntime_on_site\nbrowser\nos\ndeviceCategory\nproductListName\nproductListPosition\nisImpression\nisClick\n\n\n\n\n88\n6055189100224767003\n1472755933\n1\n2016-09-01 11:52:13\ncpm\nDisplay\n5\n0\nClick through of product lists\n4\n17\nChrome\nMacintosh\ndesktop\nCategory\n0\n&lt;NA&gt;\nTrue\n\n\n968\n7109081858569729237\n1472755255\n1\n2016-09-01 11:40:55\ncpm\nDisplay\n9\n0\nClick through of product lists\n8\n82\nChrome\nMacintosh\ndesktop\nSearch Results\n0\n&lt;NA&gt;\nTrue\n\n\n1094\n6495012494710721260\n1472828880\n1\n2016-09-02 08:08:00\ncpc\nPaid Search\n10\n0\nClick through of product lists\n8\n262\nChrome\nWindows\ndesktop\nCategory\n0\n&lt;NA&gt;\nTrue\n\n\n1095\n6495012494710721260\n1472828880\n1\n2016-09-02 08:08:00\ncpc\nPaid Search\n10\n0\nClick through of product lists\n8\n262\nChrome\nWindows\ndesktop\nCategory\n23\n&lt;NA&gt;\nTrue\n\n\n1443\n9275813847347927121\n1472882823\n1\n2016-09-02 23:07:03\ncpc\nPaid Search\n10\n0\nClick through of product lists\n7\n53\nChrome\nMacintosh\ndesktop\nCategory\n0\n&lt;NA&gt;\nTrue\n\n\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n\n\n109743\n8486302275562434243\n1472746894\n1\n2016-09-01 09:21:34\n(none)\nDirect\n67\n0\nClick through of product lists\n46\n1298\nChrome\nWindows\ndesktop\nCategory\n31\n&lt;NA&gt;\nTrue\n\n\n109782\n8486302275562434243\n1472746894\n1\n2016-09-01 09:21:34\n(none)\nDirect\n67\n0\nClick through of product lists\n46\n1298\nChrome\nWindows\ndesktop\nCategory\n0\n&lt;NA&gt;\nTrue\n\n\n109784\n8486302275562434243\n1472746894\n1\n2016-09-01 09:21:34\n(none)\nDirect\n67\n0\nClick through of product lists\n46\n1298\nChrome\nWindows\ndesktop\nCategory\n13\n&lt;NA&gt;\nTrue\n\n\n110589\n093437836654213633\n1472857366\n1\n2016-09-02 16:02:46\norganic\nOrganic Search\n3\n0\nClick through of product lists\n2\n18\nSafari\niOS\nmobile\nCategory\n0\n&lt;NA&gt;\nTrue\n\n\n110599\n0962511771321073901\n1472766824\n1\n2016-09-01 14:53:44\norganic\nOrganic Search\n3\n0\nClick through of product lists\n2\n14\nInternet Explorer\nWindows\ndesktop\nCategory\n0\n&lt;NA&gt;\nTrue\n\n\n\n\n1717 rows × 18 columns\n\n\n\nGet two visits with a product click\nShow two visits with a product click\n\n\n\n\n\n\n\n\n\nfullvisitorid\nvisitId\nvisitNumber\nvisitStartTime\nmedium\nchannelGrouping\nhits\nbounces\naction_type\npageviews\ntime_on_site\nbrowser\nos\ndeviceCategory\nproductListName\nproductListPosition\nisImpression\nisClick\n\n\n\n\n19597\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nNone\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n\n\n19598\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n1\nTrue\n&lt;NA&gt;\n\n\n19599\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n2\nTrue\n&lt;NA&gt;\n\n\n19600\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n3\nTrue\n&lt;NA&gt;\n\n\n19601\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n4\nTrue\n&lt;NA&gt;\n\n\n19602\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n5\nTrue\n&lt;NA&gt;\n\n\n19603\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n6\nTrue\n&lt;NA&gt;\n\n\n19604\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n7\nTrue\n&lt;NA&gt;\n\n\n19605\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n8\nTrue\n&lt;NA&gt;\n\n\n19606\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n9\nTrue\n&lt;NA&gt;\n\n\n19607\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n10\nTrue\n&lt;NA&gt;\n\n\n19608\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n11\nTrue\n&lt;NA&gt;\n\n\n19609\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n12\nTrue\n&lt;NA&gt;\n\n\n19610\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n13\nTrue\n&lt;NA&gt;\n\n\n19611\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n14\nTrue\n&lt;NA&gt;\n\n\n19612\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n15\nTrue\n&lt;NA&gt;\n\n\n19613\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n16\nTrue\n&lt;NA&gt;\n\n\n19614\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n17\nTrue\n&lt;NA&gt;\n\n\n19615\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n18\nTrue\n&lt;NA&gt;\n\n\n19616\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n19\nTrue\n&lt;NA&gt;\n\n\n19617\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n20\nTrue\n&lt;NA&gt;\n\n\n19618\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n21\nTrue\n&lt;NA&gt;\n\n\n19619\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n22\nTrue\n&lt;NA&gt;\n\n\n19620\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n23\nTrue\n&lt;NA&gt;\n\n\n19621\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n24\nTrue\n&lt;NA&gt;\n\n\n19622\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n25\nTrue\n&lt;NA&gt;\n\n\n19623\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n26\nTrue\n&lt;NA&gt;\n\n\n19624\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n27\nTrue\n&lt;NA&gt;\n\n\n19625\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n28\nTrue\n&lt;NA&gt;\n\n\n19626\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n29\nTrue\n&lt;NA&gt;\n\n\n19627\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n30\nTrue\n&lt;NA&gt;\n\n\n19628\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n31\nTrue\n&lt;NA&gt;\n\n\n19629\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n32\nTrue\n&lt;NA&gt;\n\n\n19630\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n33\nTrue\n&lt;NA&gt;\n\n\n19631\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n34\nTrue\n&lt;NA&gt;\n\n\n19632\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nClick through of product lists\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n0\n&lt;NA&gt;\nTrue\n\n\n19633\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nProduct detail views\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n19\n&lt;NA&gt;\n&lt;NA&gt;\n\n\n19634\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nClick through of product lists\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n19\n&lt;NA&gt;\nTrue\n\n\n19635\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nRelated Products\n1\nTrue\n&lt;NA&gt;\n\n\n19636\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nRelated Products\n2\nTrue\n&lt;NA&gt;\n\n\n19637\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nRelated Products\n3\nTrue\n&lt;NA&gt;\n\n\n19638\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nNone\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n\n\n19639\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nNone\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n\n\n19640\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n1\nTrue\n&lt;NA&gt;\n\n\n19641\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n2\nTrue\n&lt;NA&gt;\n\n\n19642\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n3\nTrue\n&lt;NA&gt;\n\n\n19643\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n4\nTrue\n&lt;NA&gt;\n\n\n19644\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n5\nTrue\n&lt;NA&gt;\n\n\n19645\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n6\nTrue\n&lt;NA&gt;\n\n\n19646\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n7\nTrue\n&lt;NA&gt;\n\n\n19647\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n8\nTrue\n&lt;NA&gt;\n\n\n19648\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n9\nTrue\n&lt;NA&gt;\n\n\n19649\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n10\nTrue\n&lt;NA&gt;\n\n\n19650\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n11\nTrue\n&lt;NA&gt;\n\n\n19651\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n12\nTrue\n&lt;NA&gt;\n\n\n19652\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n13\nTrue\n&lt;NA&gt;\n\n\n19653\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n14\nTrue\n&lt;NA&gt;\n\n\n19654\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n15\nTrue\n&lt;NA&gt;\n\n\n19655\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n16\nTrue\n&lt;NA&gt;\n\n\n19656\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n17\nTrue\n&lt;NA&gt;\n\n\n19657\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n18\nTrue\n&lt;NA&gt;\n\n\n19658\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n19\nTrue\n&lt;NA&gt;\n\n\n19659\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n20\nTrue\n&lt;NA&gt;\n\n\n19660\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n21\nTrue\n&lt;NA&gt;\n\n\n19661\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n22\nTrue\n&lt;NA&gt;\n\n\n19662\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n23\nTrue\n&lt;NA&gt;\n\n\n19663\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n24\nTrue\n&lt;NA&gt;\n\n\n19664\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n25\nTrue\n&lt;NA&gt;\n\n\n19665\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n26\nTrue\n&lt;NA&gt;\n\n\n19666\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n27\nTrue\n&lt;NA&gt;\n\n\n19667\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n28\nTrue\n&lt;NA&gt;\n\n\n19668\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n29\nTrue\n&lt;NA&gt;\n\n\n19669\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n30\nTrue\n&lt;NA&gt;\n\n\n19670\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n31\nTrue\n&lt;NA&gt;\n\n\n19671\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n32\nTrue\n&lt;NA&gt;\n\n\n19672\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n33\nTrue\n&lt;NA&gt;\n\n\n19673\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n34\nTrue\n&lt;NA&gt;\n\n\n19674\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nProduct detail views\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n5\n&lt;NA&gt;\n&lt;NA&gt;\n\n\n19675\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nClick through of product lists\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n0\n&lt;NA&gt;\nTrue\n\n\n19676\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n1\nTrue\n&lt;NA&gt;\n\n\n19677\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n2\nTrue\n&lt;NA&gt;\n\n\n19678\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n3\nTrue\n&lt;NA&gt;\n\n\n19679\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n4\nTrue\n&lt;NA&gt;\n\n\n19680\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n5\nTrue\n&lt;NA&gt;\n\n\n19681\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n6\nTrue\n&lt;NA&gt;\n\n\n19682\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n7\nTrue\n&lt;NA&gt;\n\n\n19683\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n8\nTrue\n&lt;NA&gt;\n\n\n19684\n569579103002599546\n1472875116\n1\n2016-09-02 20:58:36\nreferral\nSocial\n12\n0\nUnknown\n8\n153\nChrome\nMacintosh\ndesktop\nCategory\n9\nTrue\n&lt;NA&gt;\n\n\n93387\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n1\nTrue\n&lt;NA&gt;\n\n\n93388\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n2\nTrue\n&lt;NA&gt;\n\n\n93389\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n3\nTrue\n&lt;NA&gt;\n\n\n93390\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n4\nTrue\n&lt;NA&gt;\n\n\n93391\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n5\nTrue\n&lt;NA&gt;\n\n\n93392\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n6\nTrue\n&lt;NA&gt;\n\n\n93393\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n7\nTrue\n&lt;NA&gt;\n\n\n93394\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n8\nTrue\n&lt;NA&gt;\n\n\n93395\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n9\nTrue\n&lt;NA&gt;\n\n\n93396\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n10\nTrue\n&lt;NA&gt;\n\n\n93397\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n11\nTrue\n&lt;NA&gt;\n\n\n93398\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n12\nTrue\n&lt;NA&gt;\n\n\n93399\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n13\nTrue\n&lt;NA&gt;\n\n\n93400\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n14\nTrue\n&lt;NA&gt;\n\n\n93401\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n15\nTrue\n&lt;NA&gt;\n\n\n93402\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n16\nTrue\n&lt;NA&gt;\n\n\n93403\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n17\nTrue\n&lt;NA&gt;\n\n\n93404\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n18\nTrue\n&lt;NA&gt;\n\n\n93405\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n19\nTrue\n&lt;NA&gt;\n\n\n93406\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n20\nTrue\n&lt;NA&gt;\n\n\n93407\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n21\nTrue\n&lt;NA&gt;\n\n\n93408\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n22\nTrue\n&lt;NA&gt;\n\n\n93409\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n23\nTrue\n&lt;NA&gt;\n\n\n93410\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n24\nTrue\n&lt;NA&gt;\n\n\n93411\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n25\nTrue\n&lt;NA&gt;\n\n\n93412\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n26\nTrue\n&lt;NA&gt;\n\n\n93413\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n27\nTrue\n&lt;NA&gt;\n\n\n93414\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n28\nTrue\n&lt;NA&gt;\n\n\n93415\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n29\nTrue\n&lt;NA&gt;\n\n\n93416\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n30\nTrue\n&lt;NA&gt;\n\n\n93417\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n31\nTrue\n&lt;NA&gt;\n\n\n93418\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n32\nTrue\n&lt;NA&gt;\n\n\n93419\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n33\nTrue\n&lt;NA&gt;\n\n\n93420\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n34\nTrue\n&lt;NA&gt;\n\n\n93421\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n1\nTrue\n&lt;NA&gt;\n\n\n93422\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n2\nTrue\n&lt;NA&gt;\n\n\n93423\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n3\nTrue\n&lt;NA&gt;\n\n\n93424\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n4\nTrue\n&lt;NA&gt;\n\n\n93425\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n5\nTrue\n&lt;NA&gt;\n\n\n93426\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n6\nTrue\n&lt;NA&gt;\n\n\n93427\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n7\nTrue\n&lt;NA&gt;\n\n\n93428\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n8\nTrue\n&lt;NA&gt;\n\n\n93429\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n9\nTrue\n&lt;NA&gt;\n\n\n93430\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n10\nTrue\n&lt;NA&gt;\n\n\n93431\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n11\nTrue\n&lt;NA&gt;\n\n\n93432\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n12\nTrue\n&lt;NA&gt;\n\n\n93433\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n13\nTrue\n&lt;NA&gt;\n\n\n93434\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n14\nTrue\n&lt;NA&gt;\n\n\n93435\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n15\nTrue\n&lt;NA&gt;\n\n\n93436\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n16\nTrue\n&lt;NA&gt;\n\n\n93437\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n17\nTrue\n&lt;NA&gt;\n\n\n93438\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n18\nTrue\n&lt;NA&gt;\n\n\n93439\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n19\nTrue\n&lt;NA&gt;\n\n\n93440\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n20\nTrue\n&lt;NA&gt;\n\n\n93441\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n21\nTrue\n&lt;NA&gt;\n\n\n93442\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n22\nTrue\n&lt;NA&gt;\n\n\n93443\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n23\nTrue\n&lt;NA&gt;\n\n\n93444\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n24\nTrue\n&lt;NA&gt;\n\n\n93445\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n25\nTrue\n&lt;NA&gt;\n\n\n93446\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n26\nTrue\n&lt;NA&gt;\n\n\n93447\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n27\nTrue\n&lt;NA&gt;\n\n\n93448\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n28\nTrue\n&lt;NA&gt;\n\n\n93449\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n29\nTrue\n&lt;NA&gt;\n\n\n93450\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n30\nTrue\n&lt;NA&gt;\n\n\n93451\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n31\nTrue\n&lt;NA&gt;\n\n\n93452\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n32\nTrue\n&lt;NA&gt;\n\n\n93453\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n33\nTrue\n&lt;NA&gt;\n\n\n93454\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n34\nTrue\n&lt;NA&gt;\n\n\n93455\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n1\nTrue\n&lt;NA&gt;\n\n\n93456\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n2\nTrue\n&lt;NA&gt;\n\n\n93457\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n3\nTrue\n&lt;NA&gt;\n\n\n93458\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n4\nTrue\n&lt;NA&gt;\n\n\n93459\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n5\nTrue\n&lt;NA&gt;\n\n\n93460\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n6\nTrue\n&lt;NA&gt;\n\n\n93461\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n7\nTrue\n&lt;NA&gt;\n\n\n93462\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n8\nTrue\n&lt;NA&gt;\n\n\n93463\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n9\nTrue\n&lt;NA&gt;\n\n\n93464\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n10\nTrue\n&lt;NA&gt;\n\n\n93465\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n11\nTrue\n&lt;NA&gt;\n\n\n93466\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n12\nTrue\n&lt;NA&gt;\n\n\n93467\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n13\nTrue\n&lt;NA&gt;\n\n\n93468\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n14\nTrue\n&lt;NA&gt;\n\n\n93469\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n15\nTrue\n&lt;NA&gt;\n\n\n93470\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n16\nTrue\n&lt;NA&gt;\n\n\n93471\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n17\nTrue\n&lt;NA&gt;\n\n\n93472\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n18\nTrue\n&lt;NA&gt;\n\n\n93473\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n19\nTrue\n&lt;NA&gt;\n\n\n93474\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n20\nTrue\n&lt;NA&gt;\n\n\n93475\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n21\nTrue\n&lt;NA&gt;\n\n\n93476\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n22\nTrue\n&lt;NA&gt;\n\n\n93477\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n23\nTrue\n&lt;NA&gt;\n\n\n93478\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n24\nTrue\n&lt;NA&gt;\n\n\n93479\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n25\nTrue\n&lt;NA&gt;\n\n\n93480\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n26\nTrue\n&lt;NA&gt;\n\n\n93481\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n27\nTrue\n&lt;NA&gt;\n\n\n93482\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n28\nTrue\n&lt;NA&gt;\n\n\n93483\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n29\nTrue\n&lt;NA&gt;\n\n\n93484\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n1\nTrue\n&lt;NA&gt;\n\n\n93485\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n2\nTrue\n&lt;NA&gt;\n\n\n93486\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n3\nTrue\n&lt;NA&gt;\n\n\n93487\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n4\nTrue\n&lt;NA&gt;\n\n\n93488\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n5\nTrue\n&lt;NA&gt;\n\n\n93489\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n6\nTrue\n&lt;NA&gt;\n\n\n93490\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n7\nTrue\n&lt;NA&gt;\n\n\n93491\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n8\nTrue\n&lt;NA&gt;\n\n\n93492\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n9\nTrue\n&lt;NA&gt;\n\n\n93493\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n10\nTrue\n&lt;NA&gt;\n\n\n93494\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n11\nTrue\n&lt;NA&gt;\n\n\n93495\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n12\nTrue\n&lt;NA&gt;\n\n\n93496\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n13\nTrue\n&lt;NA&gt;\n\n\n93497\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n14\nTrue\n&lt;NA&gt;\n\n\n93498\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n15\nTrue\n&lt;NA&gt;\n\n\n93499\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n16\nTrue\n&lt;NA&gt;\n\n\n93500\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n17\nTrue\n&lt;NA&gt;\n\n\n93501\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n18\nTrue\n&lt;NA&gt;\n\n\n93502\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n19\nTrue\n&lt;NA&gt;\n\n\n93503\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n20\nTrue\n&lt;NA&gt;\n\n\n93504\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n21\nTrue\n&lt;NA&gt;\n\n\n93505\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n22\nTrue\n&lt;NA&gt;\n\n\n93506\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n23\nTrue\n&lt;NA&gt;\n\n\n93507\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n24\nTrue\n&lt;NA&gt;\n\n\n93508\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n25\nTrue\n&lt;NA&gt;\n\n\n93509\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n26\nTrue\n&lt;NA&gt;\n\n\n93510\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n27\nTrue\n&lt;NA&gt;\n\n\n93511\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n28\nTrue\n&lt;NA&gt;\n\n\n93512\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n29\nTrue\n&lt;NA&gt;\n\n\n93513\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n30\nTrue\n&lt;NA&gt;\n\n\n93514\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n31\nTrue\n&lt;NA&gt;\n\n\n93515\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n32\nTrue\n&lt;NA&gt;\n\n\n93516\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n33\nTrue\n&lt;NA&gt;\n\n\n93517\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n34\nTrue\n&lt;NA&gt;\n\n\n93518\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n1\nTrue\n&lt;NA&gt;\n\n\n93519\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n2\nTrue\n&lt;NA&gt;\n\n\n93520\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n3\nTrue\n&lt;NA&gt;\n\n\n93521\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n4\nTrue\n&lt;NA&gt;\n\n\n93522\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n5\nTrue\n&lt;NA&gt;\n\n\n93523\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n6\nTrue\n&lt;NA&gt;\n\n\n93524\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n7\nTrue\n&lt;NA&gt;\n\n\n93525\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n8\nTrue\n&lt;NA&gt;\n\n\n93526\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n9\nTrue\n&lt;NA&gt;\n\n\n93527\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n10\nTrue\n&lt;NA&gt;\n\n\n93528\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n11\nTrue\n&lt;NA&gt;\n\n\n93529\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n12\nTrue\n&lt;NA&gt;\n\n\n93530\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n13\nTrue\n&lt;NA&gt;\n\n\n93531\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n14\nTrue\n&lt;NA&gt;\n\n\n93532\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n15\nTrue\n&lt;NA&gt;\n\n\n93533\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n16\nTrue\n&lt;NA&gt;\n\n\n93534\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n17\nTrue\n&lt;NA&gt;\n\n\n93535\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n18\nTrue\n&lt;NA&gt;\n\n\n93536\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n19\nTrue\n&lt;NA&gt;\n\n\n93537\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n20\nTrue\n&lt;NA&gt;\n\n\n93538\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n21\nTrue\n&lt;NA&gt;\n\n\n93539\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n22\nTrue\n&lt;NA&gt;\n\n\n93540\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n23\nTrue\n&lt;NA&gt;\n\n\n93541\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n24\nTrue\n&lt;NA&gt;\n\n\n93542\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n25\nTrue\n&lt;NA&gt;\n\n\n93543\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n26\nTrue\n&lt;NA&gt;\n\n\n93544\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n27\nTrue\n&lt;NA&gt;\n\n\n93545\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n28\nTrue\n&lt;NA&gt;\n\n\n93546\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n29\nTrue\n&lt;NA&gt;\n\n\n93547\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n30\nTrue\n&lt;NA&gt;\n\n\n93548\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n31\nTrue\n&lt;NA&gt;\n\n\n93549\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n32\nTrue\n&lt;NA&gt;\n\n\n93550\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n33\nTrue\n&lt;NA&gt;\n\n\n93551\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n34\nTrue\n&lt;NA&gt;\n\n\n93552\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n1\nTrue\n&lt;NA&gt;\n\n\n93553\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n2\nTrue\n&lt;NA&gt;\n\n\n93554\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n3\nTrue\n&lt;NA&gt;\n\n\n93555\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n4\nTrue\n&lt;NA&gt;\n\n\n93556\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n5\nTrue\n&lt;NA&gt;\n\n\n93557\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n6\nTrue\n&lt;NA&gt;\n\n\n93558\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n7\nTrue\n&lt;NA&gt;\n\n\n93559\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n8\nTrue\n&lt;NA&gt;\n\n\n93560\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n9\nTrue\n&lt;NA&gt;\n\n\n93561\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n10\nTrue\n&lt;NA&gt;\n\n\n93562\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n1\nTrue\n&lt;NA&gt;\n\n\n93563\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n2\nTrue\n&lt;NA&gt;\n\n\n93564\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n3\nTrue\n&lt;NA&gt;\n\n\n93565\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n4\nTrue\n&lt;NA&gt;\n\n\n93566\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n5\nTrue\n&lt;NA&gt;\n\n\n93567\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n6\nTrue\n&lt;NA&gt;\n\n\n93568\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n7\nTrue\n&lt;NA&gt;\n\n\n93569\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n8\nTrue\n&lt;NA&gt;\n\n\n93570\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n9\nTrue\n&lt;NA&gt;\n\n\n93571\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n10\nTrue\n&lt;NA&gt;\n\n\n93572\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n11\nTrue\n&lt;NA&gt;\n\n\n93573\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n12\nTrue\n&lt;NA&gt;\n\n\n93574\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n13\nTrue\n&lt;NA&gt;\n\n\n93575\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n14\nTrue\n&lt;NA&gt;\n\n\n93576\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n15\nTrue\n&lt;NA&gt;\n\n\n93577\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n16\nTrue\n&lt;NA&gt;\n\n\n93578\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n17\nTrue\n&lt;NA&gt;\n\n\n93579\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n18\nTrue\n&lt;NA&gt;\n\n\n93580\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nSearch Results\n1\nTrue\n&lt;NA&gt;\n\n\n93581\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nSearch Results\n2\nTrue\n&lt;NA&gt;\n\n\n93582\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nSearch Results\n3\nTrue\n&lt;NA&gt;\n\n\n93583\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n1\nTrue\n&lt;NA&gt;\n\n\n93584\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n2\nTrue\n&lt;NA&gt;\n\n\n93585\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n3\nTrue\n&lt;NA&gt;\n\n\n93586\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n4\nTrue\n&lt;NA&gt;\n\n\n93587\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n5\nTrue\n&lt;NA&gt;\n\n\n93588\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n6\nTrue\n&lt;NA&gt;\n\n\n93589\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n7\nTrue\n&lt;NA&gt;\n\n\n93590\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n8\nTrue\n&lt;NA&gt;\n\n\n93591\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n9\nTrue\n&lt;NA&gt;\n\n\n93592\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n10\nTrue\n&lt;NA&gt;\n\n\n93593\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n11\nTrue\n&lt;NA&gt;\n\n\n93594\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n12\nTrue\n&lt;NA&gt;\n\n\n93595\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n13\nTrue\n&lt;NA&gt;\n\n\n93596\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n14\nTrue\n&lt;NA&gt;\n\n\n93597\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n15\nTrue\n&lt;NA&gt;\n\n\n93598\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n16\nTrue\n&lt;NA&gt;\n\n\n93599\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n17\nTrue\n&lt;NA&gt;\n\n\n93600\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n18\nTrue\n&lt;NA&gt;\n\n\n93601\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n19\nTrue\n&lt;NA&gt;\n\n\n93602\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n20\nTrue\n&lt;NA&gt;\n\n\n93603\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n21\nTrue\n&lt;NA&gt;\n\n\n93604\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n22\nTrue\n&lt;NA&gt;\n\n\n93605\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n23\nTrue\n&lt;NA&gt;\n\n\n93606\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n24\nTrue\n&lt;NA&gt;\n\n\n93607\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n25\nTrue\n&lt;NA&gt;\n\n\n93608\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n26\nTrue\n&lt;NA&gt;\n\n\n93609\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n27\nTrue\n&lt;NA&gt;\n\n\n93610\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n28\nTrue\n&lt;NA&gt;\n\n\n93611\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nSearch Results\n1\nTrue\n&lt;NA&gt;\n\n\n93612\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nSearch Results\n2\nTrue\n&lt;NA&gt;\n\n\n93613\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nSearch Results\n3\nTrue\n&lt;NA&gt;\n\n\n93614\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n1\nTrue\n&lt;NA&gt;\n\n\n93615\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n2\nTrue\n&lt;NA&gt;\n\n\n93616\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n3\nTrue\n&lt;NA&gt;\n\n\n93617\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n4\nTrue\n&lt;NA&gt;\n\n\n93618\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n5\nTrue\n&lt;NA&gt;\n\n\n93619\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n6\nTrue\n&lt;NA&gt;\n\n\n93620\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n7\nTrue\n&lt;NA&gt;\n\n\n93621\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n8\nTrue\n&lt;NA&gt;\n\n\n93622\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n9\nTrue\n&lt;NA&gt;\n\n\n93623\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n10\nTrue\n&lt;NA&gt;\n\n\n93624\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n11\nTrue\n&lt;NA&gt;\n\n\n93625\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n12\nTrue\n&lt;NA&gt;\n\n\n93626\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n13\nTrue\n&lt;NA&gt;\n\n\n93627\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n14\nTrue\n&lt;NA&gt;\n\n\n93628\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n15\nTrue\n&lt;NA&gt;\n\n\n93629\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n16\nTrue\n&lt;NA&gt;\n\n\n93630\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n17\nTrue\n&lt;NA&gt;\n\n\n93631\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n1\nTrue\n&lt;NA&gt;\n\n\n93632\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n2\nTrue\n&lt;NA&gt;\n\n\n93633\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n3\nTrue\n&lt;NA&gt;\n\n\n93634\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n4\nTrue\n&lt;NA&gt;\n\n\n93635\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n5\nTrue\n&lt;NA&gt;\n\n\n93636\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n6\nTrue\n&lt;NA&gt;\n\n\n93637\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n7\nTrue\n&lt;NA&gt;\n\n\n93638\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n8\nTrue\n&lt;NA&gt;\n\n\n93639\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n9\nTrue\n&lt;NA&gt;\n\n\n93640\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n10\nTrue\n&lt;NA&gt;\n\n\n93641\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n11\nTrue\n&lt;NA&gt;\n\n\n93642\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n12\nTrue\n&lt;NA&gt;\n\n\n93643\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n13\nTrue\n&lt;NA&gt;\n\n\n93644\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n14\nTrue\n&lt;NA&gt;\n\n\n93645\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n15\nTrue\n&lt;NA&gt;\n\n\n93646\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n16\nTrue\n&lt;NA&gt;\n\n\n93647\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n17\nTrue\n&lt;NA&gt;\n\n\n93648\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n18\nTrue\n&lt;NA&gt;\n\n\n93649\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n19\nTrue\n&lt;NA&gt;\n\n\n93650\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n20\nTrue\n&lt;NA&gt;\n\n\n93651\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n21\nTrue\n&lt;NA&gt;\n\n\n93652\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n22\nTrue\n&lt;NA&gt;\n\n\n93653\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n23\nTrue\n&lt;NA&gt;\n\n\n93654\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n24\nTrue\n&lt;NA&gt;\n\n\n93655\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n25\nTrue\n&lt;NA&gt;\n\n\n93656\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n26\nTrue\n&lt;NA&gt;\n\n\n93657\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n27\nTrue\n&lt;NA&gt;\n\n\n93658\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n28\nTrue\n&lt;NA&gt;\n\n\n93659\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n29\nTrue\n&lt;NA&gt;\n\n\n93660\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n30\nTrue\n&lt;NA&gt;\n\n\n93661\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n31\nTrue\n&lt;NA&gt;\n\n\n93662\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n32\nTrue\n&lt;NA&gt;\n\n\n93663\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n33\nTrue\n&lt;NA&gt;\n\n\n93664\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n34\nTrue\n&lt;NA&gt;\n\n\n93665\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n1\nTrue\n&lt;NA&gt;\n\n\n93666\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n2\nTrue\n&lt;NA&gt;\n\n\n93667\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n3\nTrue\n&lt;NA&gt;\n\n\n93668\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n4\nTrue\n&lt;NA&gt;\n\n\n93669\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n5\nTrue\n&lt;NA&gt;\n\n\n93670\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n6\nTrue\n&lt;NA&gt;\n\n\n93671\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n7\nTrue\n&lt;NA&gt;\n\n\n93672\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n8\nTrue\n&lt;NA&gt;\n\n\n93673\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n9\nTrue\n&lt;NA&gt;\n\n\n93674\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n10\nTrue\n&lt;NA&gt;\n\n\n93675\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n11\nTrue\n&lt;NA&gt;\n\n\n93676\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n12\nTrue\n&lt;NA&gt;\n\n\n93677\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n13\nTrue\n&lt;NA&gt;\n\n\n93678\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n14\nTrue\n&lt;NA&gt;\n\n\n93679\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n15\nTrue\n&lt;NA&gt;\n\n\n93680\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n16\nTrue\n&lt;NA&gt;\n\n\n93681\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n17\nTrue\n&lt;NA&gt;\n\n\n93682\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n18\nTrue\n&lt;NA&gt;\n\n\n93683\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n19\nTrue\n&lt;NA&gt;\n\n\n93684\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n20\nTrue\n&lt;NA&gt;\n\n\n93685\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n21\nTrue\n&lt;NA&gt;\n\n\n93686\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n22\nTrue\n&lt;NA&gt;\n\n\n93687\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n23\nTrue\n&lt;NA&gt;\n\n\n93688\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n24\nTrue\n&lt;NA&gt;\n\n\n93689\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n25\nTrue\n&lt;NA&gt;\n\n\n93690\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n26\nTrue\n&lt;NA&gt;\n\n\n93691\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n27\nTrue\n&lt;NA&gt;\n\n\n93692\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n28\nTrue\n&lt;NA&gt;\n\n\n93693\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n29\nTrue\n&lt;NA&gt;\n\n\n93694\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nClick through of product lists\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n0\n&lt;NA&gt;\nTrue\n\n\n93695\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nProduct detail views\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n23\n&lt;NA&gt;\n&lt;NA&gt;\n\n\n93696\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nClick through of product lists\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n0\n&lt;NA&gt;\nTrue\n\n\n93697\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nProduct detail views\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n23\n&lt;NA&gt;\n&lt;NA&gt;\n\n\n93698\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nClick through of product lists\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n23\n&lt;NA&gt;\nTrue\n\n\n93699\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nRelated Products\n1\nTrue\n&lt;NA&gt;\n\n\n93700\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nRelated Products\n2\nTrue\n&lt;NA&gt;\n\n\n93701\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nRelated Products\n3\nTrue\n&lt;NA&gt;\n\n\n93702\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n1\nTrue\n&lt;NA&gt;\n\n\n93703\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n2\nTrue\n&lt;NA&gt;\n\n\n93704\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n3\nTrue\n&lt;NA&gt;\n\n\n93705\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n4\nTrue\n&lt;NA&gt;\n\n\n93706\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n5\nTrue\n&lt;NA&gt;\n\n\n93707\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n6\nTrue\n&lt;NA&gt;\n\n\n93708\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n7\nTrue\n&lt;NA&gt;\n\n\n93709\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n8\nTrue\n&lt;NA&gt;\n\n\n93710\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n9\nTrue\n&lt;NA&gt;\n\n\n93711\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n10\nTrue\n&lt;NA&gt;\n\n\n93712\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n11\nTrue\n&lt;NA&gt;\n\n\n93713\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n12\nTrue\n&lt;NA&gt;\n\n\n93714\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n13\nTrue\n&lt;NA&gt;\n\n\n93715\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n14\nTrue\n&lt;NA&gt;\n\n\n93716\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n15\nTrue\n&lt;NA&gt;\n\n\n93717\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n16\nTrue\n&lt;NA&gt;\n\n\n93718\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n17\nTrue\n&lt;NA&gt;\n\n\n93719\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n18\nTrue\n&lt;NA&gt;\n\n\n93720\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n19\nTrue\n&lt;NA&gt;\n\n\n93721\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n20\nTrue\n&lt;NA&gt;\n\n\n93722\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n21\nTrue\n&lt;NA&gt;\n\n\n93723\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n22\nTrue\n&lt;NA&gt;\n\n\n93724\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n23\nTrue\n&lt;NA&gt;\n\n\n93725\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n24\nTrue\n&lt;NA&gt;\n\n\n93726\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n25\nTrue\n&lt;NA&gt;\n\n\n93727\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n26\nTrue\n&lt;NA&gt;\n\n\n93728\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n27\nTrue\n&lt;NA&gt;\n\n\n93729\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n28\nTrue\n&lt;NA&gt;\n\n\n93730\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n29\nTrue\n&lt;NA&gt;\n\n\n93731\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n30\nTrue\n&lt;NA&gt;\n\n\n93732\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n31\nTrue\n&lt;NA&gt;\n\n\n93733\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n32\nTrue\n&lt;NA&gt;\n\n\n93734\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n33\nTrue\n&lt;NA&gt;\n\n\n93735\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n34\nTrue\n&lt;NA&gt;\n\n\n93736\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n1\nTrue\n&lt;NA&gt;\n\n\n93737\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n2\nTrue\n&lt;NA&gt;\n\n\n93738\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n3\nTrue\n&lt;NA&gt;\n\n\n93739\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n4\nTrue\n&lt;NA&gt;\n\n\n93740\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n5\nTrue\n&lt;NA&gt;\n\n\n93741\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n6\nTrue\n&lt;NA&gt;\n\n\n93742\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n7\nTrue\n&lt;NA&gt;\n\n\n93743\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n8\nTrue\n&lt;NA&gt;\n\n\n93744\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n9\nTrue\n&lt;NA&gt;\n\n\n93745\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n10\nTrue\n&lt;NA&gt;\n\n\n93746\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n1\nTrue\n&lt;NA&gt;\n\n\n93747\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n2\nTrue\n&lt;NA&gt;\n\n\n93748\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n3\nTrue\n&lt;NA&gt;\n\n\n93749\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n4\nTrue\n&lt;NA&gt;\n\n\n93750\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n5\nTrue\n&lt;NA&gt;\n\n\n93751\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n6\nTrue\n&lt;NA&gt;\n\n\n93752\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n7\nTrue\n&lt;NA&gt;\n\n\n93753\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n8\nTrue\n&lt;NA&gt;\n\n\n93754\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n9\nTrue\n&lt;NA&gt;\n\n\n93755\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n10\nTrue\n&lt;NA&gt;\n\n\n93756\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n11\nTrue\n&lt;NA&gt;\n\n\n93757\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n12\nTrue\n&lt;NA&gt;\n\n\n93758\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n13\nTrue\n&lt;NA&gt;\n\n\n93759\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n14\nTrue\n&lt;NA&gt;\n\n\n93760\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n15\nTrue\n&lt;NA&gt;\n\n\n93761\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n16\nTrue\n&lt;NA&gt;\n\n\n93762\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n17\nTrue\n&lt;NA&gt;\n\n\n93763\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n18\nTrue\n&lt;NA&gt;\n\n\n93764\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n19\nTrue\n&lt;NA&gt;\n\n\n93765\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n20\nTrue\n&lt;NA&gt;\n\n\n93766\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n21\nTrue\n&lt;NA&gt;\n\n\n93767\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n22\nTrue\n&lt;NA&gt;\n\n\n93768\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n23\nTrue\n&lt;NA&gt;\n\n\n93769\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n24\nTrue\n&lt;NA&gt;\n\n\n93770\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n25\nTrue\n&lt;NA&gt;\n\n\n93771\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n26\nTrue\n&lt;NA&gt;\n\n\n93772\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n27\nTrue\n&lt;NA&gt;\n\n\n93773\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n28\nTrue\n&lt;NA&gt;\n\n\n93774\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n1\nTrue\n&lt;NA&gt;\n\n\n93775\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n2\nTrue\n&lt;NA&gt;\n\n\n93776\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n3\nTrue\n&lt;NA&gt;\n\n\n93777\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n4\nTrue\n&lt;NA&gt;\n\n\n93778\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n5\nTrue\n&lt;NA&gt;\n\n\n93779\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n6\nTrue\n&lt;NA&gt;\n\n\n93780\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n7\nTrue\n&lt;NA&gt;\n\n\n93781\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n8\nTrue\n&lt;NA&gt;\n\n\n93782\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n9\nTrue\n&lt;NA&gt;\n\n\n93783\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n10\nTrue\n&lt;NA&gt;\n\n\n93784\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n11\nTrue\n&lt;NA&gt;\n\n\n93785\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n12\nTrue\n&lt;NA&gt;\n\n\n93786\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n13\nTrue\n&lt;NA&gt;\n\n\n93787\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n14\nTrue\n&lt;NA&gt;\n\n\n93788\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n15\nTrue\n&lt;NA&gt;\n\n\n93789\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n16\nTrue\n&lt;NA&gt;\n\n\n93790\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n17\nTrue\n&lt;NA&gt;\n\n\n93791\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n18\nTrue\n&lt;NA&gt;\n\n\n93792\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n19\nTrue\n&lt;NA&gt;\n\n\n93793\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n20\nTrue\n&lt;NA&gt;\n\n\n93794\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n21\nTrue\n&lt;NA&gt;\n\n\n93795\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n22\nTrue\n&lt;NA&gt;\n\n\n93796\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n23\nTrue\n&lt;NA&gt;\n\n\n93797\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n24\nTrue\n&lt;NA&gt;\n\n\n93798\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n25\nTrue\n&lt;NA&gt;\n\n\n93799\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n26\nTrue\n&lt;NA&gt;\n\n\n93800\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n27\nTrue\n&lt;NA&gt;\n\n\n93801\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n28\nTrue\n&lt;NA&gt;\n\n\n93802\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n29\nTrue\n&lt;NA&gt;\n\n\n93803\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n30\nTrue\n&lt;NA&gt;\n\n\n93804\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n31\nTrue\n&lt;NA&gt;\n\n\n93805\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n32\nTrue\n&lt;NA&gt;\n\n\n93806\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n33\nTrue\n&lt;NA&gt;\n\n\n93807\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n34\nTrue\n&lt;NA&gt;\n\n\n93808\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nClick through of product lists\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n0\n&lt;NA&gt;\nTrue\n\n\n93809\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nProduct detail views\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n27\n&lt;NA&gt;\n&lt;NA&gt;\n\n\n93810\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nClick through of product lists\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n0\n&lt;NA&gt;\nTrue\n\n\n93811\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nProduct detail views\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n32\n&lt;NA&gt;\n&lt;NA&gt;\n\n\n93812\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nClick through of product lists\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n32\n&lt;NA&gt;\nTrue\n\n\n93813\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nRelated Products\n1\nTrue\n&lt;NA&gt;\n\n\n93814\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nRelated Products\n2\nTrue\n&lt;NA&gt;\n\n\n93815\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nRelated Products\n3\nTrue\n&lt;NA&gt;\n\n\n93816\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n1\nTrue\n&lt;NA&gt;\n\n\n93817\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n2\nTrue\n&lt;NA&gt;\n\n\n93818\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n3\nTrue\n&lt;NA&gt;\n\n\n93819\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n4\nTrue\n&lt;NA&gt;\n\n\n93820\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n5\nTrue\n&lt;NA&gt;\n\n\n93821\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n6\nTrue\n&lt;NA&gt;\n\n\n93822\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n7\nTrue\n&lt;NA&gt;\n\n\n93823\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n8\nTrue\n&lt;NA&gt;\n\n\n93824\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n9\nTrue\n&lt;NA&gt;\n\n\n93825\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n10\nTrue\n&lt;NA&gt;\n\n\n93826\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n11\nTrue\n&lt;NA&gt;\n\n\n93827\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n12\nTrue\n&lt;NA&gt;\n\n\n93828\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n13\nTrue\n&lt;NA&gt;\n\n\n93829\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n14\nTrue\n&lt;NA&gt;\n\n\n93830\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n15\nTrue\n&lt;NA&gt;\n\n\n93831\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n16\nTrue\n&lt;NA&gt;\n\n\n93832\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n17\nTrue\n&lt;NA&gt;\n\n\n93833\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n18\nTrue\n&lt;NA&gt;\n\n\n93834\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n19\nTrue\n&lt;NA&gt;\n\n\n93835\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n20\nTrue\n&lt;NA&gt;\n\n\n93836\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n21\nTrue\n&lt;NA&gt;\n\n\n93837\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n22\nTrue\n&lt;NA&gt;\n\n\n93838\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n23\nTrue\n&lt;NA&gt;\n\n\n93839\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n24\nTrue\n&lt;NA&gt;\n\n\n93840\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n25\nTrue\n&lt;NA&gt;\n\n\n93841\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n26\nTrue\n&lt;NA&gt;\n\n\n93842\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n27\nTrue\n&lt;NA&gt;\n\n\n93843\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n28\nTrue\n&lt;NA&gt;\n\n\n93844\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n29\nTrue\n&lt;NA&gt;\n\n\n93845\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n30\nTrue\n&lt;NA&gt;\n\n\n93846\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n31\nTrue\n&lt;NA&gt;\n\n\n93847\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n32\nTrue\n&lt;NA&gt;\n\n\n93848\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n33\nTrue\n&lt;NA&gt;\n\n\n93849\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nUnknown\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n34\nTrue\n&lt;NA&gt;\n\n\n93850\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nClick through of product lists\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n0\n&lt;NA&gt;\nTrue\n\n\n93851\n378535583935008249\n1472851024\n1\n2016-09-02 14:17:04\n(none)\nDirect\n32\n0\nProduct detail views\n25\n2024\nSafari\nMacintosh\ndesktop\nCategory\n32\n&lt;NA&gt;\n&lt;NA&gt;\n\n\n\n\n\n\n\nProduct clicks are not observed for the Unknown action type, as shown below\nCalculate the product clickthrough rate (CTR) for all products in a product list across these two visits\n\n\n\n\n\n\n\n\n\nvisitId\nviews\nclicks\nproduct_ctr\n\n\n\n\n0\n1472851024\n453\n7\n1.545254\n\n\n1\n1472875116\n80\n3\n3.75\n\n\n\n\n\n\n\nUsing Python, calculate the clickthrough rate (CTR) for all products in a product list across all visits - by product - number of products that were clicked in a product list / number of products that were viewed a product list - by visitor - number of visitors who clicked a product in a product list / number of visitors who viewed a product list\n\n\n\n\n\n\n\n\n\nnum_visitors\nactions\nproduct_views\nproduct_clicks\nvisitor_views\nvisitor_clicks\nproduct_ctr\nvisitor_ctr\n\n\n\n\n0\n1359\n4104\n103119\n1717\n911\n379\n1.665067\n41.602634\n\n\n\n\n\n\n\nGet the following aggregated product-related actions performed per visit - product views - product clicks\n\n\nQuery execution start time = 2023-07-02 13:43:56.176...done at 2023-07-02 13:43:58.144 (1.968 seconds).\nQuery returned 1,360 rows\n\n\n\n\n\n\n\n\n\nfullvisitorid\nvisitId\nvisitNumber\nvisitStartTime\nmedium\nchannelGrouping\nhits\nbounces\nlast_action\npageviews\ntime_on_site\nbrowser\nos\ndeviceCategory\nproduct_views\nproduct_clicks\n\n\n\n\n0\n9750540744658016166\n1472748832\n1\n2016-09-01 09:53:52\norganic\nOrganic Search\n39\n0\nProduct detail views\n17\n1334\nChrome\nAndroid\nmobile\n188\n4\n\n\n1\n5133217183540194806\n1472877510\n1\n2016-09-02 21:38:30\norganic\nOrganic Search\n19\n0\nAdd product(s) to cart\n13\n338\nSafari\nMacintosh\ndesktop\n133\n4\n\n\n2\n7370259867769888657\n1472856605\n1\n2016-09-02 15:50:05\norganic\nOrganic Search\n4\n0\nUnknown\n3\n37\nChrome\nAndroid\nmobile\n34\n0\n\n\n3\n3108089013033989361\n1472767301\n1\n2016-09-01 15:01:41\norganic\nOrganic Search\n4\n0\nUnknown\n3\n24\nChrome\nAndroid\nmobile\n34\n0\n\n\n4\n3497940039722152076\n1472869927\n1\n2016-09-02 19:32:07\norganic\nOrganic Search\n4\n0\nUnknown\n3\n36\nSafari\niOS\ntablet\n34\n0\n\n\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n\n\n1355\n9609367222527813362\n1472844552\n1\n2016-09-02 12:29:12\norganic\nOrganic Search\n1\n1\nUnknown\n1\n0\nChrome\nWindows\ndesktop\n34\n0\n\n\n1356\n185444327419942710\n1472758915\n1\n2016-09-01 12:41:55\nreferral\nSocial\n1\n1\nUnknown\n1\n0\nChrome\nWindows\ndesktop\n21\n0\n\n\n1357\n664300994101851701\n1472771026\n1\n2016-09-01 16:03:46\n(none)\nDirect\n2\n0\nUnknown\n2\n74\nChrome\nMacintosh\ndesktop\n25\n0\n\n\n1358\n7567453673632648637\n1472868432\n1\n2016-09-02 19:07:12\nreferral\nSocial\n2\n0\nUnknown\n2\n27\nSafari (in-app)\niOS\nmobile\n46\n0\n\n\n1359\n7382880288852070714\n1472743586\n1\n2016-09-01 08:26:26\norganic\nOrganic Search\n3\n0\nUnknown\n3\n21\nChrome\nLinux\ndesktop\n96\n0\n\n\n\n\n1360 rows × 16 columns\n\n\n\n\n\n\n\n\n\nNotes\n\n\n\n\nFrom the datset documentation for the Field Name hits.eCommerceAction.action_type, in order to calculate number of products in a product list it is sufficient to use the SQL conditional WHERE hits.product.isImpression == TRUE. This was used as part of a CASE WHEN in option 1 with the SUM() aggregation function to count the number of products in a product list that were viewed. Alternatively, since the SQL COUNT() function counts non-NULL values, this function could also be used to get the same result, as shown in the two commented lines in option 2.\nSimilar logic for product views is also used to get the number of products in a product list that were clicked.\n\n\n\nRepeat the Python calculation of the clickthrough rate (CTR) for all products in a product list across all visits - by product - by visitor\nusing the aggregated visits data retrieved, where the calculation is performed using SQL\n\n\n\n\n\n\n\n\n\nnum_visitors\nproduct_views\nproduct_clicks\nvisitor_views\nvisitor_clicks\nproduct_ctr\nvisitor_ctr\n\n\n\n\n0\n1359\n103119\n1717\n911\n379\n1.665067\n41.602634\n\n\n\n\n\n\n\nVerify that the CTR by products and visitors calculated using visits aggregated with - Python - SQL\nare equivalent"
  },
  {
    "objectID": "notebooks/02-train/notebooks/04_train.html",
    "href": "notebooks/02-train/notebooks/04_train.html",
    "title": "ML Development",
    "section": "",
    "text": "Train a ML model to predict first-time US-based visitors’ propensity to make a purchase on a return visit to the Google merchandise store.\n\n\n\nVisit data is taken from Google Cloud’s public dataset with Google Analytics visitor transaction data.\n\n\n\nThe study timeline covers several months. During the study period, the visitor ID of every visitor who made a return visit to the store is retrieved. The ML model will be developed using the first visit by these visitors only, since there isn’t any useful information to be learnt from visitors who made a single visit to the store without returning. The attributes of the first visit to the store by the return visitors will be used when splitting the data for use in ML model development. Three data splits are created for ML model development, which includes model training, validation and evaluation. As mentioned above, the data splits combine to cover the study period and they occur in chronological order.\nThe training data split covers the first several months of available data and it captures attributes of the first-time visitors who were found to make a return visit to the store during the study period. The first visit occurs during these pre-determined months. The validation split covers first-time visitors to the store during the month that follows the last month of training data. Similarly, the test data split covers visitors during the month following the validation data period.\n\n\n\nThe ML model is trained using the training data and scored on the validation data. Features are engineered and pre-processed using the training and validation data splits. Due to the class imbalance with most visitors not making a purchase during a return visit, over- and under-sampling techniques are used to help the model learn from attributes of first-time visits that resulted in a purchase. A ML pipeline is developed using the scikit-learn ML framework for tabular data with the Pipeline class. The pipeline covers all the steps that are part of typical ML training, including feature engineering, pre-processing, feature selection and re-sampling (over- or under-sampling) and classification steps. If over-sampling is chosen, then this step is performed after the pre-processing step and before the classification step. If under-sampling is performed, then re-sampling is performed as the first step of the pipeline.\n\n\n\nAs mentioned in the project scope, a single evaluation metric is preferred for this project. For comparison purposes, several metrics will be computed. Model selection (next step) will be performed using the primary (preferred) metric only.\n\n\n\nDuring this step, one or more runs of a single or multiple ML experiments will be executed.\nA single run of a single experiment consists of training and evaluating a single pipeline (model). A grid of model hyperparameters for the pipeline is defined in the User Inputs section. These hyperparameters will be optimized (tuned) by training the pipeline on the training data split and scoring its predictions on the validation data. The best hyperparameters for the pipeline will be the ones that return the best evaluation metric on the validation data. The pipeline with the best hyperparameters will then be re-trained using the combined training and validation data and it will be used to predict and evaluate observations in the test data split. At the end of a single experiment run, all the metadata (eg. features used, best pipeline hyperparameters, metrics, etc.) and metrics associated with that run are tracked using the MLFlow ML lifecycle management platform.\nDuring the next step, the pipeline (model) with the best metric (score) on the test data split will be determined by retrieving the metadata for all experiment runs and ranking the runs based on the scoring metric on the test data split. The best model will then be tagged for further use (to generate a marketing audience) during a later step in this project."
  },
  {
    "objectID": "notebooks/02-train/notebooks/04_train.html#about",
    "href": "notebooks/02-train/notebooks/04_train.html#about",
    "title": "ML Development",
    "section": "",
    "text": "Train a ML model to predict first-time US-based visitors’ propensity to make a purchase on a return visit to the Google merchandise store.\n\n\n\nVisit data is taken from Google Cloud’s public dataset with Google Analytics visitor transaction data.\n\n\n\nThe study timeline covers several months. During the study period, the visitor ID of every visitor who made a return visit to the store is retrieved. The ML model will be developed using the first visit by these visitors only, since there isn’t any useful information to be learnt from visitors who made a single visit to the store without returning. The attributes of the first visit to the store by the return visitors will be used when splitting the data for use in ML model development. Three data splits are created for ML model development, which includes model training, validation and evaluation. As mentioned above, the data splits combine to cover the study period and they occur in chronological order.\nThe training data split covers the first several months of available data and it captures attributes of the first-time visitors who were found to make a return visit to the store during the study period. The first visit occurs during these pre-determined months. The validation split covers first-time visitors to the store during the month that follows the last month of training data. Similarly, the test data split covers visitors during the month following the validation data period.\n\n\n\nThe ML model is trained using the training data and scored on the validation data. Features are engineered and pre-processed using the training and validation data splits. Due to the class imbalance with most visitors not making a purchase during a return visit, over- and under-sampling techniques are used to help the model learn from attributes of first-time visits that resulted in a purchase. A ML pipeline is developed using the scikit-learn ML framework for tabular data with the Pipeline class. The pipeline covers all the steps that are part of typical ML training, including feature engineering, pre-processing, feature selection and re-sampling (over- or under-sampling) and classification steps. If over-sampling is chosen, then this step is performed after the pre-processing step and before the classification step. If under-sampling is performed, then re-sampling is performed as the first step of the pipeline.\n\n\n\nAs mentioned in the project scope, a single evaluation metric is preferred for this project. For comparison purposes, several metrics will be computed. Model selection (next step) will be performed using the primary (preferred) metric only.\n\n\n\nDuring this step, one or more runs of a single or multiple ML experiments will be executed.\nA single run of a single experiment consists of training and evaluating a single pipeline (model). A grid of model hyperparameters for the pipeline is defined in the User Inputs section. These hyperparameters will be optimized (tuned) by training the pipeline on the training data split and scoring its predictions on the validation data. The best hyperparameters for the pipeline will be the ones that return the best evaluation metric on the validation data. The pipeline with the best hyperparameters will then be re-trained using the combined training and validation data and it will be used to predict and evaluate observations in the test data split. At the end of a single experiment run, all the metadata (eg. features used, best pipeline hyperparameters, metrics, etc.) and metrics associated with that run are tracked using the MLFlow ML lifecycle management platform.\nDuring the next step, the pipeline (model) with the best metric (score) on the test data split will be determined by retrieving the metadata for all experiment runs and ranking the runs based on the scoring metric on the test data split. The best model will then be tagged for further use (to generate a marketing audience) during a later step in this project."
  },
  {
    "objectID": "notebooks/02-train/notebooks/04_train.html#user-inputs",
    "href": "notebooks/02-train/notebooks/04_train.html#user-inputs",
    "title": "ML Development",
    "section": "User Inputs",
    "text": "User Inputs\nDefine the following\n\nstart and end dates for train, validation and test data\nlist of categorical features\nlist of categorical features present in the raw data as integers\nlist of numerical features\ndatetime features\nfeatures to exclude\nname of column containing label (outcome)\nresampling approach (over- or under-sampling)\nprimary ML scoring metric\nhyperparameter grid\ntype of scikit-learn ML model\nMLFlow-related inputs for experiment tracking\n\n\n# 1. start and end dates\ntrain_start_date = \"20160901\"\ntrain_end_date = \"20161231\"\nval_start_date = \"20170101\"\nval_end_date = \"20170131\"\ntest_start_date = \"20170201\"\ntest_end_date = \"20170228\"\n\n# 2. categorical column\ncategorical_features = [\n    \"bounces\",\n    \"last_action\",\n    \"source\",\n    \"medium\",\n    \"channelGrouping\",\n    \"browser\",\n    \"os\",\n    \"deviceCategory\",\n]\n\n# 3. categorical columns present as integers\ncategorical_features_ints = [\"bounces\"]\n\n# 4. numerical columns\nnumerical_features = [\n    \"hits\",\n    \"promos_displayed\",\n    \"promos_clicked\",\n    \"product_views\",\n    \"product_clicks\",\n    \"pageviews\",\n    \"time_on_site\",\n]\n\n# 5. datetime features\ndatetime_features = [\"quarter\", \"month\", \"day_of_month\", \"day_of_week\", \"hour\"]\n\n# 6. features to exclude\ncols_to_drop = [\n    \"fullvisitorid\",\n    \"visitId\",\n    \"visitNumber\",\n    \"visitStartTime\",\n    'revenue',\n]\n\n# 7. label column\nlabel = \"made_purchase_on_future_visit\"\n\n# 8. resampling\nresampling_approach = \"os\"\n\n# 9. scoring metric\nprimary_metric = \"fbeta2\"\n\n# 10. define hyperParameter grid\nparam_grid = {\n    \"resampler__sampling_strategy\": [0.1],\n    \"select__threshold\": [0.7],\n    \"preprocessor__cat__rarecats__fe__tol\": [0.10],\n    \"preprocessor__cat__rarecats__fe__n_categories\": [1],\n    \"preprocessor__cat__rarecats__fe__ignore_format\": [True],\n    \"preprocessor__cat__rarecats__fe__replace_with\": [\"other\"],\n    # \"clf__strategy\": [\"stratified\"],  # model_type = DummyClassifier\n    \"clf__a\": [0.2, 0.3, 0.4, 0.35, 0.15, 0.45],  # model_type = BetaDistClassifier\n    \"clf__b\": [2.31, 2.25, 2.35, 2.4, 2.5],  # model_type = BetaDistClassifier\n}\n\n# 11. type of model\nmodel_type = \"BetaDistClassifier\"\n\n# 12. mlflow\nmlflow_expt_name = \"My Demo Experiment 2\"\nmlflow_unwanted_tracking_cols = [\n    \"tags.mlflow.source.name\",\n    \"tags.mlflow.source.type\",\n    \"tags.mlflow.user\",\n    \"artifact_uri\",\n    \"start_time\",\n    \"end_time\",\n]\ncleanup_mlflow = True\n\nA helper function will be created to programmatically load data from BigQuery based on the desired start and end dates. The function accepts the following\n\nstart and end dates for which data is to be retrieved\n\nthese dates will be different for the training, validation and test splits\n\nstart date for the training data and end date for the test data\n\nthese two dates define the period over which ML model development will occur\nthese are used to retrieve visitors who made a purchase on a return (future) visit to the store during this period\n\n\nThe function is defined in src/sql_helpers.py."
  },
  {
    "objectID": "notebooks/02-train/notebooks/04_train.html#get-data",
    "href": "notebooks/02-train/notebooks/04_train.html#get-data",
    "title": "ML Development",
    "section": "Get Data",
    "text": "Get Data\n\nTrain\n\nquery_train = sqlh.get_sql_query(\n    train_start_date, train_end_date, train_start_date, test_end_date\n)\ndf_train, _ = th.extract_data(query_train, gcp_auth_dict).pipe(\n    th.transform_data,\n    datatypes_dict=dtypes_dict,\n    duplicate_cols=[\"fullvisitorid\"],\n    column_mapper_dict={'last_action': action_mapper},\n    # categoricals=list(set(categorical_features) - set(categorical_features_ints)),\n)\n# df_train.pipe(th.load_data, processed_data_dir, \"train\")\n\nQuery execution start time = 2023-07-10 14:38:05.951...done at 2023-07-10 14:38:22.659 (16.708 seconds).\nQuery returned 92,859 rows\nGot 92,551 rows and 29 columns after dropping duplicates\nTransformed data has 92,551 rows & 29 columns\n\n\n\n\nValidation\n\nquery_val = sqlh.get_sql_query(val_start_date, val_end_date, train_start_date, test_end_date)\ndf_val, _ = th.extract_data(query_val, gcp_auth_dict).pipe(\n    th.transform_data,\n    datatypes_dict=dtypes_dict,\n    duplicate_cols=[\"fullvisitorid\"],\n    column_mapper_dict={'last_action': action_mapper},\n)\n# df_val.pipe(th.load_data, processed_data_dir, \"val\")\n\nQuery execution start time = 2023-07-10 14:38:22.789...done at 2023-07-10 14:38:28.202 (5.413 seconds).\nQuery returned 21,208 rows\nGot 21,177 rows and 29 columns after dropping duplicates\nTransformed data has 21,177 rows & 29 columns\n\n\n\n\nTest\n\nquery_test = sqlh.get_sql_query(test_start_date, test_end_date, train_start_date, test_end_date)\ndf_test, cat_mapper_dicts_test = th.extract_data(query_test, gcp_auth_dict).pipe(\n    th.transform_data,\n    datatypes_dict=dtypes_dict,\n    duplicate_cols=[\"fullvisitorid\"],\n    column_mapper_dict={'last_action': action_mapper},\n)\n# df_test.pipe(th.load_data, processed_data_dir, \"test\")\n\nQuery execution start time = 2023-07-10 14:38:28.251...done at 2023-07-10 14:38:32.660 (4.409 seconds).\nQuery returned 20,180 rows\nGot 20,164 rows and 29 columns after dropping duplicates\nTransformed data has 20,164 rows & 29 columns\n\n\n\n\nCombine Data and Split for ML Validation\nCreate combined training and validation data, where only the training data has been shuffled\n\ndf_train, df_train_val = th.create_combined_validation_data(df_train, df_val, dtypes_dict)\n\n\n\nCombine Data for ML Evaluation\nCreate combined training and validation data that has been shuffled\n\ndf_train_val_eval = (\n    pd.concat([df_train, df_val])\n    .pipe(th.set_datatypes, dtypes_dict)\n    .pipe(th.shuffle_data)\n)\n\n\n\nCombine Data for Inference\nShuffle all available data\n\ndf_all = (\n    pd.concat([df_train, df_val, df_test])\n    .pipe(th.set_datatypes, dtypes_dict)\n    .pipe(th.shuffle_data)\n)\n\n\n\nSeparate Features and Label\n\n(\n    X_train,\n    y_train,\n    X_val,\n    y_val,\n    X_train_val,\n    y_train_val,\n    X_train_val_eval,\n    y_train_val_eval,\n    X_test,\n    y_test,\n    X,\n    y,\n) = xyh.get_feats_label(\n    df_train,\n    df_val,\n    df_train_val,\n    df_train_val_eval,\n    df_test,\n    df_all,\n    cols_to_drop,\n    label,\n)\n\n\n\n\n\n\n\n\n\n\ndtype\nsplit\n\n\n\n\n0\nInt64\ntrain\n\n\n1\nInt64\nval\n\n\n2\nInt64\ntrain+val\n\n\n3\nInt64\ntrain+val_for_eval\n\n\n4\nInt64\ntest\n\n\n5\nInt64\nall"
  },
  {
    "objectID": "notebooks/02-train/notebooks/04_train.html#exploratory-data-analysis",
    "href": "notebooks/02-train/notebooks/04_train.html#exploratory-data-analysis",
    "title": "ML Development",
    "section": "Exploratory Data Analysis",
    "text": "Exploratory Data Analysis\nGet features that will be used in ML development (excludes ID features such as fullvisitorid, etc.)\n\n\n\n\n\n\n\n\n\nquarter\nmonth\nday_of_month\nday_of_week\nhour\nhits\npromos_displayed\npromos_clicked\nproduct_views\nproduct_clicks\npageviews\ntime_on_site\nbounces\nlast_action\nsource\nmedium\nchannelGrouping\nbrowser\nos\ndeviceCategory\n\n\n\n\n35094\n4\n12\n18\n1\n17\n5\n9\n0\n9\n0\n5\n64\n0\nUnknown\nyahoo\norganic\nOrganic Search\nFirefox\nWindows\ndesktop\n\n\n52575\n4\n11\n27\n1\n18\n1\n0\n0\n0\n0\n1\n0\n1\nUnknown\naol\norganic\nOrganic Search\nChrome\nWindows\ndesktop\n\n\n40349\n4\n12\n10\n7\n14\n1\n0\n0\n0\n0\n1\n0\n1\nUnknown\ngoogle\norganic\nOrganic Search\nSafari\niOS\nmobile\n\n\n91913\n4\n10\n3\n2\n9\n1\n0\n0\n12\n0\n1\n0\n1\nUnknown\ngoogle\norganic\nOrganic Search\nSafari\niOS\nmobile\n\n\n9236\n3\n9\n6\n3\n20\n2\n0\n0\n23\n0\n2\n7\n0\nUnknown\n(direct)\n(none)\nDirect\nChrome\nMacintosh\ndesktop\n\n\n\n\n\n\n\n\nMulti-Collinearity\n\n\n\n\n\n\n\n\n\ndtype\n\n\n\n\nquarter\nInt64\n\n\nmonth\nInt64\n\n\nday_of_month\nInt64\n\n\nday_of_week\nInt64\n\n\nhour\nInt64\n\n\nhits\nInt64\n\n\npromos_displayed\nInt64\n\n\npromos_clicked\nInt64\n\n\nproduct_views\nInt64\n\n\nproduct_clicks\nInt64\n\n\npageviews\nInt64\n\n\ntime_on_site\nInt64\n\n\nbounces\nInt64\n\n\nlast_action\nInt64\n\n\nsource\nInt64\n\n\nmedium\nInt64\n\n\nchannelGrouping\nInt64\n\n\nbrowser\nInt64\n\n\nos\nInt64\n\n\ndeviceCategory\nInt64\n\n\n\n\n\n\n\nCheck for multi-collinearity among all features using feature correlation heatmap\n\n\n\n\n\n\n\n \nquarter\nmonth\nday_of_month\nday_of_week\nhour\nhits\npromos_displayed\npromos_clicked\nproduct_views\nproduct_clicks\npageviews\ntime_on_site\nbounces\nlast_action\nsource\nmedium\nchannelGrouping\nbrowser\nos\n\n\n\n\nquarter\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nmonth\n0.749056\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nday_of_month\n-0.009929\n-0.058935\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nday_of_week\n-0.044466\n-0.011619\n-0.053393\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nhour\n0.008033\n0.008430\n-0.006886\n-0.021754\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nhits\n-0.016704\n-0.012521\n-0.011854\n-0.003323\n0.032888\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\npromos_displayed\n-0.022588\n-0.030119\n-0.032248\n-0.001756\n0.022073\n0.426496\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\npromos_clicked\n-0.052039\n-0.097719\n-0.043614\n0.006600\n0.025703\n0.253367\n0.482923\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nproduct_views\n-0.239647\n-0.187742\n-0.032876\n0.002226\n0.039937\n0.742857\n0.346689\n0.249975\n\n\n\n\n\n\n\n\n\n\n\n\n\nproduct_clicks\n-0.036184\n-0.029200\n-0.005315\n-0.002263\n0.024018\n0.849428\n0.199241\n0.119570\n0.566116\n\n\n\n\n\n\n\n\n\n\n\n\npageviews\n-0.009221\n-0.003065\n-0.010634\n-0.003402\n0.035145\n0.981496\n0.460251\n0.227677\n0.768513\n0.774284\n\n\n\n\n\n\n\n\n\n\n\ntime_on_site\n0.012394\n0.015554\n-0.005331\n-0.005089\n0.016945\n0.688599\n0.325391\n0.162599\n0.538109\n0.503694\n0.715981\n\n\n\n\n\n\n\n\n\n\nbounces\n-0.010789\n-0.014581\n0.013799\n0.007232\n-0.042903\n-0.342037\n-0.362688\n-0.204132\n-0.329360\n-0.205393\n-0.371634\n-0.305192\n\n\n\n\n\n\n\n\n\nlast_action\n0.029183\n0.055264\n0.010565\n-0.004585\n0.027683\n0.631974\n0.191315\n0.059962\n0.372112\n0.483755\n0.647019\n0.511003\n-0.340936\n\n\n\n\n\n\n\n\nsource\n-0.006955\n-0.033789\n-0.018000\n-0.007185\n0.043985\n0.066794\n0.141590\n0.055988\n0.117343\n0.042095\n0.075075\n0.029192\n-0.198419\n0.004786\n\n\n\n\n\n\n\nmedium\n-0.041886\n-0.090244\n-0.018058\n0.000371\n0.024225\n0.008071\n0.116904\n0.053130\n0.071881\n0.004074\n0.010609\n-0.012303\n-0.123807\n-0.076442\n0.919839\n\n\n\n\n\n\nchannelGrouping\n-0.034850\n-0.076291\n-0.010821\n-0.002790\n0.005324\n-0.004460\n0.135009\n0.036497\n0.023630\n-0.007121\n-0.003399\n-0.017845\n-0.086359\n-0.070648\n0.930220\n0.843336\n\n\n\n\n\nbrowser\n-0.002030\n-0.000943\n0.019165\n0.013121\n0.033497\n-0.086839\n0.016992\n0.059421\n-0.057898\n-0.069364\n-0.094082\n-0.068781\n0.075474\n-0.112199\n-0.048606\n0.020729\n-0.015763\n\n\n\n\nos\n-0.007607\n-0.009877\n0.008745\n0.001001\n-0.002192\n-0.055974\n-0.006860\n-0.005917\n-0.026407\n-0.040171\n-0.058667\n-0.045059\n0.037794\n-0.079878\n0.014679\n0.100079\n0.061709\n0.507414\n\n\n\ndeviceCategory\n0.011482\n0.036301\n0.023509\n0.022398\n0.062181\n-0.074624\n0.066863\n0.144486\n-0.045483\n-0.073826\n-0.081847\n-0.056358\n0.063628\n-0.122525\n-0.109626\n-0.096443\n-0.153407\n0.450204\n0.087484\n\n\n\n\n\n\n\n\n\n\n\nObservations\n\n\n\n\npageviews is\n\nhighly correlated (&gt;0.7) to hits, product_clicks and product_views\nmoderately correlated (&gt;0.5 and &lt;0.7) to last_action\n\nproduct_clicks and product_views are highly correlated to hits.\nlast_action is moderately correlated to time_on_site.\nTo allow ML model explainability, multi-collinearity must be removed from the features. So, highly-correlated features will have to be dropped. Moderately correlated features will be permitted.\n\n\n\n\n\n\n\n\n\n\n\n\ndtype\n\n\n\n\nquarter\nFloat64\n\n\nmonth\nFloat64\n\n\nday_of_month\nFloat64\n\n\nday_of_week\nFloat64\n\n\nhour\nFloat64\n\n\nhits\nFloat64\n\n\npromos_displayed\nFloat64\n\n\npromos_clicked\nFloat64\n\n\nproduct_views\nFloat64\n\n\nproduct_clicks\nFloat64\n\n\npageviews\nFloat64\n\n\ntime_on_site\nFloat64\n\n\nbounces\nFloat64\n\n\nlast_action\nFloat64\n\n\nsource\nFloat64\n\n\nmedium\nFloat64\n\n\nchannelGrouping\nFloat64\n\n\nbrowser\nFloat64\n\n\nos\nFloat64\n\n\n\n\n\n\n\n\n\nCorrelation to Label\n\n\n\n\n\n\n\n \nfeature\ncorr\nfeature_type\n\n\n\n\n0\nlast_action\n0.225053\ncategorical\n\n\n1\npageviews\n0.147561\nnumerical\n\n\n2\nhits\n0.143601\nnumerical\n\n\n3\ntime_on_site\n0.127583\nnumerical\n\n\n4\nproduct_clicks\n0.106997\nnumerical\n\n\n5\nproduct_views\n0.068513\nnumerical\n\n\n6\nmonth\n0.050392\ndatetime\n\n\n7\nquarter\n0.043607\ndatetime\n\n\n8\npromos_displayed\n0.032815\nnumerical\n\n\n9\nsource\n0.021458\ncategorical\n\n\n10\nday_of_month\n0.005347\ndatetime\n\n\n11\nhour\n0.002831\ndatetime\n\n\n12\nchannelGrouping\n-0.010328\ncategorical\n\n\n13\nday_of_week\n-0.013618\ndatetime\n\n\n14\npromos_clicked\n-0.018745\nnumerical\n\n\n15\nmedium\n-0.049056\ncategorical\n\n\n16\nos\n-0.073147\ncategorical\n\n\n17\nbounces\n-0.096282\ncategorical\n\n\n18\nbrowser\n-0.098378\ncategorical\n\n\n19\ndeviceCategory\n-0.108512\ncategorical\n\n\n\n\n\n\n\n\n\n\n\nObservations\n\n\n\n\nUnfortunately, the extracted features show a weak correlation (&lt;0.5) to the label.\nThe first-time visitors’ last_action (i.e. the last action they performed during their first visit) shows the highest correlation (0.23) to the label. This is a categorical feature (hilighted in yellow). The other categorcal features show a weak correlation to the label.\nThe numerical features (hilighted in light-green above) show the next strongest correlations (&gt;0.06 and &lt;0.15) to the label, but some of these features are highly correlated to eachother (as seen above) and so a subset of these numerical features will be excluded in order to support model explainability.\nThe datetime features (not hilighted above) are treated like categoricals in the extracted data, and they show a poor correlation to the label. Other approaches to encoding datetime attributes (eg. using trigonometric functions) should be explored during feature pre-processing.\n\n\n\n\n\n\n\n\n\n\n\n\ndtype\n\n\n\n\nfeature\nobject\n\n\ncorr\nFloat64\n\n\nfeature_type\nobject\n\n\n\n\n\n\n\n\n\nCardinality of Categorical Features\n\n\n\n\n\n\n\n\n\ncolumn\nlen_mapper_dict_train\nmapper_dict_train\n\n\n\n\n0\nsource\n116\n{'(direct)': 0, '(not set)': 1, '0.muppet1.frontend.gws.muppet-exp.ij-q.borg.google.com:14634': 2, '0.shared.bow.cat2.ads-bow.lf.borg.google.com:9...\n\n\n1\nbrowser\n26\n{'Amazon Silk': 0, 'Android Browser': 1, 'Android Webview': 2, 'Apple-iPhone7C2': 3, 'BlackBerry': 4, 'Chrome': 5, 'Coc Coc': 6, 'Edge': 7, 'Firef...\n\n\n2\nos\n15\n{'(not set)': 0, 'Android': 1, 'BlackBerry': 2, 'Chrome OS': 3, 'FreeBSD': 4, 'Linux': 5, 'Macintosh': 6, 'Nintendo Wii': 7, 'Nokia': 8, 'Samsung'...\n\n\n3\nchannelGrouping\n8\n{'(Other)': 0, 'Affiliates': 1, 'Direct': 2, 'Display': 3, 'Organic Search': 4, 'Paid Search': 5, 'Referral': 6, 'Social': 7}\n\n\n4\nlast_action\n7\n{'Unknown': 0, 'Click through of product lists': 1, 'Product detail views': 2, 'Add product(s) to cart': 3, 'Remove product(s) from cart': 4, 'Che...\n\n\n5\nmedium\n7\n{'(none)': 0, '(not set)': 1, 'affiliate': 2, 'cpc': 3, 'cpm': 4, 'organic': 5, 'referral': 6}\n\n\n6\ndeviceCategory\n3\n{'desktop': 0, 'mobile': 1, 'tablet': 2}\n\n\n7\nbounces\n2\n{0: 0, 1: 1}\n\n\n\n\n\n\n\n\n\n\n\n\n\nObservations\n\n\n\n\nAt least three of the categorical features have a problem with high-cardinality (&gt;10 categories), which will lead to a sparse matrix and suffer from the curse of dimensionality. To overcome this, only the most commonly occurring values in each categorical feature will have to be kept and all the other (infrequenly occurring) values with will be replaced with an other value. Based on the training data, this will have to be done for the source, browser and os features.\n\n\n\nShow the frequency of categories for every categorical feature\n\n\n\n\n\n\n\n \nbounces\nproportion\nshowing_all_cats\n\n\n\n\n0\n0\n70.768549\nTrue\n\n\n1\n1\n29.231451\nTrue\n\n\n\n\n\n\n\n\n\n\n \nlast_action\nproportion\nshowing_all_cats\n\n\n\n\n0\nUnknown\n72.953291\nTrue\n\n\n1\nProduct detail views\n15.905825\nTrue\n\n\n2\nAdd product(s) to cart\n5.029659\nTrue\n\n\n3\nCompleted purchase\n3.346263\nTrue\n\n\n4\nCheck out\n1.767674\nTrue\n\n\n5\nRemove product(s) from cart\n0.952988\nTrue\n\n\n6\nClick through of product lists\n0.044300\nTrue\n\n\n\n\n\n\n\n\n\n\n \nsource\nproportion\nshowing_all_cats\n\n\n\n\n0\ngoogle\n51.560647\nFalse\n\n\n1\n(direct)\n25.543143\nFalse\n\n\n2\nmall.googleplex.com\n13.959252\nFalse\n\n\n3\nsites.google.com\n1.303306\nFalse\n\n\n4\nmoma.corp.google.com\n1.233338\nFalse\n\n\n5\nPartners\n1.066126\nFalse\n\n\n6\ndfa\n1.003273\nFalse\n\n\n\n\n\n\n\n\n\n\n \nmedium\nproportion\nshowing_all_cats\n\n\n\n\n0\norganic\n41.680803\nTrue\n\n\n1\nreferral\n27.099653\nTrue\n\n\n2\n(none)\n23.272574\nTrue\n\n\n3\ncpc\n6.059362\nTrue\n\n\n4\naffiliate\n0.971356\nTrue\n\n\n5\ncpm\n0.914091\nTrue\n\n\n6\n(not set)\n0.002161\nTrue\n\n\n\n\n\n\n\n\n\n\n \nchannelGrouping\nproportion\nshowing_all_cats\n\n\n\n\n0\nOrganic Search\n41.680803\nTrue\n\n\n1\nDirect\n23.272574\nTrue\n\n\n2\nReferral\n17.455241\nTrue\n\n\n3\nSocial\n9.644412\nTrue\n\n\n4\nPaid Search\n6.059362\nTrue\n\n\n5\nAffiliates\n0.971356\nTrue\n\n\n6\nDisplay\n0.914091\nTrue\n\n\n7\n(Other)\n0.002161\nTrue\n\n\n\n\n\n\n\n\n\n\n \nbrowser\nproportion\nshowing_all_cats\n\n\n\n\n0\nChrome\n74.642753\nFalse\n\n\n1\nSafari\n16.544249\nFalse\n\n\n2\nFirefox\n2.806053\nFalse\n\n\n3\nInternet Explorer\n2.394989\nFalse\n\n\n4\nOpera\n1.210476\nFalse\n\n\n5\nEdge\n1.069848\nFalse\n\n\n\n\n\n\n\n\n\n\n \nos\nproportion\nshowing_all_cats\n\n\n\n\n0\nMacintosh\n33.073657\nTrue\n\n\n1\nWindows\n27.647459\nTrue\n\n\n2\niOS\n14.586552\nTrue\n\n\n3\nAndroid\n12.410455\nTrue\n\n\n4\nLinux\n7.023155\nTrue\n\n\n5\nChrome OS\n5.122581\nTrue\n\n\n6\n(not set)\n0.057266\nTrue\n\n\n7\nWindows Phone\n0.042139\nTrue\n\n\n8\nNintendo Wii\n0.011885\nTrue\n\n\n9\nBlackBerry\n0.010805\nTrue\n\n\n10\nXbox\n0.009724\nTrue\n\n\n11\nNokia\n0.001080\nTrue\n\n\n12\nSunOS\n0.001080\nTrue\n\n\n13\nSamsung\n0.001080\nTrue\n\n\n14\nFreeBSD\n0.001080\nTrue\n\n\n\n\n\n\n\n\n\n\n \ndeviceCategory\nproportion\nshowing_all_cats\n\n\n\n\n0\ndesktop\n72.776091\nTrue\n\n\n1\nmobile\n23.543776\nTrue\n\n\n2\ntablet\n3.680133\nTrue\n\n\n\n\n\n\n\n\n\n\n\nObservations\n\n\n\n\nEach of the top two to four categories account for &gt;10% of observations (visitors) in all nine of the categorical features. Four (channelGrouping, os, medium and last_action) of the nine categorical features have categories that occur with a frequency of between 5 - 10%. Based on the training data, a minimum required frequency of 10% appears to be a reasonable starting point for replacing infrequently occurring categories.\n\n\n\n\n\nDistribution of Numerical Features\n\n\n\n\n\n\n\n\n\n\n\nObservations\n\n\n\n\nFor numerical features among return visitors who did not make a purchase (Return Purchasers = False)\n\nthere is a wider range of outliers\nthe IQR range (height of the box) is more well-defined (smaller)\naverage value (horizontal line inside the box) is generally higher\n\nthan for the same features among those visitors who did.\nBased on univariate analaysis, the overall numerical features contain approximately 8-11% of outliers. promotions clicked is the only feature with more outliers (15%).\n\n\n\n\n\nConversion Rates Among Categorical Features\n\n\n\n\n\n\n\n\n\n\n\nObservations\n\n\n\n\n(bounces) A smaller fraction of return purchasers bounced off the page than for non-return purchasers. It seems keeping visitors engaged during their first visit is a good indicator for getting their business during a return visit to the store.\n(desktop) The largest fraction of return purchasers used a desktop computer during their first visit. This dataset captures visitors from as early as August 2016 to as late as August 2017. With increased mobile phone use since then, these proportions might have changed over time. Nonetheless, finding higher desktop usage overall (not just among return purchasers) seems like a reasonable observation for this dataset.\n(operating system) The largest fraction of return purchasers used a desktop-based operating system (Mac, Windows and Linux) to access the store during their first visit. This is not surprising based on the above observation about the high fraction desktop use among return purcasers. Notably, Android and iOS show a relatively higher ratio of visitors who did not make a return purchase compared to other operating systems (see relative widths of the grey bars). This suggests mobile devices might have been used by visitors who possibly did not plan to make a return purchase and only wanted to browse the store, while a desktop computer was used by visitors who made a return purchase.\n(browser) Chrome was the dominant browser, ahead of a grouping of Safari and Firefox. The Microsoft Edge browser was only released in July 2015, so it not surprising that Edge is a little further back from Safari and Firefox.\n(channel, medium and source) Based on source, medium and channel, return purchasers\n\ndirectly accessed the store’s site (manually typed in the URL of the store)\n\nmedium=None\nchannel=Direct\nsource=(direct)\n\nrelied on referrals (visitor clicked a link to the store on another site - 1, 2)\n\nchannel=Referral\nmedium=Referral\n\naccessed the store site by clicking on a link from a non-paid search result in a search engine\n\nchannel=Organic Search\nmedium=organic\n\nduring their first visit. From the chart for the source feature, we see that the dominant search engine (contributing to the organic search results) is Google Search.\n\n(last action) Qualitatively, the largest fraction (ratio of red bar to grey bar) of return purchasers\n\nadded a product to their shopping cart\nchecked out\ncompleted a purchase\nremoved a product from their shopping cart\n\nas the last action during their first visit to the store. The largest number (length of red bar) of return purchasers\n\nperformed an action that could not be tracked by the embedded Google Analytics tracking script\nviewed product details\nadded a product to their shopping cart\n\nas the last action during their first visit to the store.\n\n\n\n\n\nNumerical Feature Interactions\n\n\n\n\n\n\nSlow Execution\n\n\n\nAs the length of the data grows (as more months of training data are used), it takes longer to retrieve feature interactions.\n\n\n\n\n/opt/conda/envs/train/lib/python3.11/site-packages/seaborn/axisgrid.py:118: UserWarning: The figure layout has changed to tight\n  self._figure.tight_layout(*args, **kwargs)\n\n\n\n\n\n\n\n\n\n\n\nObservations\n\n\n\n\nInter-feature correlations are observed between hits and product clicks or between hits and page views. Qualitatively, the other feature interactions do not show evidence of a correlation."
  },
  {
    "objectID": "notebooks/02-train/notebooks/04_train.html#ml-pipeline",
    "href": "notebooks/02-train/notebooks/04_train.html#ml-pipeline",
    "title": "ML Development",
    "section": "ML Pipeline",
    "text": "ML Pipeline\nAs indicated in the EDA section, all non-ID features will be passed into the ML pipeline. The ML pipeline will first perform feature engineering and preprocessing. This step is named preprocessor. The next step of the pipeline (named select) will select features based on feature-to-feature correlations.\n\nFeature Selection - SQL\nSeveral features were selected extracted from the raw GA360 data using BigQuery SQL. These features were selected based on intuition about factors that would be helpful to predict future (return) visit propensity.\n\n\nFeature Selection - Python\nHighly correlated features will be dropped and all remaining features (low or moderately correlated to eachother) will be selected.\n\n\nFeature Engineering - SQL\nAs part of the data retrieval from the Google Analytics tracking data for the merchandise store’s site, the following features of the first visit were engineered using SQL\n\nlast_action\n\nlast action performed during the first visit\n\nadded_to_cart\n\nnumber of products added to shopping cart during the first visit\n\n\nAll other features were extracted directly from the raw GA360 data, without being engineered.\n\n\nFeature Engineering - Python\nFeature engineering is performed on the raw data, before pre-processing. For each numerical feature, we’ll extract three new features as the ratio to the mean. The intuition behind this transformation is that visitors with a higher-than-average number of pages viewed on their first visit have a higher likelihood of making a purchase on a return visit. This is implemented in src/feature_helpers.py using a scikit-learn custom transformer.\n\n\nFeature Pre-Processing\nA feature processing pipeline is defined with the following steps\n\nnumerical columns\n\nfeature engineering\nnormalization\n\ncategorical columns\n\nfrequency encoding\ndummy encoding\n\nfeature selection\n\ndrop highly correlated features (r &gt; 0.7)\nkeep weakly (r &lt; 0.5) and moderately (r &gt; 0.5 and r &lt; 0.7) corelated features\n\n\n\n\nPipeline\nIn the overall ML pipeline, preprocessing is performed in combination with under-sampling or over-sampling in order to handle the class imbalance. If the observations are undersampled, then this is done before preprocessing features. By comparison , if they are oversampled, then this is done after preprocessing features.\nAfter preprocessing, the class-imbalance increases in favor of the minority class. The class imbalances can be the same after preprocessing using under- and over-sampling. The sampling_strategy hyperparameter determines the imbalance in the label after resampling. If hyperparameter is the same for over- and under-sampling then both approaches produce the same class imbalance after resampling. For this reason, equal class imbalances is possible with both approaches. With the same sampling_strategy hyperparameter, the number of remaining observations after resampling can be different depending on whether under- or over-sampling is used, since both resampling approaches work differently.\nOver-sampling adds more observations in the minority class and so there are more observations in this class after over-sampling. For under-sampling, the number of such minority-class observations are unchanged, since observations are removed from the majority class.\n\n\nPipeline(steps=[('preprocessor',\n                 ColumnTransformer(transformers=[('num',\n                                                  Pipeline(steps=[('aboveavg',\n                                                                   AboveAveragePagePromoEngager(cols=['hits',\n                                                                                                      'promos_displayed',\n                                                                                                      'promos_clicked',\n                                                                                                      'product_views',\n                                                                                                      'product_clicks',\n                                                                                                      'pageviews',\n                                                                                                      'time_on_site'])),\n                                                                  ('scaler',\n                                                                   MinMaxScaler())]),\n                                                  ['hits', 'promos_displayed',\n                                                   'promos_clicked',\n                                                   'product_views',\n                                                   'product_clicks',\n                                                   'page...\n                                                                                                     'last_action',\n                                                                                                     'source',\n                                                                                                     'medium',\n                                                                                                     'channelGrouping',\n                                                                                                     'browser',\n                                                                                                     'os',\n                                                                                                     'deviceCategory'])])),\n                                                                  ('dummy',\n                                                                   OneHotEncoder(drop='first',\n                                                                                 dtype=&lt;class 'int'&gt;,\n                                                                                 handle_unknown='ignore'))]),\n                                                  ['bounces', 'last_action',\n                                                   'source', 'medium',\n                                                   'channelGrouping', 'browser',\n                                                   'os', 'deviceCategory'])])),\n                ('select', DropCorrelatedFeatures()),\n                ('resampler', RandomOverSampler(random_state=88))])In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.PipelinePipeline(steps=[('preprocessor',\n                 ColumnTransformer(transformers=[('num',\n                                                  Pipeline(steps=[('aboveavg',\n                                                                   AboveAveragePagePromoEngager(cols=['hits',\n                                                                                                      'promos_displayed',\n                                                                                                      'promos_clicked',\n                                                                                                      'product_views',\n                                                                                                      'product_clicks',\n                                                                                                      'pageviews',\n                                                                                                      'time_on_site'])),\n                                                                  ('scaler',\n                                                                   MinMaxScaler())]),\n                                                  ['hits', 'promos_displayed',\n                                                   'promos_clicked',\n                                                   'product_views',\n                                                   'product_clicks',\n                                                   'page...\n                                                                                                     'last_action',\n                                                                                                     'source',\n                                                                                                     'medium',\n                                                                                                     'channelGrouping',\n                                                                                                     'browser',\n                                                                                                     'os',\n                                                                                                     'deviceCategory'])])),\n                                                                  ('dummy',\n                                                                   OneHotEncoder(drop='first',\n                                                                                 dtype=&lt;class 'int'&gt;,\n                                                                                 handle_unknown='ignore'))]),\n                                                  ['bounces', 'last_action',\n                                                   'source', 'medium',\n                                                   'channelGrouping', 'browser',\n                                                   'os', 'deviceCategory'])])),\n                ('select', DropCorrelatedFeatures()),\n                ('resampler', RandomOverSampler(random_state=88))])preprocessor: ColumnTransformerColumnTransformer(transformers=[('num',\n                                 Pipeline(steps=[('aboveavg',\n                                                  AboveAveragePagePromoEngager(cols=['hits',\n                                                                                     'promos_displayed',\n                                                                                     'promos_clicked',\n                                                                                     'product_views',\n                                                                                     'product_clicks',\n                                                                                     'pageviews',\n                                                                                     'time_on_site'])),\n                                                 ('scaler', MinMaxScaler())]),\n                                 ['hits', 'promos_displayed', 'promos_clicked',\n                                  'product_views', 'product_clicks',\n                                  'pageviews', 'time_on_site']),\n                                ('cat',\n                                 P...\n                                                  ColumnTransformer(remainder='passthrough',\n                                                                    transformers=[('fe',\n                                                                                   RareLabelEncoder(variables=['source',\n                                                                                                               'browser']),\n                                                                                   ['bounces',\n                                                                                    'last_action',\n                                                                                    'source',\n                                                                                    'medium',\n                                                                                    'channelGrouping',\n                                                                                    'browser',\n                                                                                    'os',\n                                                                                    'deviceCategory'])])),\n                                                 ('dummy',\n                                                  OneHotEncoder(drop='first',\n                                                                dtype=&lt;class 'int'&gt;,\n                                                                handle_unknown='ignore'))]),\n                                 ['bounces', 'last_action', 'source', 'medium',\n                                  'channelGrouping', 'browser', 'os',\n                                  'deviceCategory'])])num['hits', 'promos_displayed', 'promos_clicked', 'product_views', 'product_clicks', 'pageviews', 'time_on_site']AboveAveragePagePromoEngagerAboveAveragePagePromoEngager(cols=['hits', 'promos_displayed', 'promos_clicked',\n                                   'product_views', 'product_clicks',\n                                   'pageviews', 'time_on_site'])MinMaxScalerMinMaxScaler()cat['bounces', 'last_action', 'source', 'medium', 'channelGrouping', 'browser', 'os', 'deviceCategory']rarecats: ColumnTransformerColumnTransformer(remainder='passthrough',\n                  transformers=[('fe',\n                                 RareLabelEncoder(variables=['source',\n                                                             'browser']),\n                                 ['bounces', 'last_action', 'source', 'medium',\n                                  'channelGrouping', 'browser', 'os',\n                                  'deviceCategory'])])fe['bounces', 'last_action', 'source', 'medium', 'channelGrouping', 'browser', 'os', 'deviceCategory']RareLabelEncoderRareLabelEncoder(variables=['source', 'browser'])remainderpassthroughpassthroughOneHotEncoderOneHotEncoder(drop='first', dtype=&lt;class 'int'&gt;, handle_unknown='ignore')DropCorrelatedFeaturesDropCorrelatedFeatures()RandomOverSamplerRandomOverSampler(random_state=88)"
  },
  {
    "objectID": "notebooks/02-train/notebooks/04_train.html#model-development",
    "href": "notebooks/02-train/notebooks/04_train.html#model-development",
    "title": "ML Development",
    "section": "Model Development",
    "text": "Model Development\n\nDefine Cross-Validator\nA single validation fold (the validation data split) is used to validate the ML pipeline. A cross-validator is defined using sklearn’s PredefinedSplit to train the pipeline on the training data split and evaluate predictions on the validation data split.\n\n\nAppend ML Model to Pipeline\n\n\nPipeline(steps=[('preprocessor',\n                 ColumnTransformer(transformers=[('num',\n                                                  Pipeline(steps=[('aboveavg',\n                                                                   AboveAveragePagePromoEngager(cols=['hits',\n                                                                                                      'promos_displayed',\n                                                                                                      'promos_clicked',\n                                                                                                      'product_views',\n                                                                                                      'product_clicks',\n                                                                                                      'pageviews',\n                                                                                                      'time_on_site'])),\n                                                                  ('scaler',\n                                                                   MinMaxScaler())]),\n                                                  ['hits', 'promos_displayed',\n                                                   'promos_clicked',\n                                                   'product_views',\n                                                   'product_clicks',\n                                                   'page...\n                                                                                                     'channelGrouping',\n                                                                                                     'browser',\n                                                                                                     'os',\n                                                                                                     'deviceCategory'])])),\n                                                                  ('dummy',\n                                                                   OneHotEncoder(drop='first',\n                                                                                 dtype=&lt;class 'int'&gt;,\n                                                                                 handle_unknown='ignore'))]),\n                                                  ['bounces', 'last_action',\n                                                   'source', 'medium',\n                                                   'channelGrouping', 'browser',\n                                                   'os', 'deviceCategory'])])),\n                ('select', DropCorrelatedFeatures()),\n                ('resampler', RandomOverSampler(random_state=88)),\n                ['clf', BetaDistClassifier(random_state=88)]])In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.PipelinePipeline(steps=[('preprocessor',\n                 ColumnTransformer(transformers=[('num',\n                                                  Pipeline(steps=[('aboveavg',\n                                                                   AboveAveragePagePromoEngager(cols=['hits',\n                                                                                                      'promos_displayed',\n                                                                                                      'promos_clicked',\n                                                                                                      'product_views',\n                                                                                                      'product_clicks',\n                                                                                                      'pageviews',\n                                                                                                      'time_on_site'])),\n                                                                  ('scaler',\n                                                                   MinMaxScaler())]),\n                                                  ['hits', 'promos_displayed',\n                                                   'promos_clicked',\n                                                   'product_views',\n                                                   'product_clicks',\n                                                   'page...\n                                                                                                     'channelGrouping',\n                                                                                                     'browser',\n                                                                                                     'os',\n                                                                                                     'deviceCategory'])])),\n                                                                  ('dummy',\n                                                                   OneHotEncoder(drop='first',\n                                                                                 dtype=&lt;class 'int'&gt;,\n                                                                                 handle_unknown='ignore'))]),\n                                                  ['bounces', 'last_action',\n                                                   'source', 'medium',\n                                                   'channelGrouping', 'browser',\n                                                   'os', 'deviceCategory'])])),\n                ('select', DropCorrelatedFeatures()),\n                ('resampler', RandomOverSampler(random_state=88)),\n                ['clf', BetaDistClassifier(random_state=88)]])preprocessor: ColumnTransformerColumnTransformer(transformers=[('num',\n                                 Pipeline(steps=[('aboveavg',\n                                                  AboveAveragePagePromoEngager(cols=['hits',\n                                                                                     'promos_displayed',\n                                                                                     'promos_clicked',\n                                                                                     'product_views',\n                                                                                     'product_clicks',\n                                                                                     'pageviews',\n                                                                                     'time_on_site'])),\n                                                 ('scaler', MinMaxScaler())]),\n                                 ['hits', 'promos_displayed', 'promos_clicked',\n                                  'product_views', 'product_clicks',\n                                  'pageviews', 'time_on_site']),\n                                ('cat',\n                                 P...\n                                                  ColumnTransformer(remainder='passthrough',\n                                                                    transformers=[('fe',\n                                                                                   RareLabelEncoder(variables=['source',\n                                                                                                               'browser']),\n                                                                                   ['bounces',\n                                                                                    'last_action',\n                                                                                    'source',\n                                                                                    'medium',\n                                                                                    'channelGrouping',\n                                                                                    'browser',\n                                                                                    'os',\n                                                                                    'deviceCategory'])])),\n                                                 ('dummy',\n                                                  OneHotEncoder(drop='first',\n                                                                dtype=&lt;class 'int'&gt;,\n                                                                handle_unknown='ignore'))]),\n                                 ['bounces', 'last_action', 'source', 'medium',\n                                  'channelGrouping', 'browser', 'os',\n                                  'deviceCategory'])])num['hits', 'promos_displayed', 'promos_clicked', 'product_views', 'product_clicks', 'pageviews', 'time_on_site']AboveAveragePagePromoEngagerAboveAveragePagePromoEngager(cols=['hits', 'promos_displayed', 'promos_clicked',\n                                   'product_views', 'product_clicks',\n                                   'pageviews', 'time_on_site'])MinMaxScalerMinMaxScaler()cat['bounces', 'last_action', 'source', 'medium', 'channelGrouping', 'browser', 'os', 'deviceCategory']rarecats: ColumnTransformerColumnTransformer(remainder='passthrough',\n                  transformers=[('fe',\n                                 RareLabelEncoder(variables=['source',\n                                                             'browser']),\n                                 ['bounces', 'last_action', 'source', 'medium',\n                                  'channelGrouping', 'browser', 'os',\n                                  'deviceCategory'])])fe['bounces', 'last_action', 'source', 'medium', 'channelGrouping', 'browser', 'os', 'deviceCategory']RareLabelEncoderRareLabelEncoder(variables=['source', 'browser'])remainderpassthroughpassthroughOneHotEncoderOneHotEncoder(drop='first', dtype=&lt;class 'int'&gt;, handle_unknown='ignore')DropCorrelatedFeaturesDropCorrelatedFeatures()RandomOverSamplerRandomOverSampler(random_state=88)BetaDistClassifierBetaDistClassifier(random_state=88)\n\n\n\n\nHyper-Parameter Tuning\nPerform hyper-parameter tuning\n\n\nFitting 1 folds for each of 30 candidates, totalling 30 fits\n[CV] END clf__a=0.2, clf__b=2.31, preprocessor__cat__rarecats__fe__ignore_format=True, preprocessor__cat__rarecats__fe__n_categories=1, preprocessor__cat__rarecats__fe__replace_with=other, preprocessor__cat__rarecats__fe__tol=0.1, resampler__sampling_strategy=0.1, select__threshold=0.7; total time=   0.9s\n[CV] END clf__a=0.2, clf__b=2.25, preprocessor__cat__rarecats__fe__ignore_format=True, preprocessor__cat__rarecats__fe__n_categories=1, preprocessor__cat__rarecats__fe__replace_with=other, preprocessor__cat__rarecats__fe__tol=0.1, resampler__sampling_strategy=0.1, select__threshold=0.7; total time=   0.9s\n[CV] END clf__a=0.2, clf__b=2.35, preprocessor__cat__rarecats__fe__ignore_format=True, preprocessor__cat__rarecats__fe__n_categories=1, preprocessor__cat__rarecats__fe__replace_with=other, preprocessor__cat__rarecats__fe__tol=0.1, resampler__sampling_strategy=0.1, select__threshold=0.7; total time=   0.9s\n[CV] END clf__a=0.2, clf__b=2.4, preprocessor__cat__rarecats__fe__ignore_format=True, preprocessor__cat__rarecats__fe__n_categories=1, preprocessor__cat__rarecats__fe__replace_with=other, preprocessor__cat__rarecats__fe__tol=0.1, resampler__sampling_strategy=0.1, select__threshold=0.7; total time=   0.9s\n[CV] END clf__a=0.2, clf__b=2.5, preprocessor__cat__rarecats__fe__ignore_format=True, preprocessor__cat__rarecats__fe__n_categories=1, preprocessor__cat__rarecats__fe__replace_with=other, preprocessor__cat__rarecats__fe__tol=0.1, resampler__sampling_strategy=0.1, select__threshold=0.7; total time=   0.9s\n[CV] END clf__a=0.3, clf__b=2.31, preprocessor__cat__rarecats__fe__ignore_format=True, preprocessor__cat__rarecats__fe__n_categories=1, preprocessor__cat__rarecats__fe__replace_with=other, preprocessor__cat__rarecats__fe__tol=0.1, resampler__sampling_strategy=0.1, select__threshold=0.7; total time=   0.9s\n[CV] END clf__a=0.3, clf__b=2.25, preprocessor__cat__rarecats__fe__ignore_format=True, preprocessor__cat__rarecats__fe__n_categories=1, preprocessor__cat__rarecats__fe__replace_with=other, preprocessor__cat__rarecats__fe__tol=0.1, resampler__sampling_strategy=0.1, select__threshold=0.7; total time=   0.9s\n[CV] END clf__a=0.3, clf__b=2.35, preprocessor__cat__rarecats__fe__ignore_format=True, preprocessor__cat__rarecats__fe__n_categories=1, preprocessor__cat__rarecats__fe__replace_with=other, preprocessor__cat__rarecats__fe__tol=0.1, resampler__sampling_strategy=0.1, select__threshold=0.7; total time=   0.9s\n[CV] END clf__a=0.3, clf__b=2.4, preprocessor__cat__rarecats__fe__ignore_format=True, preprocessor__cat__rarecats__fe__n_categories=1, preprocessor__cat__rarecats__fe__replace_with=other, preprocessor__cat__rarecats__fe__tol=0.1, resampler__sampling_strategy=0.1, select__threshold=0.7; total time=   0.9s\n[CV] END clf__a=0.3, clf__b=2.5, preprocessor__cat__rarecats__fe__ignore_format=True, preprocessor__cat__rarecats__fe__n_categories=1, preprocessor__cat__rarecats__fe__replace_with=other, preprocessor__cat__rarecats__fe__tol=0.1, resampler__sampling_strategy=0.1, select__threshold=0.7; total time=   0.9s\n[CV] END clf__a=0.4, clf__b=2.31, preprocessor__cat__rarecats__fe__ignore_format=True, preprocessor__cat__rarecats__fe__n_categories=1, preprocessor__cat__rarecats__fe__replace_with=other, preprocessor__cat__rarecats__fe__tol=0.1, resampler__sampling_strategy=0.1, select__threshold=0.7; total time=   0.9s\n[CV] END clf__a=0.4, clf__b=2.25, preprocessor__cat__rarecats__fe__ignore_format=True, preprocessor__cat__rarecats__fe__n_categories=1, preprocessor__cat__rarecats__fe__replace_with=other, preprocessor__cat__rarecats__fe__tol=0.1, resampler__sampling_strategy=0.1, select__threshold=0.7; total time=   0.9s\n[CV] END clf__a=0.4, clf__b=2.35, preprocessor__cat__rarecats__fe__ignore_format=True, preprocessor__cat__rarecats__fe__n_categories=1, preprocessor__cat__rarecats__fe__replace_with=other, preprocessor__cat__rarecats__fe__tol=0.1, resampler__sampling_strategy=0.1, select__threshold=0.7; total time=   0.9s\n[CV] END clf__a=0.4, clf__b=2.4, preprocessor__cat__rarecats__fe__ignore_format=True, preprocessor__cat__rarecats__fe__n_categories=1, preprocessor__cat__rarecats__fe__replace_with=other, preprocessor__cat__rarecats__fe__tol=0.1, resampler__sampling_strategy=0.1, select__threshold=0.7; total time=   0.9s\n[CV] END clf__a=0.4, clf__b=2.5, preprocessor__cat__rarecats__fe__ignore_format=True, preprocessor__cat__rarecats__fe__n_categories=1, preprocessor__cat__rarecats__fe__replace_with=other, preprocessor__cat__rarecats__fe__tol=0.1, resampler__sampling_strategy=0.1, select__threshold=0.7; total time=   0.9s\n[CV] END clf__a=0.35, clf__b=2.31, preprocessor__cat__rarecats__fe__ignore_format=True, preprocessor__cat__rarecats__fe__n_categories=1, preprocessor__cat__rarecats__fe__replace_with=other, preprocessor__cat__rarecats__fe__tol=0.1, resampler__sampling_strategy=0.1, select__threshold=0.7; total time=   0.9s\n[CV] END clf__a=0.35, clf__b=2.25, preprocessor__cat__rarecats__fe__ignore_format=True, preprocessor__cat__rarecats__fe__n_categories=1, preprocessor__cat__rarecats__fe__replace_with=other, preprocessor__cat__rarecats__fe__tol=0.1, resampler__sampling_strategy=0.1, select__threshold=0.7; total time=   0.9s\n[CV] END clf__a=0.35, clf__b=2.35, preprocessor__cat__rarecats__fe__ignore_format=True, preprocessor__cat__rarecats__fe__n_categories=1, preprocessor__cat__rarecats__fe__replace_with=other, preprocessor__cat__rarecats__fe__tol=0.1, resampler__sampling_strategy=0.1, select__threshold=0.7; total time=   0.9s\n[CV] END clf__a=0.35, clf__b=2.4, preprocessor__cat__rarecats__fe__ignore_format=True, preprocessor__cat__rarecats__fe__n_categories=1, preprocessor__cat__rarecats__fe__replace_with=other, preprocessor__cat__rarecats__fe__tol=0.1, resampler__sampling_strategy=0.1, select__threshold=0.7; total time=   0.9s\n[CV] END clf__a=0.35, clf__b=2.5, preprocessor__cat__rarecats__fe__ignore_format=True, preprocessor__cat__rarecats__fe__n_categories=1, preprocessor__cat__rarecats__fe__replace_with=other, preprocessor__cat__rarecats__fe__tol=0.1, resampler__sampling_strategy=0.1, select__threshold=0.7; total time=   0.9s\n[CV] END clf__a=0.15, clf__b=2.31, preprocessor__cat__rarecats__fe__ignore_format=True, preprocessor__cat__rarecats__fe__n_categories=1, preprocessor__cat__rarecats__fe__replace_with=other, preprocessor__cat__rarecats__fe__tol=0.1, resampler__sampling_strategy=0.1, select__threshold=0.7; total time=   0.9s\n[CV] END clf__a=0.15, clf__b=2.25, preprocessor__cat__rarecats__fe__ignore_format=True, preprocessor__cat__rarecats__fe__n_categories=1, preprocessor__cat__rarecats__fe__replace_with=other, preprocessor__cat__rarecats__fe__tol=0.1, resampler__sampling_strategy=0.1, select__threshold=0.7; total time=   0.9s\n[CV] END clf__a=0.15, clf__b=2.35, preprocessor__cat__rarecats__fe__ignore_format=True, preprocessor__cat__rarecats__fe__n_categories=1, preprocessor__cat__rarecats__fe__replace_with=other, preprocessor__cat__rarecats__fe__tol=0.1, resampler__sampling_strategy=0.1, select__threshold=0.7; total time=   0.9s\n[CV] END clf__a=0.15, clf__b=2.4, preprocessor__cat__rarecats__fe__ignore_format=True, preprocessor__cat__rarecats__fe__n_categories=1, preprocessor__cat__rarecats__fe__replace_with=other, preprocessor__cat__rarecats__fe__tol=0.1, resampler__sampling_strategy=0.1, select__threshold=0.7; total time=   0.9s\n[CV] END clf__a=0.15, clf__b=2.5, preprocessor__cat__rarecats__fe__ignore_format=True, preprocessor__cat__rarecats__fe__n_categories=1, preprocessor__cat__rarecats__fe__replace_with=other, preprocessor__cat__rarecats__fe__tol=0.1, resampler__sampling_strategy=0.1, select__threshold=0.7; total time=   0.9s\n[CV] END clf__a=0.45, clf__b=2.31, preprocessor__cat__rarecats__fe__ignore_format=True, preprocessor__cat__rarecats__fe__n_categories=1, preprocessor__cat__rarecats__fe__replace_with=other, preprocessor__cat__rarecats__fe__tol=0.1, resampler__sampling_strategy=0.1, select__threshold=0.7; total time=   0.9s\n[CV] END clf__a=0.45, clf__b=2.25, preprocessor__cat__rarecats__fe__ignore_format=True, preprocessor__cat__rarecats__fe__n_categories=1, preprocessor__cat__rarecats__fe__replace_with=other, preprocessor__cat__rarecats__fe__tol=0.1, resampler__sampling_strategy=0.1, select__threshold=0.7; total time=   0.9s\n[CV] END clf__a=0.45, clf__b=2.35, preprocessor__cat__rarecats__fe__ignore_format=True, preprocessor__cat__rarecats__fe__n_categories=1, preprocessor__cat__rarecats__fe__replace_with=other, preprocessor__cat__rarecats__fe__tol=0.1, resampler__sampling_strategy=0.1, select__threshold=0.7; total time=   0.9s\n[CV] END clf__a=0.45, clf__b=2.4, preprocessor__cat__rarecats__fe__ignore_format=True, preprocessor__cat__rarecats__fe__n_categories=1, preprocessor__cat__rarecats__fe__replace_with=other, preprocessor__cat__rarecats__fe__tol=0.1, resampler__sampling_strategy=0.1, select__threshold=0.7; total time=   0.9s\n[CV] END clf__a=0.45, clf__b=2.5, preprocessor__cat__rarecats__fe__ignore_format=True, preprocessor__cat__rarecats__fe__n_categories=1, preprocessor__cat__rarecats__fe__replace_with=other, preprocessor__cat__rarecats__fe__tol=0.1, resampler__sampling_strategy=0.1, select__threshold=0.7; total time=   0.9s\nDone with hyperparameter tuning\nCPU times: user 27.8 s, sys: 1.16 s, total: 28.9 s\nWall time: 28.9 s\n\n\n\n\nGet Validation Hyper-Parameters and Metrics\n\n\n\n\n\n\n\n\n\nresampling_approach\nclf\nparam_clf__a\nparam_clf__b\nparam_preprocessor__cat__rarecats__fe__ignore_format\nparam_preprocessor__cat__rarecats__fe__n_categories\nparam_preprocessor__cat__rarecats__fe__replace_with\nparam_preprocessor__cat__rarecats__fe__tol\nparam_resampler__sampling_strategy\nparam_select__threshold\nmean_test_accuracy\nmean_test_balanced_accuracy\nmean_test_precision\nmean_test_recall\nmean_test_roc_auc\nmean_test_f1\nmean_test_fbeta05\nmean_test_fbeta2\nmean_test_pr_auc\nmean_test_avg_precision\nmean_fit_time\nmean_score_time\n\n\n\n\n0\nos\nBetaDistClassifier\n0.2\n2.31\nTrue\n1\nother\n0.1\n0.1\n0.7\n0.937904\n0.501539\n0.501726\n0.501539\n0.501539\n0.501568\n0.501646\n0.501536\n0.035103\n0.034205\n0.809488\n0.123062\n\n\n1\nos\nBetaDistClassifier\n0.2\n2.25\nTrue\n1\nother\n0.1\n0.1\n0.7\n0.935732\n0.497742\n0.497604\n0.497742\n0.497742\n0.497659\n0.497622\n0.497705\n0.034681\n0.033965\n0.805559\n0.12235\n\n\n2\nos\nBetaDistClassifier\n0.2\n2.35\nTrue\n1\nother\n0.1\n0.1\n0.7\n0.938707\n0.499282\n0.499163\n0.499282\n0.499282\n0.499125\n0.499121\n0.499198\n0.032796\n0.034049\n0.805286\n0.121149\n\n\n3\nos\nBetaDistClassifier\n0.2\n2.4\nTrue\n1\nother\n0.1\n0.1\n0.7\n0.940549\n0.504244\n0.505168\n0.504244\n0.504244\n0.504495\n0.50484\n0.504301\n0.035744\n0.034455\n0.803107\n0.122443\n\n\n4\nos\nBetaDistClassifier\n0.2\n2.5\nTrue\n1\nother\n0.1\n0.1\n0.7\n0.942532\n0.499926\n0.4999\n0.499926\n0.499926\n0.499561\n0.499658\n0.499713\n0.032515\n0.034089\n0.801959\n0.121958\n\n\n5\nos\nBetaDistClassifier\n0.3\n2.31\nTrue\n1\nother\n0.1\n0.1\n0.7\n0.919866\n0.498214\n0.498741\n0.498214\n0.498214\n0.497814\n0.498251\n0.497846\n0.034976\n0.033984\n0.803779\n0.122666\n\n\n6\nos\nBetaDistClassifier\n0.3\n2.25\nTrue\n1\nother\n0.1\n0.1\n0.7\n0.91741\n0.498947\n0.499295\n0.498947\n0.498947\n0.498194\n0.498695\n0.498343\n0.033065\n0.034027\n0.81925\n0.122459\n\n\n7\nos\nBetaDistClassifier\n0.3\n2.35\nTrue\n1\nother\n0.1\n0.1\n0.7\n0.921471\n0.499713\n0.499792\n0.499713\n0.499713\n0.499173\n0.499437\n0.499319\n0.035574\n0.034075\n0.802816\n0.122655\n\n\n8\nos\nBetaDistClassifier\n0.3\n2.4\nTrue\n1\nother\n0.1\n0.1\n0.7\n0.925296\n0.509042\n0.506949\n0.509042\n0.509042\n0.50747\n0.507056\n0.508258\n0.034781\n0.034921\n0.802461\n0.12219\n\n\n9\nos\nBetaDistClassifier\n0.3\n2.5\nTrue\n1\nother\n0.1\n0.1\n0.7\n0.92728\n0.497375\n0.497806\n0.497375\n0.497375\n0.497442\n0.497629\n0.49736\n0.034528\n0.033942\n0.802324\n0.122535\n\n\n10\nos\nBetaDistClassifier\n0.4\n2.31\nTrue\n1\nother\n0.1\n0.1\n0.7\n0.905511\n0.50214\n0.501158\n0.50214\n0.50214\n0.498943\n0.499882\n0.499831\n0.032523\n0.034243\n0.805459\n0.123924\n\n\n11\nos\nBetaDistClassifier\n0.4\n2.25\nTrue\n1\nother\n0.1\n0.1\n0.7\n0.901969\n0.505651\n0.502881\n0.505651\n0.505651\n0.500615\n0.501476\n0.502187\n0.034332\n0.034524\n0.811444\n0.124512\n\n\n12\nos\nBetaDistClassifier\n0.4\n2.35\nTrue\n1\nother\n0.1\n0.1\n0.7\n0.907919\n0.502719\n0.501525\n0.502719\n0.502719\n0.499736\n0.500456\n0.50064\n0.037026\n0.034288\n0.803777\n0.122974\n\n\n13\nos\nBetaDistClassifier\n0.4\n2.4\nTrue\n1\nother\n0.1\n0.1\n0.7\n0.909619\n0.49625\n0.497806\n0.49625\n0.49625\n0.495386\n0.496584\n0.495315\n0.032283\n0.033876\n0.802748\n0.123793\n\n\n14\nos\nBetaDistClassifier\n0.4\n2.5\nTrue\n1\nother\n0.1\n0.1\n0.7\n0.914247\n0.499981\n0.499988\n0.499981\n0.499981\n0.498654\n0.499237\n0.498996\n0.033059\n0.034092\n0.801397\n0.123114\n\n\n15\nos\nBetaDistClassifier\n0.35\n2.31\nTrue\n1\nother\n0.1\n0.1\n0.7\n0.914294\n0.504682\n0.502914\n0.504682\n0.504682\n0.502182\n0.50236\n0.503125\n0.037819\n0.034452\n0.80261\n0.122525\n\n\n16\nos\nBetaDistClassifier\n0.35\n2.25\nTrue\n1\nother\n0.1\n0.1\n0.7\n0.910186\n0.496543\n0.49796\n0.496543\n0.496543\n0.495658\n0.496791\n0.49562\n0.032837\n0.033892\n0.803887\n0.122805\n\n\n17\nos\nBetaDistClassifier\n0.35\n2.35\nTrue\n1\nother\n0.1\n0.1\n0.7\n0.915097\n0.498417\n0.498985\n0.498417\n0.498417\n0.497558\n0.498224\n0.497688\n0.033328\n0.033995\n0.813213\n0.123105\n\n\n18\nos\nBetaDistClassifier\n0.35\n2.4\nTrue\n1\nother\n0.1\n0.1\n0.7\n0.916324\n0.492372\n0.494916\n0.492372\n0.492372\n0.492925\n0.493995\n0.492359\n0.032488\n0.033733\n0.803372\n0.123793\n\n\n19\nos\nBetaDistClassifier\n0.35\n2.5\nTrue\n1\nother\n0.1\n0.1\n0.7\n0.920055\n0.490963\n0.493478\n0.490963\n0.490963\n0.491824\n0.492743\n0.491186\n0.034802\n0.033715\n0.809016\n0.123184\n\n\n20\nos\nBetaDistClassifier\n0.15\n2.31\nTrue\n1\nother\n0.1\n0.1\n0.7\n0.943996\n0.496007\n0.494135\n0.496007\n0.496007\n0.494694\n0.494238\n0.495415\n0.035475\n0.033919\n0.806123\n0.12071\n\n\n21\nos\nBetaDistClassifier\n0.15\n2.25\nTrue\n1\nother\n0.1\n0.1\n0.7\n0.94291\n0.496113\n0.494564\n0.496113\n0.496113\n0.495032\n0.494656\n0.495624\n0.033018\n0.033917\n0.803947\n0.121289\n\n\n22\nos\nBetaDistClassifier\n0.15\n2.35\nTrue\n1\nother\n0.1\n0.1\n0.7\n0.945554\n0.498818\n0.498164\n0.498818\n0.498818\n0.497852\n0.497825\n0.498325\n0.031906\n0.034024\n0.811426\n0.124769\n\n\n23\nos\nBetaDistClassifier\n0.15\n2.4\nTrue\n1\nother\n0.1\n0.1\n0.7\n0.945979\n0.493693\n0.489654\n0.493693\n0.493693\n0.491306\n0.490188\n0.492679\n0.03449\n0.033925\n0.80539\n0.121918\n\n\n24\nos\nBetaDistClassifier\n0.15\n2.5\nTrue\n1\nother\n0.1\n0.1\n0.7\n0.94801\n0.495412\n0.491705\n0.495412\n0.495412\n0.492929\n0.491961\n0.494325\n0.031851\n0.033936\n0.803261\n0.122052\n\n\n25\nos\nBetaDistClassifier\n0.45\n2.31\nTrue\n1\nother\n0.1\n0.1\n0.7\n0.894319\n0.499019\n0.499544\n0.499019\n0.499019\n0.495048\n0.497207\n0.495651\n0.033661\n0.034031\n0.804827\n0.122843\n\n\n26\nos\nBetaDistClassifier\n0.45\n2.25\nTrue\n1\nother\n0.1\n0.1\n0.7\n0.890872\n0.500575\n0.500256\n0.500575\n0.500575\n0.495348\n0.497672\n0.496287\n0.032565\n0.034132\n0.805194\n0.123328\n\n\n27\nos\nBetaDistClassifier\n0.45\n2.35\nTrue\n1\nother\n0.1\n0.1\n0.7\n0.89635\n0.492053\n0.496158\n0.492053\n0.492053\n0.491043\n0.493705\n0.4904\n0.036357\n0.033679\n0.805729\n0.123224\n\n\n28\nos\nBetaDistClassifier\n0.45\n2.4\nTrue\n1\nother\n0.1\n0.1\n0.7\n0.901119\n0.502539\n0.501286\n0.502539\n0.502539\n0.498447\n0.499679\n0.499523\n0.034183\n0.034273\n0.812191\n0.123645\n\n\n29\nos\nBetaDistClassifier\n0.45\n2.5\nTrue\n1\nother\n0.1\n0.1\n0.7\n0.907352\n0.501089\n0.500608\n0.501089\n0.501089\n0.498516\n0.499426\n0.499192\n0.033904\n0.034168\n0.803499\n0.122829\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ndtype\n\n\n\n\nresampling_approach\nstring[python]\n\n\nclf\nstring[python]\n\n\nparam_clf__a\nobject\n\n\nparam_clf__b\nobject\n\n\nparam_preprocessor__cat__rarecats__fe__ignore_format\nobject\n\n\nparam_preprocessor__cat__rarecats__fe__n_categories\nInt64\n\n\nparam_preprocessor__cat__rarecats__fe__replace_with\nobject\n\n\nparam_preprocessor__cat__rarecats__fe__tol\nFloat64\n\n\nparam_resampler__sampling_strategy\nobject\n\n\nparam_select__threshold\nFloat64\n\n\nparams\nstring[python]\n\n\nmean_test_accuracy\nFloat64\n\n\nmean_test_balanced_accuracy\nFloat64\n\n\nmean_test_precision\nFloat64\n\n\nmean_test_recall\nFloat64\n\n\nmean_test_roc_auc\nFloat64\n\n\nmean_test_f1\nFloat64\n\n\nmean_test_fbeta05\nFloat64\n\n\nmean_test_fbeta2\nFloat64\n\n\nmean_test_pr_auc\nFloat64\n\n\nmean_test_avg_precision\nFloat64\n\n\nmean_fit_time\nFloat64\n\n\nmean_score_time\nFloat64\n\n\n\n\n\n\n\n\n\nGet Best Hyper-Parameters\n\n\n\n\n\n\n\n\n\nresampling_approach\nclf\nparam_clf__a\nparam_clf__b\nparam_preprocessor__cat__rarecats__fe__ignore_format\nparam_preprocessor__cat__rarecats__fe__n_categories\nparam_preprocessor__cat__rarecats__fe__replace_with\nparam_preprocessor__cat__rarecats__fe__tol\nparam_resampler__sampling_strategy\nparam_select__threshold\n...\nmean_test_precision\nmean_test_recall\nmean_test_roc_auc\nmean_test_f1\nmean_test_fbeta05\nmean_test_fbeta2\nmean_test_pr_auc\nmean_test_avg_precision\nmean_fit_time\nmean_score_time\n\n\n\n\n8\nos\nBetaDistClassifier\n0.3\n2.4\nTrue\n1\nother\n0.1\n0.1\n0.7\n...\n0.506949\n0.509042\n0.509042\n0.50747\n0.507056\n0.508258\n0.034781\n0.034921\n0.802461\n0.12219\n\n\n\n\n1 rows × 23 columns\n\n\n\n\n\nSet Best Hyper-Parameters in Pipeline\nSet best hyperparameters in new Pipeline\n\n\nPipeline(steps=[('preprocessor',\n                 ColumnTransformer(transformers=[('num',\n                                                  Pipeline(steps=[('aboveavg',\n                                                                   AboveAveragePagePromoEngager(cols=['hits',\n                                                                                                      'promos_displayed',\n                                                                                                      'promos_clicked',\n                                                                                                      'product_views',\n                                                                                                      'product_clicks',\n                                                                                                      'pageviews',\n                                                                                                      'time_on_site'])),\n                                                                  ('scaler',\n                                                                   MinMaxScaler())]),\n                                                  ['hits', 'promos_displayed',\n                                                   'promos_clicked',\n                                                   'product_views',\n                                                   'product_clicks',\n                                                   'page...\n                                                                  ('dummy',\n                                                                   OneHotEncoder(drop='first',\n                                                                                 dtype=&lt;class 'int'&gt;,\n                                                                                 handle_unknown='ignore'))]),\n                                                  ['bounces', 'last_action',\n                                                   'source', 'medium',\n                                                   'channelGrouping', 'browser',\n                                                   'os', 'deviceCategory'])])),\n                ('select', DropCorrelatedFeatures(threshold=0.7)),\n                ('resampler',\n                 RandomOverSampler(random_state=88, sampling_strategy=0.1)),\n                ['clf', BetaDistClassifier(a=0.3, b=2.4, random_state=88)]])In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.PipelinePipeline(steps=[('preprocessor',\n                 ColumnTransformer(transformers=[('num',\n                                                  Pipeline(steps=[('aboveavg',\n                                                                   AboveAveragePagePromoEngager(cols=['hits',\n                                                                                                      'promos_displayed',\n                                                                                                      'promos_clicked',\n                                                                                                      'product_views',\n                                                                                                      'product_clicks',\n                                                                                                      'pageviews',\n                                                                                                      'time_on_site'])),\n                                                                  ('scaler',\n                                                                   MinMaxScaler())]),\n                                                  ['hits', 'promos_displayed',\n                                                   'promos_clicked',\n                                                   'product_views',\n                                                   'product_clicks',\n                                                   'page...\n                                                                  ('dummy',\n                                                                   OneHotEncoder(drop='first',\n                                                                                 dtype=&lt;class 'int'&gt;,\n                                                                                 handle_unknown='ignore'))]),\n                                                  ['bounces', 'last_action',\n                                                   'source', 'medium',\n                                                   'channelGrouping', 'browser',\n                                                   'os', 'deviceCategory'])])),\n                ('select', DropCorrelatedFeatures(threshold=0.7)),\n                ('resampler',\n                 RandomOverSampler(random_state=88, sampling_strategy=0.1)),\n                ['clf', BetaDistClassifier(a=0.3, b=2.4, random_state=88)]])preprocessor: ColumnTransformerColumnTransformer(transformers=[('num',\n                                 Pipeline(steps=[('aboveavg',\n                                                  AboveAveragePagePromoEngager(cols=['hits',\n                                                                                     'promos_displayed',\n                                                                                     'promos_clicked',\n                                                                                     'product_views',\n                                                                                     'product_clicks',\n                                                                                     'pageviews',\n                                                                                     'time_on_site'])),\n                                                 ('scaler', MinMaxScaler())]),\n                                 ['hits', 'promos_displayed', 'promos_clicked',\n                                  'product_views', 'product_clicks',\n                                  'pageviews', 'time_on_site']),\n                                ('cat',\n                                 P...\n                                                                                                    n_categories=1,\n                                                                                                    replace_with='other',\n                                                                                                    tol=0.1,\n                                                                                                    variables=['source',\n                                                                                                               'browser']),\n                                                                                   ['bounces',\n                                                                                    'last_action',\n                                                                                    'source',\n                                                                                    'medium',\n                                                                                    'channelGrouping',\n                                                                                    'browser',\n                                                                                    'os',\n                                                                                    'deviceCategory'])])),\n                                                 ('dummy',\n                                                  OneHotEncoder(drop='first',\n                                                                dtype=&lt;class 'int'&gt;,\n                                                                handle_unknown='ignore'))]),\n                                 ['bounces', 'last_action', 'source', 'medium',\n                                  'channelGrouping', 'browser', 'os',\n                                  'deviceCategory'])])num['hits', 'promos_displayed', 'promos_clicked', 'product_views', 'product_clicks', 'pageviews', 'time_on_site']AboveAveragePagePromoEngagerAboveAveragePagePromoEngager(cols=['hits', 'promos_displayed', 'promos_clicked',\n                                   'product_views', 'product_clicks',\n                                   'pageviews', 'time_on_site'])MinMaxScalerMinMaxScaler()cat['bounces', 'last_action', 'source', 'medium', 'channelGrouping', 'browser', 'os', 'deviceCategory']rarecats: ColumnTransformerColumnTransformer(remainder='passthrough',\n                  transformers=[('fe',\n                                 RareLabelEncoder(ignore_format=True,\n                                                  n_categories=1,\n                                                  replace_with='other', tol=0.1,\n                                                  variables=['source',\n                                                             'browser']),\n                                 ['bounces', 'last_action', 'source', 'medium',\n                                  'channelGrouping', 'browser', 'os',\n                                  'deviceCategory'])])fe['bounces', 'last_action', 'source', 'medium', 'channelGrouping', 'browser', 'os', 'deviceCategory']RareLabelEncoderRareLabelEncoder(ignore_format=True, n_categories=1, replace_with='other',\n                 tol=0.1, variables=['source', 'browser'])remainderpassthroughpassthroughOneHotEncoderOneHotEncoder(drop='first', dtype=&lt;class 'int'&gt;, handle_unknown='ignore')DropCorrelatedFeaturesDropCorrelatedFeatures(threshold=0.7)RandomOverSamplerRandomOverSampler(random_state=88, sampling_strategy=0.1)BetaDistClassifierBetaDistClassifier(a=0.3, b=2.4, random_state=88)"
  },
  {
    "objectID": "notebooks/02-train/notebooks/04_train.html#ml-evaluation-1",
    "href": "notebooks/02-train/notebooks/04_train.html#ml-evaluation-1",
    "title": "ML Development",
    "section": "ML Evaluation",
    "text": "ML Evaluation\n\nTrain Best Pipeline Using Combined and Shuffled Training and Validation Data\n\n_ = pipe.fit(X_train_val_eval, y_train_val_eval)\n\n\n\nMake Predictions\nSoft predictions\n\ny_train_val_eval_pred_proba = pd.DataFrame(\n    pipe.predict_proba(X_train_val_eval)[:, 1], index=X_train_val_eval.index\n# ).astype(pd.Float32Dtype())\n).astype(pd.Float64Dtype())\ny_test_pred_proba = pd.DataFrame(\n    pipe.predict_proba(X_test)[:, 1], index=X_test.index\n# ).astype(pd.Float32Dtype())\n).astype(pd.Float64Dtype())\n\nConvert to hard labels, using discrimination threshold of 0.5\n\ny_train_val_eval_pred = (y_train_val_eval_pred_proba.squeeze() &gt;= 0.5).astype(\n    # pd.Int8Dtype()\n    pd.Int64Dtype()\n)\ny_test_pred = (y_test_pred_proba.squeeze() &gt;= 0.5).astype(\n    # pd.Int8Dtype()\n    pd.Int64Dtype()\n)\n\n\n\nGet Evaluation Metrics\n\n\n\n\n\n\n\nsplit\nmetric\ntrain_val\ntest\n\n\n\n\n0\naccuracy\n0.915096\n0.936669\n\n\n1\nbalanced_accuracy\n0.498810\n0.499338\n\n\n2\nprecision\n0.041504\n0.022353\n\n\n3\nrecall\n0.498810\n0.499338\n\n\n4\nroc_auc\n0.498810\n0.499338\n\n\n5\nf1\n0.498821\n0.498082\n\n\n6\nfbeta05\n0.498832\n0.498804\n\n\n7\nfbeta2\n0.498814\n0.498315\n\n\n8\npr_auc\n0.043402\n0.023243\n\n\n9\navg_precision\n0.043624\n0.023032\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ndtype\n\n\nsplit\n\n\n\n\n\nmetric\nstring[python]\n\n\ntrain_val\nFloat64\n\n\ntest\nFloat64\n\n\n\n\n\n\n\n\n\nOptimal Discrimination Threshold Tuning\nDiscrimination or decision threshold is the probability at which the minority class is chosen over the majority class, when converting soft predictions to hard labels. By default, the threshold is set at 0.5. For imbalanced data, the default threshold of 0.5 can give poor model performance. One possible approach to improving the performance of a model when working with imbalanced data is to vary the discrimination threshold (or threshold tuning), which in-turn varies the sensitivity of the model to false positives, etc. In this way, it is possible to use a brute-force grid search to find the optimal threshold for a particular use-case, based on one or more evaluation metrics.\nFrom varying the threshold using predictions made using the best pipeline, show\n\nmetrics for default threshold of 0.5\ndescriptive statistics for metrics as threshold is varied\n\n\n\n\n\n\n\n\n\n\ndtype\n\n\n\n\nmetric\nstring[python]\n\n\nt=0.5\nFloat64\n\n\nmean\nFloat64\n\n\nstd\nFloat64\n\n\nmin\nFloat64\n\n\n25%\nFloat64\n\n\n50%\nFloat64\n\n\n75%\nFloat64\n\n\nmax\nFloat64\n\n\n\n\n\n\n\nShow a visualization of evaluation metrics relative to the discrimination threshold\n\n\n\n\n\n\n\n\n\n\n\nObservations\n\n\n\n\nTo be done.\n\n\n\n\n\nTrain Best Pipeline Using All Available Combined and Shuffled Data\n\n_ = pipe.fit(X, y)\n\n\n\nGet Validation and Evaluation Metrics, Feature Metadata and Observation Metadata\nGet metrics and metadata for model evaluation\n\n\n\n\n\n\n\n\n\nresampling_approach\nclf\nparam_clf__a\nparam_clf__b\nparam_preprocessor__cat__rarecats__fe__ignore_format\nparam_preprocessor__cat__rarecats__fe__n_categories\nparam_preprocessor__cat__rarecats__fe__replace_with\nparam_preprocessor__cat__rarecats__fe__tol\nparam_resampler__sampling_strategy\nparam_select__threshold\n...\ntrain_val_f1\ntest_f1\ntrain_val_fbeta05\ntest_fbeta05\ntrain_val_fbeta2\ntest_fbeta2\ntrain_val_pr_auc\ntest_pr_auc\ntrain_val_avg_precision\ntest_avg_precision\n\n\n\n\n0\nos\nBetaDistClassifier\n0.3\n2.4\nTrue\n1\nother\n0.1\n0.1\n0.7\n...\n0.498821\n0.498082\n0.498832\n0.498804\n0.498814\n0.498315\n0.043402\n0.023243\n0.043624\n0.023032\n\n\n\n\n1 rows × 31 columns\n\n\n\nCombine metrics and metadata for model validation and evaluation, and append experiment ID and run ID\n\n\n\n\n\n\n\n\n\nresampling_approach\nclf\nparam_clf__a\nparam_clf__b\nparam_preprocessor__cat__rarecats__fe__ignore_format\nparam_preprocessor__cat__rarecats__fe__n_categories\nparam_preprocessor__cat__rarecats__fe__replace_with\nparam_preprocessor__cat__rarecats__fe__tol\nparam_resampler__sampling_strategy\nparam_select__threshold\nparams\ntest_accuracy\ntest_balanced_accuracy\ntest_precision\ntest_recall\ntest_roc_auc\ntest_f1\ntest_fbeta05\ntest_fbeta2\ntest_pr_auc\ntest_avg_precision\nfit_time\nscore_time\nexperiment_run_type\ntrain_val_accuracy\ntrain_val_balanced_accuracy\ntrain_val_precision\ntrain_val_recall\ntrain_val_roc_auc\ntrain_val_f1\ntrain_val_fbeta05\ntrain_val_fbeta2\ntrain_val_pr_auc\ntrain_val_avg_precision\ntrain_start_date\ntest_end_date\nnum_observations\nnum_columns\ncolumn_names\n\n\n\n\n0\nos\nBetaDistClassifier\n0.2\n2.31\nTrue\n1\nother\n0.1\n0.1\n0.7\n{\"clf__a\": 0.2, \"clf__b\": 2.31, \"preprocessor_...\n0.937904\n0.501539\n0.501726\n0.501539\n0.501539\n0.501568\n0.501646\n0.501536\n0.035103\n0.034205\n0.809488\n0.123062\nnested\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n20160901\n20170228\n113728\n29\n[\"fullvisitorid\", \"visitId\", \"visitNumber\", \"v...\n\n\n1\nos\nBetaDistClassifier\n0.2\n2.25\nTrue\n1\nother\n0.1\n0.1\n0.7\n{\"clf__a\": 0.2, \"clf__b\": 2.25, \"preprocessor_...\n0.935732\n0.497742\n0.497604\n0.497742\n0.497742\n0.497659\n0.497622\n0.497705\n0.034681\n0.033965\n0.805559\n0.12235\nnested\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n20160901\n20170228\n113728\n29\n[\"fullvisitorid\", \"visitId\", \"visitNumber\", \"v...\n\n\n2\nos\nBetaDistClassifier\n0.2\n2.35\nTrue\n1\nother\n0.1\n0.1\n0.7\n{\"clf__a\": 0.2, \"clf__b\": 2.35, \"preprocessor_...\n0.938707\n0.499282\n0.499163\n0.499282\n0.499282\n0.499125\n0.499121\n0.499198\n0.032796\n0.034049\n0.805286\n0.121149\nnested\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n20160901\n20170228\n113728\n29\n[\"fullvisitorid\", \"visitId\", \"visitNumber\", \"v...\n\n\n3\nos\nBetaDistClassifier\n0.2\n2.4\nTrue\n1\nother\n0.1\n0.1\n0.7\n{\"clf__a\": 0.2, \"clf__b\": 2.4, \"preprocessor__...\n0.940549\n0.504244\n0.505168\n0.504244\n0.504244\n0.504495\n0.50484\n0.504301\n0.035744\n0.034455\n0.803107\n0.122443\nnested\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n20160901\n20170228\n113728\n29\n[\"fullvisitorid\", \"visitId\", \"visitNumber\", \"v...\n\n\n4\nos\nBetaDistClassifier\n0.2\n2.5\nTrue\n1\nother\n0.1\n0.1\n0.7\n{\"clf__a\": 0.2, \"clf__b\": 2.5, \"preprocessor__...\n0.942532\n0.499926\n0.4999\n0.499926\n0.499926\n0.499561\n0.499658\n0.499713\n0.032515\n0.034089\n0.801959\n0.121958\nnested\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n20160901\n20170228\n113728\n29\n[\"fullvisitorid\", \"visitId\", \"visitNumber\", \"v...\n\n\n5\nos\nBetaDistClassifier\n0.3\n2.31\nTrue\n1\nother\n0.1\n0.1\n0.7\n{\"clf__a\": 0.3, \"clf__b\": 2.31, \"preprocessor_...\n0.919866\n0.498214\n0.498741\n0.498214\n0.498214\n0.497814\n0.498251\n0.497846\n0.034976\n0.033984\n0.803779\n0.122666\nnested\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n20160901\n20170228\n113728\n29\n[\"fullvisitorid\", \"visitId\", \"visitNumber\", \"v...\n\n\n6\nos\nBetaDistClassifier\n0.3\n2.25\nTrue\n1\nother\n0.1\n0.1\n0.7\n{\"clf__a\": 0.3, \"clf__b\": 2.25, \"preprocessor_...\n0.91741\n0.498947\n0.499295\n0.498947\n0.498947\n0.498194\n0.498695\n0.498343\n0.033065\n0.034027\n0.81925\n0.122459\nnested\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n20160901\n20170228\n113728\n29\n[\"fullvisitorid\", \"visitId\", \"visitNumber\", \"v...\n\n\n7\nos\nBetaDistClassifier\n0.3\n2.35\nTrue\n1\nother\n0.1\n0.1\n0.7\n{\"clf__a\": 0.3, \"clf__b\": 2.35, \"preprocessor_...\n0.921471\n0.499713\n0.499792\n0.499713\n0.499713\n0.499173\n0.499437\n0.499319\n0.035574\n0.034075\n0.802816\n0.122655\nnested\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n20160901\n20170228\n113728\n29\n[\"fullvisitorid\", \"visitId\", \"visitNumber\", \"v...\n\n\n8\nos\nBetaDistClassifier\n0.3\n2.4\nTrue\n1\nother\n0.1\n0.1\n0.7\n{\"clf__a\": 0.3, \"clf__b\": 2.4, \"preprocessor__...\n0.925296\n0.509042\n0.506949\n0.509042\n0.509042\n0.50747\n0.507056\n0.508258\n0.034781\n0.034921\n0.802461\n0.12219\nnested\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n20160901\n20170228\n113728\n29\n[\"fullvisitorid\", \"visitId\", \"visitNumber\", \"v...\n\n\n9\nos\nBetaDistClassifier\n0.3\n2.5\nTrue\n1\nother\n0.1\n0.1\n0.7\n{\"clf__a\": 0.3, \"clf__b\": 2.5, \"preprocessor__...\n0.92728\n0.497375\n0.497806\n0.497375\n0.497375\n0.497442\n0.497629\n0.49736\n0.034528\n0.033942\n0.802324\n0.122535\nnested\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n20160901\n20170228\n113728\n29\n[\"fullvisitorid\", \"visitId\", \"visitNumber\", \"v...\n\n\n10\nos\nBetaDistClassifier\n0.4\n2.31\nTrue\n1\nother\n0.1\n0.1\n0.7\n{\"clf__a\": 0.4, \"clf__b\": 2.31, \"preprocessor_...\n0.905511\n0.50214\n0.501158\n0.50214\n0.50214\n0.498943\n0.499882\n0.499831\n0.032523\n0.034243\n0.805459\n0.123924\nnested\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n20160901\n20170228\n113728\n29\n[\"fullvisitorid\", \"visitId\", \"visitNumber\", \"v...\n\n\n11\nos\nBetaDistClassifier\n0.4\n2.25\nTrue\n1\nother\n0.1\n0.1\n0.7\n{\"clf__a\": 0.4, \"clf__b\": 2.25, \"preprocessor_...\n0.901969\n0.505651\n0.502881\n0.505651\n0.505651\n0.500615\n0.501476\n0.502187\n0.034332\n0.034524\n0.811444\n0.124512\nnested\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n20160901\n20170228\n113728\n29\n[\"fullvisitorid\", \"visitId\", \"visitNumber\", \"v...\n\n\n12\nos\nBetaDistClassifier\n0.4\n2.35\nTrue\n1\nother\n0.1\n0.1\n0.7\n{\"clf__a\": 0.4, \"clf__b\": 2.35, \"preprocessor_...\n0.907919\n0.502719\n0.501525\n0.502719\n0.502719\n0.499736\n0.500456\n0.50064\n0.037026\n0.034288\n0.803777\n0.122974\nnested\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n20160901\n20170228\n113728\n29\n[\"fullvisitorid\", \"visitId\", \"visitNumber\", \"v...\n\n\n13\nos\nBetaDistClassifier\n0.4\n2.4\nTrue\n1\nother\n0.1\n0.1\n0.7\n{\"clf__a\": 0.4, \"clf__b\": 2.4, \"preprocessor__...\n0.909619\n0.49625\n0.497806\n0.49625\n0.49625\n0.495386\n0.496584\n0.495315\n0.032283\n0.033876\n0.802748\n0.123793\nnested\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n20160901\n20170228\n113728\n29\n[\"fullvisitorid\", \"visitId\", \"visitNumber\", \"v...\n\n\n14\nos\nBetaDistClassifier\n0.4\n2.5\nTrue\n1\nother\n0.1\n0.1\n0.7\n{\"clf__a\": 0.4, \"clf__b\": 2.5, \"preprocessor__...\n0.914247\n0.499981\n0.499988\n0.499981\n0.499981\n0.498654\n0.499237\n0.498996\n0.033059\n0.034092\n0.801397\n0.123114\nnested\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n20160901\n20170228\n113728\n29\n[\"fullvisitorid\", \"visitId\", \"visitNumber\", \"v...\n\n\n15\nos\nBetaDistClassifier\n0.35\n2.31\nTrue\n1\nother\n0.1\n0.1\n0.7\n{\"clf__a\": 0.35, \"clf__b\": 2.31, \"preprocessor...\n0.914294\n0.504682\n0.502914\n0.504682\n0.504682\n0.502182\n0.50236\n0.503125\n0.037819\n0.034452\n0.80261\n0.122525\nnested\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n20160901\n20170228\n113728\n29\n[\"fullvisitorid\", \"visitId\", \"visitNumber\", \"v...\n\n\n16\nos\nBetaDistClassifier\n0.35\n2.25\nTrue\n1\nother\n0.1\n0.1\n0.7\n{\"clf__a\": 0.35, \"clf__b\": 2.25, \"preprocessor...\n0.910186\n0.496543\n0.49796\n0.496543\n0.496543\n0.495658\n0.496791\n0.49562\n0.032837\n0.033892\n0.803887\n0.122805\nnested\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n20160901\n20170228\n113728\n29\n[\"fullvisitorid\", \"visitId\", \"visitNumber\", \"v...\n\n\n17\nos\nBetaDistClassifier\n0.35\n2.35\nTrue\n1\nother\n0.1\n0.1\n0.7\n{\"clf__a\": 0.35, \"clf__b\": 2.35, \"preprocessor...\n0.915097\n0.498417\n0.498985\n0.498417\n0.498417\n0.497558\n0.498224\n0.497688\n0.033328\n0.033995\n0.813213\n0.123105\nnested\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n20160901\n20170228\n113728\n29\n[\"fullvisitorid\", \"visitId\", \"visitNumber\", \"v...\n\n\n18\nos\nBetaDistClassifier\n0.35\n2.4\nTrue\n1\nother\n0.1\n0.1\n0.7\n{\"clf__a\": 0.35, \"clf__b\": 2.4, \"preprocessor_...\n0.916324\n0.492372\n0.494916\n0.492372\n0.492372\n0.492925\n0.493995\n0.492359\n0.032488\n0.033733\n0.803372\n0.123793\nnested\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n20160901\n20170228\n113728\n29\n[\"fullvisitorid\", \"visitId\", \"visitNumber\", \"v...\n\n\n19\nos\nBetaDistClassifier\n0.35\n2.5\nTrue\n1\nother\n0.1\n0.1\n0.7\n{\"clf__a\": 0.35, \"clf__b\": 2.5, \"preprocessor_...\n0.920055\n0.490963\n0.493478\n0.490963\n0.490963\n0.491824\n0.492743\n0.491186\n0.034802\n0.033715\n0.809016\n0.123184\nnested\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n20160901\n20170228\n113728\n29\n[\"fullvisitorid\", \"visitId\", \"visitNumber\", \"v...\n\n\n20\nos\nBetaDistClassifier\n0.15\n2.31\nTrue\n1\nother\n0.1\n0.1\n0.7\n{\"clf__a\": 0.15, \"clf__b\": 2.31, \"preprocessor...\n0.943996\n0.496007\n0.494135\n0.496007\n0.496007\n0.494694\n0.494238\n0.495415\n0.035475\n0.033919\n0.806123\n0.12071\nnested\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n20160901\n20170228\n113728\n29\n[\"fullvisitorid\", \"visitId\", \"visitNumber\", \"v...\n\n\n21\nos\nBetaDistClassifier\n0.15\n2.25\nTrue\n1\nother\n0.1\n0.1\n0.7\n{\"clf__a\": 0.15, \"clf__b\": 2.25, \"preprocessor...\n0.94291\n0.496113\n0.494564\n0.496113\n0.496113\n0.495032\n0.494656\n0.495624\n0.033018\n0.033917\n0.803947\n0.121289\nnested\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n20160901\n20170228\n113728\n29\n[\"fullvisitorid\", \"visitId\", \"visitNumber\", \"v...\n\n\n22\nos\nBetaDistClassifier\n0.15\n2.35\nTrue\n1\nother\n0.1\n0.1\n0.7\n{\"clf__a\": 0.15, \"clf__b\": 2.35, \"preprocessor...\n0.945554\n0.498818\n0.498164\n0.498818\n0.498818\n0.497852\n0.497825\n0.498325\n0.031906\n0.034024\n0.811426\n0.124769\nnested\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n20160901\n20170228\n113728\n29\n[\"fullvisitorid\", \"visitId\", \"visitNumber\", \"v...\n\n\n23\nos\nBetaDistClassifier\n0.15\n2.4\nTrue\n1\nother\n0.1\n0.1\n0.7\n{\"clf__a\": 0.15, \"clf__b\": 2.4, \"preprocessor_...\n0.945979\n0.493693\n0.489654\n0.493693\n0.493693\n0.491306\n0.490188\n0.492679\n0.03449\n0.033925\n0.80539\n0.121918\nnested\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n20160901\n20170228\n113728\n29\n[\"fullvisitorid\", \"visitId\", \"visitNumber\", \"v...\n\n\n24\nos\nBetaDistClassifier\n0.15\n2.5\nTrue\n1\nother\n0.1\n0.1\n0.7\n{\"clf__a\": 0.15, \"clf__b\": 2.5, \"preprocessor_...\n0.94801\n0.495412\n0.491705\n0.495412\n0.495412\n0.492929\n0.491961\n0.494325\n0.031851\n0.033936\n0.803261\n0.122052\nnested\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n20160901\n20170228\n113728\n29\n[\"fullvisitorid\", \"visitId\", \"visitNumber\", \"v...\n\n\n25\nos\nBetaDistClassifier\n0.45\n2.31\nTrue\n1\nother\n0.1\n0.1\n0.7\n{\"clf__a\": 0.45, \"clf__b\": 2.31, \"preprocessor...\n0.894319\n0.499019\n0.499544\n0.499019\n0.499019\n0.495048\n0.497207\n0.495651\n0.033661\n0.034031\n0.804827\n0.122843\nnested\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n20160901\n20170228\n113728\n29\n[\"fullvisitorid\", \"visitId\", \"visitNumber\", \"v...\n\n\n26\nos\nBetaDistClassifier\n0.45\n2.25\nTrue\n1\nother\n0.1\n0.1\n0.7\n{\"clf__a\": 0.45, \"clf__b\": 2.25, \"preprocessor...\n0.890872\n0.500575\n0.500256\n0.500575\n0.500575\n0.495348\n0.497672\n0.496287\n0.032565\n0.034132\n0.805194\n0.123328\nnested\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n20160901\n20170228\n113728\n29\n[\"fullvisitorid\", \"visitId\", \"visitNumber\", \"v...\n\n\n27\nos\nBetaDistClassifier\n0.45\n2.35\nTrue\n1\nother\n0.1\n0.1\n0.7\n{\"clf__a\": 0.45, \"clf__b\": 2.35, \"preprocessor...\n0.89635\n0.492053\n0.496158\n0.492053\n0.492053\n0.491043\n0.493705\n0.4904\n0.036357\n0.033679\n0.805729\n0.123224\nnested\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n20160901\n20170228\n113728\n29\n[\"fullvisitorid\", \"visitId\", \"visitNumber\", \"v...\n\n\n28\nos\nBetaDistClassifier\n0.45\n2.4\nTrue\n1\nother\n0.1\n0.1\n0.7\n{\"clf__a\": 0.45, \"clf__b\": 2.4, \"preprocessor_...\n0.901119\n0.502539\n0.501286\n0.502539\n0.502539\n0.498447\n0.499679\n0.499523\n0.034183\n0.034273\n0.812191\n0.123645\nnested\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n20160901\n20170228\n113728\n29\n[\"fullvisitorid\", \"visitId\", \"visitNumber\", \"v...\n\n\n29\nos\nBetaDistClassifier\n0.45\n2.5\nTrue\n1\nother\n0.1\n0.1\n0.7\n{\"clf__a\": 0.45, \"clf__b\": 2.5, \"preprocessor_...\n0.907352\n0.501089\n0.500608\n0.501089\n0.501089\n0.498516\n0.499426\n0.499192\n0.033904\n0.034168\n0.803499\n0.122829\nnested\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n20160901\n20170228\n113728\n29\n[\"fullvisitorid\", \"visitId\", \"visitNumber\", \"v...\n\n\n30\nos\nBetaDistClassifier\n0.3\n2.4\nTrue\n1\nother\n0.1\n0.1\n0.7\n{\"clf__a\": 0.3, \"clf__b\": 2.4, \"preprocessor__...\n0.936669\n0.499338\n0.022353\n0.499338\n0.499338\n0.498082\n0.498804\n0.498315\n0.023243\n0.023032\n&lt;NA&gt;\n&lt;NA&gt;\nparent\n0.915096\n0.49881\n0.041504\n0.49881\n0.49881\n0.498821\n0.498832\n0.498814\n0.043402\n0.043624\n20160901\n20170228\n113728\n29\n[\"fullvisitorid\", \"visitId\", \"visitNumber\", \"v...\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ndtype\n\n\n\n\nresampling_approach\nstring[python]\n\n\nclf\nstring[python]\n\n\nparam_clf__a\nstring[python]\n\n\nparam_clf__b\nstring[python]\n\n\nparam_preprocessor__cat__rarecats__fe__ignore_format\nstring[python]\n\n\nparam_preprocessor__cat__rarecats__fe__n_categories\nstring[python]\n\n\nparam_preprocessor__cat__rarecats__fe__replace_with\nstring[python]\n\n\nparam_preprocessor__cat__rarecats__fe__tol\nstring[python]\n\n\nparam_resampler__sampling_strategy\nstring[python]\n\n\nparam_select__threshold\nstring[python]\n\n\nparams\nstring[python]\n\n\ntest_accuracy\nFloat64\n\n\ntest_balanced_accuracy\nFloat64\n\n\ntest_precision\nFloat64\n\n\ntest_recall\nFloat64\n\n\ntest_roc_auc\nFloat64\n\n\ntest_f1\nFloat64\n\n\ntest_fbeta05\nFloat64\n\n\ntest_fbeta2\nFloat64\n\n\ntest_pr_auc\nFloat64\n\n\ntest_avg_precision\nFloat64\n\n\nfit_time\nFloat64\n\n\nscore_time\nFloat64\n\n\nexperiment_run_type\nstring[python]\n\n\ntrain_val_accuracy\nFloat64\n\n\ntrain_val_balanced_accuracy\nFloat64\n\n\ntrain_val_precision\nFloat64\n\n\ntrain_val_recall\nFloat64\n\n\ntrain_val_roc_auc\nFloat64\n\n\ntrain_val_f1\nFloat64\n\n\ntrain_val_fbeta05\nFloat64\n\n\ntrain_val_fbeta2\nFloat64\n\n\ntrain_val_pr_auc\nFloat64\n\n\ntrain_val_avg_precision\nFloat64\n\n\ntrain_start_date\nstring[python]\n\n\ntest_end_date\nstring[python]\n\n\nnum_observations\nInt64\n\n\nnum_columns\nInt64\n\n\ncolumn_names\nstring[python]\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfullvisitorid\nvisitId\nvisitNumber\nvisitStartTime\nquarter\nmonth\nday_of_month\nday_of_week\nhour\nminute\n...\nbrowser\nos\ndeviceCategory\nadded_to_cart\nrevenue\nmade_purchase_on_future_visit\nsplit_type\nscore\npredicted_score_label\npredicted_label\n\n\n\n\n23966\n4157301099254368232\n1476636342\n1\n2016-10-16 09:45:42\n4\n10\n16\n1\n9\n45\n...\nSafari\nMacintosh\ndesktop\n0\n&lt;NA&gt;\n1\ntrain_val\n0.058666\nTrue\n0\n\n\n37792\n786312091291497372\n1481408395\n1\n2016-12-10 14:19:55\n4\n12\n10\n7\n14\n19\n...\nChrome\nChrome OS\ndesktop\n0\n&lt;NA&gt;\n0\ntrain_val\n0.130899\nTrue\n0\n\n\n28036\n322228537289095245\n1482626483\n1\n2016-12-24 16:41:23\n4\n12\n24\n7\n16\n41\n...\nChrome\nWindows\ndesktop\n1\n52.99\n0\ntrain_val\n0.000751\nTrue\n0\n\n\n30148\n7808115684091011900\n1482430339\n1\n2016-12-22 10:12:19\n4\n12\n22\n5\n10\n12\n...\nChrome\nWindows\ndesktop\n0\n&lt;NA&gt;\n0\ntrain_val\n0.02076\nTrue\n0\n\n\n15164\n9442018438865871704\n1484757590\n1\n2017-01-18 08:39:50\n1\n1\n18\n4\n8\n39\n...\nChrome\nWindows\ndesktop\n0\n&lt;NA&gt;\n0\ntrain_val\n0.202944\nTrue\n0\n\n\n\n\n5 rows × 33 columns\n\n\n\n\n\n\n\n\n\n\ndtype\n\n\n\n\nfullvisitorid\nstring[python]\n\n\nvisitId\nstring[python]\n\n\nvisitNumber\nInt64\n\n\nvisitStartTime\ndatetime64[ns]\n\n\nquarter\nInt64\n\n\nmonth\nInt64\n\n\nday_of_month\nInt64\n\n\nday_of_week\nInt64\n\n\nhour\nInt64\n\n\nminute\nInt64\n\n\nsecond\nInt64\n\n\nsource\ncategory\n\n\nmedium\ncategory\n\n\nchannelGrouping\ncategory\n\n\nhits\nInt64\n\n\nbounces\ncategory\n\n\nlast_action\ncategory\n\n\npromos_displayed\nInt64\n\n\npromos_clicked\nInt64\n\n\nproduct_views\nInt64\n\n\nproduct_clicks\nInt64\n\n\npageviews\nInt64\n\n\ntime_on_site\nInt64\n\n\nbrowser\ncategory\n\n\nos\ncategory\n\n\ndeviceCategory\ncategory\n\n\nadded_to_cart\nInt64\n\n\nrevenue\nFloat64\n\n\nmade_purchase_on_future_visit\nInt64\n\n\nsplit_type\ncategory\n\n\nscore\nFloat64\n\n\npredicted_score_label\nboolean\n\n\npredicted_label\ncategory"
  },
  {
    "objectID": "notebooks/02-train/notebooks/04_train.html#ml-experiment-tracking-1",
    "href": "notebooks/02-train/notebooks/04_train.html#ml-experiment-tracking-1",
    "title": "ML Development",
    "section": "ML Experiment Tracking",
    "text": "ML Experiment Tracking\n\nSet up MLFlow Experiment\n\nclient = MlflowClient(tracking_uri=mlflow.get_tracking_uri())\nif not client.get_experiment_by_name(mlflow_expt_name):\n    experiment_id = client.create_experiment(\n        mlflow_expt_name,\n        artifact_location=mlflow_artifact_fpath,\n        tags={\"version\": \"v1\", \"priority\": \"P1\"},\n    )\n    client.set_experiment_tag(experiment_id, \"demo\", \"mydemo\")\n    print(f\"Created new experiment with ID = {experiment_id}\")\nelse:\n    experiment_id = client.get_experiment_by_name(mlflow_expt_name).experiment_id\n    print(f\"Retrieved existing experiment with ID = {experiment_id}\")\n\n\n\nTrack Experiment Run Outputs (Metrics and Metadata)\n\nwith mlflow.start_run(experiment_id=experiment_id) as run:\n    run_id = run.info.run_id\n    expt_run_fpath = os.path.join(\n        raw_data_dir, f'ml__run_{run_id}__expt_{experiment_id}.parquet.gzip'\n    )\n\n    # export validation metrics to file and log as MLFlow artifact\n    (\n        df_expt_run_metrics.assign(experiment_id=experiment_id)\n        .assign(run_id=run_id)\n        .to_parquet(expt_run_fpath, index=False, compression='gzip', engine='pyarrow')\n    )\n    mlflow.log_artifact(expt_run_fpath)\n    print(\n        \"Logged metrics and metadata DataFrame as artifact in file \"\n        f\"{os.path.basename(expt_run_fpath)}\"\n    )\n\n    # export combined processed data to file and log as MLFlow artifact\n    proc_data_fpath = os.path.join(\n        processed_data_dir, f'processed_data__run_{run_id}__expt_{experiment_id}.parquet.gzip'\n    )\n    df_train_val_eval_test.to_parquet(\n        proc_data_fpath, index=False, compression='gzip', engine='pyarrow'\n    )\n    mlflow.log_artifact(proc_data_fpath)\n    print(\n        f\"Logged processed data used during training and evaluation in file \"\n        f\"{os.path.basename(proc_data_fpath)}\"\n    )\n\n    # export threshold tuning outputs to file and log as MLFlow artifact\n    threshold_data_fpath = os.path.join(\n        processed_data_dir,\n        f'threshold_tuning_data__run_{run_id}__expt_{experiment_id}.parquet.gzip',\n    )\n    df_thresholds.to_parquet(\n        threshold_data_fpath, index=False, compression='gzip', engine='pyarrow'\n    )\n    mlflow.log_artifact(threshold_data_fpath)\n    print(\n        f\"Logged data from threshold tuning used test data in file \"\n        f\"{os.path.basename(threshold_data_fpath)}\"\n    )\n\n    # log evaluation metrics\n    mlflow.log_metrics(\n        df_eval_metrics_metadata.select_dtypes(pd.Float64Dtype()).transpose().to_dict(\n            orient=\"dict\"\n        )[0]\n    )\n    print(\"Logged metrics evaluated against combined train+validation and test data splits\")\n\n    curr_datetime = datetime.now().strftime(\"%Y%m%d_%H%M%S\")\n    model_name = (\n        f\"{model_type}_{train_start_date}_{test_end_date}_{X.shape[0]}_feats\"\n        f\"__{curr_datetime}\"\n    )\n    _ = mlflow.sklearn.log_model(\n        sk_model=pipe,\n        await_registration_for=None,\n        artifact_path=\"model\",\n        serialization_format='cloudpickle',\n        registered_model_name=model_name,\n    )\n    print(\n        f\"Logged best {model_type} model (with score of {best_model_eval_score:.3f}), \"\n        \"after training on all data\"\n    )\n\n\n\nNon-MLFlow Monitoring\nGet untrained version of ML Pipeline\n\n\nPipeline(steps=[('preprocessor',\n                 ColumnTransformer(transformers=[('num',\n                                                  Pipeline(steps=[('aboveavg',\n                                                                   AboveAveragePagePromoEngager(cols=['hits',\n                                                                                                      'promos_displayed',\n                                                                                                      'promos_clicked',\n                                                                                                      'product_views',\n                                                                                                      'product_clicks',\n                                                                                                      'pageviews',\n                                                                                                      'time_on_site'])),\n                                                                  ('scaler',\n                                                                   MinMaxScaler())]),\n                                                  ['hits', 'promos_displayed',\n                                                   'promos_clicked',\n                                                   'product_views',\n                                                   'product_clicks',\n                                                   'page...\n                                                                  ('dummy',\n                                                                   OneHotEncoder(drop='first',\n                                                                                 dtype=&lt;class 'int'&gt;,\n                                                                                 handle_unknown='ignore'))]),\n                                                  ['bounces', 'last_action',\n                                                   'source', 'medium',\n                                                   'channelGrouping', 'browser',\n                                                   'os', 'deviceCategory'])])),\n                ('select', DropCorrelatedFeatures(threshold=0.7)),\n                ('resampler',\n                 RandomOverSampler(random_state=88, sampling_strategy=0.1)),\n                ['clf', BetaDistClassifier(a=0.3, b=2.4, random_state=88)]])In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.PipelinePipeline(steps=[('preprocessor',\n                 ColumnTransformer(transformers=[('num',\n                                                  Pipeline(steps=[('aboveavg',\n                                                                   AboveAveragePagePromoEngager(cols=['hits',\n                                                                                                      'promos_displayed',\n                                                                                                      'promos_clicked',\n                                                                                                      'product_views',\n                                                                                                      'product_clicks',\n                                                                                                      'pageviews',\n                                                                                                      'time_on_site'])),\n                                                                  ('scaler',\n                                                                   MinMaxScaler())]),\n                                                  ['hits', 'promos_displayed',\n                                                   'promos_clicked',\n                                                   'product_views',\n                                                   'product_clicks',\n                                                   'page...\n                                                                  ('dummy',\n                                                                   OneHotEncoder(drop='first',\n                                                                                 dtype=&lt;class 'int'&gt;,\n                                                                                 handle_unknown='ignore'))]),\n                                                  ['bounces', 'last_action',\n                                                   'source', 'medium',\n                                                   'channelGrouping', 'browser',\n                                                   'os', 'deviceCategory'])])),\n                ('select', DropCorrelatedFeatures(threshold=0.7)),\n                ('resampler',\n                 RandomOverSampler(random_state=88, sampling_strategy=0.1)),\n                ['clf', BetaDistClassifier(a=0.3, b=2.4, random_state=88)]])preprocessor: ColumnTransformerColumnTransformer(transformers=[('num',\n                                 Pipeline(steps=[('aboveavg',\n                                                  AboveAveragePagePromoEngager(cols=['hits',\n                                                                                     'promos_displayed',\n                                                                                     'promos_clicked',\n                                                                                     'product_views',\n                                                                                     'product_clicks',\n                                                                                     'pageviews',\n                                                                                     'time_on_site'])),\n                                                 ('scaler', MinMaxScaler())]),\n                                 ['hits', 'promos_displayed', 'promos_clicked',\n                                  'product_views', 'product_clicks',\n                                  'pageviews', 'time_on_site']),\n                                ('cat',\n                                 P...\n                                                                                                    n_categories=1,\n                                                                                                    replace_with='other',\n                                                                                                    tol=0.1,\n                                                                                                    variables=['source',\n                                                                                                               'browser']),\n                                                                                   ['bounces',\n                                                                                    'last_action',\n                                                                                    'source',\n                                                                                    'medium',\n                                                                                    'channelGrouping',\n                                                                                    'browser',\n                                                                                    'os',\n                                                                                    'deviceCategory'])])),\n                                                 ('dummy',\n                                                  OneHotEncoder(drop='first',\n                                                                dtype=&lt;class 'int'&gt;,\n                                                                handle_unknown='ignore'))]),\n                                 ['bounces', 'last_action', 'source', 'medium',\n                                  'channelGrouping', 'browser', 'os',\n                                  'deviceCategory'])])num['hits', 'promos_displayed', 'promos_clicked', 'product_views', 'product_clicks', 'pageviews', 'time_on_site']AboveAveragePagePromoEngagerAboveAveragePagePromoEngager(cols=['hits', 'promos_displayed', 'promos_clicked',\n                                   'product_views', 'product_clicks',\n                                   'pageviews', 'time_on_site'])MinMaxScalerMinMaxScaler()cat['bounces', 'last_action', 'source', 'medium', 'channelGrouping', 'browser', 'os', 'deviceCategory']rarecats: ColumnTransformerColumnTransformer(remainder='passthrough',\n                  transformers=[('fe',\n                                 RareLabelEncoder(ignore_format=True,\n                                                  n_categories=1,\n                                                  replace_with='other', tol=0.1,\n                                                  variables=['source',\n                                                             'browser']),\n                                 ['bounces', 'last_action', 'source', 'medium',\n                                  'channelGrouping', 'browser', 'os',\n                                  'deviceCategory'])])fe['bounces', 'last_action', 'source', 'medium', 'channelGrouping', 'browser', 'os', 'deviceCategory']RareLabelEncoderRareLabelEncoder(ignore_format=True, n_categories=1, replace_with='other',\n                 tol=0.1, variables=['source', 'browser'])remainderpassthroughpassthroughOneHotEncoderOneHotEncoder(drop='first', dtype=&lt;class 'int'&gt;, handle_unknown='ignore')DropCorrelatedFeaturesDropCorrelatedFeatures(threshold=0.7)RandomOverSamplerRandomOverSampler(random_state=88, sampling_strategy=0.1)BetaDistClassifierBetaDistClassifier(a=0.3, b=2.4, random_state=88)\n\n\nExport untrained model object to disk\n\nmodel_filepath = os.path.join(model_rub_dir_path, 'model.joblib')\n_ = joblib.dump(pipe_new, model_filepath)"
  },
  {
    "objectID": "notebooks/02-train/notebooks/04_train.html#next-step",
    "href": "notebooks/02-train/notebooks/04_train.html#next-step",
    "title": "ML Development",
    "section": "Next Step",
    "text": "Next Step\nThe trained model associated with the best experiment run (having the best evaluation metric) will be retrieved. This model will be registered in the MLFlow model registry so that it can be accessed in production to make inference predictions."
  },
  {
    "objectID": "notebooks/02-train/notebooks/05_get_best_model.html",
    "href": "notebooks/02-train/notebooks/05_get_best_model.html",
    "title": "Register Best Model in MLFlow Model Registry",
    "section": "",
    "text": "This step retrieves the best ML model across all the MLFlow experiment runs that were tracked during ML development. This best model is then registered in the MLFlow Model Registry."
  },
  {
    "objectID": "notebooks/02-train/notebooks/05_get_best_model.html#about",
    "href": "notebooks/02-train/notebooks/05_get_best_model.html#about",
    "title": "Register Best Model in MLFlow Model Registry",
    "section": "",
    "text": "This step retrieves the best ML model across all the MLFlow experiment runs that were tracked during ML development. This best model is then registered in the MLFlow Model Registry."
  },
  {
    "objectID": "notebooks/02-train/notebooks/05_get_best_model.html#user-inputs",
    "href": "notebooks/02-train/notebooks/05_get_best_model.html#user-inputs",
    "title": "Register Best Model in MLFlow Model Registry",
    "section": "User Inputs",
    "text": "User Inputs\nDefine the primary ML scoring metric\n\nprimary_metric = \"fbeta2\""
  },
  {
    "objectID": "notebooks/02-train/notebooks/05_get_best_model.html#manage-ml-experiments",
    "href": "notebooks/02-train/notebooks/05_get_best_model.html#manage-ml-experiments",
    "title": "Register Best Model in MLFlow Model Registry",
    "section": "Manage ML Experiments",
    "text": "Manage ML Experiments\n\nInspect Experiment Run Outputs\nGet all runs of all experiments\n\ndf_expt_runs = modh.get_all_experiment_runs()\n\n2023/07/10 18:58:19 INFO mlflow.store.db.utils: Creating initial MLflow database tables...\n2023/07/10 18:58:19 INFO mlflow.store.db.utils: Updating database tables\nINFO  [alembic.runtime.migration] Context impl SQLiteImpl.\nINFO  [alembic.runtime.migration] Will assume non-transactional DDL.\nINFO  [alembic.runtime.migration] Context impl SQLiteImpl.\nINFO  [alembic.runtime.migration] Will assume non-transactional DDL.\n\n\n\n\nGet Outputs of Best Experiment Run\n\ndf_best_expt_run = modh.get_best_experiment_run(\n    df_expt_runs, \"experiment_run_type == 'parent'\", f\"test_{primary_metric}\"\n)\n\n\n\nGet Parameters Associated With Best Experiment Run\nGet the metadata and metrics for all available data and experiment run ID for best performing run\n\nfeatures\n\nlist of column names\n\nmetrics\n\nprimary metric score on the test split, during ML evaluation\n\nrun ID\n\nMLFlow experiment run ID\n\n\n\ncols_best_expt_run = json.loads(df_best_expt_run[\"column_names\"])\nbest_model_eval_score = df_best_expt_run[f\"test_{primary_metric}\"]\nbest_run_id = df_best_expt_run[\"run_id\"]\n\n\n\nGet Name of Logged Model Associated with Best Experiment Run\nGet name of model associated with best run\n\ndf_best_run_model = modh.get_single_registered_model(f\"run_id == '{best_run_id}'\")\nbest_run_model_name = df_best_run_model.squeeze()[\"name\"]\n\n2023/07/10 18:58:20 INFO mlflow.store.db.utils: Creating initial MLflow database tables...\n2023/07/10 18:58:20 INFO mlflow.store.db.utils: Updating database tables\nINFO  [alembic.runtime.migration] Context impl SQLiteImpl.\nINFO  [alembic.runtime.migration] Will assume non-transactional DDL.\n\n\n\n\n\n\n\n\n\n\n\nname\nrun_id\ndescription\nsource\nversion\nstatus\n\n\n\n\n0\nBetaDistClassifier_20160901_20170228_133892_feats__20230710_184102\nf805253a6ba64ee6a41bf14310ef16a4\nBest BetaDistClassifier model with fbeta2 score of 0.4983145472\n/home/jovyan/notebooks/mlruns/f805253a6ba64ee6a41bf14310ef16a4/artifacts/model\n1\nREADY\n\n\n\n\n\n\n\nBetaDistClassifier_20160901_20170228_133892_feats__20230710_184102\n\n\n\n\nLoad Best Deployment Candidate Model from Model Registry\n\n\nPipeline(steps=[('preprocessor',\n                 ColumnTransformer(transformers=[('num',\n                                                  Pipeline(steps=[('aboveavg',\n                                                                   AboveAveragePagePromoEngager(cols=['hits',\n                                                                                                      'promos_displayed',\n                                                                                                      'promos_clicked',\n                                                                                                      'product_views',\n                                                                                                      'product_clicks',\n                                                                                                      'pageviews',\n                                                                                                      'time_on_site'])),\n                                                                  ('scaler',\n                                                                   MinMaxScaler())]),\n                                                  ['hits', 'promos_displayed',\n                                                   'promos_clicked',\n                                                   'product_views',\n                                                   'product_clicks',\n                                                   'page...\n                                                                  ('dummy',\n                                                                   OneHotEncoder(drop='first',\n                                                                                 dtype=&lt;class 'int'&gt;,\n                                                                                 handle_unknown='ignore'))]),\n                                                  ['bounces', 'last_action',\n                                                   'source', 'medium',\n                                                   'channelGrouping', 'browser',\n                                                   'os', 'deviceCategory'])])),\n                ('select', DropCorrelatedFeatures(threshold=0.7)),\n                ('resampler',\n                 RandomOverSampler(random_state=88, sampling_strategy=0.1)),\n                ['clf', BetaDistClassifier(a=0.3, b=2.4, random_state=88)]])In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.PipelinePipeline(steps=[('preprocessor',\n                 ColumnTransformer(transformers=[('num',\n                                                  Pipeline(steps=[('aboveavg',\n                                                                   AboveAveragePagePromoEngager(cols=['hits',\n                                                                                                      'promos_displayed',\n                                                                                                      'promos_clicked',\n                                                                                                      'product_views',\n                                                                                                      'product_clicks',\n                                                                                                      'pageviews',\n                                                                                                      'time_on_site'])),\n                                                                  ('scaler',\n                                                                   MinMaxScaler())]),\n                                                  ['hits', 'promos_displayed',\n                                                   'promos_clicked',\n                                                   'product_views',\n                                                   'product_clicks',\n                                                   'page...\n                                                                  ('dummy',\n                                                                   OneHotEncoder(drop='first',\n                                                                                 dtype=&lt;class 'int'&gt;,\n                                                                                 handle_unknown='ignore'))]),\n                                                  ['bounces', 'last_action',\n                                                   'source', 'medium',\n                                                   'channelGrouping', 'browser',\n                                                   'os', 'deviceCategory'])])),\n                ('select', DropCorrelatedFeatures(threshold=0.7)),\n                ('resampler',\n                 RandomOverSampler(random_state=88, sampling_strategy=0.1)),\n                ['clf', BetaDistClassifier(a=0.3, b=2.4, random_state=88)]])preprocessor: ColumnTransformerColumnTransformer(transformers=[('num',\n                                 Pipeline(steps=[('aboveavg',\n                                                  AboveAveragePagePromoEngager(cols=['hits',\n                                                                                     'promos_displayed',\n                                                                                     'promos_clicked',\n                                                                                     'product_views',\n                                                                                     'product_clicks',\n                                                                                     'pageviews',\n                                                                                     'time_on_site'])),\n                                                 ('scaler', MinMaxScaler())]),\n                                 ['hits', 'promos_displayed', 'promos_clicked',\n                                  'product_views', 'product_clicks',\n                                  'pageviews', 'time_on_site']),\n                                ('cat',\n                                 P...\n                                                                                                    n_categories=1,\n                                                                                                    replace_with='other',\n                                                                                                    tol=0.1,\n                                                                                                    variables=['source',\n                                                                                                               'browser']),\n                                                                                   ['bounces',\n                                                                                    'last_action',\n                                                                                    'source',\n                                                                                    'medium',\n                                                                                    'channelGrouping',\n                                                                                    'browser',\n                                                                                    'os',\n                                                                                    'deviceCategory'])])),\n                                                 ('dummy',\n                                                  OneHotEncoder(drop='first',\n                                                                dtype=&lt;class 'int'&gt;,\n                                                                handle_unknown='ignore'))]),\n                                 ['bounces', 'last_action', 'source', 'medium',\n                                  'channelGrouping', 'browser', 'os',\n                                  'deviceCategory'])])num['hits', 'promos_displayed', 'promos_clicked', 'product_views', 'product_clicks', 'pageviews', 'time_on_site']AboveAveragePagePromoEngagerAboveAveragePagePromoEngager(cols=['hits', 'promos_displayed', 'promos_clicked',\n                                   'product_views', 'product_clicks',\n                                   'pageviews', 'time_on_site'])MinMaxScalerMinMaxScaler()cat['bounces', 'last_action', 'source', 'medium', 'channelGrouping', 'browser', 'os', 'deviceCategory']rarecats: ColumnTransformerColumnTransformer(remainder='passthrough',\n                  transformers=[('fe',\n                                 RareLabelEncoder(ignore_format=True,\n                                                  n_categories=1,\n                                                  replace_with='other', tol=0.1,\n                                                  variables=['source',\n                                                             'browser']),\n                                 ['bounces', 'last_action', 'source', 'medium',\n                                  'channelGrouping', 'browser', 'os',\n                                  'deviceCategory'])])fe['bounces', 'last_action', 'source', 'medium', 'channelGrouping', 'browser', 'os', 'deviceCategory']RareLabelEncoderRareLabelEncoder(ignore_format=True, n_categories=1, replace_with='other',\n                 tol=0.1, variables=['source', 'browser'])remainderpassthroughpassthroughOneHotEncoderOneHotEncoder(drop='first', dtype=&lt;class 'int'&gt;, handle_unknown='ignore')DropCorrelatedFeaturesDropCorrelatedFeatures(threshold=0.7)RandomOverSamplerRandomOverSampler(random_state=88, sampling_strategy=0.1)BetaDistClassifierBetaDistClassifier(a=0.3, b=2.4, random_state=88)\n\n\n\n\nAdd MLFlow Model Associated with Best Experiment Run to Model Registry\nCreate a new registered model, with a version\n\nclient = MlflowClient(tracking_uri=mlflow.get_tracking_uri())\nresult = client.create_model_version(\n    name=best_run_model_name,\n    await_creation_for=None,\n    tags={'deployment-candidate': \"yes\"},\n    description=(\n        f\"Best Model based on {primary_metric} score of \"\n        f\"{best_model_eval_score:.10f}\"\n    ),\n    source=f\"mlruns/{best_run_id}/artifacts/model\",\n    run_id=best_run_id,\n)"
  },
  {
    "objectID": "notebooks/02-train/notebooks/05_get_best_model.html#next-step",
    "href": "notebooks/02-train/notebooks/05_get_best_model.html#next-step",
    "title": "Register Best Model in MLFlow Model Registry",
    "section": "Next Step",
    "text": "Next Step\nThe registered model will be used during downstream steps such as inference to make predictions for first-time visitors to the store during the production period (following the end of the test data split)."
  },
  {
    "objectID": "notebooks/02-train/notebooks/06_design_experiment.html",
    "href": "notebooks/02-train/notebooks/06_design_experiment.html",
    "title": "Post-Processing",
    "section": "",
    "text": "As discussed for the overall use-case, a marketing strategy is to be developed based on first-time visitors’ propenisty to make a purchase during a future (return) visit to the merchandise store website. The aim of the strategy is to convert these first time visitors into customers (if they did not make a purchase during their first visit), or repeat customers (if they did make a purchase during their first visit). This covers steps 2. and 3. from a typical A/B Testing workflow.\nThis step can be run during ML model development since it requires\n\ncombined training+validation\ntest\n\ndata splits to be created.\n\n\n\nTwo marketing strategies to consider for first-time visitors to the store during the inference period are\n\nwhen conducting the marketing campaign, use all first-time visitors, grouped by their predicted propensity to make a purchase during a future visit, where the strategy is modified based on the group\nwhen conducting the marketing campaign, use the group of first-time visitors with the highest predicted propensity to make a purchase during a future visit, where a single strategy can be used for all visitors in the group\n\nEach group will be referred to as a marketing audience group. For the multi-group strategy (strategy 1), the groups of visitors are created based on predicted propensities. If three such groups are preferred, then the group with the visitors who are predicted to have the highest propensity to make a purchase on a return visit would be named as the High propensity group. Similarly, the other two groups would be named the Medium and Low propensity groups. The size of each group would be as equal as possible. For 15,000 first-time visitors, each group would consist of 5,000 visitors. Similarly, if 10 such groups are preferred then each group would consist of 1,500 visitors. The groups are created by binning the predicted propensities using their quantiles.\nFor the single-group strategy (strategy 2), a single group is required. Again, the quantiles are used to create the groups (or bins or segments or buckets) of visitors based on their predicted propensity. However, only the visitors in the top group will be chosen for the marketing campaign. For the case where 10 groups (quantiles) are preferred, then only the top group is chosen.\n\n\n\nRegardless of the number of groups used in this strategy, a rank is assigned to each group where the lowest rank corresponds to the group with the highest predicted propensities to make a purchase on a future (return) visit. For the case where 10 groups (quantiles) are preferred, then the top group would be the one consisting of visitors with a propensity higher than 90% of all first-time visitors to the store during the inference data period. Similarly, the bottom group would be the one consisting of visitors with a propensity higher than 10% of all such visitors. If three groups are preferred, then the top group captures visitors with a predicted propensity higher than 66.667% of all first-time visitors, while the visitors in the bottom group are predicted to have a propensity to make a purchase on a return visit that is higher than 33.333% of all visitors.\n\n\n\nVisitors placed in each group will then be randomly placed into test and control cohorts to run an A/B test for quantifying the impact of the marketing campaign. So, the sample size required for the test and control cohort must also be determined for both these strategies. The KPI to be maximized is the future conversion rate since we want visitors to become customers during a future (return) visit to the store. The required sample sizes will be estimated for a combinations of conversion rate, uplift, power and confidence level (1, 2)."
  },
  {
    "objectID": "notebooks/02-train/notebooks/06_design_experiment.html#about",
    "href": "notebooks/02-train/notebooks/06_design_experiment.html#about",
    "title": "Post-Processing",
    "section": "",
    "text": "As discussed for the overall use-case, a marketing strategy is to be developed based on first-time visitors’ propenisty to make a purchase during a future (return) visit to the merchandise store website. The aim of the strategy is to convert these first time visitors into customers (if they did not make a purchase during their first visit), or repeat customers (if they did make a purchase during their first visit). This covers steps 2. and 3. from a typical A/B Testing workflow.\nThis step can be run during ML model development since it requires\n\ncombined training+validation\ntest\n\ndata splits to be created.\n\n\n\nTwo marketing strategies to consider for first-time visitors to the store during the inference period are\n\nwhen conducting the marketing campaign, use all first-time visitors, grouped by their predicted propensity to make a purchase during a future visit, where the strategy is modified based on the group\nwhen conducting the marketing campaign, use the group of first-time visitors with the highest predicted propensity to make a purchase during a future visit, where a single strategy can be used for all visitors in the group\n\nEach group will be referred to as a marketing audience group. For the multi-group strategy (strategy 1), the groups of visitors are created based on predicted propensities. If three such groups are preferred, then the group with the visitors who are predicted to have the highest propensity to make a purchase on a return visit would be named as the High propensity group. Similarly, the other two groups would be named the Medium and Low propensity groups. The size of each group would be as equal as possible. For 15,000 first-time visitors, each group would consist of 5,000 visitors. Similarly, if 10 such groups are preferred then each group would consist of 1,500 visitors. The groups are created by binning the predicted propensities using their quantiles.\nFor the single-group strategy (strategy 2), a single group is required. Again, the quantiles are used to create the groups (or bins or segments or buckets) of visitors based on their predicted propensity. However, only the visitors in the top group will be chosen for the marketing campaign. For the case where 10 groups (quantiles) are preferred, then only the top group is chosen.\n\n\n\nRegardless of the number of groups used in this strategy, a rank is assigned to each group where the lowest rank corresponds to the group with the highest predicted propensities to make a purchase on a future (return) visit. For the case where 10 groups (quantiles) are preferred, then the top group would be the one consisting of visitors with a propensity higher than 90% of all first-time visitors to the store during the inference data period. Similarly, the bottom group would be the one consisting of visitors with a propensity higher than 10% of all such visitors. If three groups are preferred, then the top group captures visitors with a predicted propensity higher than 66.667% of all first-time visitors, while the visitors in the bottom group are predicted to have a propensity to make a purchase on a return visit that is higher than 33.333% of all visitors.\n\n\n\nVisitors placed in each group will then be randomly placed into test and control cohorts to run an A/B test for quantifying the impact of the marketing campaign. So, the sample size required for the test and control cohort must also be determined for both these strategies. The KPI to be maximized is the future conversion rate since we want visitors to become customers during a future (return) visit to the store. The required sample sizes will be estimated for a combinations of conversion rate, uplift, power and confidence level (1, 2)."
  },
  {
    "objectID": "notebooks/02-train/notebooks/06_design_experiment.html#implementation",
    "href": "notebooks/02-train/notebooks/06_design_experiment.html#implementation",
    "title": "Post-Processing",
    "section": "Implementation",
    "text": "Implementation\nThis step will used the best ML model to estimate the size of the group, for both such strategies. The model will be used with the test data split (last month of data that was used during ML model development) to estimate the required size of marketing audience (test and control) cohorts for both strategies. In the next step, the same ML model will be used to predict the propensity for first-time visitors to the store during the inference period, assign these visitors to one or more audience groups based on the type of strategy (single group or multiple groups) and finally select random test and control cohorts from each group. The cohort (sample) sizes estimated in this step will be used to create the test and control cohorts in the next step."
  },
  {
    "objectID": "notebooks/02-train/notebooks/06_design_experiment.html#user-inputs",
    "href": "notebooks/02-train/notebooks/06_design_experiment.html#user-inputs",
    "title": "Post-Processing",
    "section": "User Inputs",
    "text": "User Inputs\nDefine the following\n\nname of column containing label (outcome)\nprimary ML scoring metric\naudience_groups_strategy_n\n\ndesired audience groups into which the first-time visitors propensities will be placed\n\nnum_propens_groups specifies the number of desired audience propensity groups\npropens_group_labels specifies names of the desired audience propensity groups (low, medium and high, etc.)\n\n\ngrid of inputs for which sample sizes are required (uplift, power, confidence level)\n\n\n# 1. label column\nlabel = \"made_purchase_on_future_visit\"\n\n# 2. scoring metric\nprimary_metric = \"fbeta2\"\n\n# 3. mapping dictionaries\naudience_groups_strategy_1 = {\n    \"num_propens_groups\": 3,\n    \"propens_group_labels\": [\"High\", \"Medium\", \"Low\"],\n}\naudience_groups_strategy_2 = {\n    \"num_propens_groups\": 3,\n    \"propens_group_labels\": [\"High\", \"High-Medium\", \"High-Medium-Low\"],\n}\n\n# 4. grid of inputs for estimating sample sizes\nuplift_ranges = (10, 12, 15)\npower_ranges = (55, 57, 60, 63, 65, 66, 67, 68, 69, 70, 80, 90)\nci_level_ranges = (55, 57, 60, 63, 65, 66, 67, 68, 69, 70, 75, 85, 90, 95)\n\nCreate a mapping between audience group number (0, 1, 2) and name (high, medium, low), where\n\n0 is mapped to high\n1 is mapped to medium\n2 is mapped to low\n\nsince it is standard to assign a label the top percentile (highest propensity) with the smallest number (0)\n\nmapper_dict_audience_strategy_1 = dict(\n    zip(\n        range(audience_groups_strategy_1[\"num_propens_groups\"]),\n        audience_groups_strategy_1[\"propens_group_labels\"],\n    )\n)\nmapper_dict_audience_strategy_2 = dict(\n    zip(\n        range(audience_groups_strategy_1[\"num_propens_groups\"]),\n        audience_groups_strategy_2[\"propens_group_labels\"],\n    )\n)\nprint(mapper_dict_audience_strategy_1)\nprint(mapper_dict_audience_strategy_2)\n\n{0: 'High', 1: 'Medium', 2: 'Low'}\n{0: 'High', 1: 'High-Medium', 2: 'High-Medium-Low'}\n\n\n\n\n\n\n\n\nNotes\n\n\n\n\nThe group integer-to-name mapping dictionary contains keys that start at the lowest group number (0) for the High propensity audience group. For this audience strategy, a single group is used, so 0 is the only key in this dictionary."
  },
  {
    "objectID": "notebooks/02-train/notebooks/06_design_experiment.html#get-best-mlflow-model-from-model-registry",
    "href": "notebooks/02-train/notebooks/06_design_experiment.html#get-best-mlflow-model-from-model-registry",
    "title": "Post-Processing",
    "section": "Get Best MLFlow Model from Model Registry",
    "text": "Get Best MLFlow Model from Model Registry\n\nFetch Latest Version of Best Deployment Candidate Model\nGet all MLFlow deployment candidate models from MLFlow model registry\n\ndf_deployment_candidate_mlflow_models = modh.get_all_deployment_candidate_models()\n\n2023/07/10 20:21:33 INFO mlflow.store.db.utils: Creating initial MLflow database tables...\n2023/07/10 20:21:33 INFO mlflow.store.db.utils: Updating database tables\nINFO  [alembic.runtime.migration] Context impl SQLiteImpl.\nINFO  [alembic.runtime.migration] Will assume non-transactional DDL.\nINFO  [alembic.runtime.migration] Context impl SQLiteImpl.\nINFO  [alembic.runtime.migration] Will assume non-transactional DDL.\n2023/07/10 20:21:33 INFO mlflow.store.db.utils: Creating initial MLflow database tables...\n2023/07/10 20:21:33 INFO mlflow.store.db.utils: Updating database tables\nINFO  [alembic.runtime.migration] Context impl SQLiteImpl.\nINFO  [alembic.runtime.migration] Will assume non-transactional DDL.\n\n\n\n\n\n\n\n\nNotes\n\n\n\n\nThese are registered models that have been assigned a tag (tags={deployment-candidate: 'yes'}), as opposed to models that are not deployment candidates and do not have any tag (tags={}).\n\n\n\nGet name of best deployment candidate model\n\nbest_run_model_name = modh.get_best_deployment_candidate_model(\n    df_deployment_candidate_mlflow_models\n)\n\n\n\nGet Data Used to Develop Best Deployment Candidate Model\nGet all available data used during model development of the best deployment candidate model\n\ndf_all = modh.get_data_for_run_id(df_deployment_candidate_mlflow_models, 'processed_data')\n\n\n\n\n\n\n\n\n\n\ndtype\n\n\n\n\nfullvisitorid\nstring[python]\n\n\nvisitId\nstring[python]\n\n\nvisitNumber\nInt64\n\n\nvisitStartTime\ndatetime64[ns]\n\n\nquarter\nInt64\n\n\nmonth\nInt64\n\n\nday_of_month\nInt64\n\n\nday_of_week\nInt64\n\n\nhour\nInt64\n\n\nminute\nInt64\n\n\nsecond\nInt64\n\n\nsource\ncategory\n\n\nmedium\ncategory\n\n\nchannelGrouping\ncategory\n\n\nhits\nInt64\n\n\nbounces\nint64\n\n\nlast_action\ncategory\n\n\npromos_displayed\nInt64\n\n\npromos_clicked\nInt64\n\n\nproduct_views\nInt64\n\n\nproduct_clicks\nInt64\n\n\npageviews\nInt64\n\n\ntime_on_site\nInt64\n\n\nbrowser\ncategory\n\n\nos\ncategory\n\n\ndeviceCategory\ncategory\n\n\nadded_to_cart\nInt64\n\n\nrevenue\nFloat64\n\n\nmade_purchase_on_future_visit\nInt64\n\n\nsplit_type\ncategory\n\n\nscore\nFloat64\n\n\npredicted_score_label\nboolean\n\n\npredicted_label\nint64\n\n\n\n\n\n\n\nSeparate features and label\n\nX, y = [df_all.drop(columns=[label, 'split_type']), df_all[label]]\n\n\n\n\n\n\n\n\n\n\ndtype\n\n\n\n\nfullvisitorid\nstring[python]\n\n\nvisitId\nstring[python]\n\n\nvisitNumber\nInt64\n\n\nvisitStartTime\ndatetime64[ns]\n\n\nquarter\nInt64\n\n\nmonth\nInt64\n\n\nday_of_month\nInt64\n\n\nday_of_week\nInt64\n\n\nhour\nInt64\n\n\nminute\nInt64\n\n\nsecond\nInt64\n\n\nsource\ncategory\n\n\nmedium\ncategory\n\n\nchannelGrouping\ncategory\n\n\nhits\nInt64\n\n\nbounces\nint64\n\n\nlast_action\ncategory\n\n\npromos_displayed\nInt64\n\n\npromos_clicked\nInt64\n\n\nproduct_views\nInt64\n\n\nproduct_clicks\nInt64\n\n\npageviews\nInt64\n\n\ntime_on_site\nInt64\n\n\nbrowser\ncategory\n\n\nos\ncategory\n\n\ndeviceCategory\ncategory\n\n\nadded_to_cart\nInt64\n\n\nrevenue\nFloat64\n\n\nscore\nFloat64\n\n\npredicted_score_label\nboolean\n\n\npredicted_label\nint64\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ncolumn\ndtype\n\n\n\n\n0\ny\nInt64\n\n\n\n\n\n\n\nGet test split from the data used during development of the best deployment candidate model\n\ndf_prediction_best_run = (\n    df_all\n    .query(\"split_type == 'test'\")\n    .rename(columns={label: 'label'})\n    .drop(columns=['split_type'])\n)\n\n\n\n\n\n\n\nNotes\n\n\n\n\nThe fullvisitorid column is the ID of each visitor who\n\nmade a purchase on a return visit to the store\nmade their first visit to the store during the dates covered by the test data split\n\nThe score column is the predicted probability (using .pred_proba()), which is the propensity of a visitor to make a purchase on a return visit.\nThe predicted_score_label column is the predicted label using ML. A discrmination threshold of 0.5 is used to convert the predicted score (probability) into a label. The true ML label will not be known until a later date. As of the current date, only the predicted ML label can be known. See the project scope for details.\n\n\n\n\n\nLoad Best Deployment Candidate Model from Model Registry\n\nbest_model_uri = f\"models:/{best_run_model_name}/latest\"\nmodel = mlflow.sklearn.load_model(model_uri=best_model_uri)"
  },
  {
    "objectID": "notebooks/02-train/notebooks/06_design_experiment.html#explore-best-model-performance",
    "href": "notebooks/02-train/notebooks/06_design_experiment.html#explore-best-model-performance",
    "title": "Post-Processing",
    "section": "Explore Best Model Performance",
    "text": "Explore Best Model Performance\nMake predictions on same data that best model was trained on\n\ny_pred, y_pred_proba = modh.make_inference(model, X, y.name)\n\nGet evaluation metrics on same data that best model was trained on\n\ndf_metrics_all = mh.calculate_metrics(y, y_pred, y_pred_proba, None, None, None, [\"all\"])\n\n\n\n\n\n\n\n\n\n\ndtype\n\n\nsplit\n\n\n\n\n\nmetric\nstring[python]\n\n\nall\nFloat64\n\n\n\n\n\n\n\n\nOptimal Discrimination Threshold Tuning\n\n\n\n\n\n\n\n\n\ndtype\n\n\n\n\nt\nfloat64\n\n\naccuracy\nfloat64\n\n\nbalanced_accuracy\nfloat64\n\n\nprecision\nfloat64\n\n\nrecall\nfloat64\n\n\nroc_auc\nfloat64\n\n\nf1\nfloat64\n\n\nfbeta05\nfloat64\n\n\nfbeta2\nfloat64\n\n\navg_precision\nfloat64\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ndtype\n\n\n\n\nmetric\nstring[python]\n\n\nt=0.5\nFloat64\n\n\nmean\nFloat64\n\n\nstd\nFloat64\n\n\nmin\nFloat64\n\n\n25%\nFloat64\n\n\n50%\nFloat64\n\n\n75%\nFloat64\n\n\nmax\nFloat64\n\n\n\n\n\n\n\nShow a visualization of evaluation metrics relative to the discrimination threshold\n\nvh.plot_multi_line_threshold_chart(\n    df_thresholds_best_run.set_index(\"t\"),\n    ptitle_str=\"Threshold Plot\",\n    xlabel=\"Threshold (t)\",\n    ylabel=\"Score\",\n    title_fontsize=12,\n    axis_label_fontsize=12,\n    figsize=(8, 4),\n)\n\n\n\n\n\n\n\n\n\n\nObservations\n\n\n\n\nTo be completed."
  },
  {
    "objectID": "notebooks/02-train/notebooks/06_design_experiment.html#get-size-of-marketing-audience-for-campaign",
    "href": "notebooks/02-train/notebooks/06_design_experiment.html#get-size-of-marketing-audience-for-campaign",
    "title": "Post-Processing",
    "section": "Get Size of Marketing Audience For Campaign",
    "text": "Get Size of Marketing Audience For Campaign\n\nGet Marketing Audience Using All Propensity Groups (Strategy 1)\nPerform the following to get the sample size estimates for each audience propensity group, using this approach\n\nSort predictions in ascending order of the predicted probability (propensity) (score)\n\nwhen predictions are then assigned to groups (bins), this order of sorting means the lowest group number will be assigned to samples (predictions) with the lowest probability, so this ordering is non-standard\nthe group integer-to-name mapping dictionary contains keys that start at the lowest group number (0) for the High propensity audience group\n\nSeparate the predictions into group, using the predicted probability, based on the required number of groups\nGet conversion rates (KPI) per group\nget sample sizes per group, based on\n\nKPI per group\ndesired magnitude of the input (uplift, power, confidence level)\n\nreverse order of groups and sort by group number\nassign meaningful names to groups\nset datatypes for columns\n(optional) move column with meaningful names to second from front (for display purposes only)\n\n\ndf_sample_sizes_strategy_1 = (\n    df_prediction_best_run.copy()\n    .pipe(ash.sort_scores, True)\n    .pipe(ash.get_audience_groups_by_propensity, audience_groups_strategy_1[\"num_propens_groups\"])\n    .pipe(ash.set_datatypes, {\"bounces\": pd.Int64Dtype()})\n    .pipe(ash.get_kpi_per_audience_group)\n    .pipe(ash.set_datatypes, {\"conversion_rate\": pd.Float64Dtype()})\n    .pipe(\n        ash.calculate_multi_group_sample_sizes,\n        uplift_ranges,\n        power_ranges,\n        ci_level_ranges,\n    )\n    .pipe(ash.invert_group_numbers, audience_groups_strategy_1[\"num_propens_groups\"])\n    .pipe(ash.map_audience_group_number_to_name, mapper_dict_audience_strategy_1)\n    .pipe(\n        ash.set_datatypes,\n        {\n            \"group_number\": pd.Int8Dtype(),\n            \"maudience\": pd.StringDtype(),\n            \"group_size\": pd.Int64Dtype(),  # Int16Dtype\n            \"group_min_propensity\": pd.Float64Dtype(),  # Float32Dtype\n            \"group_conv_rate\": pd.Float64Dtype(),  # Float32Dtype\n            \"ctr\": pd.Float64Dtype(),  # Float32Dtype\n            \"revenue\": pd.Float64Dtype(),  # Float32Dtype\n            \"bounce_rate\": pd.Float64Dtype(),  # Float32Dtype\n            \"uplift\": pd.Int8Dtype(),\n            \"power\": pd.Int8Dtype(),\n            \"ci_level\": pd.Int8Dtype(),\n            \"required_sample_size\": pd.Int64Dtype(),  # Int32Dtype\n        },\n    )\n    .pipe(ash.move_cols_to_front, [\"group_number\", \"maudience\"])\n)\ndf_sample_sizes_strategy_1\n\nSet all specified datatypes.\nSet all specified datatypes.\nSet all specified datatypes.\n\n\n\n\n\n\n\n\n\ngroup_number\nmaudience\ngroup_size\ngroup_min_propensity\ngroup_conv_rate\nctr\nrevenue\nbounce_rate\nuplift\npower\nci_level\nrequired_sample_size\n\n\n\n\n0\n0\nHigh\n6721\n0.096287\n2.216932\n2.653428\n37589.59\n35.396518\n15\n90\n95\n20598\n\n\n1\n0\nHigh\n6721\n0.096287\n2.216932\n2.653428\n37589.59\n35.396518\n10\n90\n66\n21966\n\n\n2\n0\nHigh\n6721\n0.096287\n2.216932\n2.653428\n37589.59\n35.396518\n10\n90\n67\n22372\n\n\n3\n0\nHigh\n6721\n0.096287\n2.216932\n2.653428\n37589.59\n35.396518\n10\n90\n68\n22787\n\n\n4\n0\nHigh\n6721\n0.096287\n2.216932\n2.653428\n37589.59\n35.396518\n10\n90\n69\n23214\n\n\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n\n\n1507\n2\nLow\n6722\n0.0\n2.261232\n2.734552\n36949.55\n35.673907\n15\n55\n67\n2098\n\n\n1508\n2\nLow\n6722\n0.0\n2.261232\n2.734552\n36949.55\n35.673907\n15\n55\n68\n2205\n\n\n1509\n2\nLow\n6722\n0.0\n2.261232\n2.734552\n36949.55\n35.673907\n15\n55\n69\n2313\n\n\n1510\n2\nLow\n6722\n0.0\n2.261232\n2.734552\n36949.55\n35.673907\n12\n90\n70\n16097\n\n\n1511\n2\nLow\n6722\n0.0\n2.261232\n2.734552\n36949.55\n35.673907\n10\n55\n55\n2103\n\n\n\n\n1512 rows × 12 columns\n\n\n\n\n\nGet Marketing Audience Using Top Propensity Group (Strategy 2)\nPerform the following to get the sample size estimates for the top audience propensity group, using this approach\n\nSort predictions in descending order of the predicted probability (propensity) (score)\nget group (bin) size that separates the predictions into groups (bins) of equal size, using the predicted probability, based on the required number of groups\nseparate the predictions into groups, using the predicted probability, based on the\n\nrequired number of groups\ncalculated group size from above step\n\nget conversion rates (KPI) per group\nget sample sizes per group, based on\n\nKPI per group\ndesired magnitude of the input (uplift, power, confidence level)\n\nsubtract one from group number\nassign meaningful names to groups\nset datatypes for columns\n(optional) move column with meaningful names to second from front (for display purposes only)\n\n\ndf_sample_sizes_strategy_2 = (\n    df_prediction_best_run.copy()\n    .pipe(ash.sort_scores, False)\n    .pipe(ash.set_datatypes, {\"bounces\": pd.Int64Dtype(), \"predicted_label\": pd.Int64Dtype()})\n    .pipe(\n        ash.calculate_single_group_sample_sizes,\n        audience_groups_strategy_2[\"num_propens_groups\"],\n        ash.get_group_size(df_prediction_best_run, audience_groups_strategy_2[\"num_propens_groups\"]),\n        uplift_ranges,\n        power_ranges,\n        ci_level_ranges,\n    )\n    .pipe(ash.subtract_one_from_group_numbers, \"group_number\")\n    .pipe(\n        ash.map_audience_group_number_to_name,\n        mapper_dict_audience_strategy_2,\n        \"group_number\",\n    )\n    .pipe(\n        ash.set_datatypes,\n        {\n            \"group_number\": pd.Int8Dtype(),\n            \"maudience\": pd.StringDtype(),\n            \"group_size\": pd.Int64Dtype(),  # Int16Dtype\n            \"group_size_proportion\": pd.Float64Dtype(),  # Float32Dtype\n            \"group_min_propensity\": pd.Float64Dtype(),  # Float32Dtype\n            \"group_conv_rate\": pd.Float64Dtype(),  # Float32Dtype\n            \"ctr\": pd.Float64Dtype(),  # Float32Dtype\n            \"revenue\": pd.Float64Dtype(),  # Float32Dtype\n            \"bounce_rate\": pd.Float64Dtype(),  # Float32Dtype\n            \"uplift\": pd.Int8Dtype(),\n            \"power\": pd.Int8Dtype(),\n            \"ci_level\": pd.Int8Dtype(),\n            \"required_sample_size\": pd.Int64Dtype(),  # Float32Dtype\n        },\n    )\n    .pipe(ash.move_cols_to_front, [\"group_number\", \"maudience\"])\n)\ndf_sample_sizes_strategy_2\n\nSet all specified datatypes.\nSet all specified datatypes.\n\n\n\n\n\n\n\n\n\ngroup_number\nmaudience\ngroup_size\ngroup_size_proportion\ngroup_min_propensity\ngroup_conv_rate\nctr\nrevenue\nbounce_rate\nuplift\npower\nci_level\nrequired_sample_size\n\n\n\n\n0\n0\nHigh\n6721\n33.33168\n0.095669\n2.216932\n2.653428\n37589.59\n35.396518\n10\n55\n55\n2146\n\n\n1\n0\nHigh\n6721\n33.33168\n0.095669\n2.216932\n2.653428\n37589.59\n35.396518\n10\n55\n57\n2572\n\n\n2\n0\nHigh\n6721\n33.33168\n0.095669\n2.216932\n2.653428\n37589.59\n35.396518\n10\n55\n60\n3219\n\n\n3\n0\nHigh\n6721\n33.33168\n0.095669\n2.216932\n2.653428\n37589.59\n35.396518\n10\n55\n63\n3885\n\n\n4\n0\nHigh\n6721\n33.33168\n0.095669\n2.216932\n2.653428\n37589.59\n35.396518\n10\n55\n65\n4343\n\n\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n\n\n1507\n2\nHigh-Medium-Low\n20163\n99.995041\n0.0\n2.306204\n2.69755\n111202.47\n35.232852\n15\n90\n70\n10097\n\n\n1508\n2\nHigh-Medium-Low\n20163\n99.995041\n0.0\n2.306204\n2.69755\n111202.47\n35.232852\n15\n90\n75\n11126\n\n\n1509\n2\nHigh-Medium-Low\n20163\n99.995041\n0.0\n2.306204\n2.69755\n111202.47\n35.232852\n15\n90\n85\n13940\n\n\n1510\n2\nHigh-Medium-Low\n20163\n99.995041\n0.0\n2.306204\n2.69755\n111202.47\n35.232852\n15\n90\n90\n16124\n\n\n1511\n2\nHigh-Medium-Low\n20163\n99.995041\n0.0\n2.306204\n2.69755\n111202.47\n35.232852\n15\n90\n95\n19783\n\n\n\n\n1512 rows × 13 columns"
  },
  {
    "objectID": "notebooks/02-train/notebooks/06_design_experiment.html#export-audience-sample-sizes-to-disk",
    "href": "notebooks/02-train/notebooks/06_design_experiment.html#export-audience-sample-sizes-to-disk",
    "title": "Post-Processing",
    "section": "Export Audience Sample Sizes to Disk",
    "text": "Export Audience Sample Sizes to Disk\n\n\n\n\n\n\n\n\n\ngroup_number\nmaudience\ngroup_size\ngroup_min_propensity\ngroup_conv_rate\nctr\nrevenue\nbounce_rate\nuplift\npower\nci_level\nrequired_sample_size\n\n\n\n\n158\n0\nHigh\n6721\n0.096287\n2.216932\n2.653428\n37589.59\n35.396518\n10\n55\n55\n2146\n\n\n846\n1\nMedium\n6721\n0.009169\n2.440113\n2.705586\n36663.33\n34.622824\n10\n55\n55\n1945\n\n\n1511\n2\nLow\n6722\n0.0\n2.261232\n2.734552\n36949.55\n35.673907\n10\n55\n55\n2103\n\n\n\n\n\n\n\nConcatenate the two DataFrames with the required sample sizes to acheive a KPI using different combinations of inputs (uplift, confidence level and power) and then export to disk\n\n(\n    df_combined_sample_sizes,\n    aud_sizes_fpath,\n) = ash.combine_and_export_sample_size_estimates(\n    df_sample_sizes_strategy_1,\n    df_sample_sizes_strategy_2,\n    df_deployment_candidate_mlflow_models,\n    processed_data_dir,\n)"
  },
  {
    "objectID": "notebooks/02-train/notebooks/06_design_experiment.html#ml-experiment-tracking",
    "href": "notebooks/02-train/notebooks/06_design_experiment.html#ml-experiment-tracking",
    "title": "Post-Processing",
    "section": "ML Experiment Tracking",
    "text": "ML Experiment Tracking\nGet best run ID\n\nbest_run_id = df_deployment_candidate_mlflow_models.squeeze()[\"run_id\"]\n\nLog audience sample sizes file as MLFlow artifact\n\nwith mlflow.start_run(run_id=best_run_id) as run:\n    mlflow.log_artifact(aud_sizes_fpath)\nprint(\n    \"Logged required audience sizes as artifact in file \"\n    f\"{os.path.basename(aud_sizes_fpath)}\"\n)"
  },
  {
    "objectID": "notebooks/02-train/notebooks/06_design_experiment.html#next-step",
    "href": "notebooks/02-train/notebooks/06_design_experiment.html#next-step",
    "title": "Post-Processing",
    "section": "Next Step",
    "text": "Next Step\nNext, test and control cohorts will be created using the inference data at the end of the production period (one month). The size of each cohort will be chosen based on the required sizes that were found in this step."
  },
  {
    "objectID": "notebooks/02-train/notebooks/07_get_audience_cohorts.html",
    "href": "notebooks/02-train/notebooks/07_get_audience_cohorts.html",
    "title": "Get Randomized Audience Cohorts From Inference",
    "section": "",
    "text": "This step generates the randomized test and control cohorts needed to run a marketing campaign. The impact of the campaign on conversions (KPI) will be assessed using an A/B test at the end of the campaign. The randomized cohorts are needed in order to conduct this test. This is step 4. from a typical A/B Testing workflow.\n\n\n\nThis step can be run prospectively at the end of the inference period, just before the start of the campaign, when all the inference data (first-time visitors to the store) becomes available.\nFor the current use-case, the required sizes of one or more audience groups have been determined in the previous step. Recall that an audience strategy determines if one of more groups are used. For a strategy consisting of a single audience group, only the visitors predicted to have a high propensity to make a purchase on a return visit are selected to participate in the campaign and so randomized cohorts are to be drawn from this single group. For multiple audience groups, namely visitors predicted to have a low, medium or high propensity, randomized cohorts are to be drawn from each such group.\nWith this in mind, this step first assigns all first-time visitors to the store during the inference period to an audience group based on the requied audience strategy (single or multiple audience groups).\nNext, before generating audience cohorts, features in the unseen (inference) data are checked for data drift relative to the test data used during ML model development.\n\nUse statistical tests, that are called as part of EvidentlyAI’s data drift monitor (1, 2) for tabular data. The following statistical tests and logic are used by EvidentlyAI and are also implemented here\n\nnumerical features with less than or equal to 1,000 observations (this is not used here since the inference data consists of more than 1,000 observations during the inference data period)\n\nKolmogorov-Smirnov goodness-of-fit Test (two-sample version)\n\nnumerical features with more than 1,000 observations (this is the case here since the inference data has more than 1,000 first-time visitors during the inference data period)\n\nWasserstein distance\n\ncategorical features with less than or equal to 1,000 observations (not used here)\n\nchi-squared goodness-of-fit test\n\ncategorical features with more than 1,000 observations (used here)\n\nJensen-Shannon distance\n\n\nHere, a custom function is defined to manually implement these tests on the unseen (inference) data.\nPerform sanity checks on the data, by directly using EvidentlyAI’s data test suite (1, 2). A suite consisting of the following tests is applied to the unseen (inference) data in order to test that the number of\n\ncolumns with missing values (columns with at least one missing value)\nrows with missing values\nconstant (single-valued) columns\nduplicated rows (rows that are duplicates)\nduplicated columns (columns that are duplicates)\ncolumn datatypes\nempty columns (all values in a column are missing)\nempty rows (all values in a row are missing)\nrows with missing values (rows with at least one missing value)\nnumber of columns\n\nin the unseen (inference) data equals the number in the reference data (test split from the data used during ML model development).\n\nFinally, within each audience group, visitors are randomly assigned to test or control cohorts. A brief profile of each audience group is then performed using attributes of the visitors’ first visit. The profile and the inference data with the audience group and cohort for each first-time visitor during the inference period can be used by the marketing team to design and implement the marketing campaign aimed at growing the customer base.\n\n\n\nA custom python module in src/cohorts.py has been developed to create the test and control audience cohorts based on required sample sizes that were estimated in the previous step and logged as a MLFlow artifact (file) for the best MLFlow deployment candidate model.\nThe procedure followed in this step is briefle outlined below\n\nthe MLFlow artifact (file) is loaded in order to access the required sample sizes for each\n\naudience strategy\ndesired combination of effect sizes (power, confidence level and uplift)\n\nthe file is filtered based on the\n\naudience strategy\ndesired combination of effect sizes (see wanted_effect_sizes from User Inputs)\n\ninference data (first-time visitors) is retrieved and the best ML model is used to make inference predictions of the propensity of these visitors to make a purchase on a return (future) visit to the store.\npropensities are used to assign first-time visitors to audience groups (or bins)\n\nif the desired audience strategy is for a single audience group, then visitors are placed into a single bin\nif the desired audience strategy is for multiple audience groups, then multiple bins are creaed\n\nfor each bin (audience group), visitors are randomly placed into test and control cohorts\nthe inference data with\n\npredicted propensity (probability)\naudience group\ncohort (test or control)\n\nis then logged as a MLFlow artifact\ngenerate the following\n\nprofile of the audience groups in terms of\n\ndescriptive statistics\nbehavioral attributes (values of columns in the data by visitors assigned to each group)\n\nsummary of the cohorts and audience groups, showing the\n\nconversion rate (KPI) per audience group, cohort and overall\nsize of random cohort relative to overall audience group\n\n\nwhich are then logged as separate MLFlow artifacts\n\nOutputs produced by steps 6. and 7. in this procedure are for use by the marketing team to build and design the campaign."
  },
  {
    "objectID": "notebooks/02-train/notebooks/07_get_audience_cohorts.html#about",
    "href": "notebooks/02-train/notebooks/07_get_audience_cohorts.html#about",
    "title": "Get Randomized Audience Cohorts From Inference",
    "section": "",
    "text": "This step generates the randomized test and control cohorts needed to run a marketing campaign. The impact of the campaign on conversions (KPI) will be assessed using an A/B test at the end of the campaign. The randomized cohorts are needed in order to conduct this test. This is step 4. from a typical A/B Testing workflow.\n\n\n\nThis step can be run prospectively at the end of the inference period, just before the start of the campaign, when all the inference data (first-time visitors to the store) becomes available.\nFor the current use-case, the required sizes of one or more audience groups have been determined in the previous step. Recall that an audience strategy determines if one of more groups are used. For a strategy consisting of a single audience group, only the visitors predicted to have a high propensity to make a purchase on a return visit are selected to participate in the campaign and so randomized cohorts are to be drawn from this single group. For multiple audience groups, namely visitors predicted to have a low, medium or high propensity, randomized cohorts are to be drawn from each such group.\nWith this in mind, this step first assigns all first-time visitors to the store during the inference period to an audience group based on the requied audience strategy (single or multiple audience groups).\nNext, before generating audience cohorts, features in the unseen (inference) data are checked for data drift relative to the test data used during ML model development.\n\nUse statistical tests, that are called as part of EvidentlyAI’s data drift monitor (1, 2) for tabular data. The following statistical tests and logic are used by EvidentlyAI and are also implemented here\n\nnumerical features with less than or equal to 1,000 observations (this is not used here since the inference data consists of more than 1,000 observations during the inference data period)\n\nKolmogorov-Smirnov goodness-of-fit Test (two-sample version)\n\nnumerical features with more than 1,000 observations (this is the case here since the inference data has more than 1,000 first-time visitors during the inference data period)\n\nWasserstein distance\n\ncategorical features with less than or equal to 1,000 observations (not used here)\n\nchi-squared goodness-of-fit test\n\ncategorical features with more than 1,000 observations (used here)\n\nJensen-Shannon distance\n\n\nHere, a custom function is defined to manually implement these tests on the unseen (inference) data.\nPerform sanity checks on the data, by directly using EvidentlyAI’s data test suite (1, 2). A suite consisting of the following tests is applied to the unseen (inference) data in order to test that the number of\n\ncolumns with missing values (columns with at least one missing value)\nrows with missing values\nconstant (single-valued) columns\nduplicated rows (rows that are duplicates)\nduplicated columns (columns that are duplicates)\ncolumn datatypes\nempty columns (all values in a column are missing)\nempty rows (all values in a row are missing)\nrows with missing values (rows with at least one missing value)\nnumber of columns\n\nin the unseen (inference) data equals the number in the reference data (test split from the data used during ML model development).\n\nFinally, within each audience group, visitors are randomly assigned to test or control cohorts. A brief profile of each audience group is then performed using attributes of the visitors’ first visit. The profile and the inference data with the audience group and cohort for each first-time visitor during the inference period can be used by the marketing team to design and implement the marketing campaign aimed at growing the customer base.\n\n\n\nA custom python module in src/cohorts.py has been developed to create the test and control audience cohorts based on required sample sizes that were estimated in the previous step and logged as a MLFlow artifact (file) for the best MLFlow deployment candidate model.\nThe procedure followed in this step is briefle outlined below\n\nthe MLFlow artifact (file) is loaded in order to access the required sample sizes for each\n\naudience strategy\ndesired combination of effect sizes (power, confidence level and uplift)\n\nthe file is filtered based on the\n\naudience strategy\ndesired combination of effect sizes (see wanted_effect_sizes from User Inputs)\n\ninference data (first-time visitors) is retrieved and the best ML model is used to make inference predictions of the propensity of these visitors to make a purchase on a return (future) visit to the store.\npropensities are used to assign first-time visitors to audience groups (or bins)\n\nif the desired audience strategy is for a single audience group, then visitors are placed into a single bin\nif the desired audience strategy is for multiple audience groups, then multiple bins are creaed\n\nfor each bin (audience group), visitors are randomly placed into test and control cohorts\nthe inference data with\n\npredicted propensity (probability)\naudience group\ncohort (test or control)\n\nis then logged as a MLFlow artifact\ngenerate the following\n\nprofile of the audience groups in terms of\n\ndescriptive statistics\nbehavioral attributes (values of columns in the data by visitors assigned to each group)\n\nsummary of the cohorts and audience groups, showing the\n\nconversion rate (KPI) per audience group, cohort and overall\nsize of random cohort relative to overall audience group\n\n\nwhich are then logged as separate MLFlow artifacts\n\nOutputs produced by steps 6. and 7. in this procedure are for use by the marketing team to build and design the campaign."
  },
  {
    "objectID": "notebooks/02-train/notebooks/07_get_audience_cohorts.html#user-inputs",
    "href": "notebooks/02-train/notebooks/07_get_audience_cohorts.html#user-inputs",
    "title": "Get Randomized Audience Cohorts From Inference",
    "section": "User Inputs",
    "text": "User Inputs\nDefine the following\n\nstart and end dates for inference data\nname of column containing label (outcome)\nlist of categorical features\nlist of numerical features, including categorical features present in the raw data as integers\naudience_groups\n\ndesired audience groups into which the first-time visitors propensities will be placed\n\nnum_propens_groups specifies the number of desired audience propensity groups (low, medium and high)\npropens_group_labels specifies names of the desired audience propensity groups\n\n\ninputs (uplift, powerm confidence level) for which random cohort sizes are to be created\ntype of audience strategy (single- or multi- group) from which to create cohorts\n\n\n# 1. start and end dates\ninfer_start_date = \"20170301\"\ninfer_end_date = \"20170331\"\n\n# 2. label column\nlabel = \"made_purchase_on_future_visit\"\n\n# 3. categorical column\ncategoricals=[\n    'bounces',\n    'source',\n    'medium',\n    'channelGrouping',\n    'last_action',\n    'browser',\n    'os',\n    'deviceCategory',\n]\n\n# 4. numerical columns\nnumericals=[\n    'hits',\n    'pageviews',\n    'promos_displayed',\n    'product_views',\n    'product_clicks',\n    'time_on_site',\n]\n\n# 5. mapping dictionaries\naudience_groups_strategy_1 = {\n    \"num_propens_groups\": 3,\n    \"propens_group_labels\": [\"High\", \"Medium\", \"Low\"],\n}\naudience_groups_strategy_2 = {\n    \"num_propens_groups\": 3,\n    \"propens_group_labels\": [\"High\", \"High-Medium\", \"High-Medium-Low\"],\n}\n\n# 6. wanted inputs for estimating sample sizes\nwanted_inputs = {\n    \"uplift_percentage\": 10,\n    \"power_percentage\": 55,\n    \"confidence_level_percentage\": 55,\n}\n\n# 7. type of audience strategy to use when creating groups\naudience_strategy = 1\n\nCreate a mapping between audience group number (0, 1, 2) and group name\n\nmapper_dict_audience_strategy_1 = dict(\n    zip(\n        range(audience_groups_strategy_1[\"num_propens_groups\"]),\n        audience_groups_strategy_1[\"propens_group_labels\"],\n    )\n)\nmapper_dict_audience_strategy_2 = dict(\n    zip(\n        range(audience_groups_strategy_2[\"num_propens_groups\"]),\n        audience_groups_strategy_2[\"propens_group_labels\"],\n    )\n)\nprint(mapper_dict_audience_strategy_1)\nprint(mapper_dict_audience_strategy_2)\n\n{0: 'High', 1: 'Medium', 2: 'Low'}\n{0: 'High', 1: 'High-Medium', 2: 'High-Medium-Low'}\n\n\nGet desired effect size queries and number of audience groups\n\nif audience_strategy == 1:\n    query_inputs = (\n        f\"(uplift == {wanted_inputs['uplift_percentage']}) & \"\n        f\"(power == {wanted_inputs['power_percentage']}) & \"\n        f\"(ci_level == {wanted_inputs['confidence_level_percentage']})\"\n    )\nelse:\n    query_inputs = (\n        f\"(group_size_proportion &lt; 34) & \"\n        f\"(uplift == {wanted_inputs['uplift_percentage']}) & \"\n        f\"(power == {wanted_inputs['power_percentage']}) & \"\n        f\"(ci_level == {wanted_inputs['confidence_level_percentage']})\"\n    )\n\nnum_bins = (\n    audience_groups_strategy_1[\"num_propens_groups\"]\n    if audience_strategy == 1\n    else audience_groups_strategy_2[\"num_propens_groups\"]\n)"
  },
  {
    "objectID": "notebooks/02-train/notebooks/07_get_audience_cohorts.html#get-inference-data",
    "href": "notebooks/02-train/notebooks/07_get_audience_cohorts.html#get-inference-data",
    "title": "Get Randomized Audience Cohorts From Inference",
    "section": "Get Inference Data",
    "text": "Get Inference Data\n\nquery_infer = sqlh.get_sql_query_infer(infer_start_date, infer_end_date)\nX_infer, _ = th.extract_data(query_infer, gcp_auth_dict).pipe(\n    th.transform_data,\n    datatypes_dict={k:v for k,v in dtypes_dict.items() if k != label},\n    duplicate_cols=[\"fullvisitorid\"],\n    column_mapper_dict={'last_action': action_mapper},\n)\nX_infer = X_infer.pipe(th.shuffle_data)\n\nQuery execution start time = 2023-07-10 19:10:31.771...done at 2023-07-10 19:10:36.786 (5.016 seconds).\nQuery returned 21,768 rows\nGot 21,752 rows and 28 columns after dropping duplicates\nTransformed data has 21,752 rows & 28 columns\n\n\nGet the size of each audience cohort in the inference data\n\nbin_size_infer = len(X_infer) / num_bins\nbin_size_infer_control = int(bin_size_infer / 2)"
  },
  {
    "objectID": "notebooks/02-train/notebooks/07_get_audience_cohorts.html#get-model",
    "href": "notebooks/02-train/notebooks/07_get_audience_cohorts.html#get-model",
    "title": "Get Randomized Audience Cohorts From Inference",
    "section": "Get Model",
    "text": "Get Model\n\nFetch Latest Version of Best Deployment Candidate Model\nGet name of best deployment candidate model from MLFlow model registry\n\ndf_deployment_candidate_mlflow_models = modh.get_all_deployment_candidate_models()\nbest_run_model_name = modh.get_best_deployment_candidate_model(\n    df_deployment_candidate_mlflow_models\n)\nwith pd.option_context(\"display.max_colwidth\", None):\n    display(df_deployment_candidate_mlflow_models)\n\n2023/07/10 23:10:37 INFO mlflow.store.db.utils: Creating initial MLflow database tables...\n2023/07/10 23:10:37 INFO mlflow.store.db.utils: Updating database tables\nINFO  [alembic.runtime.migration] Context impl SQLiteImpl.\nINFO  [alembic.runtime.migration] Will assume non-transactional DDL.\nINFO  [alembic.runtime.migration] Context impl SQLiteImpl.\nINFO  [alembic.runtime.migration] Will assume non-transactional DDL.\n2023/07/10 23:10:37 INFO mlflow.store.db.utils: Creating initial MLflow database tables...\n2023/07/10 23:10:37 INFO mlflow.store.db.utils: Updating database tables\nINFO  [alembic.runtime.migration] Context impl SQLiteImpl.\nINFO  [alembic.runtime.migration] Will assume non-transactional DDL.\n\n\n\n\n\n\n\n\n\nname\ndescription\nrun_id\ntags\nversion\nscore\n\n\n\n\n0\nBetaDistClassifier_20160901_20170228_133892_feats__20230710_184102\nBest Model based on fbeta2 score of 0.4983145472\nf805253a6ba64ee6a41bf14310ef16a4\n{'deployment-candidate': 'yes'}\n2\n0.498315\n\n\n\n\n\n\n\n\n\nPipeline(steps=[('preprocessor',\n                 ColumnTransformer(transformers=[('num',\n                                                  Pipeline(steps=[('aboveavg',\n                                                                   AboveAveragePagePromoEngager(cols=['hits',\n                                                                                                      'promos_displayed',\n                                                                                                      'promos_clicked',\n                                                                                                      'product_views',\n                                                                                                      'product_clicks',\n                                                                                                      'pageviews',\n                                                                                                      'time_on_site'])),\n                                                                  ('scaler',\n                                                                   MinMaxScaler())]),\n                                                  ['hits', 'promos_displayed',\n                                                   'promos_clicked',\n                                                   'product_views',\n                                                   'product_clicks',\n                                                   'page...\n                                                                  ('dummy',\n                                                                   OneHotEncoder(drop='first',\n                                                                                 dtype=&lt;class 'int'&gt;,\n                                                                                 handle_unknown='ignore'))]),\n                                                  ['bounces', 'last_action',\n                                                   'source', 'medium',\n                                                   'channelGrouping', 'browser',\n                                                   'os', 'deviceCategory'])])),\n                ('select', DropCorrelatedFeatures(threshold=0.7)),\n                ('resampler',\n                 RandomOverSampler(random_state=88, sampling_strategy=0.1)),\n                ['clf', BetaDistClassifier(a=0.3, b=2.4, random_state=88)]])In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.PipelinePipeline(steps=[('preprocessor',\n                 ColumnTransformer(transformers=[('num',\n                                                  Pipeline(steps=[('aboveavg',\n                                                                   AboveAveragePagePromoEngager(cols=['hits',\n                                                                                                      'promos_displayed',\n                                                                                                      'promos_clicked',\n                                                                                                      'product_views',\n                                                                                                      'product_clicks',\n                                                                                                      'pageviews',\n                                                                                                      'time_on_site'])),\n                                                                  ('scaler',\n                                                                   MinMaxScaler())]),\n                                                  ['hits', 'promos_displayed',\n                                                   'promos_clicked',\n                                                   'product_views',\n                                                   'product_clicks',\n                                                   'page...\n                                                                  ('dummy',\n                                                                   OneHotEncoder(drop='first',\n                                                                                 dtype=&lt;class 'int'&gt;,\n                                                                                 handle_unknown='ignore'))]),\n                                                  ['bounces', 'last_action',\n                                                   'source', 'medium',\n                                                   'channelGrouping', 'browser',\n                                                   'os', 'deviceCategory'])])),\n                ('select', DropCorrelatedFeatures(threshold=0.7)),\n                ('resampler',\n                 RandomOverSampler(random_state=88, sampling_strategy=0.1)),\n                ['clf', BetaDistClassifier(a=0.3, b=2.4, random_state=88)]])preprocessor: ColumnTransformerColumnTransformer(transformers=[('num',\n                                 Pipeline(steps=[('aboveavg',\n                                                  AboveAveragePagePromoEngager(cols=['hits',\n                                                                                     'promos_displayed',\n                                                                                     'promos_clicked',\n                                                                                     'product_views',\n                                                                                     'product_clicks',\n                                                                                     'pageviews',\n                                                                                     'time_on_site'])),\n                                                 ('scaler', MinMaxScaler())]),\n                                 ['hits', 'promos_displayed', 'promos_clicked',\n                                  'product_views', 'product_clicks',\n                                  'pageviews', 'time_on_site']),\n                                ('cat',\n                                 P...\n                                                                                                    n_categories=1,\n                                                                                                    replace_with='other',\n                                                                                                    tol=0.1,\n                                                                                                    variables=['source',\n                                                                                                               'browser']),\n                                                                                   ['bounces',\n                                                                                    'last_action',\n                                                                                    'source',\n                                                                                    'medium',\n                                                                                    'channelGrouping',\n                                                                                    'browser',\n                                                                                    'os',\n                                                                                    'deviceCategory'])])),\n                                                 ('dummy',\n                                                  OneHotEncoder(drop='first',\n                                                                dtype=&lt;class 'int'&gt;,\n                                                                handle_unknown='ignore'))]),\n                                 ['bounces', 'last_action', 'source', 'medium',\n                                  'channelGrouping', 'browser', 'os',\n                                  'deviceCategory'])])num['hits', 'promos_displayed', 'promos_clicked', 'product_views', 'product_clicks', 'pageviews', 'time_on_site']AboveAveragePagePromoEngagerAboveAveragePagePromoEngager(cols=['hits', 'promos_displayed', 'promos_clicked',\n                                   'product_views', 'product_clicks',\n                                   'pageviews', 'time_on_site'])MinMaxScalerMinMaxScaler()cat['bounces', 'last_action', 'source', 'medium', 'channelGrouping', 'browser', 'os', 'deviceCategory']rarecats: ColumnTransformerColumnTransformer(remainder='passthrough',\n                  transformers=[('fe',\n                                 RareLabelEncoder(ignore_format=True,\n                                                  n_categories=1,\n                                                  replace_with='other', tol=0.1,\n                                                  variables=['source',\n                                                             'browser']),\n                                 ['bounces', 'last_action', 'source', 'medium',\n                                  'channelGrouping', 'browser', 'os',\n                                  'deviceCategory'])])fe['bounces', 'last_action', 'source', 'medium', 'channelGrouping', 'browser', 'os', 'deviceCategory']RareLabelEncoderRareLabelEncoder(ignore_format=True, n_categories=1, replace_with='other',\n                 tol=0.1, variables=['source', 'browser'])remainderpassthroughpassthroughOneHotEncoderOneHotEncoder(drop='first', dtype=&lt;class 'int'&gt;, handle_unknown='ignore')DropCorrelatedFeaturesDropCorrelatedFeatures(threshold=0.7)RandomOverSamplerRandomOverSampler(random_state=88, sampling_strategy=0.1)BetaDistClassifierBetaDistClassifier(a=0.3, b=2.4, random_state=88)\n\n\n\n\nGet Data Used to Develop Best Deployment Candidate Model\nGet all available data used during model development of the best deployment candidate model\n\ndf_all = (\n    modh.get_data_for_run_id(df_deployment_candidate_mlflow_models, 'processed_data')\n    .pipe(ash.set_datatypes, {\"predicted_label\": pd.Int64Dtype()})\n)\n\nSet all specified datatypes.\n\n\n::: {.content-hidden} Show column datatypes for data used to train model during best experiment run :::\n\n\n\n\n\n\n\n\n\ndtype\n\n\n\n\nfullvisitorid\nstring[python]\n\n\nvisitId\nstring[python]\n\n\nvisitNumber\nInt64\n\n\nvisitStartTime\ndatetime64[ns]\n\n\nquarter\nInt64\n\n\nmonth\nInt64\n\n\nday_of_month\nInt64\n\n\nday_of_week\nInt64\n\n\nhour\nInt64\n\n\nminute\nInt64\n\n\nsecond\nInt64\n\n\nsource\ncategory\n\n\nmedium\ncategory\n\n\nchannelGrouping\ncategory\n\n\nhits\nInt64\n\n\nbounces\nint64\n\n\nlast_action\ncategory\n\n\npromos_displayed\nInt64\n\n\npromos_clicked\nInt64\n\n\nproduct_views\nInt64\n\n\nproduct_clicks\nInt64\n\n\npageviews\nInt64\n\n\ntime_on_site\nInt64\n\n\nbrowser\ncategory\n\n\nos\ncategory\n\n\ndeviceCategory\ncategory\n\n\nadded_to_cart\nInt64\n\n\nrevenue\nFloat64\n\n\nmade_purchase_on_future_visit\nInt64\n\n\nsplit_type\ncategory\n\n\nscore\nFloat64\n\n\npredicted_score_label\nboolean\n\n\npredicted_label\nInt64\n\n\n\n\n\n\n\n\n\nCheck Data Drift and Stability\nGet test split from the data used during development of the best deployment candidate model. This was the last month of data used during ML model development and it will be considered as the reference data.\n\nX_test_best_run = (\n    df_all\n    .query(\"split_type == 'test'\")\n    .drop(columns=['split_type', label])\n)\n\nCheck numerical features for drift between\n\nML development data (test split)\nunseen data (inference)\n\nusing the Wasserstein test\n\ndf_num_drift, _ = dch.detect_features_drift(\n    X_infer.assign(revenue=lambda df: df['revenue'].fillna(0)),\n    X_test_best_run.assign(revenue=lambda df: df['revenue'].fillna(0)),\n    numericals=numericals+['revenue'],\n    categoricals=[],\n    kst_threshold=0.05,\n    kst_params=dict(\n        method='exact',\n        N=max(len(X_test_best_run), len(X_infer)),\n        alternative='two-sided',\n    ),\n    wsd_threshold=1,\n)\ndisplay(df_num_drift)\n\n\n\n\n\n\n\n\nfeature_type\nfeature\nnunique_ref\nnunique_curr\npct_diff_mean\npct_diff_std\nabs_diff_mean\nabs_diff_std\nmetric_value\nmetric_threshold\ndrift_detected\ntest_type\n\n\n\n\n0\nnumerical\nhits\n104\n112\n-2.719244\n-15.613408\n-0.168233\n-1.512405\n0.218377\n1\nFalse\nWasserstein\n\n\n1\nnumerical\npageviews\n78\n94\n-2.129631\n-18.01145\n-0.112481\n-1.334363\n0.158976\n1\nFalse\nWasserstein\n\n\n2\nnumerical\npromos_displayed\n21\n18\n-9.680134\n2.989891\n-0.756197\n0.316096\n0.787574\n1\nFalse\nWasserstein\n\n\n3\nnumerical\nproduct_views\n273\n286\n1.279359\n-5.401748\n0.300529\n-1.931742\n0.717114\n1\nFalse\nWasserstein\n\n\n4\nnumerical\nproduct_clicks\n30\n35\n-6.811965\n-13.635198\n-0.043161\n-0.248311\n0.043161\n1\nFalse\nWasserstein\n\n\n5\nnumerical\ntime_on_site\n1583\n1702\n-7.31577\n-6.511785\n-13.085232\n-25.663694\n13.449954\n1\nTrue\nWasserstein\n\n\n6\nnumerical\nrevenue\n361\n414\n-13.610552\n-31.823916\n-0.750609\n-13.854969\n0.76026\n1\nFalse\nWasserstein\n\n\n\n\n\n\n\n\n\n\n\n\n\nNotes\n\n\n\n\nFor descriptive statistics, consider drift being present if both of the following conditions are met\n\npct_diff_mean &gt; 5\n\npercent difference between mean value in reference (test data) and current (inference) data is larger than 5%\n\npct_diff_std &gt; 15\n\npercent difference between standard deviation (which provides an indication of variability) in reference (test data) and current (inference) data is larger than 15%\n\n\nBoth percent differnces are calculated relative to the reference data.\n\n\n\n\n\n\n\n\n\nObservations\n\n\n\n\nThe percent differences in the descriptive statistics (mean and standard deviation) suggest that drift is minimal for the following numerical features\n\npromos_displayed\nproduct_views\ntime_on_site\nproduct_clicks\nrevenue (not a feature)\n\nThe pageviews and hits features, and revenue column, show a drift from their higher variability, as suggested by their higher standard deviation, which in-turn indicates the presence of outliers. These do not show any drift in the mean percent difference.\nThe last four columns are related to the statistical test comparing the same feature in two datasets. A threshold of 1 was arbitrarily chosen. The limitation of this test is due to the difficulty in setting a reasonable threshold against which the metric can be compared. This test of drift could be useful if multiple inference periods were present during the production period. In such a scenario, the percent change in the metric could be tracked from one period to the next in order to determine if the feature is showing the presence of drift. These four columns are of less use in drift monitoring for a single infernce period.\n\n\n\nPerform sanity checks on all features between\n\nML development data (test split)\nunseen data (inference)\n\n\ndtypes_eai = dict(zip(categoricals, ['str']*len(categoricals)))\ndf_stability = dch.check_data_stability(\n    X_infer.astype(dtypes_eai),\n    X_test_best_run.astype(dtypes_eai),\n    numericals=numericals+['revenue'],\n    categoricals=categoricals,\n)\nwith pd.option_context('display.max_colwidth', None):\n    display(df_stability)\n\nTest suite start time = 2023-07-10 19:10:38.026...done at 2023-07-10 19:10:42.458 (4.432 seconds).\n\n\n\n\n\n\n\n\n\nall_passed\ntotal_tests\nsuccess_tests\nfailed_tests\nlen_curr_data\nlen_ref_data\nfeatures_checked\nnum_features_checked\nSUCCESS\n\n\n\n\n0\nTrue\n8\n8\n0\n21752\n20164\n[\"bounces\", \"source\", \"medium\", \"channelGrouping\", \"last_action\", \"browser\", \"os\", \"deviceCategory\", \"hits\", \"pageviews\", \"promos_displayed\", \"product_views\", \"product_clicks\", \"time_on_site\", \"revenue\"]\n15\n8\n\n\n\n\n\n\n\n\n\n\n\n\n\nNotes\n\n\n\n\nThe EvidentlyAI TestSuite module requires string features to have the object datatype. So, a datatype mapping dictionary was defined (dtypes_eai) to change the datatypes for these features.\n\n\n\n\n\n\n\n\n\nObservations\n\n\n\n\nIt is reassuring that all data stability tests have passed. This indicates that features in the unseen (inference) data are stable in the 10 attributes listed in the About section, relative to those in the data used during ML development."
  },
  {
    "objectID": "notebooks/02-train/notebooks/07_get_audience_cohorts.html#make-inference-predictions",
    "href": "notebooks/02-train/notebooks/07_get_audience_cohorts.html#make-inference-predictions",
    "title": "Get Randomized Audience Cohorts From Inference",
    "section": "Make Inference Predictions",
    "text": "Make Inference Predictions\nMake inference predictions with best deployment candidate model, using features extracted from the inference data\n\ny_infer_pred, y_infer_pred_proba = modh.make_inference(model, X_infer, label)\n\n/opt/conda/envs/train/lib/python3.11/site-packages/sklearn/preprocessing/_encoders.py:202: UserWarning: Found unknown categories in columns [6] during transform. These unknown categories will be encoded as all zeros\n  warnings.warn(\n/opt/conda/envs/train/lib/python3.11/site-packages/sklearn/preprocessing/_encoders.py:202: UserWarning: Found unknown categories in columns [6] during transform. These unknown categories will be encoded as all zeros\n  warnings.warn(\n\n\n\n\n\n\n\n\n\n\n\nmade_purchase_on_future_visit\nproportion\nnumber\n\n\n\n\n0\n0\n0.955039\n20774\n\n\n1\n1\n0.044961\n978\n\n\n\n\n\n\n\n\n\n\n\n\n\nNotes\n\n\n\n\nPer the business use-case, these are predictions of whether a visitor will make a purchase during a later (return) visit to the merchandise store. Such predictions are made using attributes (features) of the first visit by visitors to the store and they can only be evaluated at a later time (after the outcome of the same visitor’s later visit is known)."
  },
  {
    "objectID": "notebooks/02-train/notebooks/07_get_audience_cohorts.html#create-cohorts",
    "href": "notebooks/02-train/notebooks/07_get_audience_cohorts.html#create-cohorts",
    "title": "Get Randomized Audience Cohorts From Inference",
    "section": "Create Cohorts",
    "text": "Create Cohorts\nPerform the following to prepare the inference observations for extracting cohorts from the audience group(s)\n\ncombine inference features and predicted hard and soft labels into single DataFrame\nsort predictions in ascending order of the predicted probability (propensity) (score)\nseparate the predictions into bins, using the predicted probability, based on the required number of bins\nrename bin_number column (for use in downstream step)\nset datatypes for columns\n\n\ndf_infer_pred = (\n    ch.combine_infer_data(X_infer, y_infer_pred, y_infer_pred_proba)\n    .pipe(ash.sort_scores, False)\n    .pipe(ash.get_audience_groups_by_propensity, num_bins)\n    .pipe(ch.rename_columns, {\"group_number\": \"maudience\"})\n    .pipe(\n        ash.set_datatypes,\n        {\n            \"row_number\": pd.Int16Dtype(),\n            \"fullvisitorid\": pd.StringDtype(),\n            \"score\": pd.Float64Dtype(),  # Float32Dtype\n            \"predicted_score_label\": pd.BooleanDtype(),\n            \"maudience\": pd.Int8Dtype(),\n            \"row_number\": pd.Int64Dtype(),\n        },\n    )\n)\nwith pd.option_context(\"display.max_columns\", 1000):\n    display(df_infer_pred)\n\nSet all specified datatypes.\n\n\n\n\n\n\n\n\n\nfullvisitorid\nvisitId\nvisitNumber\nvisitStartTime\nquarter\nmonth\nday_of_month\nday_of_week\nhour\nminute\nsecond\nsource\nmedium\nchannelGrouping\nhits\nbounces\nlast_action\npromos_displayed\npromos_clicked\nproduct_views\nproduct_clicks\npageviews\ntime_on_site\nbrowser\nos\ndeviceCategory\nadded_to_cart\nrevenue\nscore\npredicted_score_label\nrow_number\nmaudience\n\n\n\n\n6784\n7701350257079842191\n1488377334\n1\n2017-03-01 06:08:54\n1\n3\n1\n4\n6\n8\n54\nlearn.temple.edu\nreferral\nReferral\n1\n1\nUnknown\n9\n0\n0\n0\n1\n0\nChrome\nMacintosh\ndesktop\n0\n&lt;NA&gt;\n0.961501\nFalse\n0\n0\n\n\n20268\n2695658604851424923\n1489171901\n1\n2017-03-10 10:51:41\n1\n3\n10\n6\n10\n51\n41\ngoogle\norganic\nOrganic Search\n1\n1\nUnknown\n0\n0\n0\n0\n1\n0\nChrome\nMacintosh\ndesktop\n0\n&lt;NA&gt;\n0.945025\nFalse\n1\n0\n\n\n16170\n8971083254880506569\n1489199324\n1\n2017-03-10 18:28:44\n1\n3\n10\n6\n18\n28\n44\ngoogle\norganic\nOrganic Search\n1\n1\nUnknown\n0\n0\n12\n0\n1\n0\nChrome\nAndroid\nmobile\n0\n&lt;NA&gt;\n0.940148\nFalse\n2\n0\n\n\n16629\n4054255996057072564\n1489603486\n1\n2017-03-15 11:44:46\n1\n3\n15\n4\n11\n44\n46\ngoogle\norganic\nOrganic Search\n13\n0\nAdd product(s) to cart\n9\n0\n73\n1\n11\n224\nChrome\nLinux\ndesktop\n1\n&lt;NA&gt;\n0.93972\nFalse\n3\n0\n\n\n3120\n0374263254549285298\n1490817249\n1\n2017-03-29 12:54:09\n1\n3\n29\n4\n12\n54\n9\ngoogle\norganic\nOrganic Search\n4\n0\nUnknown\n9\n0\n12\n0\n4\n90\nChrome\nAndroid\nmobile\n0\n&lt;NA&gt;\n0.934395\nFalse\n4\n0\n\n\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n\n\n17358\n5874575205881769874\n1490761689\n1\n2017-03-28 21:28:09\n1\n3\n28\n3\n21\n28\n9\nyoutube.com\nreferral\nSocial\n26\n0\nProduct detail views\n9\n0\n64\n9\n17\n817\nEdge\nWindows\ndesktop\n0\n&lt;NA&gt;\n0.0\nTrue\n21747\n2\n\n\n10266\n8012619550898035818\n1490675313\n1\n2017-03-27 21:28:33\n1\n3\n27\n2\n21\n28\n33\ngoogle\norganic\nOrganic Search\n3\n0\nUnknown\n9\n0\n18\n0\n3\n48\nSafari\niOS\nmobile\n0\n&lt;NA&gt;\n0.0\nFalse\n21748\n2\n\n\n8666\n434532778812104332\n1489575014\n1\n2017-03-15 03:50:14\n1\n3\n15\n4\n3\n50\n14\ngoogle\norganic\nOrganic Search\n6\n0\nUnknown\n18\n0\n43\n0\n6\n246\nChrome\niOS\ntablet\n0\n&lt;NA&gt;\n0.0\nFalse\n21749\n2\n\n\n8034\n5010936918921461102\n1490914132\n1\n2017-03-30 15:48:52\n1\n3\n30\n5\n15\n48\n52\n(direct)\n(none)\nDirect\n2\n0\nUnknown\n0\n0\n6\n0\n2\n162\nSafari\niOS\nmobile\n0\n&lt;NA&gt;\n0.0\nFalse\n21750\n2\n\n\n7394\n6847844312870761783\n1490498125\n1\n2017-03-25 20:15:25\n1\n3\n25\n7\n20\n15\n25\n(direct)\n(none)\nDirect\n2\n0\nUnknown\n9\n0\n12\n0\n2\n43\nChrome\nAndroid\nmobile\n0\n&lt;NA&gt;\n0.0\nFalse\n21751\n2\n\n\n\n\n21752 rows × 32 columns\n\n\n\n\n\n\n\n\n\nNotes\n\n\n\n\nThis is the same data preparation that was used during the (previous) sample size estimation step step in order to prepare the test data split for estimating the required sample size.\n\n\n\n\n\n\n\n\n\n\n\n\nfullvisitorid\nvisitId\nvisitNumber\nvisitStartTime\nquarter\nmonth\nday_of_month\nday_of_week\nhour\nminute\nsecond\nsource\nmedium\nchannelGrouping\nhits\nbounces\nlast_action\npromos_displayed\npromos_clicked\nproduct_views\nproduct_clicks\npageviews\ntime_on_site\nbrowser\nos\ndeviceCategory\nadded_to_cart\nrevenue\nscore\npredicted_score_label\nrow_number\nmaudience\n\n\n\n\ndtype\nstring[python]\nstring[python]\nInt64\ndatetime64[ns]\nInt64\nInt64\nInt64\nInt64\nInt64\nInt64\nInt64\ncategory\ncategory\ncategory\nInt64\ncategory\ncategory\nInt64\nInt64\nInt64\nInt64\nInt64\nInt64\ncategory\ncategory\ncategory\nInt64\nFloat64\nFloat64\nboolean\nInt64\nInt8\n\n\n\n\n\n\n\nPerform the following to get the test and control cohorts from the inference data\n\nload estimates for required sample sizes associated with best deployment candidate model\nget required sample sizes for the chosen audience strategy\nget required sample sizes that can be supported by size of inference data\nget required sample sizes that support all required audience groups (bins)\nget required sample sizes that capture required effect sizes\nget random test and control cohorts\n\n\ndf_infer_audience_groups = (\n    ch.load_file_from_mlflow_artifact(\n        df_deployment_candidate_mlflow_models, \"audience_sample_sizes\"\n    )\n    .pipe(ash.set_datatypes, {\"audience_strategy\": pd.Int8Dtype()})\n    .pipe(ch.get_sample_sizes_by_strategy, audience_strategy)\n    .pipe(ch.get_suitable_sample_sizes, bin_size_infer_control)\n    .pipe(ch.get_sample_sizes_with_all_audience_groups, num_bins)\n    .pipe(ch.get_required_inputs, query_inputs)\n    .pipe(\n        ch.create_cohorts,\n        df_infer_pred,\n        mapper_dict_audience_strategy_1\n        if audience_strategy == 1\n        else mapper_dict_audience_strategy_2,\n        audience_strategy,\n    )\n    .pipe(\n        ash.set_datatypes,\n        {\n            \"maudience\": pd.StringDtype(),\n            \"cohort\": pd.StringDtype(),\n            \"audience_strategy\": pd.Int8Dtype(),\n        },\n    )\n)\nwith pd.option_context(\"display.max_columns\", 1000):\n    display(df_infer_audience_groups)\n\nSet all specified datatypes.\naudience=0: High, size=7,251,  excluded=2,621, wanted=2,315, control=2,315, test=2,315\naudience=1: Medium, size=7,250,  excluded=3,054, wanted=2,098, control=2,098, test=2,098\naudience=2: Low, size=7,251,  excluded=2,715, wanted=2,268, control=2,268, test=2,268\nFound suitable sample sizes and generated cohorts.\nSet all specified datatypes.\n\n\n\n\n\n\n\n\n\nfullvisitorid\nvisitId\nvisitNumber\nvisitStartTime\nquarter\nmonth\nday_of_month\nday_of_week\nhour\nminute\nsecond\nsource\nmedium\nchannelGrouping\nhits\nbounces\nlast_action\npromos_displayed\npromos_clicked\nproduct_views\nproduct_clicks\npageviews\ntime_on_site\nbrowser\nos\ndeviceCategory\nadded_to_cart\nrevenue\nscore\npredicted_score_label\nmaudience\ncohort\naudience_strategy\n\n\n\n\n0\n7701350257079842191\n1488377334\n1\n2017-03-01 06:08:54\n1\n3\n1\n4\n6\n8\n54\nlearn.temple.edu\nreferral\nReferral\n1\n1\nUnknown\n9\n0\n0\n0\n1\n0\nChrome\nMacintosh\ndesktop\n0\n&lt;NA&gt;\n0.961501\nFalse\nHigh\nControl\n1\n\n\n1\n1927404893298120774\n1489438559\n1\n2017-03-13 13:55:59\n1\n3\n13\n2\n13\n55\n59\ngoogle\norganic\nOrganic Search\n2\n0\nUnknown\n0\n0\n12\n0\n2\n14\nChrome\nWindows\ndesktop\n0\n&lt;NA&gt;\n0.884723\nFalse\nHigh\nControl\n1\n\n\n2\n4081311830661383532\n1489678740\n1\n2017-03-16 08:39:00\n1\n3\n16\n5\n8\n39\n0\ngoogle\norganic\nOrganic Search\n1\n1\nUnknown\n0\n0\n1\n0\n1\n0\nChrome\nChrome OS\ndesktop\n0\n&lt;NA&gt;\n0.879829\nFalse\nHigh\nControl\n1\n\n\n3\n48980746408094895\n1489003955\n1\n2017-03-08 12:12:35\n1\n3\n8\n4\n12\n12\n35\ngoogle\norganic\nOrganic Search\n27\n0\nProduct detail views\n0\n0\n166\n4\n23\n928\nChrome\nWindows\ndesktop\n0\n&lt;NA&gt;\n0.866037\nFalse\nHigh\nControl\n1\n\n\n4\n0480615828723852227\n1490621968\n1\n2017-03-27 06:39:28\n1\n3\n27\n2\n6\n39\n28\ngoogle\norganic\nOrganic Search\n2\n0\nUnknown\n9\n0\n0\n0\n2\n8\nChrome\nMacintosh\ndesktop\n0\n&lt;NA&gt;\n0.864021\nFalse\nHigh\nControl\n1\n\n\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n\n\n21747\n0301626924810909605\n1490969834\n1\n2017-03-31 07:17:14\n1\n3\n31\n6\n7\n17\n14\n(direct)\n(none)\nDirect\n15\n0\nProduct detail views\n9\n0\n27\n2\n13\n291\nChrome\nMacintosh\ndesktop\n0\n&lt;NA&gt;\n0.0\nFalse\nLow\n&lt;NA&gt;\n1\n\n\n21748\n0088053741107907630\n1489626052\n1\n2017-03-15 18:00:52\n1\n3\n15\n4\n18\n0\n52\n(direct)\n(none)\nDirect\n3\n0\nUnknown\n9\n0\n0\n0\n3\n28\nSafari\nMacintosh\ndesktop\n0\n&lt;NA&gt;\n0.0\nFalse\nLow\n&lt;NA&gt;\n1\n\n\n21749\n5874575205881769874\n1490761689\n1\n2017-03-28 21:28:09\n1\n3\n28\n3\n21\n28\n9\nyoutube.com\nreferral\nSocial\n26\n0\nProduct detail views\n9\n0\n64\n9\n17\n817\nEdge\nWindows\ndesktop\n0\n&lt;NA&gt;\n0.0\nTrue\nLow\n&lt;NA&gt;\n1\n\n\n21750\n8012619550898035818\n1490675313\n1\n2017-03-27 21:28:33\n1\n3\n27\n2\n21\n28\n33\ngoogle\norganic\nOrganic Search\n3\n0\nUnknown\n9\n0\n18\n0\n3\n48\nSafari\niOS\nmobile\n0\n&lt;NA&gt;\n0.0\nFalse\nLow\n&lt;NA&gt;\n1\n\n\n21751\n5010936918921461102\n1490914132\n1\n2017-03-30 15:48:52\n1\n3\n30\n5\n15\n48\n52\n(direct)\n(none)\nDirect\n2\n0\nUnknown\n0\n0\n6\n0\n2\n162\nSafari\niOS\nmobile\n0\n&lt;NA&gt;\n0.0\nFalse\nLow\n&lt;NA&gt;\n1\n\n\n\n\n21752 rows × 33 columns\n\n\n\n\n\n\n\n\n\nNotes\n\n\n\n\nThe final sample size used to generate the cohorts is the least number of samples (first-time visitors) to be included in each of the control and test cohorts of each audience group. These sizes come from the output of the previous step (designing a media or marketing experiment - 1, 2).\n\n\n\nThe treatment (or test) and control groups should be similar to each other for the property to be tested. This is a fundamental requirement of test and control groups. In this case, the probability (score column) is the property of interest. With this in mind, we now show selected descriptive statistics, for the score column, for both the test (treatment) and control cohorts within each desired audience group (low, medium and high propensity)\n\ndf_aud_stats = ch.get_cohort_stats(df_infer_audience_groups)\ndf_aud_stats\n\n\n\n\n\n\n\n\nmaudience\ncohort\nscore_count\nscore_min\nscore_mean\nscore_median\nscore_max\n\n\n\n\n0\nHigh\nControl\n2315\n0.098383\n0.290206\n0.235826\n0.961501\n\n\n1\nHigh\nTest\n2315\n0.098402\n0.29217\n0.235049\n0.940148\n\n\n2\nHigh\n&lt;NA&gt;\n2621\n0.098362\n0.287721\n0.233066\n0.945025\n\n\n3\nLow\nControl\n2268\n0.0\n0.001985\n0.000808\n0.008814\n\n\n4\nLow\nTest\n2268\n0.0\n0.00199\n0.000807\n0.008805\n\n\n5\nLow\n&lt;NA&gt;\n2715\n0.0\n0.001984\n0.000835\n0.008811\n\n\n6\nMedium\nControl\n2098\n0.008823\n0.041494\n0.035349\n0.098338\n\n\n7\nMedium\nTest\n2098\n0.008815\n0.041513\n0.034737\n0.098317\n\n\n8\nMedium\n&lt;NA&gt;\n3054\n0.008829\n0.040498\n0.033774\n0.098326\n\n\n\n\n\n\n\n\n\n\n\n\n\nObservations\n\n\n\n\nIt is reassuring that there is agreement in the statistics for the probabilities per Test-Control cohort within the same audience group.\n\n\n\n\n\n\n\n\n\n\n\n\ndtype\n\n\n\n\nmaudience\nstring[python]\n\n\ncohort\nstring[python]\n\n\nscore_count\nInt64\n\n\nscore_min\nFloat64\n\n\nscore_mean\nFloat64\n\n\nscore_median\nFloat64\n\n\nscore_max\nFloat64"
  },
  {
    "objectID": "notebooks/02-train/notebooks/07_get_audience_cohorts.html#summarize-cohorts",
    "href": "notebooks/02-train/notebooks/07_get_audience_cohorts.html#summarize-cohorts",
    "title": "Get Randomized Audience Cohorts From Inference",
    "section": "Summarize Cohorts",
    "text": "Summarize Cohorts\n\nAudience Profiles\nNext, the audience groups in the inference data are briefly profiled, in order to identify characteristics that might help the marketing team build an appropriate strategy to be implemented during the campaign. For each audience group, the profile consists of the following\n\nproportion of visitors who displayed the following behavior\n\nwhose last action during thier first visit was\n\nlast_action == 'Add product(s) to cart'\nlast_action == 'Product detail_views'\nlast_action == 'Click through of product lists'\n\nwho\n\nused a medium == 'referral' to get to the store’s website on their first visit\nadded one item to their shopping cart (added_to_cart &gt; 0) on their first visit\n\nwhose\n\nfirst visit occurred on a weekend (day_of_week.isin(@weekend_days))\n\n\nbounce rate during all first visits\nfollowing descriptive statistics\n\nhour, day_of_week\n\nstatistic: mean\n\nsource, medium, channelGrouping, last_action, browser, os, deviceCategory\n\nstatistic: mode (most common value)\n\npromos_displayed, promos_clicked, product_views, product_clicks, pageviews, added_to_cart\n\nstatistics: mean, max\n\n\n\n\ndf_profile = (\n    pa.get_audience_profile(df_infer_audience_groups, audience_strategy)\n    .pipe(\n        th.set_datatypes,\n        dict(\n            stat=pd.StringDtype(),\n            stat_type=pd.StringDtype(),\n            High=pd.StringDtype(),\n            Low=pd.StringDtype(),\n            Medium=pd.StringDtype(),\n            feature=pd.StringDtype(),\n            audience_strategy=pd.Int8Dtype(),\n        )\n    )\n)\nwith pd.option_context(\"display.max_columns\", 1000):\n    display(df_profile)\n\nSet all specified datatypes.\nSet all specified datatypes.\n\n\n\n\n\n\n\n\n\nstat\nstat_type\nHigh\nLow\nMedium\nfeature\naudience_strategy\n\n\n\n\n0\nhour__mean\nmean\n12.988829127016963\n13.004689008412633\n13.03503448275862\nhour\n1\n\n\n1\nday_of_week__mean\nmean\n4.027858226451524\n3.991035719211143\n3.993793103448276\nday_of_week\n1\n\n\n2\nsource__mode\nmode\ngoogle\ngoogle\ngoogle\nsource\n1\n\n\n3\nmedium__mode\nmode\norganic\norganic\norganic\nmedium\n1\n\n\n4\nchannelGrouping__mode\nmode\nOrganic Search\nOrganic Search\nOrganic Search\nchannelGrouping\n1\n\n\n5\nlast_action__mode\nmode\nUnknown\nUnknown\nUnknown\nlast_action\n1\n\n\n6\nbrowser__mode\nmode\nChrome\nChrome\nChrome\nbrowser\n1\n\n\n7\nos__mode\nmode\nMacintosh\nMacintosh\nMacintosh\nos\n1\n\n\n8\ndeviceCategory__mode\nmode\ndesktop\ndesktop\ndesktop\ndeviceCategory\n1\n\n\n9\nhits__mean\nmean\n6.4591090884016\n6.408219555923321\n6.197655172413793\nhits\n1\n\n\n10\nhits__max\nmax\n226\n500\n175\nhits\n1\n\n\n11\npromos_displayed__mean\nmean\n8.585436491518411\n8.677285891601159\n8.441379310344828\npromos_displayed\n1\n\n\n12\npromos_displayed__max\nmax\n189\n189\n126\npromos_displayed\n1\n\n\n13\npromos_clicked__mean\nmean\n0.00013791201213625708\n0.0\n0.0\npromos_clicked\n1\n\n\n14\npromos_clicked__max\nmax\n1\n0\n0\npromos_clicked\n1\n\n\n15\nproduct_views__mean\nmean\n23.478140946076405\n22.888153358157496\n23.204\nproduct_views\n1\n\n\n16\nproduct_views__max\nmax\n625\n987\n480\nproduct_views\n1\n\n\n17\nproduct_clicks__mean\nmean\n0.7141083988415391\n0.667356226727348\n0.6488275862068965\nproduct_clicks\n1\n\n\n18\nproduct_clicks__max\nmax\n79\n50\n46\nproduct_clicks\n1\n\n\n19\npageviews__mean\nmean\n5.459522824438008\n5.439249758653979\n5.283724137931035\npageviews\n1\n\n\n20\npageviews__max\nmax\n176\n466\n109\npageviews\n1\n\n\n21\nrevenue__mean\nmean\n165.1793893129771\n209.0597609561753\n175.87772925764193\nrevenue\n1\n\n\n22\nrevenue__max\nmax\n3027\n3829\n870\nrevenue\n1\n\n\n23\nadded_to_cart__mean\nmean\n0.20576472210729554\n0.1959729692456213\n0.188\nadded_to_cart\n1\n\n\n24\nadded_to_cart__max\nmax\n21\n23\n25\nadded_to_cart\n1\n\n\n25\nlast_action_added_to_cart\nbehavior\n5.1579092538960145\n4.909667632050752\n5.227586206896552\nlast_action\n1\n\n\n26\nlast_action_completed_purchase\nbehavior\n3.6132947179699353\n3.4615915046200523\n3.1586206896551725\nlast_action\n1\n\n\n27\nlast_action_check_out\nbehavior\n1.2963729140808165\n1.3791201213625708\n1.4068965517241379\nlast_action\n1\n\n\n28\nlast_action_removed_products_from_cart\nbehavior\n0.8550544752447938\n0.8136808716039167\n0.7586206896551724\nlast_action\n1\n\n\n29\nlast_action_clicked_through_product_lists\nbehavior\n0.027582402427251414\n0.08274720728175423\n0.05517241379310345\nlast_action\n1\n\n\n30\nused_referral\nbehavior\n24.18976692869949\n24.465590952972004\n24.413793103448278\nmedium\n1\n\n\n31\nadded_gt_1_to_cart\nbehavior\n3.916701144669701\n4.20631637015584\n3.7655172413793103\nadded_to_cart\n1\n\n\n32\nweekend_visitors\nbehavior\n17.81823196800441\n17.749275961936284\n18.482758620689655\nday_of_week\n1\n\n\n33\nbounce_rate\nbehavior\n33.40228933940146\n32.98855330299269\n33.682758620689654\nbounces\n1\n\n\n34\nnum_observations\nbehavior\n7251\n7251\n7250\nall\n1\n\n\n\n\n\n\n\n\n\n\n\n\n\nNotes\n\n\n\n\nThe audience profile consists of different types of statistics about the first visit, for each audience group.\nThe stat column shows the attribute from the first visit in the inference data for which a statistic is calculated.\nThe stat_type column indicates the type of statistic.\nThe High, Medium and Low columns (or just the High column, if the single-group audience strategy is being used) show the statistic of each attribute within each audience group.\n\n\n\n\n\n\n\n\n\n\n\n\ndtype\n\n\n\n\nstat\nstring[python]\n\n\nstat_type\nstring[python]\n\n\nHigh\nstring[python]\n\n\nLow\nstring[python]\n\n\nMedium\nstring[python]\n\n\nfeature\nstring[python]\n\n\naudience_strategy\nInt8\n\n\n\n\n\n\n\n\n\nConversion Rates per Audience Group and Overall\n\n\nSet all specified datatypes.\nSet all specified datatypes.\nSet all specified datatypes.\nSet all specified datatypes.\nSet all specified datatypes.\nSet all specified datatypes.\nSet all specified datatypes.\nSet all specified datatypes.\n\n\n\n\n\n\n\n\n\naudience_strategy\nmaudience\npred_conversions\ntotal_visitors\nmin_score\ntrue_conversions\ndata_type\ndata_size\ntrue_conv_rate\noverall_true_conv_rate\npred_conv_rate\noverall_pred_conv_rate\n\n\n\n\n0\n1\nHigh\n850\n6722\n0.095656\n149\ndevelopment\n20164\n2.216602\n2.30609\n12.645046\n4.215433\n\n\n1\n1\nLow\n0\n6721\n0.0\n152\ndevelopment\n20164\n2.261568\n2.30609\n0.0\n4.215433\n\n\n2\n1\nMedium\n0\n6721\n0.00911\n164\ndevelopment\n20164\n2.440113\n2.30609\n0.0\n4.215433\n\n\n3\n1\nHigh\n975\n7251\n0.098362\n&lt;NA&gt;\ninference\n21752\n&lt;NA&gt;\n&lt;NA&gt;\n13.446421\n4.482346\n\n\n4\n1\nLow\n0\n7251\n0.0\n&lt;NA&gt;\ninference\n21752\n&lt;NA&gt;\n&lt;NA&gt;\n0.0\n4.482346\n\n\n5\n1\nMedium\n0\n7250\n0.008815\n&lt;NA&gt;\ninference\n21752\n&lt;NA&gt;\n&lt;NA&gt;\n0.0\n4.482346\n\n\n\n\n\n\n\n\n\n\n\n\n\nObservations\n\n\n\n\nBetween the development and inference datasets, the\n\noverall conversion rates(overall_pred_conv_rate)\npredicted conversion rates (pred_conv_rate) for each audience group\nminimum score (min_score) for each audience group\n\nare in good agreement with eachother.\nAt the time of generating the (forward-looking) propensity predictions using the inference data, the true outcome is not known. So, the true number of converted visitors (true_conversions) and true conversion rate (true_conv_rate) for each audience group and overall true conversion rate (overall_true_conv_rate) are not known. Only their predicted values are known.\nThe inaccuracy of the ML model is seen from the difference in the true and predicted conversion rates overall and for each audience group.\n\n\n\n\n\nFraction of Audience Estimated and Actually Assigned to Random Cohorts\n\n\nSet all specified datatypes.\nSet all specified datatypes.\nSet all specified datatypes.\nSet all specified datatypes.\nSet all specified datatypes.\n\n\n\n\n\n\n\n\n\nmaudience\ncohort\nsize\ngroup_size\nuplift\npower\nci_level\nsamp_to_aud_frac\nsize_type\ndata_type\ndata_size\n\n\n\n\n0\nHigh\nTest\n2146\n6721\n10\n55\n55\n31.929772\nrequired\ndevelopment\n20164\n\n\n1\nHigh\nControl\n2146\n6721\n10\n55\n55\n31.929772\nrequired\ndevelopment\n20164\n\n\n2\nMedium\nTest\n1945\n6721\n10\n55\n55\n28.939146\nrequired\ndevelopment\n20164\n\n\n3\nMedium\nControl\n1945\n6721\n10\n55\n55\n28.939146\nrequired\ndevelopment\n20164\n\n\n4\nLow\nTest\n2103\n6722\n10\n55\n55\n31.285332\nrequired\ndevelopment\n20164\n\n\n5\nLow\nControl\n2103\n6722\n10\n55\n55\n31.285332\nrequired\ndevelopment\n20164\n\n\n6\nHigh\nControl\n2315\n7251\n10\n55\n55\n31.926631\nrandomly selected\ninference\n21752\n\n\n7\nHigh\nTest\n2315\n7251\n10\n55\n55\n31.926631\nrandomly selected\ninference\n21752\n\n\n8\nLow\nControl\n2268\n7251\n10\n55\n55\n31.278444\nrandomly selected\ninference\n21752\n\n\n9\nLow\nTest\n2268\n7251\n10\n55\n55\n31.278444\nrandomly selected\ninference\n21752\n\n\n10\nMedium\nControl\n2098\n7250\n10\n55\n55\n28.937931\nrandomly selected\ninference\n21752\n\n\n11\nMedium\nTest\n2098\n7250\n10\n55\n55\n28.937931\nrandomly selected\ninference\n21752\n\n\n\n\n\n\n\n\n\n\n\n\n\nObservations\n\n\n\n\nIt is reassuring that there is agreement in the samp_to_aud_frac (fraction of visitors in the cohort relative to those in associated audience group) across the development and inference datasets. The required sizes (size) were estimated using the test split of the development data (data_type). These sample sizes were scaled to account for the difference between the sizes of the inference and development datasets (see the group_size column). The scaled up sample (cohort) sizes were rounded to the nearest integer. So, it is not surprising that there is good agreement between the fractions across the development and inference datasets."
  },
  {
    "objectID": "notebooks/02-train/notebooks/07_get_audience_cohorts.html#export-to-disk-and-ml-experiment-tracking",
    "href": "notebooks/02-train/notebooks/07_get_audience_cohorts.html#export-to-disk-and-ml-experiment-tracking",
    "title": "Get Randomized Audience Cohorts From Inference",
    "section": "Export to Disk and ML Experiment Tracking",
    "text": "Export to Disk and ML Experiment Tracking\nGet the best MLFlow run ID\n\nbest_run_id = df_deployment_candidate_mlflow_models.squeeze()[\"run_id\"]\n\n\nAudience Cohorts\n\n\n\n\n\n\nNotes\n\n\n\n\nThe cohort column has missing values for visitors who were not assigned to either the test or control groups. This is expected.\n\n\n\nExport to disk and log exported file as MLFlow artifact\n\nut.export_and_track(\n    os.path.join(\n        processed_data_dir,\n        f\"audience_cohorts__run_\"\n        f\"{best_run_id}__\"\n        f\"infer_month_{month_name[1:][X_infer['month'].iloc[-1] - 1]}__\"\n        f\"{datetime.now().strftime('%Y%m%d_%H%M%S')}.parquet.gzip\",\n    ),\n    df_infer_audience_groups,\n    (\n        \"inference audience cohorts for \"\n        f\"{month_name[1:][X_infer['month'].iloc[-1] - 1]}\"\n    ),\n    best_run_id,\n)\n\n\n\nAudience Profiles\n\n\n\n\n\n\nNotes\n\n\n\n\nThe behavioral attributes in the profile are not specific to an individual column. So, the column in the profile DataFrame has missing values for these attributes.\n\n\n\nExport to disk and log exported file as MLFlow artifact\n\nut.export_and_track(\n    os.path.join(\n        processed_data_dir,\n        f\"audience_profiles__run_\"\n        f\"{best_run_id}__\"\n        f\"infer_month_{month_name[1:][X_infer['month'].iloc[-1] - 1]}__\"\n        f\"{datetime.now().strftime('%Y%m%d_%H%M%S')}.parquet.gzip\",\n    ),\n    df_profile,\n    (\n        \"inference audience profiles for \"\n        f\"{month_name[1:][X_infer['month'].iloc[-1] - 1]}\"\n    ),\n    best_run_id,\n)\n\n\n\nConversion Rates per Audience Group and Overall\nExport to disk and log exported file as MLFlow artifact\n\nut.export_and_track(\n    os.path.join(\n        processed_data_dir,\n        f\"audience_development_inference_conversion_rates__run_\"\n        f\"{best_run_id}__\"\n        f\"infer_month_{month_name[1:][X_infer['month'].iloc[-1] - 1]}__\"\n        f\"{datetime.now().strftime('%Y%m%d_%H%M%S')}.parquet.gzip\",\n    ),\n    df_conv_rates,\n    (\n        \"inference and development conversion rates for \"\n        f\"{month_name[1:][X_infer['month'].iloc[-1] - 1]}\"\n    ),\n    best_run_id,\n)\n\n\n\nEstimated and True Fractions of Audience Assigned to Random Cohorts\nExport to disk and log exported file as MLFlow artifact\n\nut.export_and_track(\n    os.path.join(\n        processed_data_dir,\n        f\"cohort_audience_fractions__run_\"\n        f\"{best_run_id}__\"\n        f\"infer_month_{month_name[1:][X_infer['month'].iloc[-1] - 1]}__\"\n        f\"{datetime.now().strftime('%Y%m%d_%H%M%S')}.parquet.gzip\",\n    ),\n    df_sa_frac,\n    (\n        \"inference and development cohort-to-audience fractions for \"\n        f\"{month_name[1:][X_infer['month'].iloc[-1] - 1]}\"\n    ),\n    best_run_id,\n)"
  },
  {
    "objectID": "notebooks/02-train/notebooks/07_get_audience_cohorts.html#next-step",
    "href": "notebooks/02-train/notebooks/07_get_audience_cohorts.html#next-step",
    "title": "Get Randomized Audience Cohorts From Inference",
    "section": "Next Step",
    "text": "Next Step\nThe next step will add to the audience profiles, by exploring the best ML model’s predictions of propensity for first-time visitors to the store during the unseen (inference) data period."
  },
  {
    "objectID": "notebooks/02-train/notebooks/11_analyze_campaign_outputs.html",
    "href": "notebooks/02-train/notebooks/11_analyze_campaign_outputs.html",
    "title": "Run Campaign and Analyze Results",
    "section": "",
    "text": "This step assess the impact of running the marketing campaign. This step can be performed retrospectively, at the end of the campaign, when the outcome of the return visit of the first-time visitors to the merchandise store (during the inference period) is known. This is step 5. from a typical A/B Testing workflow.\nFor the current use-case, if the marketing campaign results in more conversions in the control cohort compared to the test cohort, then this could suggest that the campaign has grown the customer base and thereby met the objective of this project. However, a test of statistical significance will be needed in order to ensure that this impact seen by running the campaign (growth in conversions) was not a random occurrence.\nThis step compares the proportions (conversions) taken from two independent samples (test and control cohorts). The purpose is to determine if the conversion rate (KPI) of the test cohort is statistically different from that of the control cohort. If the\n\nconversion rate is higher in the test cohort\ndifference in conversion rate between the test and control cohort is statistically significant at some level of confidence (eg. 95%)\n\nthen it is possible to say with 95% confidence that the campaign has grown the customer base.\n\n\n\nIn python, such a comparison is implemented using the statsmodels library in the proportions_chisquare() method where the count parameter represents the number of convertions in each cohort (test or control) and nobs represents the overall size of the same cohort."
  },
  {
    "objectID": "notebooks/02-train/notebooks/11_analyze_campaign_outputs.html#about",
    "href": "notebooks/02-train/notebooks/11_analyze_campaign_outputs.html#about",
    "title": "Run Campaign and Analyze Results",
    "section": "",
    "text": "This step assess the impact of running the marketing campaign. This step can be performed retrospectively, at the end of the campaign, when the outcome of the return visit of the first-time visitors to the merchandise store (during the inference period) is known. This is step 5. from a typical A/B Testing workflow.\nFor the current use-case, if the marketing campaign results in more conversions in the control cohort compared to the test cohort, then this could suggest that the campaign has grown the customer base and thereby met the objective of this project. However, a test of statistical significance will be needed in order to ensure that this impact seen by running the campaign (growth in conversions) was not a random occurrence.\nThis step compares the proportions (conversions) taken from two independent samples (test and control cohorts). The purpose is to determine if the conversion rate (KPI) of the test cohort is statistically different from that of the control cohort. If the\n\nconversion rate is higher in the test cohort\ndifference in conversion rate between the test and control cohort is statistically significant at some level of confidence (eg. 95%)\n\nthen it is possible to say with 95% confidence that the campaign has grown the customer base.\n\n\n\nIn python, such a comparison is implemented using the statsmodels library in the proportions_chisquare() method where the count parameter represents the number of convertions in each cohort (test or control) and nobs represents the overall size of the same cohort."
  },
  {
    "objectID": "notebooks/02-train/notebooks/11_analyze_campaign_outputs.html#user-inputs",
    "href": "notebooks/02-train/notebooks/11_analyze_campaign_outputs.html#user-inputs",
    "title": "Run Campaign and Analyze Results",
    "section": "User Inputs",
    "text": "User Inputs\nDefine the following\n\nstart and end dates for inference data\nconfidence levels at which the difference in the cohort conversion rates is to be checked\n\n\n# 1. start and end dates\ninfer_start_date = \"20170301\"\ninfer_end_date = \"20170331\"\n\n# 2. confidence levels to check difference in conversion rates\nci_levels = np.arange(0.20, 1.00, 0.05, dtype=float)\n\nThe following helper functions are defined in the module src/statistical_checks.py and are used here\n\nget_inference_data_with_cohorts()\n\nloads inference predictions data with audience groups and cohorts assigned as separate columns\n\nget_outcome_labels()\n\nloads the outcome (ML label) of the inference predictions data\nfor demonstration purposes only, this outcome is randomly generated here\n\nget_cohorts()\n\nfilters audience data to retrieve visitors that were placed in one of the two audience cohorts (test or control)\n\nget_overall_and_converted_cohort_sizes\n\ncalculate the size of the overall cohort and the conversions, for both test and control cohorts\n\ncheck_significance_using_chisq()\n\nchecks significance of the difference in conversions between test and control cohort"
  },
  {
    "objectID": "notebooks/02-train/notebooks/11_analyze_campaign_outputs.html#get-data",
    "href": "notebooks/02-train/notebooks/11_analyze_campaign_outputs.html#get-data",
    "title": "Run Campaign and Analyze Results",
    "section": "Get Data",
    "text": "Get Data\n\nFetch Latest Version of Best Deployment Candidate Model from Model Registry\nGet best deployment candidate model from model registry\n\ndf_candidate_mlflow_models = modh.get_all_deployment_candidate_models()\n\n\n\nGet Inference Data with Audience Cohorts, Associated with Best Model\nLoad inference data, with the audience groups and cohorts shown as separate columns. This data should contain the outcome for all these first-time visitors to the store during the inference period. Filter this data to only get visitors who were placed in a test or control cohorts, and exclude others. This is done below using random outcomes (for demonstration purposes)\n\ndf_infer_audience_cohorts = (\n    sc.get_inference_data_with_cohorts(df_candidate_mlflow_models, \"audience_cohorts\")\n    .pipe(sc.get_outcome_labels)\n    .pipe(sc.get_cohorts, \"cohort\")\n)\n\n\n\n\n\n\n\nNotes\n\n\n\n\nsc.get_outcome_labels() retrieves the campaign outcomes, which is the number of conversions in both the control and test cohorts. Here, for demonstration purposes, random values are used for the outcomes for both cohorts."
  },
  {
    "objectID": "notebooks/02-train/notebooks/11_analyze_campaign_outputs.html#compare-difference-in-kpi-between-cohorts",
    "href": "notebooks/02-train/notebooks/11_analyze_campaign_outputs.html#compare-difference-in-kpi-between-cohorts",
    "title": "Run Campaign and Analyze Results",
    "section": "Compare Difference in KPI Between Cohorts",
    "text": "Compare Difference in KPI Between Cohorts\nCheck if the difference between conversions across the two cohorts is statistically significant\n\noverall_sizes, conversion_sizes = sc.get_overall_and_converted_cohort_sizes(\n    df_infer_audience_cohorts, verbose=False\n)\ndf_sig_checks = sc.check_significance_using_chisq(\n    overall_sizes, conversion_sizes, ci_levels\n).pipe(\n    ash.set_datatypes,\n    {\n        \"check\": pd.StringDtype(),\n        \"p_value\": pd.Float32Dtype(),\n        \"ci_level\": pd.Int8Dtype(),\n        \"control_size\": pd.Int16Dtype(),\n        \"test_size\": pd.Int16Dtype(),\n        \"control_conversions\": pd.Int16Dtype(),\n        \"test_conversions\": pd.Int16Dtype(),\n        \"control_conversion_rate\": pd.Float32Dtype(),\n        \"test_conversion_rate\": pd.Float32Dtype(),\n    },\n)\ndf_sig_checks\n\nSet all specified datatypes.\n\n\n\n\n\n\n\n\n\ncheck\np_value\nci_level\ncontrol_size\ntest_size\ncontrol_conversions\ntest_conversions\ncontrol_conversion_rate\ntest_conversion_rate\n\n\n\n\n0\nnot statistically significant\n0.268837\n94\n6249\n6249\n325\n353\n5.200832\n5.648904\n\n\n1\nstatistically significant\n0.268837\n70\n6249\n6249\n325\n353\n5.200832\n5.648904\n\n\n\n\n\n\n\n\n\n\n\n\n\nNotes\n\n\n\n\nThe chi-squared test indicates if the difference between the conversion rate in the test and control cohort is statistically significant at a particular confidence level.\n\n\n\n\n\n\n\n\n\nObservations\n\n\n\n\nThe top row shows the test of significance for the maximum specified confidence level (in this case 94%).\nThe bottom row shows the maximum confidence level (40%) for which the difference in conversion rates is significant."
  },
  {
    "objectID": "notebooks/02-train/notebooks/11_analyze_campaign_outputs.html#export-to-disk-and-ml-experiment-tracking",
    "href": "notebooks/02-train/notebooks/11_analyze_campaign_outputs.html#export-to-disk-and-ml-experiment-tracking",
    "title": "Run Campaign and Analyze Results",
    "section": "Export to Disk and ML Experiment Tracking",
    "text": "Export to Disk and ML Experiment Tracking\nGet the best MLFlow run ID\n\nbest_run_id = df_candidate_mlflow_models.squeeze()[\"run_id\"]\n\nExport to disk and log exported file as MLFlow artifact\n\nut.export_and_track(\n    os.path.join(\n        processed_data_dir,\n        f\"campaign_analysis__run_\"\n        f\"{best_run_id}__\"\n        f\"infer_month_{infer_month}__\"\n        f\"{datetime.now().strftime('%Y%m%d_%H%M%S')}.parquet.gzip\",\n    ),\n    df_sig_checks,\n    f\"campaign outcome analysis for inference during {infer_month}\",\n    best_run_id,\n)"
  },
  {
    "objectID": "notebooks/02-train/notebooks/11_analyze_campaign_outputs.html#next-step",
    "href": "notebooks/02-train/notebooks/11_analyze_campaign_outputs.html#next-step",
    "title": "Run Campaign and Analyze Results",
    "section": "Next Step",
    "text": "Next Step\nThe next step will clean up all project resources related to MLFlow."
  },
  {
    "objectID": "notebooks/02-train/notebooks/12_cleanup_mlflow.html",
    "href": "notebooks/02-train/notebooks/12_cleanup_mlflow.html",
    "title": "Cleanup Model Monitoring Outputs",
    "section": "",
    "text": "This step cleans up all project resources that were created, including\n\nintermediate (non-MLFlow) files\nMLFlow outputs (artifacts, metrics, etc.)\n\n\n\n\nThis step can be run at the end of the project, after the campaign has ended and its outcomes have been analyzed."
  },
  {
    "objectID": "notebooks/02-train/notebooks/12_cleanup_mlflow.html#about",
    "href": "notebooks/02-train/notebooks/12_cleanup_mlflow.html#about",
    "title": "Cleanup Model Monitoring Outputs",
    "section": "",
    "text": "This step cleans up all project resources that were created, including\n\nintermediate (non-MLFlow) files\nMLFlow outputs (artifacts, metrics, etc.)\n\n\n\n\nThis step can be run at the end of the project, after the campaign has ended and its outcomes have been analyzed."
  },
  {
    "objectID": "notebooks/02-train/notebooks/12_cleanup_mlflow.html#user-inputs",
    "href": "notebooks/02-train/notebooks/12_cleanup_mlflow.html#user-inputs",
    "title": "Cleanup Model Monitoring Outputs",
    "section": "User Inputs",
    "text": "User Inputs\nDefine the following\n\nfile name prefix for the following MLFlow artifacts associated with the best deployment candidate MLFLow ML model\n\nprocessed data\nthreshold tuning data, where predictions per threshold were evaluated using the test data split\nestimated sample sizes, where sizes were estimated using the test data split\naudience cohorts created using the inference data split\naudience profiles using the inference data split\npost-campaign impact evaluation\n\n\n\nartifact_file_prefixes = [\n    'processed_data',\n    \"threshold_tuning_data\",\n    \"audience_sample_sizes\",\n    \"audience_cohorts\",\n    \"audience_profiles\",\n    \"campaign_analysis\",\n]"
  },
  {
    "objectID": "notebooks/02-train/notebooks/12_cleanup_mlflow.html#get-data",
    "href": "notebooks/02-train/notebooks/12_cleanup_mlflow.html#get-data",
    "title": "Cleanup Model Monitoring Outputs",
    "section": "Get Data",
    "text": "Get Data\n\nFetch Latest Version of Best Deployment Candidate Model\nGet best deployment candidate model from model registry\n\ndf_candidate_mlflow_models = modh.get_all_deployment_candidate_models()\n\n\n\nGet Filepaths to MLFlow File Artifacts\nGet the filepath to the MLFlow artifacts associated with the best deployment candidate model, as well as the filepath to the corresponding local file used when logging the artifact\n\nartifacts_dict = {\n    k: show_artifact_and_local_filepath_for_run_id(\n        df_candidate_mlflow_models, k, processed_data_dir\n    )\n    for k in artifact_file_prefixes\n}"
  },
  {
    "objectID": "notebooks/02-train/notebooks/12_cleanup_mlflow.html#cleanup",
    "href": "notebooks/02-train/notebooks/12_cleanup_mlflow.html#cleanup",
    "title": "Cleanup Model Monitoring Outputs",
    "section": "Cleanup",
    "text": "Cleanup\n\n(Non-MLFlow) Local Outputs\n\nfor k,v in artifacts_dict.items():\n    os.remove(v[1])\n    print(f\"Deleted: {os.path.basename(v[1]).split('__run')[0]}\")\n\n\n\n(Non-MLFlow) ML Development Experiment Outputs\n\nml_runs_glob = os.path.join(raw_data_dir, \"ml__run_*__expt_*.parquet*\")\nfor local_fpath in glob(ml_runs_glob):\n    os.remove(local_fpath)\n    print(f\"Deleted: {os.path.basename(local_fpath).split('__run')[0]}\")\n\n\n\nMLFlow Outputs\nDelete the MLFlow run-logging database file\n\nos.remove(mlruns_db_fpath)\nprint(f\"Removed MLFlow database at {os.path.basename(mlruns_db_fpath)}\")\n\nDelete the MLFlow artifact directory (mlruns), and all the artifact sub-directories contained in that directory\n\nshutil.rmtree(mlflow_artifact_fpath)\nprint(\n    \"Removed local MLFlow artifact logging directory at \"\n    f\"{os.path.basename(mlflow_artifact_fpath)}\"\n)"
  },
  {
    "objectID": "notebooks/02-train/notebooks/12_cleanup_mlflow.html#next-step",
    "href": "notebooks/02-train/notebooks/12_cleanup_mlflow.html#next-step",
    "title": "Cleanup Model Monitoring Outputs",
    "section": "Next Step",
    "text": "Next Step\nThe next step will clean up all project resources related to BigQuery."
  },
  {
    "objectID": "notebooks/03-explore/notebooks/08_explore_best_model.html",
    "href": "notebooks/03-explore/notebooks/08_explore_best_model.html",
    "title": "Explore Best Model Predictions",
    "section": "",
    "text": "As mentioned in the scope, understanding ML predictions of propensity can be helpful to characterize audience groups during the design of a marketing campaign. One example question could be answered by exploring the predictions of a ML model is what are the most and least important attributes of visitors predicted to have a high or low propensity. This can be one factor used to design a marketing strategy aimed at one or both groups of visitors.\nThis step explores the best ML model’s predictions of visitor propensity to make a purchase on a return visit using ML explainability packages (eg. SHAP). This exploration is done per audience group so the output of this step is a profile of each audience group based on the features that are most important to predicting the outcome for first-time visitors to the store in that group during the inference data period. This is performed as part of step 4. from a typical A/B Testing workflow.\nThis step can be run prospectively at the end of the inference period, just before the start of the campaign, when all the inference data (first-time visitors to the store) becomes available.\n\n\n\nModel exploration is supported for a single ML model. This is the best model found in an earlier step and registered in the MLFlow model registry. The model associated with a single experiment run (or run_id) is a sklearn Pipeline, consisting of data preprocessing and ML modeling steps. SHAP cannot work directly with a sklearn Pipelines to generate explanations. It can only accept the ML model (classifier, or last Pipeline step). So, we’ll need to retrieve the preliminary Pipeline steps (the data preprocessor) and the transformed data that is generated by the preprocessor. Then, we can make predictions on this transformed data using the last step (the ML classifier). Finally, SHAP can be used to explain predictions made by this classifier. These explanations are required for the first-time visitors to the store during the inference data period.\n\n\n\n\nSince extracting SHAP values can be time-consuming, they will be retrieved for a slice of the inference data and not for the entire inference dataset.\n\n\n\n\nFirst, the preprocessor steps of the Pipeline are used to get the transformed train and test data splits from the best model. A custom Python modeule src/model_explore_helpers.py has been developed to extract the transformed train and data. Next, the ML classifier step of the Pipeline is used to make and score predictions of the processed test data using this model.\nNext, the end-to-end Pipeline will be used to make and evaluate these predictions directly on the raw test data, without creating the intermediate transformed data splits.\nThen, the metrics using both approaches will be compared to ensure they are identical to each other. This is outlined below\n\nMake and evaluate predictions using the model (end-to-end sklearn Pipeline) associated with the specified run_id\nMake and evaluate predictions using the manual approach\nCompare predictions and evaluation metrics on the training and test data splits between the Pipeline-based and manual outputs\n\nIf the Pipeline and manual approaches are verified to give identical metrics for first-time visitors in the test data split during ML model development, then it is possible to reliably apply the same manual workflow to retrieve the transformed features during the inference period. So, next, this same manual transformation procedure is applied to transform the inference data. Recall that the inference data only covers the first visit during the inference period and so the outcome of the return visit for each first-time visitor is not known until after the entire inference (production) period (one month) has ended.\nFinally, a SHAP explainer will be used to explore a subset of the transformed inference data in order to get the feature importances for the audience group(s). The top N most important features for each audience group will be combined into a single DataFrame and exported to disk. This will represent the profile of the audience group(s) in terms of most important features."
  },
  {
    "objectID": "notebooks/03-explore/notebooks/08_explore_best_model.html#about",
    "href": "notebooks/03-explore/notebooks/08_explore_best_model.html#about",
    "title": "Explore Best Model Predictions",
    "section": "",
    "text": "As mentioned in the scope, understanding ML predictions of propensity can be helpful to characterize audience groups during the design of a marketing campaign. One example question could be answered by exploring the predictions of a ML model is what are the most and least important attributes of visitors predicted to have a high or low propensity. This can be one factor used to design a marketing strategy aimed at one or both groups of visitors.\nThis step explores the best ML model’s predictions of visitor propensity to make a purchase on a return visit using ML explainability packages (eg. SHAP). This exploration is done per audience group so the output of this step is a profile of each audience group based on the features that are most important to predicting the outcome for first-time visitors to the store in that group during the inference data period. This is performed as part of step 4. from a typical A/B Testing workflow.\nThis step can be run prospectively at the end of the inference period, just before the start of the campaign, when all the inference data (first-time visitors to the store) becomes available.\n\n\n\nModel exploration is supported for a single ML model. This is the best model found in an earlier step and registered in the MLFlow model registry. The model associated with a single experiment run (or run_id) is a sklearn Pipeline, consisting of data preprocessing and ML modeling steps. SHAP cannot work directly with a sklearn Pipelines to generate explanations. It can only accept the ML model (classifier, or last Pipeline step). So, we’ll need to retrieve the preliminary Pipeline steps (the data preprocessor) and the transformed data that is generated by the preprocessor. Then, we can make predictions on this transformed data using the last step (the ML classifier). Finally, SHAP can be used to explain predictions made by this classifier. These explanations are required for the first-time visitors to the store during the inference data period.\n\n\n\n\nSince extracting SHAP values can be time-consuming, they will be retrieved for a slice of the inference data and not for the entire inference dataset.\n\n\n\n\nFirst, the preprocessor steps of the Pipeline are used to get the transformed train and test data splits from the best model. A custom Python modeule src/model_explore_helpers.py has been developed to extract the transformed train and data. Next, the ML classifier step of the Pipeline is used to make and score predictions of the processed test data using this model.\nNext, the end-to-end Pipeline will be used to make and evaluate these predictions directly on the raw test data, without creating the intermediate transformed data splits.\nThen, the metrics using both approaches will be compared to ensure they are identical to each other. This is outlined below\n\nMake and evaluate predictions using the model (end-to-end sklearn Pipeline) associated with the specified run_id\nMake and evaluate predictions using the manual approach\nCompare predictions and evaluation metrics on the training and test data splits between the Pipeline-based and manual outputs\n\nIf the Pipeline and manual approaches are verified to give identical metrics for first-time visitors in the test data split during ML model development, then it is possible to reliably apply the same manual workflow to retrieve the transformed features during the inference period. So, next, this same manual transformation procedure is applied to transform the inference data. Recall that the inference data only covers the first visit during the inference period and so the outcome of the return visit for each first-time visitor is not known until after the entire inference (production) period (one month) has ended.\nFinally, a SHAP explainer will be used to explore a subset of the transformed inference data in order to get the feature importances for the audience group(s). The top N most important features for each audience group will be combined into a single DataFrame and exported to disk. This will represent the profile of the audience group(s) in terms of most important features."
  },
  {
    "objectID": "notebooks/03-explore/notebooks/08_explore_best_model.html#user-inputs",
    "href": "notebooks/03-explore/notebooks/08_explore_best_model.html#user-inputs",
    "title": "Explore Best Model Predictions",
    "section": "User Inputs",
    "text": "User Inputs\nDefine the following\n\nbest MLFlow run ID\nname of column containing label (outcome)\nlist of categorical features\nlist of numerical features, including categorical features present in the raw data as integers\nnumber of SHAP observations from the transformed inferece data that are to be explained\nnumber of features from the transformed inference data for which SHAP feature importances are required\naudience_groups_strategies\n\ndictionary of desired audience groups into which the first-time visitors propensities will be placed\n\nkey specifies the number of desired audience propensity groups (low, medium and high)\nvalue specifies names of the desired audience propensity groups\n\n\ntype of audience strategy (single- or multi- group) from which to create cohorts\n\n\n# 1. \nbest_run_id = \"f805253a6ba64ee6a41bf14310ef16a4\"\n\n# 2. label column\nlabel = \"made_purchase_on_future_visit\"\n\n# 3. categorical columns\ncategorical_features = [\n    \"bounces\",\n    \"last_action\",\n    \"source\",\n    \"medium\",\n    \"channelGrouping\",\n    \"browser\",\n    \"os\",\n    \"deviceCategory\",\n]\n\n# 4. numerical columns\nnumerical_features = [\n    'hits',\n    \"promos_displayed\",\n    \"promos_clicked\",\n    \"product_views\",\n    \"product_clicks\",\n    \"pageviews\",\n    \"time_on_site\",\n]\n\n# 5. number of SHAP observations to be explained (observations to use when\n# training SHAP explainer)\nnum_obs_explain_shap = 500\n\n# 6. number of top-performing SHAP features to be kept\nnum_features_shap = 10\n\n# 7. mapping dictionaries\naudience_groups_strategies = {\n    1: [\"High\", \"Medium\", \"Low\"], 2: [\"High\", \"High-Medium\", \"High-Medium-Low\"],\n}\n\n# 8. type of audience strategy to use when creating groups\naudience_strategy = 1"
  },
  {
    "objectID": "notebooks/03-explore/notebooks/08_explore_best_model.html#get-data",
    "href": "notebooks/03-explore/notebooks/08_explore_best_model.html#get-data",
    "title": "Explore Best Model Predictions",
    "section": "Get Data",
    "text": "Get Data\n\nFetch Latest Version of Best Deployment Candidate Model\nLoad best deployment candidate model object\n\npipe = joblib.load(model_filepath)\n\n\n\nGet Data Used in Development of Best Deployment Candidate Model\nFor the data used during development of the best deployment candidate model, get the\n\ntrain and test data splits\noverall (combined) data\n\n\ndf_train_val_eval_best_run, df_test_best_run = [\n    pd.read_parquet(\n        processed_data_filepath,\n        columns=list(dtypes_dict)+['split_type'],\n        filters=[('split_type', '=', split_type)]\n    )\n    for split_type in ['train_val', 'test']\n]\ndf_all = (\n    pd.concat(\n        [df_train_val_eval_best_run, df_test_best_run],\n        ignore_index=True,\n    )\n)\n\n\n\n\n\n\n\n\n\n\ntrain+val_for_eval\ntest\n\n\n\n\nfullvisitorid\nstring\nstring\n\n\nvisitId\nstring\nstring\n\n\nvisitNumber\nInt64\nInt64\n\n\nquarter\nInt64\nInt64\n\n\nmonth\nInt64\nInt64\n\n\nday_of_month\nInt64\nInt64\n\n\nday_of_week\nInt64\nInt64\n\n\nhour\nInt64\nInt64\n\n\nminute\nInt64\nInt64\n\n\nsecond\nInt64\nInt64\n\n\nsource\ncategory\ncategory\n\n\nmedium\ncategory\ncategory\n\n\nchannelGrouping\ncategory\ncategory\n\n\nhits\nInt64\nInt64\n\n\nbounces\nint64\nint64\n\n\nlast_action\ncategory\ncategory\n\n\npromos_displayed\nInt64\nInt64\n\n\npromos_clicked\nInt64\nInt64\n\n\nproduct_views\nInt64\nInt64\n\n\nproduct_clicks\nInt64\nInt64\n\n\npageviews\nInt64\nInt64\n\n\ntime_on_site\nInt64\nInt64\n\n\nbrowser\ncategory\ncategory\n\n\nos\ncategory\ncategory\n\n\nadded_to_cart\nInt64\nInt64\n\n\ndeviceCategory\ncategory\ncategory\n\n\nmade_purchase_on_future_visit\nInt64\nInt64\n\n\nsplit_type\ncategory\ncategory\n\n\n\n\n\n\n\nGet features and label from\n\ntrain and test split\noverall data\n\n\nX_train, y_train = [\n    df_train_val_eval_best_run.drop(columns=[label, 'split_type']),\n    df_train_val_eval_best_run[label]\n]\nX_test, y_test = [\n    df_test_best_run.drop(columns=[label, 'split_type']), df_test_best_run[label]\n]\nX, y = [df_all.drop(columns=[label, 'split_type']), df_all[label]]\n\n\n\nGet Inference Data with Audience Assignments\nLoad inference data with audience and cohort assignments\n\ndf_infer_with_audience = (\n    pd.read_parquet(\n        audience_filepath,\n        columns=[\n            c\n            for c in list(dtypes_dict)\n            if c not in ['made_purchase_on_future_visit']\n        ] + ['maudience', 'audience_strategy', 'cohort'],\n        filters=[('audience_strategy', '=', audience_strategy)]\n    ).dropna(subset=['cohort']).drop(columns=['cohort'])\n    .reset_index(drop=True)\n)\ndf_infer_with_audience\n\n\n\n\n\n\n\n\nfullvisitorid\nvisitId\nvisitNumber\nquarter\nmonth\nday_of_month\nday_of_week\nhour\nminute\nsecond\n...\nproduct_views\nproduct_clicks\npageviews\ntime_on_site\nbrowser\nos\nadded_to_cart\ndeviceCategory\nmaudience\naudience_strategy\n\n\n\n\n0\n7701350257079842191\n1488377334\n1\n1\n3\n1\n4\n6\n8\n54\n...\n0\n0\n1\n0\nChrome\nMacintosh\n0\ndesktop\nHigh\n1\n\n\n1\n1927404893298120774\n1489438559\n1\n1\n3\n13\n2\n13\n55\n59\n...\n12\n0\n2\n14\nChrome\nWindows\n0\ndesktop\nHigh\n1\n\n\n2\n4081311830661383532\n1489678740\n1\n1\n3\n16\n5\n8\n39\n0\n...\n1\n0\n1\n0\nChrome\nChrome OS\n0\ndesktop\nHigh\n1\n\n\n3\n48980746408094895\n1489003955\n1\n1\n3\n8\n4\n12\n12\n35\n...\n166\n4\n23\n928\nChrome\nWindows\n0\ndesktop\nHigh\n1\n\n\n4\n0480615828723852227\n1490621968\n1\n1\n3\n27\n2\n6\n39\n28\n...\n0\n0\n2\n8\nChrome\nMacintosh\n0\ndesktop\nHigh\n1\n\n\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n\n\n13357\n4648893335063355898\n1490645034\n1\n1\n3\n27\n2\n13\n3\n54\n...\n32\n0\n4\n101\nChrome\nWindows\n0\ndesktop\nLow\n1\n\n\n13358\n5411548277038069190\n1488556526\n1\n1\n3\n3\n6\n7\n55\n26\n...\n51\n0\n6\n94\nChrome\nMacintosh\n0\ndesktop\nLow\n1\n\n\n13359\n5142389431747491885\n1488844756\n1\n1\n3\n6\n2\n15\n59\n16\n...\n0\n0\n1\n0\nSafari\niOS\n0\nmobile\nLow\n1\n\n\n13360\n8235882112143258847\n1488390566\n1\n1\n3\n1\n4\n9\n49\n26\n...\n3\n0\n1\n0\nChrome\nMacintosh\n0\ndesktop\nLow\n1\n\n\n13361\n6847844312870761783\n1490498125\n1\n1\n3\n25\n7\n20\n15\n25\n...\n12\n0\n2\n43\nChrome\nAndroid\n0\nmobile\nLow\n1\n\n\n\n\n13362 rows × 28 columns\n\n\n\n\n\n\n\n\n\n\n\n\ndtype\n\n\n\n\nfullvisitorid\nstring\n\n\nvisitId\nstring\n\n\nvisitNumber\nInt64\n\n\nquarter\nInt64\n\n\nmonth\nInt64\n\n\nday_of_month\nInt64\n\n\nday_of_week\nInt64\n\n\nhour\nInt64\n\n\nminute\nInt64\n\n\nsecond\nInt64\n\n\nsource\ncategory\n\n\nmedium\ncategory\n\n\nchannelGrouping\ncategory\n\n\nhits\nInt64\n\n\nbounces\nint64\n\n\nlast_action\ncategory\n\n\npromos_displayed\nInt64\n\n\npromos_clicked\nInt64\n\n\nproduct_views\nInt64\n\n\nproduct_clicks\nInt64\n\n\npageviews\nInt64\n\n\ntime_on_site\nInt64\n\n\nbrowser\ncategory\n\n\nos\ncategory\n\n\nadded_to_cart\nInt64\n\n\ndeviceCategory\ncategory\n\n\nmaudience\nstring\n\n\naudience_strategy\nInt8\n\n\n\n\n\n\n\nGet features from inference data\n\nX_infer_with_audience = (\n    df_infer_with_audience.drop(columns=['maudience', 'audience_strategy'])\n)"
  },
  {
    "objectID": "notebooks/03-explore/notebooks/08_explore_best_model.html#ml-evaluation-from-pipeline",
    "href": "notebooks/03-explore/notebooks/08_explore_best_model.html#ml-evaluation-from-pipeline",
    "title": "Explore Best Model Predictions",
    "section": "ML Evaluation From Pipeline",
    "text": "ML Evaluation From Pipeline\n\n\n\n\n\n\n\nsplit\nmetric\ntrain_val\ntest\n\n\n\n\n0\naccuracy\n0.915096\n0.936669\n\n\n1\nbalanced_accuracy\n0.498810\n0.499338\n\n\n2\nprecision\n0.041504\n0.022353\n\n\n3\nrecall\n0.498810\n0.499338\n\n\n4\nroc_auc\n0.498810\n0.499338\n\n\n5\nf1\n0.498821\n0.498082\n\n\n6\nfbeta05\n0.498832\n0.498804\n\n\n7\nfbeta2\n0.498814\n0.498315\n\n\n8\npr_auc\n0.043402\n0.023243\n\n\n9\navg_precision\n0.043624\n0.023032\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ndtype\n\n\nsplit\n\n\n\n\n\nmetric\nstring\n\n\ntrain_val\nFloat64\n\n\ntest\nFloat64"
  },
  {
    "objectID": "notebooks/03-explore/notebooks/08_explore_best_model.html#ml-evaluation-from-pipeline-using-transformed-data",
    "href": "notebooks/03-explore/notebooks/08_explore_best_model.html#ml-evaluation-from-pipeline-using-transformed-data",
    "title": "Explore Best Model Predictions",
    "section": "ML Evaluation From Pipeline Using Transformed Data",
    "text": "ML Evaluation From Pipeline Using Transformed Data\n\nGet Transformed Data\nIn order to get the transformed data used by the end-to-end Pipeline, the following two-step procedure will be used\n\nExtract untrained pipeline consisting of the following steps\n\nunder-sampling\n\nunder-sampling\npre-processing\n\nover-sampling\n\npre-processing\nover-sampling\n\n\nUse untrained pipeline to get transformed training and validation data as follows\n\nunder-sampling\n\nunder-sample training data\ntrain pre-processor using under-sampled training data\npre-process all\n\ntraining data\nvalidation data\n\n\nover-sampling\n\ntrain pre-processor using all training data\npre-process all\n\ntraining data\nvalidatation data\n\nover-sample pre-processed training data\n\n\n\n\nif 'Under' in type(pipe.named_steps['resampler']).__name__:\n    resampling_approach = 'us'\n    pipe_resample_trans = meh.get_preprocessor_pipeline(pipe, 'us')\n    X_train_trans, X_test_trans = meh.get_preprocessed_resampled_data(\n        'us',\n        X_train,\n        y_train,\n        X_test,\n        categorical_features,\n        pipe_resample_trans=pipe_resample_trans,\n    )\nelse:\n    resampling_approach = 'os'\n    pipe_trans, pipe_resample = meh.get_preprocessor_pipeline(pipe, 'os')\n    (\n        X_train_trans,\n        X_test_trans,\n        X_train_trans_rs,\n        y_train_trans_rs,\n    ) = meh.get_preprocessed_resampled_data(\n        'os',\n        X_train,\n        y_train,\n        X_test,\n        categorical_features,\n        pipe_trans=pipe_trans,\n        pipe_resample=pipe_resample,\n    )\n\n\n\n\n\n\n\n\n\n\ntrain_trans\ntest_trans\ntrain_trans_rs\n\n\n\n\nhits\nFloat64\nFloat64\nFloat64\n\n\npromos_displayed\nFloat64\nFloat64\nFloat64\n\n\npromos_clicked\nFloat64\nFloat64\nFloat64\n\n\ntime_on_site\nFloat64\nFloat64\nFloat64\n\n\nbounces__1\nInt64\nInt64\nInt64\n\n\nlast_action__Check out\nInt64\nInt64\nInt64\n\n\nlast_action__Click through of product lists\nInt64\nInt64\nInt64\n\n\nlast_action__Completed purchase\nInt64\nInt64\nInt64\n\n\nlast_action__Product detail views\nInt64\nInt64\nInt64\n\n\nlast_action__Remove product(s) from cart\nInt64\nInt64\nInt64\n\n\nsource__google\nInt64\nInt64\nInt64\n\n\nsource__mall.googleplex.com\nInt64\nInt64\nInt64\n\n\nsource__other\nInt64\nInt64\nInt64\n\n\nmedium__(not set)\nInt64\nInt64\nInt64\n\n\nmedium__affiliate\nInt64\nInt64\nInt64\n\n\nmedium__cpc\nInt64\nInt64\nInt64\n\n\nmedium__cpm\nInt64\nInt64\nInt64\n\n\nmedium__referral\nInt64\nInt64\nInt64\n\n\nchannelGrouping__Direct\nInt64\nInt64\nInt64\n\n\nbrowser__Safari\nInt64\nInt64\nInt64\n\n\nbrowser__other\nInt64\nInt64\nInt64\n\n\nos__Android\nInt64\nInt64\nInt64\n\n\nos__BlackBerry\nInt64\nInt64\nInt64\n\n\nos__Chrome OS\nInt64\nInt64\nInt64\n\n\nos__FreeBSD\nInt64\nInt64\nInt64\n\n\nos__Linux\nInt64\nInt64\nInt64\n\n\nos__Macintosh\nInt64\nInt64\nInt64\n\n\nos__Nintendo Wii\nInt64\nInt64\nInt64\n\n\nos__Nokia\nInt64\nInt64\nInt64\n\n\nos__Samsung\nInt64\nInt64\nInt64\n\n\nos__SunOS\nInt64\nInt64\nInt64\n\n\nos__Windows\nInt64\nInt64\nInt64\n\n\nos__Windows Phone\nInt64\nInt64\nInt64\n\n\nos__Xbox\nInt64\nInt64\nInt64\n\n\ndeviceCategory__mobile\nInt64\nInt64\nInt64\n\n\ndeviceCategory__tablet\nInt64\nInt64\nInt64\n\n\n\n\n\n\n\n\n\nML Evaluation Using Transformed Data\n\n\n\n\n\n\n\nsplit\nmetric\ntrain_val\ntest\n\n\n\n\n0\naccuracy\n0.915096\n0.936669\n\n\n1\nbalanced_accuracy\n0.498810\n0.499338\n\n\n2\nprecision\n0.041504\n0.022353\n\n\n3\nrecall\n0.498810\n0.499338\n\n\n4\nroc_auc\n0.498810\n0.499338\n\n\n5\nf1\n0.498821\n0.498082\n\n\n6\nfbeta05\n0.498832\n0.498804\n\n\n7\nfbeta2\n0.498814\n0.498315\n\n\n8\npr_auc\n0.043402\n0.023243\n\n\n9\navg_precision\n0.043624\n0.023032\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ndtype\n\n\nsplit\n\n\n\n\n\nmetric\nstring\n\n\ntrain_val\nFloat64\n\n\ntest\nFloat64"
  },
  {
    "objectID": "notebooks/03-explore/notebooks/08_explore_best_model.html#ml-evaluation-comparison",
    "href": "notebooks/03-explore/notebooks/08_explore_best_model.html#ml-evaluation-comparison",
    "title": "Explore Best Model Predictions",
    "section": "ML Evaluation Comparison",
    "text": "ML Evaluation Comparison\nVerify that the metrics obtained using the end-to-end Pipeline and the manually transformed data are identical.\n\nTransformed Data\nVerify agreement between predictions of training data split\n\nassert y_train_pred.equals(y_train_pred_m)\nassert y_train_pred_proba.equals(y_train_pred_proba_m)\n\nVerify agreement between predictions of test data split\n\nassert y_test_pred.reset_index(drop=True).equals(y_test_pred_m)\nassert y_test_pred_proba.reset_index(drop=True).equals(y_test_pred_proba_m)\n\n\n\nEvaluation Metrics\nVerify agreement between ML model evaluation metrics using the test data split\n\nassert df_metrics.equals(df_metrics_m)\n\nThis section has verified that the manual approach to transforming features and using them to make and evaluate predictions of test data observations gives the same classification metrics as using the self-contained end-to-end Pipeline to make and evaluate predictions."
  },
  {
    "objectID": "notebooks/03-explore/notebooks/08_explore_best_model.html#explore-ml-model-using-shap",
    "href": "notebooks/03-explore/notebooks/08_explore_best_model.html#explore-ml-model-using-shap",
    "title": "Explore Best Model Predictions",
    "section": "Explore ML Model Using SHAP",
    "text": "Explore ML Model Using SHAP\nTransform features in the inference data using the same feature transformation approach as that developed above using the test data split during ML development. Use SHAP to generate explanations for a subset of these transformed observations.\n\nGet Transformed Inferece Data\nGet the transformed features for the\n\noverall data used during ML development (combination of train+val and test)\ninference data\n\n\nif 'Under' in type(pipe.named_steps['resampler']).__name__:\n    resampling_approach = 'us'\n    pipe_resample_trans = meh.get_preprocessor_pipeline(pipe, 'us')\n    X_trans, X_infer_trans = meh.get_preprocessed_resampled_data(\n        'us',\n        X,\n        y,\n        X_infer_with_audience,\n        categorical_features,\n        pipe_resample_trans=pipe_resample_trans,\n    )\nelse:\n    resampling_approach = 'os'\n    pipe_trans, pipe_resample = meh.get_preprocessor_pipeline(pipe, 'os')\n    (\n        X_trans,\n        X_infer_trans,\n        X_trans_rs,\n        y_trans_rs,\n    ) = meh.get_preprocessed_resampled_data(\n        'os',\n        X,\n        y,\n        X_infer_with_audience,\n        categorical_features,\n        pipe_trans=pipe_trans,\n        pipe_resample=pipe_resample,\n    )\n\n\n\n\n\n\n\n\n\n\nall_trans\ninfer_trans\nall_trans_rs\n\n\n\n\nhits\nFloat64\nFloat64\nFloat64\n\n\npromos_displayed\nFloat64\nFloat64\nFloat64\n\n\npromos_clicked\nFloat64\nFloat64\nFloat64\n\n\ntime_on_site\nFloat64\nFloat64\nFloat64\n\n\nbounces__1\nInt64\nInt64\nInt64\n\n\nlast_action__Check out\nInt64\nInt64\nInt64\n\n\nlast_action__Click through of product lists\nInt64\nInt64\nInt64\n\n\nlast_action__Completed purchase\nInt64\nInt64\nInt64\n\n\nlast_action__Product detail views\nInt64\nInt64\nInt64\n\n\nlast_action__Remove product(s) from cart\nInt64\nInt64\nInt64\n\n\nsource__google\nInt64\nInt64\nInt64\n\n\nsource__mall.googleplex.com\nInt64\nInt64\nInt64\n\n\nsource__other\nInt64\nInt64\nInt64\n\n\nmedium__(not set)\nInt64\nInt64\nInt64\n\n\nmedium__affiliate\nInt64\nInt64\nInt64\n\n\nmedium__cpc\nInt64\nInt64\nInt64\n\n\nmedium__cpm\nInt64\nInt64\nInt64\n\n\nmedium__referral\nInt64\nInt64\nInt64\n\n\nchannelGrouping__Direct\nInt64\nInt64\nInt64\n\n\nbrowser__Safari\nInt64\nInt64\nInt64\n\n\nbrowser__other\nInt64\nInt64\nInt64\n\n\nos__Android\nInt64\nInt64\nInt64\n\n\nos__BlackBerry\nInt64\nInt64\nInt64\n\n\nos__Chrome OS\nInt64\nInt64\nInt64\n\n\nos__Firefox OS\nInt64\nInt64\nInt64\n\n\nos__FreeBSD\nInt64\nInt64\nInt64\n\n\nos__Linux\nInt64\nInt64\nInt64\n\n\nos__Macintosh\nInt64\nInt64\nInt64\n\n\nos__Nintendo Wii\nInt64\nInt64\nInt64\n\n\nos__Nokia\nInt64\nInt64\nInt64\n\n\nos__Samsung\nInt64\nInt64\nInt64\n\n\nos__SunOS\nInt64\nInt64\nInt64\n\n\nos__Windows\nInt64\nInt64\nInt64\n\n\nos__Windows Phone\nInt64\nInt64\nInt64\n\n\nos__Xbox\nInt64\nInt64\nInt64\n\n\ndeviceCategory__mobile\nInt64\nInt64\nInt64\n\n\ndeviceCategory__tablet\nInt64\nInt64\nInt64\n\n\n\n\n\n\n\nAppend the audience group name and strategy to the transformed inference data\n\ndf_infer_trans = (\n    X_infer_trans.assign(maudience=df_infer_with_audience['maudience'])\n    .assign(audience_strategy=df_infer_with_audience['audience_strategy'])\n    .astype({\"maudience\": pd.StringDtype(), \"audience_strategy\": pd.StringDtype()})\n)\n\n\n\nExplore Model\nFor each audience group, profile the audience group(s) using SHAP feature importances as follows\n\nget a random slice of the inference data within each audience group\nget SHAP values for the selected slice of inference data\nappend metadata about the selected slice of inference data\n\nThe above process is repeated for all audience groups. This is shown below\n\nrng = np.random.default_rng(122807528840384100672342137672332424406)\ndfs_shap_values = []\nfor maudience in audience_groups_strategies[audience_strategy]:\n    # 1. Get SHAP training data for audience group\n    df_infer_shap_train = df_infer_trans.sample(n=num_obs_explain_shap)\n    print(\n        f\"Randomly sliced {num_obs_explain_shap:,} observations \"\n        f\"from {maudience} audience group in inference data\"\n    )\n\n    # 2. Get SHAP values\n    start_time = datetime.now(pytz.timezone(\"US/Eastern\"))\n    start_time_str = start_time.strftime(\"%Y-%m-%d %H:%M:%S.%f\")\n    print(f\"Query execution start time = {start_time_str[:-3]}...\", end=\"\")\n    # # actual SHAP values (to be done)\n    # explainer = shap.TreeExplainer(pipe_clf)\n    # shap_values = explainer.shap_values(X_infer_trans[:num_obs_explain_shap])\n    # shap_means = np.abs(shap_values).mean(axis=0)\n    # # randomly generated SHAP values\n    shap_means = np.random.rand(num_features_shap, 1)\n    end_time = datetime.now(pytz.timezone(\"US/Eastern\"))\n    end_time_str = end_time.strftime(\"%Y-%m-%d %H:%M:%S.%f\")\n    duration = end_time - start_time\n    duration = duration.seconds + (duration.microseconds / 1_000_000)\n    print(f\"done at {end_time_str[:-3]} ({duration:.3f} seconds).\")\n    print(\n        f\"Retrieved SHAP values using {num_obs_explain_shap:,} observations \"\n        f\"from {maudience} group in inference data\"\n    )\n\n    # 3. Log SHAP values and metadata\n    df_shap_values = (\n        pd.DataFrame.from_dict(\n            {\n                # 'feature': list(X_infer_trans)[:num_features_shap],\n                'feature': rng.choice(list(X_infer_trans), num_features_shap, replace=False),\n                'value': shap_means.squeeze(),\n            },\n            orient='index'\n        ).transpose()\n        .sort_values(by='value', ascending=False)\n        .reset_index(drop=True)\n        .assign(infer_month=month_name[X_infer_with_audience['month'].squeeze()[0]])\n        .assign(maudience=maudience)\n        .assign(audience_strategy=audience_strategy)\n        .assign(num_observations=num_obs_explain_shap)\n        .assign(stat=lambda df: df['feature'])\n        .assign(stat_type='feature_importance')\n        .assign(feature=lambda df: df['stat'].str.split(\"__\", expand=True)[0])\n    )\n    dfs_shap_values.append(df_shap_values)\n\nConvert the feature importances and metadata into a single DataFrame\n\n\n\n\n\n\n\n\n\nfeature\nvalue\ninfer_month\nmaudience\naudience_strategy\nnum_observations\nstat\nstat_type\n\n\n\n\n0\nos\n0.812657\nMarch\nHigh\n1\n500\nos__Windows\nfeature_importance\n\n\n1\nlast_action\n0.754545\nMarch\nHigh\n1\n500\nlast_action__Click through of product lists\nfeature_importance\n\n\n2\nos\n0.666231\nMarch\nHigh\n1\n500\nos__Samsung\nfeature_importance\n\n\n3\nhits\n0.564772\nMarch\nHigh\n1\n500\nhits\nfeature_importance\n\n\n4\nos\n0.446324\nMarch\nHigh\n1\n500\nos__Nokia\nfeature_importance\n\n\n5\nos\n0.409177\nMarch\nHigh\n1\n500\nos__FreeBSD\nfeature_importance\n\n\n6\nmedium\n0.348268\nMarch\nHigh\n1\n500\nmedium__(not set)\nfeature_importance\n\n\n7\nmedium\n0.279987\nMarch\nHigh\n1\n500\nmedium__cpc\nfeature_importance\n\n\n8\nbrowser\n0.064326\nMarch\nHigh\n1\n500\nbrowser__other\nfeature_importance\n\n\n9\npromos_displayed\n0.029401\nMarch\nHigh\n1\n500\npromos_displayed\nfeature_importance\n\n\n10\nmedium\n0.983034\nMarch\nMedium\n1\n500\nmedium__(not set)\nfeature_importance\n\n\n11\nmedium\n0.742581\nMarch\nMedium\n1\n500\nmedium__affiliate\nfeature_importance\n\n\n12\nsource\n0.655669\nMarch\nMedium\n1\n500\nsource__google\nfeature_importance\n\n\n13\nos\n0.506003\nMarch\nMedium\n1\n500\nos__Macintosh\nfeature_importance\n\n\n14\nos\n0.348092\nMarch\nMedium\n1\n500\nos__Nintendo Wii\nfeature_importance\n\n\n15\nos\n0.327433\nMarch\nMedium\n1\n500\nos__Chrome OS\nfeature_importance\n\n\n16\nos\n0.304339\nMarch\nMedium\n1\n500\nos__Firefox OS\nfeature_importance\n\n\n17\nhits\n0.103655\nMarch\nMedium\n1\n500\nhits\nfeature_importance\n\n\n18\nbounces\n0.064132\nMarch\nMedium\n1\n500\nbounces__1\nfeature_importance\n\n\n19\nos\n0.020448\nMarch\nMedium\n1\n500\nos__Windows Phone\nfeature_importance\n\n\n20\nos\n0.833292\nMarch\nLow\n1\n500\nos__Nokia\nfeature_importance\n\n\n21\nmedium\n0.814703\nMarch\nLow\n1\n500\nmedium__(not set)\nfeature_importance\n\n\n22\nsource\n0.773306\nMarch\nLow\n1\n500\nsource__other\nfeature_importance\n\n\n23\nbounces\n0.589624\nMarch\nLow\n1\n500\nbounces__1\nfeature_importance\n\n\n24\nos\n0.413594\nMarch\nLow\n1\n500\nos__SunOS\nfeature_importance\n\n\n25\nlast_action\n0.262345\nMarch\nLow\n1\n500\nlast_action__Remove product(s) from cart\nfeature_importance\n\n\n26\nos\n0.182279\nMarch\nLow\n1\n500\nos__BlackBerry\nfeature_importance\n\n\n27\nsource\n0.079011\nMarch\nLow\n1\n500\nsource__google\nfeature_importance\n\n\n28\nos\n0.071339\nMarch\nLow\n1\n500\nos__Macintosh\nfeature_importance\n\n\n29\nmedium\n0.05457\nMarch\nLow\n1\n500\nmedium__affiliate\nfeature_importance"
  },
  {
    "objectID": "notebooks/03-explore/notebooks/08_explore_best_model.html#export-to-disk",
    "href": "notebooks/03-explore/notebooks/08_explore_best_model.html#export-to-disk",
    "title": "Explore Best Model Predictions",
    "section": "Export To Disk",
    "text": "Export To Disk\nExport DataFrame with audience profiles, based on feature importances, to disk\n\ndf_audience_explored.to_parquet(\n    os.path.join(\n        processed_data_dir,\n        f\"audience_profiles_feature_importances__run_\"\n        f\"{best_run_id}__\"\n        f\"infer_month_{month_name[X_infer_with_audience['month'].squeeze()[0]]}__\"\n        f\"{datetime.now().strftime('%Y%m%d_%H%M%S')}.parquet.gzip\",\n    ),\n    index=False,\n    engine='pyarrow',\n    compression='gzip',\n)"
  },
  {
    "objectID": "notebooks/03-explore/notebooks/08_explore_best_model.html#next-step",
    "href": "notebooks/03-explore/notebooks/08_explore_best_model.html#next-step",
    "title": "Explore Best Model Predictions",
    "section": "Next Step",
    "text": "Next Step\nThe next step will assess the performance of the marketing campaign, after the campaign has completed."
  },
  {
    "objectID": "notebooks/04-upload/notebooks/09_upload.html#overview",
    "href": "notebooks/04-upload/notebooks/09_upload.html#overview",
    "title": "Upload Audience Data to BigQuery",
    "section": "Overview",
    "text": "Overview\nThis step will upload the following to separate tables in a private dataset on Google BigQuery\n\npredicted audience groups and (test and control) cohorts1\naudience profiles1\nmonthly performance1, relative to previous months\nsummary of required sample (cohort) sizes that were estimated in a previous step and metrics per cohort, based on desired inputs (combination of uplift, power, confidence level)\n\nThese tables will be accessed by the client-facing dashboard.\n1: using inference data"
  },
  {
    "objectID": "notebooks/04-upload/notebooks/09_upload.html#order-of-operations",
    "href": "notebooks/04-upload/notebooks/09_upload.html#order-of-operations",
    "title": "Upload Audience Data to BigQuery",
    "section": "Order of Operations",
    "text": "Order of Operations\nThis step can be run prospectively at the end of the inference period, just before the start of the campaign, when all the inference data (first-time visitors to the store) becomes available. This step is needed before the project’s dashboard (main project deliverable) can be created since the dashboard will be populated with the data derived from data uploaded to BigQuery tables in this step."
  },
  {
    "objectID": "notebooks/04-upload/notebooks/09_upload.html#outputs",
    "href": "notebooks/04-upload/notebooks/09_upload.html#outputs",
    "title": "Upload Audience Data to BigQuery",
    "section": "Outputs",
    "text": "Outputs\nThe following tables will be created\n\nCombined Audience Profile and Feature Importances\n\naudience profile consisting of the following for each predicted audience group\n\naudience strategy\nname of descriptive or behavioral statistic about attribute of first visit\nvalue of statistic in\n\nHigh propensity group of visitors\nMedium propensity group of visitors\nLow propensity group of visitors\n\n\nML feature importances\n\naudience strategy\nnumber of observations used to learn feature importances\nfeature name\naudience group\nfeature importance\n\n\nAll Available First-Time Visitors and Assigned Audience Groups and Cohorts\n\nmonth during which first-time visitors visited the store site during inference period\n\nfor development data, no audience or cohorts are assigned\nfor inference predictions, audience groups and randomly selected cohorts are assigned\n\nvisitor ID from GA360 data\nvisit ID from GA360 data\nvisit number from GA360 data\nvisit start time\nquarter of year during which visit occurred\nmonth of year during which visit occurred\nday of month during which visit occurred\nday of week during which visit occurred\nhour of day during which visit occurred\nminute of hour during which visit occurred\nsecond of minute during which visit occurred\ntraffic source from GA360 data\nmedium from GA360 data\nchannel from GA360 data\nregistered hits from GA360 data\nbounced visits from GA360 data\nlast action performed during visit from GA360 data\nnumber of promotions viewed from GA360 data\nnumber of promotions clicked from GA360 data\nnumber of product lists viewed from GA360 data\nnumber of products clicked from GA360 data\npageviews from GA360 data\ntime spent on store site from GA360 data\nbrowser used to access store site from GA360 data\noperating system used to access store site from GA360 data\ncategory of device used to access store site from GA360 data\nwhether a product was added to the shopping cart during first visit from GA360 data\nrevenue during first visit from GA360 data\npredicted propensity for making a purchase during a return visit\npredicted audience group\npredicted cohort (test or control)\naudience strategy (single- or multiple-audience)\ntrue outcome (whether a purchase was made on a return visit to the store)\n\nmissing for inference data\n\ntype of data (development - train_val/test - or inference - infer)\n\nMonthly Summary Statistics (Overall)\n\nmonth during which first-time visitors visited the store site during inference period\ntype of data (development - train_val/test - or inference - infer)\ntotal number of return purchasers\ntotal revenue\ntotal number of first-time visitors\ntotal pageviews\naverage time spent on the store site\nmost populat channel\nmost popular category of device\nmost popular browser\nmost popular operating system\naudience strategy (single- or multiple-audience)\nbounce rate\nproduct click rate\nadd-to-cart rate\ntype of visitor (development or inference)\nconversion rate\nrate of change in the following relative to the previous month\n\ntotal number of return purchasers (development) or first-time visitors (inference)\ntotal revenue\ntotal pageviews\naverage time spent on the store site\nbounce rate\nconversion rate\nproduct click rate\nadd-to-cart rate\n\n\nConversion Rates During Development and Inference\n\nover the period covering the development and inference data\n\naudience strategy (single- or multiple-audience)\nmonth during which first-time visitors visited the store site during inference period\naudience group (eg. High, Medium, Low predicted propensity)\npredicted conversions\ntotal number of visitors per audience group\nminimum score\ntrue number of conversions per audience group\ntype of visitor (development or inference)\ntotal number of each type of visitor\ntrue conversion rate per audience group\noverall true conversion rate\npredicted conversion rate per audience group\noverall predicted conversion rate\n\n\nEstimated and Actual Fractions of Cohort to Audience Size\n\nover the period covering the development and inference data\n\naudience strategy (single- or multiple-audience)\nmonth during which first-time visitors visited the store site during inference period\naudience group (eg. High, Medium, Low predicted propensity)\ncohort (test or control)\ncohort size\naudience size\nrequired uplift, power and confidence level used to estimate cohort size\nratio of cohort to audience sizes\ntype of cohort size\n\ndevelopment (estimated based on required uplift, power and confidence level)\ninference (assigned using estimates during development)\n\ntype of visitor (development or inference)\ntotal number of each type of visitor\n\n\nAggregated Conversion Rates During Development and Inference (by Audience Group & Overall)\n\nover the period covering the development and inference data\n\naudience group (eg. High, Medium, Low predicted propensity)\ndata_type (development or inference)\ntrue or predicted conversion rate\n\n\nDaily Summary Statistics by Audience Group and Overall\n\nover the period covering the development and inference data\n\ntotal number of return purchasers\ntotal revenue\ntotal number of first-time visitors\ntotal number of add-to-cart actions performed\ntotal pageviews\naverage time spent on the store site\ntotal product lists viewed\ntotal products clicked on\ntotal number of bounce events\naudience strategy (single- or multiple-audience)\nbounce rate\nproduct click rate\nadd-to-cart rate\ntype of visitor (development or inference)\naggregation type (by audience group or overall)\n\n\nKPIs by categorical feature\n\nover the period covering the test split of the development data, show the following by sub-category\n\ncategorical feature\ncategorical feature value (sub-category)\nnumber of conversions\nnumber of visitors\naverage conversion rate\naverage clickthrough rate\ntotal number of conversions\ntotal number of clicks\ntotal product lists viewed\ntotal products clicked on\ntotal revenue\ntotal number of visitors"
  },
  {
    "objectID": "notebooks/04-upload/notebooks/09_upload.html#user-inputs",
    "href": "notebooks/04-upload/notebooks/09_upload.html#user-inputs",
    "title": "Upload Audience Data to BigQuery",
    "section": "User Inputs",
    "text": "User Inputs\nDefine the following\n\nbest MLFlow run ID\nlist of categorical features\nlist of numerical features\nBigQuery\n\ndataset id\ntable ids for audience\n\ncohorts\nprofile\n\n\ndictionary to map profile statistic type to description\ninputs (uplift, power, confidence level) for which random cohort sizes were estimated during an earlier step\ntype of audience strategy (single- or multi- group) from which cohorts were created during an earlier step\n\n\n# 1. \nbest_run_id = \"f805253a6ba64ee6a41bf14310ef16a4\"\n\n# 2. categorical column\ncategorical_features = [\n    \"bounces\",\n    \"last_action\",\n    \"source\",\n    \"medium\",\n    \"channelGrouping\",\n    \"browser\",\n    \"os\",\n    \"deviceCategory\",\n]\n\n# 3. numerical columns\nnumerical_features = [\n    \"hits\",\n    \"promos_displayed\",\n    \"promos_clicked\",\n    \"product_views\",\n    \"product_clicks\",\n    \"pageviews\",\n    \"time_on_site\",\n]\n\n# 4. GCP resources\ngbq_dataset_id = 'mydemo2asdf'\ngbq_table_id_cohorts = 'audience_cohorts'\ngbq_table_id_profiles = 'audience_profiles'\ngbq_table_id_sample_sizes = 'audience_sample_sizes'\ngbq_table_feats_imps = 'audience_feats_imp'\ngbq_table_id_summary = 'monthly_summary'\ngbq_table_id_sa_fracs = \"cohort_audience_fractions\"\ngbq_table_id_conv_rates = \"audience_conversion_rates\"\ngbq_table_id_conv_rates_agg_combo = \"conversion_rates_aggregated\"\ngbq_table_id_daily_perf = \"daily_summary\"\ngbq_table_id_cat_feats_kpis = \"categorical_features_kpis\"\n\n# 5. dictionary to map statistic type to description\nstat_type_desc_mapper_dict = {\n    \"behavior\": \"Behavioral\",\n    \"mean\": \"Descriptive statistics\",\n    \"mode\": \"Descriptive statistics\",\n    \"max\": \"Descriptive statistics\",\n    \"feature_importance\": \"Most important ML features\",\n}\n\n# 6. inputs used to estimate sample sizes\nwanted_inputs = {\n    \"uplift_percentage\": 10,\n    \"power_percentage\": 55,\n    \"confidence_level_percentage\": 55,\n}\n\n# 7. type of audience strategy to use when creating groups\naudience_strategy = 1"
  },
  {
    "objectID": "notebooks/04-upload/notebooks/09_upload.html#get-data",
    "href": "notebooks/04-upload/notebooks/09_upload.html#get-data",
    "title": "Upload Audience Data to BigQuery",
    "section": "Get Data",
    "text": "Get Data\n\nFeature Importances\n\ndf_feats = (\n    pd.read_parquet(fpath_feat_imps)\n    # select only wanted columns\n    [['audience_strategy', 'num_observations', 'stat', 'maudience', 'value']]\n)\ndisplay(df_feats.head())\nsummarize_df(df_feats)\n\n\n\n\n\n\n\n\naudience_strategy\nnum_observations\nstat\nmaudience\nvalue\n\n\n\n\n0\n1\n500\nos__Windows\nHigh\n0.812657\n\n\n1\n1\n500\nlast_action__Click through of product lists\nHigh\n0.754545\n\n\n2\n1\n500\nos__Samsung\nHigh\n0.666231\n\n\n3\n1\n500\nhits\nHigh\n0.564772\n\n\n4\n1\n500\nos__Nokia\nHigh\n0.446324\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ncolumn\ndtype\nmissing\n\n\n\n\n0\naudience_strategy\nInt8\n0\n\n\n1\nnum_observations\nInt64\n0\n\n\n2\nstat\nstring[python]\n0\n\n\n3\nmaudience\nstring[python]\n0\n\n\n4\nvalue\nFloat64\n0\n\n\n\n\n\n\n\n\n\nAudience Profiles\n\ndf_profile = pd.read_parquet(fpath_profile)\ndisplay(df_profile.head())\nsummarize_df(df_profile)\n\n\n\n\n\n\n\n\nstat\nstat_type\nHigh\nLow\nMedium\nfeature\naudience_strategy\n\n\n\n\n0\nhour__mean\nmean\n12.988829127016963\n13.004689008412633\n13.03503448275862\nhour\n1\n\n\n1\nday_of_week__mean\nmean\n4.027858226451524\n3.991035719211143\n3.993793103448276\nday_of_week\n1\n\n\n2\nsource__mode\nmode\ngoogle\ngoogle\ngoogle\nsource\n1\n\n\n3\nmedium__mode\nmode\norganic\norganic\norganic\nmedium\n1\n\n\n4\nchannelGrouping__mode\nmode\nOrganic Search\nOrganic Search\nOrganic Search\nchannelGrouping\n1\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ncolumn\ndtype\nmissing\n\n\n\n\n0\nstat\nstring[python]\n0\n\n\n1\nstat_type\nstring[python]\n0\n\n\n2\nHigh\nstring[python]\n0\n\n\n3\nLow\nstring[python]\n0\n\n\n4\nMedium\nstring[python]\n0\n\n\n5\nfeature\nstring[python]\n0\n\n\n6\naudience_strategy\nInt8\n0\n\n\n\n\n\n\n\n\n\nAudience Cohorts\n\ndf_cohorts = pd.read_parquet(fpath_cohorts).astype({\"bounces\": pd.Int64Dtype()})\ndisplay(df_cohorts.head())\nsummarize_df(df_cohorts)\n\n\n\n\n\n\n\n\nfullvisitorid\nvisitId\nvisitNumber\nvisitStartTime\nquarter\nmonth\nday_of_month\nday_of_week\nhour\nminute\n...\nbrowser\nos\ndeviceCategory\nadded_to_cart\nrevenue\nscore\npredicted_score_label\nmaudience\ncohort\naudience_strategy\n\n\n\n\n0\n7701350257079842191\n1488377334\n1\n2017-03-01 06:08:54\n1\n3\n1\n4\n6\n8\n...\nChrome\nMacintosh\ndesktop\n0\n&lt;NA&gt;\n0.961501\nFalse\nHigh\nControl\n1\n\n\n1\n1927404893298120774\n1489438559\n1\n2017-03-13 13:55:59\n1\n3\n13\n2\n13\n55\n...\nChrome\nWindows\ndesktop\n0\n&lt;NA&gt;\n0.884723\nFalse\nHigh\nControl\n1\n\n\n2\n4081311830661383532\n1489678740\n1\n2017-03-16 08:39:00\n1\n3\n16\n5\n8\n39\n...\nChrome\nChrome OS\ndesktop\n0\n&lt;NA&gt;\n0.879829\nFalse\nHigh\nControl\n1\n\n\n3\n48980746408094895\n1489003955\n1\n2017-03-08 12:12:35\n1\n3\n8\n4\n12\n12\n...\nChrome\nWindows\ndesktop\n0\n&lt;NA&gt;\n0.866037\nFalse\nHigh\nControl\n1\n\n\n4\n0480615828723852227\n1490621968\n1\n2017-03-27 06:39:28\n1\n3\n27\n2\n6\n39\n...\nChrome\nMacintosh\ndesktop\n0\n&lt;NA&gt;\n0.864021\nFalse\nHigh\nControl\n1\n\n\n\n\n5 rows × 33 columns\n\n\n\n\n\n\n\n\n\n\ncolumn\ndtype\nmissing\n\n\n\n\n0\nfullvisitorid\nstring[python]\n0\n\n\n1\nvisitId\nstring[python]\n0\n\n\n2\nvisitNumber\nInt64\n0\n\n\n3\nvisitStartTime\ndatetime64[ns]\n0\n\n\n4\nquarter\nInt64\n0\n\n\n5\nmonth\nInt64\n0\n\n\n6\nday_of_month\nInt64\n0\n\n\n7\nday_of_week\nInt64\n0\n\n\n8\nhour\nInt64\n0\n\n\n9\nminute\nInt64\n0\n\n\n10\nsecond\nInt64\n0\n\n\n11\nsource\ncategory\n0\n\n\n12\nmedium\ncategory\n0\n\n\n13\nchannelGrouping\ncategory\n0\n\n\n14\nhits\nInt64\n0\n\n\n15\nbounces\nInt64\n0\n\n\n16\nlast_action\ncategory\n0\n\n\n17\npromos_displayed\nInt64\n0\n\n\n18\npromos_clicked\nInt64\n0\n\n\n19\nproduct_views\nInt64\n0\n\n\n20\nproduct_clicks\nInt64\n0\n\n\n21\npageviews\nInt64\n0\n\n\n22\ntime_on_site\nInt64\n0\n\n\n23\nbrowser\ncategory\n0\n\n\n24\nos\ncategory\n0\n\n\n25\ndeviceCategory\ncategory\n0\n\n\n26\nadded_to_cart\nInt64\n0\n\n\n27\nrevenue\nFloat64\n21010\n\n\n28\nscore\nFloat64\n0\n\n\n29\npredicted_score_label\nboolean\n0\n\n\n30\nmaudience\nstring[python]\n0\n\n\n31\ncohort\nstring[python]\n8390\n\n\n32\naudience_strategy\nInt8\n0\n\n\n\n\n\n\n\n\n\nAudience Sample (Cohort) Size Requirements and Metrics\n\ndf_required_sample_sizes = (\n    pd.read_parquet(\n        fpath_aud_sizes,\n        # filters=[\n        #     ('audience_strategy', '=', audience_strategy)\n        # ]# + [\n        #     (k, \"=\", v)\n        #     for k,v in zip(\n        #         ['uplift', 'power', 'ci_level'],\n        #         list(wanted_inputs.values()),\n        #     )\n        # ],\n    )\n    # select only wanted columns\n    .drop(columns=['group_number', 'group_size_proportion'])\n)\ndisplay(df_required_sample_sizes.head())\nsummarize_df(df_required_sample_sizes)\n\n\n\n\n\n\n\n\nmaudience\ngroup_size\ngroup_min_propensity\ngroup_conv_rate\nctr\nrevenue\nbounce_rate\nuplift\npower\nci_level\nrequired_sample_size\naudience_strategy\n\n\n\n\n0\nHigh\n6721\n0.096287\n2.216932\n2.653428\n37589.59\n35.396518\n15\n90\n95\n20598\n1\n\n\n1\nHigh\n6721\n0.096287\n2.216932\n2.653428\n37589.59\n35.396518\n10\n90\n66\n21966\n1\n\n\n2\nHigh\n6721\n0.096287\n2.216932\n2.653428\n37589.59\n35.396518\n10\n90\n67\n22372\n1\n\n\n3\nHigh\n6721\n0.096287\n2.216932\n2.653428\n37589.59\n35.396518\n10\n90\n68\n22787\n1\n\n\n4\nHigh\n6721\n0.096287\n2.216932\n2.653428\n37589.59\n35.396518\n10\n90\n69\n23214\n1\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ncolumn\ndtype\nmissing\n\n\n\n\n0\nmaudience\nstring[python]\n0\n\n\n1\ngroup_size\nInt64\n0\n\n\n2\ngroup_min_propensity\nFloat64\n0\n\n\n3\ngroup_conv_rate\nFloat64\n0\n\n\n4\nctr\nFloat64\n0\n\n\n5\nrevenue\nFloat64\n0\n\n\n6\nbounce_rate\nFloat64\n0\n\n\n7\nuplift\nInt8\n0\n\n\n8\npower\nInt8\n0\n\n\n9\nci_level\nInt8\n0\n\n\n10\nrequired_sample_size\nInt64\n0\n\n\n11\naudience_strategy\nint64\n0\n\n\n\n\n\n\n\n\n\nML Development Data\n\ndf_development = (\n    pd.read_parquet(fpath_development)\n    .astype(\n        {\n            \"predicted_label\": pd.Int64Dtype(),\n            \"bounces\": pd.Int64Dtype(),\n        }\n    )\n)\ndisplay(df_development.head())\nsummarize_df(df_development)\n\n\n\n\n\n\n\n\nfullvisitorid\nvisitId\nvisitNumber\nvisitStartTime\nquarter\nmonth\nday_of_month\nday_of_week\nhour\nminute\n...\nbrowser\nos\ndeviceCategory\nadded_to_cart\nrevenue\nmade_purchase_on_future_visit\nsplit_type\nscore\npredicted_score_label\npredicted_label\n\n\n\n\n0\n4157301099254368232\n1476636342\n1\n2016-10-16 09:45:42\n4\n10\n16\n1\n9\n45\n...\nSafari\nMacintosh\ndesktop\n0\n&lt;NA&gt;\n1\ntrain_val\n0.058666\nTrue\n0\n\n\n1\n786312091291497372\n1481408395\n1\n2016-12-10 14:19:55\n4\n12\n10\n7\n14\n19\n...\nChrome\nChrome OS\ndesktop\n0\n&lt;NA&gt;\n0\ntrain_val\n0.130899\nTrue\n0\n\n\n2\n322228537289095245\n1482626483\n1\n2016-12-24 16:41:23\n4\n12\n24\n7\n16\n41\n...\nChrome\nWindows\ndesktop\n1\n52.99\n0\ntrain_val\n0.000751\nTrue\n0\n\n\n3\n7808115684091011900\n1482430339\n1\n2016-12-22 10:12:19\n4\n12\n22\n5\n10\n12\n...\nChrome\nWindows\ndesktop\n0\n&lt;NA&gt;\n0\ntrain_val\n0.02076\nTrue\n0\n\n\n4\n9442018438865871704\n1484757590\n1\n2017-01-18 08:39:50\n1\n1\n18\n4\n8\n39\n...\nChrome\nWindows\ndesktop\n0\n&lt;NA&gt;\n0\ntrain_val\n0.202944\nTrue\n0\n\n\n\n\n5 rows × 33 columns\n\n\n\n\n\n\n\n\n\n\ncolumn\ndtype\nmissing\n\n\n\n\n0\nfullvisitorid\nstring[python]\n0\n\n\n1\nvisitId\nstring[python]\n0\n\n\n2\nvisitNumber\nInt64\n0\n\n\n3\nvisitStartTime\ndatetime64[ns]\n0\n\n\n4\nquarter\nInt64\n0\n\n\n5\nmonth\nInt64\n0\n\n\n6\nday_of_month\nInt64\n0\n\n\n7\nday_of_week\nInt64\n0\n\n\n8\nhour\nInt64\n0\n\n\n9\nminute\nInt64\n0\n\n\n10\nsecond\nInt64\n0\n\n\n11\nsource\ncategory\n0\n\n\n12\nmedium\ncategory\n0\n\n\n13\nchannelGrouping\ncategory\n0\n\n\n14\nhits\nInt64\n0\n\n\n15\nbounces\nInt64\n0\n\n\n16\nlast_action\ncategory\n0\n\n\n17\npromos_displayed\nInt64\n0\n\n\n18\npromos_clicked\nInt64\n0\n\n\n19\nproduct_views\nInt64\n0\n\n\n20\nproduct_clicks\nInt64\n0\n\n\n21\npageviews\nInt64\n0\n\n\n22\ntime_on_site\nInt64\n0\n\n\n23\nbrowser\ncategory\n0\n\n\n24\nos\ncategory\n0\n\n\n25\ndeviceCategory\ncategory\n0\n\n\n26\nadded_to_cart\nInt64\n0\n\n\n27\nrevenue\nFloat64\n129291\n\n\n28\nmade_purchase_on_future_visit\nInt64\n0\n\n\n29\nsplit_type\ncategory\n0\n\n\n30\nscore\nFloat64\n0\n\n\n31\npredicted_score_label\nboolean\n0\n\n\n32\npredicted_label\nInt64\n0\n\n\n\n\n\n\n\n\n\nConversion Rates in Development and Inference\n\ndf_conv_rates = pd.read_parquet(fpath_conv_rates)\ndisplay(df_conv_rates.head())\nsummarize_df(df_conv_rates)\n\n\n\n\n\n\n\n\naudience_strategy\nmaudience\npred_conversions\ntotal_visitors\nmin_score\ntrue_conversions\ndata_type\ndata_size\ntrue_conv_rate\noverall_true_conv_rate\npred_conv_rate\noverall_pred_conv_rate\n\n\n\n\n0\n1\nHigh\n850\n6722\n0.095656\n149\ndevelopment\n20164\n2.216602\n2.30609\n12.645046\n4.215433\n\n\n1\n1\nLow\n0\n6721\n0.0\n152\ndevelopment\n20164\n2.261568\n2.30609\n0.0\n4.215433\n\n\n2\n1\nMedium\n0\n6721\n0.00911\n164\ndevelopment\n20164\n2.440113\n2.30609\n0.0\n4.215433\n\n\n3\n1\nHigh\n975\n7251\n0.098362\n&lt;NA&gt;\ninference\n21752\n&lt;NA&gt;\n&lt;NA&gt;\n13.446421\n4.482346\n\n\n4\n1\nLow\n0\n7251\n0.0\n&lt;NA&gt;\ninference\n21752\n&lt;NA&gt;\n&lt;NA&gt;\n0.0\n4.482346\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ncolumn\ndtype\nmissing\n\n\n\n\n0\naudience_strategy\nInt8\n0\n\n\n1\nmaudience\nstring[python]\n0\n\n\n2\npred_conversions\nInt64\n0\n\n\n3\ntotal_visitors\nInt64\n0\n\n\n4\nmin_score\nFloat64\n0\n\n\n5\ntrue_conversions\nInt64\n3\n\n\n6\ndata_type\nstring[python]\n0\n\n\n7\ndata_size\nInt64\n0\n\n\n8\ntrue_conv_rate\nFloat64\n3\n\n\n9\noverall_true_conv_rate\nFloat64\n3\n\n\n10\npred_conv_rate\nFloat64\n0\n\n\n11\noverall_pred_conv_rate\nFloat64\n0\n\n\n\n\n\n\n\n\n\nEstimated and Actual Cohort to Audience Fractions\n\ndf_sa_frac = pd.read_parquet(fpath_sa_frac)\ndisplay(df_sa_frac.head())\nsummarize_df(df_sa_frac)\n\n\n\n\n\n\n\n\nmaudience\ncohort\nsize\ngroup_size\nuplift\npower\nci_level\nsamp_to_aud_frac\nsize_type\ndata_type\ndata_size\n\n\n\n\n0\nHigh\nTest\n2146\n6721\n10\n55\n55\n31.929772\nrequired\ndevelopment\n20164\n\n\n1\nHigh\nControl\n2146\n6721\n10\n55\n55\n31.929772\nrequired\ndevelopment\n20164\n\n\n2\nMedium\nTest\n1945\n6721\n10\n55\n55\n28.939146\nrequired\ndevelopment\n20164\n\n\n3\nMedium\nControl\n1945\n6721\n10\n55\n55\n28.939146\nrequired\ndevelopment\n20164\n\n\n4\nLow\nTest\n2103\n6722\n10\n55\n55\n31.285332\nrequired\ndevelopment\n20164\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ncolumn\ndtype\nmissing\n\n\n\n\n0\nmaudience\nstring[python]\n0\n\n\n1\ncohort\nstring[python]\n0\n\n\n2\nsize\nInt64\n0\n\n\n3\ngroup_size\nInt64\n0\n\n\n4\nuplift\nInt8\n0\n\n\n5\npower\nInt8\n0\n\n\n6\nci_level\nInt8\n0\n\n\n7\nsamp_to_aud_frac\nFloat64\n0\n\n\n8\nsize_type\nstring[python]\n0\n\n\n9\ndata_type\nstring[python]\n0\n\n\n10\ndata_size\nInt64\n0"
  },
  {
    "objectID": "notebooks/04-upload/notebooks/09_upload.html#transform-data",
    "href": "notebooks/04-upload/notebooks/09_upload.html#transform-data",
    "title": "Upload Audience Data to BigQuery",
    "section": "Transform Data",
    "text": "Transform Data\n\nFeature Importances\n\ndf_feats = (\n    df_feats.assign(\n        stat=lambda df: (\n            df[\"stat\"].str.replace(\"__\", \" = \")\n            .str.replace(\" = 1\", \" = True\")\n            .str.replace(\"_\", \" \")\n        )\n    )\n)\ndisplay(df_feats.head())\nsummarize_df(df_feats)\n\n\n\n\n\n\n\n\naudience_strategy\nnum_observations\nstat\nmaudience\nvalue\n\n\n\n\n0\n1\n500\nos = Windows\nHigh\n0.812657\n\n\n1\n1\n500\nlast action = Click through of product lists\nHigh\n0.754545\n\n\n2\n1\n500\nos = Samsung\nHigh\n0.666231\n\n\n3\n1\n500\nhits\nHigh\n0.564772\n\n\n4\n1\n500\nos = Nokia\nHigh\n0.446324\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ncolumn\ndtype\nmissing\n\n\n\n\n0\naudience_strategy\nInt8\n0\n\n\n1\nnum_observations\nInt64\n0\n\n\n2\nstat\nstring[python]\n0\n\n\n3\nmaudience\nstring[python]\n0\n\n\n4\nvalue\nFloat64\n0\n\n\n\n\n\n\n\n\n\nAudience Profile\n\ndf_profile_sliced = (\n    df_profile\n    # get behavioral and (average) descriptive statistics\n    .query(\"(stat_type == 'behavior') | (stat.str.endswith('mean'))\")\n    # make stat column more reader friendly\n    .assign(\n        stat_expanded=lambda df: (\n            df[\"stat\"]\n            .str.replace(\"__1\", \" = True\")\n            .str.replace(\"__0\", \" = False\")\n            .str.replace(\"__\", \" = \")\n            .str.replace(\"_\", \" \")\n            .str.replace(\"= mean\", \"(Mean)\")\n            .str.title()\n        )\n    )\n    # drop unwanted columns\n    .drop(columns=['stat'])\n    .reset_index()\n    # rename columns to titlecase\n    .rename(columns=str.title)\n    # set datatypes\n    .astype(\n        {\n            'Audience_Strategy': pd.Int8Dtype(),\n            \"Stat_Expanded\": pd.StringDtype(),\n            \"High\": pd.Float64Dtype(),  # Float32Dtype\n            \"Medium\": pd.Float64Dtype(),  # Float32Dtype\n            \"Low\": pd.Float64Dtype(),  # Float32Dtype\n        }\n    )\n    # select only wanted columns\n    [['Audience_Strategy', 'Stat_Expanded', 'High', 'Medium', 'Low']]\n)\ndisplay(df_profile_sliced.head())\nsummarize_df(df_profile_sliced)\n\n\n\n\n\n\n\n\nAudience_Strategy\nStat_Expanded\nHigh\nMedium\nLow\n\n\n\n\n0\n1\nHour (Mean)\n12.988829\n13.035034\n13.004689\n\n\n1\n1\nDay Of Week (Mean)\n4.027858\n3.993793\n3.991036\n\n\n2\n1\nHits (Mean)\n6.459109\n6.197655\n6.40822\n\n\n3\n1\nPromos Displayed (Mean)\n8.585436\n8.441379\n8.677286\n\n\n4\n1\nPromos Clicked (Mean)\n0.000138\n0.0\n0.0\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ncolumn\ndtype\nmissing\n\n\n\n\n0\nAudience_Strategy\nInt8\n0\n\n\n1\nStat_Expanded\nstring[python]\n0\n\n\n2\nHigh\nFloat64\n0\n\n\n3\nMedium\nFloat64\n0\n\n\n4\nLow\nFloat64\n0\n\n\n\n\n\n\n\n\n\nAudience Cohorts\n\ndf_cohorts = (\n    df_cohorts\n    .assign(made_purchase_on_future_visit=None)\n    .assign(split_type='infer')\n    .assign(infer_month=infer_month_feats)\n    .astype(\n        {\n            'split_type': pd.StringDtype(),\n            \"infer_month\": pd.StringDtype(),\n            \"made_purchase_on_future_visit\": pd.BooleanDtype(),\n        }\n    )\n)\ncol = df_cohorts.pop(\"infer_month\")\ndf_cohorts.insert(0, col.name, col)\nwith pd.option_context('display.max_columns', None):\n    display(df_cohorts.head())\nsummarize_df(df_cohorts)\n\n\n\n\n\n\n\n\ninfer_month\nfullvisitorid\nvisitId\nvisitNumber\nvisitStartTime\nquarter\nmonth\nday_of_month\nday_of_week\nhour\nminute\nsecond\nsource\nmedium\nchannelGrouping\nhits\nbounces\nlast_action\npromos_displayed\npromos_clicked\nproduct_views\nproduct_clicks\npageviews\ntime_on_site\nbrowser\nos\ndeviceCategory\nadded_to_cart\nrevenue\nscore\npredicted_score_label\nmaudience\ncohort\naudience_strategy\nmade_purchase_on_future_visit\nsplit_type\n\n\n\n\n0\nMarch\n7701350257079842191\n1488377334\n1\n2017-03-01 06:08:54\n1\n3\n1\n4\n6\n8\n54\nlearn.temple.edu\nreferral\nReferral\n1\n1\nUnknown\n9\n0\n0\n0\n1\n0\nChrome\nMacintosh\ndesktop\n0\n&lt;NA&gt;\n0.961501\nFalse\nHigh\nControl\n1\n&lt;NA&gt;\ninfer\n\n\n1\nMarch\n1927404893298120774\n1489438559\n1\n2017-03-13 13:55:59\n1\n3\n13\n2\n13\n55\n59\ngoogle\norganic\nOrganic Search\n2\n0\nUnknown\n0\n0\n12\n0\n2\n14\nChrome\nWindows\ndesktop\n0\n&lt;NA&gt;\n0.884723\nFalse\nHigh\nControl\n1\n&lt;NA&gt;\ninfer\n\n\n2\nMarch\n4081311830661383532\n1489678740\n1\n2017-03-16 08:39:00\n1\n3\n16\n5\n8\n39\n0\ngoogle\norganic\nOrganic Search\n1\n1\nUnknown\n0\n0\n1\n0\n1\n0\nChrome\nChrome OS\ndesktop\n0\n&lt;NA&gt;\n0.879829\nFalse\nHigh\nControl\n1\n&lt;NA&gt;\ninfer\n\n\n3\nMarch\n48980746408094895\n1489003955\n1\n2017-03-08 12:12:35\n1\n3\n8\n4\n12\n12\n35\ngoogle\norganic\nOrganic Search\n27\n0\nProduct detail views\n0\n0\n166\n4\n23\n928\nChrome\nWindows\ndesktop\n0\n&lt;NA&gt;\n0.866037\nFalse\nHigh\nControl\n1\n&lt;NA&gt;\ninfer\n\n\n4\nMarch\n0480615828723852227\n1490621968\n1\n2017-03-27 06:39:28\n1\n3\n27\n2\n6\n39\n28\ngoogle\norganic\nOrganic Search\n2\n0\nUnknown\n9\n0\n0\n0\n2\n8\nChrome\nMacintosh\ndesktop\n0\n&lt;NA&gt;\n0.864021\nFalse\nHigh\nControl\n1\n&lt;NA&gt;\ninfer\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ncolumn\ndtype\nmissing\n\n\n\n\n0\ninfer_month\nstring[python]\n0\n\n\n1\nfullvisitorid\nstring[python]\n0\n\n\n2\nvisitId\nstring[python]\n0\n\n\n3\nvisitNumber\nInt64\n0\n\n\n4\nvisitStartTime\ndatetime64[ns]\n0\n\n\n5\nquarter\nInt64\n0\n\n\n6\nmonth\nInt64\n0\n\n\n7\nday_of_month\nInt64\n0\n\n\n8\nday_of_week\nInt64\n0\n\n\n9\nhour\nInt64\n0\n\n\n10\nminute\nInt64\n0\n\n\n11\nsecond\nInt64\n0\n\n\n12\nsource\ncategory\n0\n\n\n13\nmedium\ncategory\n0\n\n\n14\nchannelGrouping\ncategory\n0\n\n\n15\nhits\nInt64\n0\n\n\n16\nbounces\nInt64\n0\n\n\n17\nlast_action\ncategory\n0\n\n\n18\npromos_displayed\nInt64\n0\n\n\n19\npromos_clicked\nInt64\n0\n\n\n20\nproduct_views\nInt64\n0\n\n\n21\nproduct_clicks\nInt64\n0\n\n\n22\npageviews\nInt64\n0\n\n\n23\ntime_on_site\nInt64\n0\n\n\n24\nbrowser\ncategory\n0\n\n\n25\nos\ncategory\n0\n\n\n26\ndeviceCategory\ncategory\n0\n\n\n27\nadded_to_cart\nInt64\n0\n\n\n28\nrevenue\nFloat64\n21010\n\n\n29\nscore\nFloat64\n0\n\n\n30\npredicted_score_label\nboolean\n0\n\n\n31\nmaudience\nstring[python]\n0\n\n\n32\ncohort\nstring[python]\n8390\n\n\n33\naudience_strategy\nInt8\n0\n\n\n34\nmade_purchase_on_future_visit\nboolean\n21752\n\n\n35\nsplit_type\nstring[python]\n0\n\n\n\n\n\n\n\n\n\nConversion Rates in Development and Inference\n\ndf_conv_rates = (\n    df_conv_rates\n    .assign(infer_month=[None]*3 + [infer_month_conv_rates]*3)\n    .assign(audience_strategy=audience_strategy)\n    .astype(\n        {\n            \"infer_month\": pd.StringDtype(),\n            \"audience_strategy\": pd.Int8Dtype(),\n        }\n    )\n    .assign(\n        data_type=lambda df: df['data_type'].str.replace('_', ' ').str.title()\n    )\n    .fillna(\n        {\n            \"true_conv_rate\": 0,\n            \"overall_true_conv_rate\": 0,\n            \"true_conversions\": 0,\n            \"pred_conv_rate\": 0,\n            \"total_visitors\": 0,\n            'min_score': 0,\n        }\n    )\n)\ncol = df_conv_rates.pop(\"infer_month\")\ndf_conv_rates.insert(0, col.name, col)\ncol = df_conv_rates.pop(\"audience_strategy\")\ndf_conv_rates.insert(0, col.name, col)\ndisplay(df_conv_rates)\nsummarize_df(df_conv_rates)\n\n\n\n\n\n\n\n\naudience_strategy\ninfer_month\nmaudience\npred_conversions\ntotal_visitors\nmin_score\ntrue_conversions\ndata_type\ndata_size\ntrue_conv_rate\noverall_true_conv_rate\npred_conv_rate\noverall_pred_conv_rate\n\n\n\n\n0\n1\n&lt;NA&gt;\nHigh\n850\n6722\n0.095656\n149\nDevelopment\n20164\n2.216602\n2.30609\n12.645046\n4.215433\n\n\n1\n1\n&lt;NA&gt;\nLow\n0\n6721\n0.0\n152\nDevelopment\n20164\n2.261568\n2.30609\n0.0\n4.215433\n\n\n2\n1\n&lt;NA&gt;\nMedium\n0\n6721\n0.00911\n164\nDevelopment\n20164\n2.440113\n2.30609\n0.0\n4.215433\n\n\n3\n1\nMarch\nHigh\n975\n7251\n0.098362\n0\nInference\n21752\n0.0\n0.0\n13.446421\n4.482346\n\n\n4\n1\nMarch\nLow\n0\n7251\n0.0\n0\nInference\n21752\n0.0\n0.0\n0.0\n4.482346\n\n\n5\n1\nMarch\nMedium\n0\n7250\n0.008815\n0\nInference\n21752\n0.0\n0.0\n0.0\n4.482346\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ncolumn\ndtype\nmissing\n\n\n\n\n0\naudience_strategy\nInt8\n0\n\n\n1\ninfer_month\nstring[python]\n3\n\n\n2\nmaudience\nstring[python]\n0\n\n\n3\npred_conversions\nInt64\n0\n\n\n4\ntotal_visitors\nInt64\n0\n\n\n5\nmin_score\nFloat64\n0\n\n\n6\ntrue_conversions\nInt64\n0\n\n\n7\ndata_type\nstring[python]\n0\n\n\n8\ndata_size\nInt64\n0\n\n\n9\ntrue_conv_rate\nFloat64\n0\n\n\n10\noverall_true_conv_rate\nFloat64\n0\n\n\n11\npred_conv_rate\nFloat64\n0\n\n\n12\noverall_pred_conv_rate\nFloat64\n0\n\n\n\n\n\n\n\n\n\nConversion Rates Aggregated by Audience Group\n\ndf_conv_rates_by_aud = (\n    df_conv_rates[['maudience', 'data_type', 'true_conv_rate', 'pred_conv_rate']].melt(\n        id_vars=['maudience', 'data_type'],\n        value_vars=['true_conv_rate', 'pred_conv_rate'],\n        value_name='value',\n        var_name='var'\n    )\n    .assign(var=lambda df: df['var'].str.replace(\"_conv_rate\", \"\"))\n    .astype(\n        {\n            \"maudience\": pd.StringDtype(),\n            'data_type': pd.StringDtype(),\n            \"var\": pd.StringDtype(),\n            \"value\": pd.Float64Dtype(),  # Float32Dtype\n        }\n    )\n)\ndisplay(df_conv_rates_by_aud)\nsummarize_df(df_conv_rates_by_aud)\n\n\n\n\n\n\n\n\nmaudience\ndata_type\nvar\nvalue\n\n\n\n\n0\nHigh\nDevelopment\ntrue\n2.216602\n\n\n1\nLow\nDevelopment\ntrue\n2.261568\n\n\n2\nMedium\nDevelopment\ntrue\n2.440113\n\n\n3\nHigh\nInference\ntrue\n0.0\n\n\n4\nLow\nInference\ntrue\n0.0\n\n\n5\nMedium\nInference\ntrue\n0.0\n\n\n6\nHigh\nDevelopment\npred\n12.645046\n\n\n7\nLow\nDevelopment\npred\n0.0\n\n\n8\nMedium\nDevelopment\npred\n0.0\n\n\n9\nHigh\nInference\npred\n13.446421\n\n\n10\nLow\nInference\npred\n0.0\n\n\n11\nMedium\nInference\npred\n0.0\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ncolumn\ndtype\nmissing\n\n\n\n\n0\nmaudience\nstring[python]\n0\n\n\n1\ndata_type\nstring[python]\n0\n\n\n2\nvar\nstring[python]\n0\n\n\n3\nvalue\nFloat64\n0\n\n\n\n\n\n\n\n\n\nConversion Rates Aggregated Overall\n\ndf_conv_rates_overall = (\n    df_conv_rates[['data_type', 'overall_true_conv_rate', 'overall_pred_conv_rate', 'data_size']]\n    .groupby(['data_type'], as_index=False).mean()\n    .melt(\n        id_vars=['data_type'],\n        value_vars=['overall_pred_conv_rate', 'overall_true_conv_rate', 'data_size'],\n        value_name='value',\n        var_name='var'\n    )\n    .assign(var=lambda df: df['var'].str.replace(\"_\", \" \").str.title())\n    .astype(\n        {\n            \"data_type\": pd.StringDtype(),\n            \"var\": pd.StringDtype(),\n            \"value\": pd.Float64Dtype(),  # Float32Dtype\n        }\n    )\n    .assign(maudience=None)\n    .astype({\"maudience\": pd.StringDtype()})\n)\ndisplay(df_conv_rates_overall)\nsummarize_df(df_conv_rates_overall)\n\n\n\n\n\n\n\n\ndata_type\nvar\nvalue\nmaudience\n\n\n\n\n0\nDevelopment\nOverall Pred Conv Rate\n4.215433\n&lt;NA&gt;\n\n\n1\nInference\nOverall Pred Conv Rate\n4.482346\n&lt;NA&gt;\n\n\n2\nDevelopment\nOverall True Conv Rate\n2.30609\n&lt;NA&gt;\n\n\n3\nInference\nOverall True Conv Rate\n0.0\n&lt;NA&gt;\n\n\n4\nDevelopment\nData Size\n20164.0\n&lt;NA&gt;\n\n\n5\nInference\nData Size\n21752.0\n&lt;NA&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ncolumn\ndtype\nmissing\n\n\n\n\n0\ndata_type\nstring[python]\n0\n\n\n1\nvar\nstring[python]\n0\n\n\n2\nvalue\nFloat64\n0\n\n\n3\nmaudience\nstring[python]\n6\n\n\n\n\n\n\n\n\n\nCombine Aggregated Conversion Rates\n\ndf_conv_rates_agg_combo = (\n    pd.concat(\n        [df_conv_rates_by_aud, df_conv_rates_overall],\n        ignore_index=True,\n    )\n    .astype({\"value\": pd.Float64Dtype()})\n)\ndisplay(df_conv_rates_agg_combo)\nsummarize_df(df_conv_rates_agg_combo)\n\n\n\n\n\n\n\n\nmaudience\ndata_type\nvar\nvalue\n\n\n\n\n0\nHigh\nDevelopment\ntrue\n2.216602\n\n\n1\nLow\nDevelopment\ntrue\n2.261568\n\n\n2\nMedium\nDevelopment\ntrue\n2.440113\n\n\n3\nHigh\nInference\ntrue\n0.0\n\n\n4\nLow\nInference\ntrue\n0.0\n\n\n5\nMedium\nInference\ntrue\n0.0\n\n\n6\nHigh\nDevelopment\npred\n12.645046\n\n\n7\nLow\nDevelopment\npred\n0.0\n\n\n8\nMedium\nDevelopment\npred\n0.0\n\n\n9\nHigh\nInference\npred\n13.446421\n\n\n10\nLow\nInference\npred\n0.0\n\n\n11\nMedium\nInference\npred\n0.0\n\n\n12\n&lt;NA&gt;\nDevelopment\nOverall Pred Conv Rate\n4.215433\n\n\n13\n&lt;NA&gt;\nInference\nOverall Pred Conv Rate\n4.482346\n\n\n14\n&lt;NA&gt;\nDevelopment\nOverall True Conv Rate\n2.30609\n\n\n15\n&lt;NA&gt;\nInference\nOverall True Conv Rate\n0.0\n\n\n16\n&lt;NA&gt;\nDevelopment\nData Size\n20164.0\n\n\n17\n&lt;NA&gt;\nInference\nData Size\n21752.0\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ncolumn\ndtype\nmissing\n\n\n\n\n0\nmaudience\nstring[python]\n6\n\n\n1\ndata_type\nstring[python]\n0\n\n\n2\nvar\nstring[python]\n0\n\n\n3\nvalue\nFloat64\n0\n\n\n\n\n\n\n\n\n\nEstimated and Actual Cohort to Audience Fractions\n\ndf_sa_frac = (\n    df_sa_frac\n    .assign(infer_month=[None]*6 + [infer_month_frac]*6)\n    .assign(audience_strategy=audience_strategy)\n    .astype(\n        {\n            \"infer_month\": pd.StringDtype(),\n            \"audience_strategy\": pd.Int8Dtype(),\n        }\n    )\n)\ncol = df_sa_frac.pop(\"infer_month\")\ndf_sa_frac.insert(0, col.name, col)\ncol = df_sa_frac.pop(\"audience_strategy\")\ndf_sa_frac.insert(0, col.name, col)\ndisplay(df_sa_frac)\nsummarize_df(df_sa_frac)\n\n\n\n\n\n\n\n\naudience_strategy\ninfer_month\nmaudience\ncohort\nsize\ngroup_size\nuplift\npower\nci_level\nsamp_to_aud_frac\nsize_type\ndata_type\ndata_size\n\n\n\n\n0\n1\n&lt;NA&gt;\nHigh\nTest\n2146\n6721\n10\n55\n55\n31.929772\nrequired\ndevelopment\n20164\n\n\n1\n1\n&lt;NA&gt;\nHigh\nControl\n2146\n6721\n10\n55\n55\n31.929772\nrequired\ndevelopment\n20164\n\n\n2\n1\n&lt;NA&gt;\nMedium\nTest\n1945\n6721\n10\n55\n55\n28.939146\nrequired\ndevelopment\n20164\n\n\n3\n1\n&lt;NA&gt;\nMedium\nControl\n1945\n6721\n10\n55\n55\n28.939146\nrequired\ndevelopment\n20164\n\n\n4\n1\n&lt;NA&gt;\nLow\nTest\n2103\n6722\n10\n55\n55\n31.285332\nrequired\ndevelopment\n20164\n\n\n5\n1\n&lt;NA&gt;\nLow\nControl\n2103\n6722\n10\n55\n55\n31.285332\nrequired\ndevelopment\n20164\n\n\n6\n1\nMarch\nHigh\nControl\n2315\n7251\n10\n55\n55\n31.926631\nrandomly selected\ninference\n21752\n\n\n7\n1\nMarch\nHigh\nTest\n2315\n7251\n10\n55\n55\n31.926631\nrandomly selected\ninference\n21752\n\n\n8\n1\nMarch\nLow\nControl\n2268\n7251\n10\n55\n55\n31.278444\nrandomly selected\ninference\n21752\n\n\n9\n1\nMarch\nLow\nTest\n2268\n7251\n10\n55\n55\n31.278444\nrandomly selected\ninference\n21752\n\n\n10\n1\nMarch\nMedium\nControl\n2098\n7250\n10\n55\n55\n28.937931\nrandomly selected\ninference\n21752\n\n\n11\n1\nMarch\nMedium\nTest\n2098\n7250\n10\n55\n55\n28.937931\nrandomly selected\ninference\n21752\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ncolumn\ndtype\nmissing\n\n\n\n\n0\naudience_strategy\nInt8\n0\n\n\n1\ninfer_month\nstring[python]\n6\n\n\n2\nmaudience\nstring[python]\n0\n\n\n3\ncohort\nstring[python]\n0\n\n\n4\nsize\nInt64\n0\n\n\n5\ngroup_size\nInt64\n0\n\n\n6\nuplift\nInt8\n0\n\n\n7\npower\nInt8\n0\n\n\n8\nci_level\nInt8\n0\n\n\n9\nsamp_to_aud_frac\nFloat64\n0\n\n\n10\nsize_type\nstring[python]\n0\n\n\n11\ndata_type\nstring[python]\n0\n\n\n12\ndata_size\nInt64\n0\n\n\n\n\n\n\n\n\n\n\n\n\n\nNotes\n\n\n\n\nThe accuracy of the predicted propensities are different between the inference and test_split datasets. The model performance is relatively worse on the unseen data (inference) compared to the data seen during development (test_split). Audience groups (bins) are created based on these predicted propensities. So, this ML model inaccuracy can create bins with different sizes between these two datasets. Additionally, if the number of visitors in the inference and test_split datasets are different, then this also contributes to differently sized bins. Both of these factors (inaccuracy and differently sized datasets - see the data_size column) are present here and this explains why the following columns\n\npredicted conversion rate (pred_conv_rate)\ncohort size (size)\ncohort-to-audience fraction (sample_to_audience_frac)\n\nare different between the test split (during ML model development) and inference (during production).\nSimilarly, the predicted (pred_conv_rate) and true (true_conv_rate) conversion rates are for the test split due to the poor accuracy of the ML model’s predictions.\n\n\n\n\n\nML Development Data\n\ndf_development = (\n    df_development\n    .assign(infer_month=None)\n    .drop(columns=['predicted_label'])\n    .assign(maudience=None)\n    .assign(cohort=None)\n    .assign(audience_strategy=None)\n    .astype(\n        {\n            \"infer_month\": pd.StringDtype(),\n            \"maudience\": pd.StringDtype(),\n            \"cohort\": pd.StringDtype(),\n            \"audience_strategy\": pd.Int8Dtype(),\n        }\n    )\n)\ncol = df_development.pop(\"infer_month\")\ndf_development.insert(0, col.name, col)\nwith pd.option_context('display.max_columns', None):\n    display(df_development.head())\nsummarize_df(df_development)\n\n\n\n\n\n\n\n\ninfer_month\nfullvisitorid\nvisitId\nvisitNumber\nvisitStartTime\nquarter\nmonth\nday_of_month\nday_of_week\nhour\nminute\nsecond\nsource\nmedium\nchannelGrouping\nhits\nbounces\nlast_action\npromos_displayed\npromos_clicked\nproduct_views\nproduct_clicks\npageviews\ntime_on_site\nbrowser\nos\ndeviceCategory\nadded_to_cart\nrevenue\nmade_purchase_on_future_visit\nsplit_type\nscore\npredicted_score_label\nmaudience\ncohort\naudience_strategy\n\n\n\n\n0\n&lt;NA&gt;\n4157301099254368232\n1476636342\n1\n2016-10-16 09:45:42\n4\n10\n16\n1\n9\n45\n42\ngoogle\norganic\nOrganic Search\n15\n0\nProduct detail views\n18\n0\n30\n4\n11\n1650\nSafari\nMacintosh\ndesktop\n0\n&lt;NA&gt;\n1\ntrain_val\n0.058666\nTrue\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n\n\n1\n&lt;NA&gt;\n786312091291497372\n1481408395\n1\n2016-12-10 14:19:55\n4\n12\n10\n7\n14\n19\n55\nmall.googleplex.com\nreferral\nReferral\n7\n0\nUnknown\n18\n0\n55\n0\n7\n484\nChrome\nChrome OS\ndesktop\n0\n&lt;NA&gt;\n0\ntrain_val\n0.130899\nTrue\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n\n\n2\n&lt;NA&gt;\n322228537289095245\n1482626483\n1\n2016-12-24 16:41:23\n4\n12\n24\n7\n16\n41\n23\ngoogle\norganic\nOrganic Search\n23\n0\nCompleted purchase\n18\n0\n72\n2\n20\n339\nChrome\nWindows\ndesktop\n1\n52.99\n0\ntrain_val\n0.000751\nTrue\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n\n\n3\n&lt;NA&gt;\n7808115684091011900\n1482430339\n1\n2016-12-22 10:12:19\n4\n12\n22\n5\n10\n12\n19\ngoogle\norganic\nOrganic Search\n1\n1\nUnknown\n9\n0\n0\n0\n1\n0\nChrome\nWindows\ndesktop\n0\n&lt;NA&gt;\n0\ntrain_val\n0.02076\nTrue\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n\n\n4\n&lt;NA&gt;\n9442018438865871704\n1484757590\n1\n2017-01-18 08:39:50\n1\n1\n18\n4\n8\n39\n50\n(direct)\n(none)\nDirect\n3\n0\nUnknown\n9\n0\n10\n0\n3\n12\nChrome\nWindows\ndesktop\n0\n&lt;NA&gt;\n0\ntrain_val\n0.202944\nTrue\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ncolumn\ndtype\nmissing\n\n\n\n\n0\ninfer_month\nstring[python]\n133892\n\n\n1\nfullvisitorid\nstring[python]\n0\n\n\n2\nvisitId\nstring[python]\n0\n\n\n3\nvisitNumber\nInt64\n0\n\n\n4\nvisitStartTime\ndatetime64[ns]\n0\n\n\n5\nquarter\nInt64\n0\n\n\n6\nmonth\nInt64\n0\n\n\n7\nday_of_month\nInt64\n0\n\n\n8\nday_of_week\nInt64\n0\n\n\n9\nhour\nInt64\n0\n\n\n10\nminute\nInt64\n0\n\n\n11\nsecond\nInt64\n0\n\n\n12\nsource\ncategory\n0\n\n\n13\nmedium\ncategory\n0\n\n\n14\nchannelGrouping\ncategory\n0\n\n\n15\nhits\nInt64\n0\n\n\n16\nbounces\nInt64\n0\n\n\n17\nlast_action\ncategory\n0\n\n\n18\npromos_displayed\nInt64\n0\n\n\n19\npromos_clicked\nInt64\n0\n\n\n20\nproduct_views\nInt64\n0\n\n\n21\nproduct_clicks\nInt64\n0\n\n\n22\npageviews\nInt64\n0\n\n\n23\ntime_on_site\nInt64\n0\n\n\n24\nbrowser\ncategory\n0\n\n\n25\nos\ncategory\n0\n\n\n26\ndeviceCategory\ncategory\n0\n\n\n27\nadded_to_cart\nInt64\n0\n\n\n28\nrevenue\nFloat64\n129291\n\n\n29\nmade_purchase_on_future_visit\nInt64\n0\n\n\n30\nsplit_type\ncategory\n0\n\n\n31\nscore\nFloat64\n0\n\n\n32\npredicted_score_label\nboolean\n0\n\n\n33\nmaudience\nstring[python]\n133892\n\n\n34\ncohort\nstring[python]\n133892\n\n\n35\naudience_strategy\nInt8\n133892\n\n\n\n\n\n\n\n\n\nCombine Development and Cohorts Data\n\ndf_dev_cohorts = (\n    pd.concat([df_development[list(df_cohorts)], df_cohorts])\n    .astype(\n        {\n            \"source\": pd.CategoricalDtype(),\n            \"medium\": pd.CategoricalDtype(),\n            \"channelGrouping\": pd.CategoricalDtype(),\n            \"browser\": pd.CategoricalDtype(),\n            \"os\": pd.CategoricalDtype(),\n            \"made_purchase_on_future_visit\": pd.BooleanDtype(),\n            \"split_type\": pd.StringDtype(),\n        }\n    )\n)\nwith pd.option_context('display.max_columns', None):\n    display(df_dev_cohorts.head())\nsummarize_df(df_dev_cohorts)\n\n\n\n\n\n\n\n\ninfer_month\nfullvisitorid\nvisitId\nvisitNumber\nvisitStartTime\nquarter\nmonth\nday_of_month\nday_of_week\nhour\nminute\nsecond\nsource\nmedium\nchannelGrouping\nhits\nbounces\nlast_action\npromos_displayed\npromos_clicked\nproduct_views\nproduct_clicks\npageviews\ntime_on_site\nbrowser\nos\ndeviceCategory\nadded_to_cart\nrevenue\nscore\npredicted_score_label\nmaudience\ncohort\naudience_strategy\nmade_purchase_on_future_visit\nsplit_type\n\n\n\n\n0\n&lt;NA&gt;\n4157301099254368232\n1476636342\n1\n2016-10-16 09:45:42\n4\n10\n16\n1\n9\n45\n42\ngoogle\norganic\nOrganic Search\n15\n0\nProduct detail views\n18\n0\n30\n4\n11\n1650\nSafari\nMacintosh\ndesktop\n0\n&lt;NA&gt;\n0.058666\nTrue\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\nTrue\ntrain_val\n\n\n1\n&lt;NA&gt;\n786312091291497372\n1481408395\n1\n2016-12-10 14:19:55\n4\n12\n10\n7\n14\n19\n55\nmall.googleplex.com\nreferral\nReferral\n7\n0\nUnknown\n18\n0\n55\n0\n7\n484\nChrome\nChrome OS\ndesktop\n0\n&lt;NA&gt;\n0.130899\nTrue\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\nFalse\ntrain_val\n\n\n2\n&lt;NA&gt;\n322228537289095245\n1482626483\n1\n2016-12-24 16:41:23\n4\n12\n24\n7\n16\n41\n23\ngoogle\norganic\nOrganic Search\n23\n0\nCompleted purchase\n18\n0\n72\n2\n20\n339\nChrome\nWindows\ndesktop\n1\n52.99\n0.000751\nTrue\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\nFalse\ntrain_val\n\n\n3\n&lt;NA&gt;\n7808115684091011900\n1482430339\n1\n2016-12-22 10:12:19\n4\n12\n22\n5\n10\n12\n19\ngoogle\norganic\nOrganic Search\n1\n1\nUnknown\n9\n0\n0\n0\n1\n0\nChrome\nWindows\ndesktop\n0\n&lt;NA&gt;\n0.02076\nTrue\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\nFalse\ntrain_val\n\n\n4\n&lt;NA&gt;\n9442018438865871704\n1484757590\n1\n2017-01-18 08:39:50\n1\n1\n18\n4\n8\n39\n50\n(direct)\n(none)\nDirect\n3\n0\nUnknown\n9\n0\n10\n0\n3\n12\nChrome\nWindows\ndesktop\n0\n&lt;NA&gt;\n0.202944\nTrue\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\nFalse\ntrain_val\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ncolumn\ndtype\nmissing\n\n\n\n\n0\ninfer_month\nstring[python]\n133892\n\n\n1\nfullvisitorid\nstring[python]\n0\n\n\n2\nvisitId\nstring[python]\n0\n\n\n3\nvisitNumber\nInt64\n0\n\n\n4\nvisitStartTime\ndatetime64[ns]\n0\n\n\n5\nquarter\nInt64\n0\n\n\n6\nmonth\nInt64\n0\n\n\n7\nday_of_month\nInt64\n0\n\n\n8\nday_of_week\nInt64\n0\n\n\n9\nhour\nInt64\n0\n\n\n10\nminute\nInt64\n0\n\n\n11\nsecond\nInt64\n0\n\n\n12\nsource\ncategory\n0\n\n\n13\nmedium\ncategory\n0\n\n\n14\nchannelGrouping\ncategory\n0\n\n\n15\nhits\nInt64\n0\n\n\n16\nbounces\nInt64\n0\n\n\n17\nlast_action\ncategory\n0\n\n\n18\npromos_displayed\nInt64\n0\n\n\n19\npromos_clicked\nInt64\n0\n\n\n20\nproduct_views\nInt64\n0\n\n\n21\nproduct_clicks\nInt64\n0\n\n\n22\npageviews\nInt64\n0\n\n\n23\ntime_on_site\nInt64\n0\n\n\n24\nbrowser\ncategory\n0\n\n\n25\nos\ncategory\n0\n\n\n26\ndeviceCategory\ncategory\n0\n\n\n27\nadded_to_cart\nInt64\n0\n\n\n28\nrevenue\nFloat64\n150301\n\n\n29\nscore\nFloat64\n0\n\n\n30\npredicted_score_label\nboolean\n0\n\n\n31\nmaudience\nstring[python]\n133892\n\n\n32\ncohort\nstring[python]\n142282\n\n\n33\naudience_strategy\nInt8\n133892\n\n\n34\nmade_purchase_on_future_visit\nboolean\n21752\n\n\n35\nsplit_type\nstring[python]\n0\n\n\n\n\n\n\n\n\n\nDaily Performance Summary in Combined Data, by Audience Group\nGet daily metadata by audience group\n\ndf_aud_hmap = (\n    trh.perform_custom_aggregation(\n        (\n            df_dev_cohorts\n            .sort_values(by=['visitStartTime'], ignore_index=True)\n            .assign(date=lambda df: pd.to_datetime(df['visitStartTime']).dt.date)\n            .assign(maudience=lambda df: df['maudience'].fillna(\"Development\"))\n        ),\n        groupby_cols=['month', 'date', 'maudience'],\n        agg_dict={\n            \"made_purchase_on_future_visit\": [\"sum\"],\n            \"revenue\": \"sum\",\n            \"fullvisitorid\": \"count\",\n            \"added_to_cart\": \"sum\",\n            \"pageviews\": \"sum\",\n            \"time_on_site\": \"mean\",\n            \"product_views\": \"sum\",\n            \"product_clicks\": \"sum\",\n            \"bounces\": \"sum\",\n        },\n        audience_strategy=df_cohorts['audience_strategy'].unique().tolist()[0],\n        column_renamer={\n            \"made_purchase_on_future_visit_sum\": \"return_purchasers\",\n            \"revenue_sum\": \"revenue\",\n            \"added_to_cart_sum\": \"add_to_cart\",\n            \"fullvisitorid_count\": \"visitors\",\n            \"product_views_sum\": \"product_views\",\n            \"product_clicks_sum\": \"product_clicks\",\n            \"pageviews_sum\": \"pageviews\",\n            \"bounces_sum\": \"bounces\",\n            \"time_on_site_mean\": \"time_on_site\",\n        },\n        visitor_type_mapper=dict(\n            zip(\n                ['Development', 'High', 'Medium', 'Low'],\n                ['return_purchasers', 'all_visitors', 'all_visitors', 'all_visitors']\n            )\n        ),\n        dtypes_out={\n            \"month\": pd.StringDtype(),\n            \"date\": pd.StringDtype(),\n            \"maudience\": pd.StringDtype(),\n            \"return_purchasers\": pd.Int16Dtype(),\n            \"revenue\": pd.Float64Dtype(),  # Float32Dtype\n            \"visitors\": pd.Int64Dtype(),  # Int16Dtype\n            \"add_to_cart\": pd.Int64Dtype(),  # Int32Dtype\n            \"pageviews\": pd.Int64Dtype(),  # Int32Dtype\n            \"time_on_site\": pd.Float64Dtype(),  # Float32Dtype\n            \"product_views\": pd.Int64Dtype(),  # Int32Dtype\n            \"product_clicks\": pd.Int64Dtype(),  # Int32Dtype\n            \"bounces\": pd.Int64Dtype(),  # Int32Dtype\n            'audience_strategy': pd.Int8Dtype(),\n            \"bounce_rate\": pd.Float64Dtype(),  # Float32Dtype\n            \"product_clicks_rate\": pd.Float64Dtype(),  # Float32Dtype\n            \"add_to_cart_rate\": pd.Float64Dtype(),  # Float32Dtype\n            \"visitor_type\": pd.StringDtype(),\n        },\n    )\n    .assign(agg_type='audience_group')\n    .astype({\"agg_type\": pd.StringDtype()})\n)\ndisplay(df_aud_hmap.head())\nsummarize_df(df_aud_hmap)\n\n\n\n\n\n\n\n\nmonth\ndate\nmaudience\nreturn_purchasers\nrevenue\nvisitors\nadd_to_cart\npageviews\ntime_on_site\nproduct_views\nproduct_clicks\nbounces\naudience_strategy\nbounce_rate\nproduct_clicks_rate\nadd_to_cart_rate\nvisitor_type\nagg_type\n\n\n\n\n0\nSeptember\n2016-09-01\nDevelopment\n21\n824.71\n718\n180\n4894\n3.087837\n53001\n892\n202\n1\n28.133705\n1.682987\n25.069638\nreturn_purchasers\naudience_group\n\n\n1\nSeptember\n2016-09-02\nDevelopment\n16\n1087.58\n637\n125\n4314\n3.171245\n49597\n817\n193\n1\n30.298273\n1.647277\n19.623234\nreturn_purchasers\naudience_group\n\n\n2\nSeptember\n2016-09-03\nDevelopment\n3\n514.88\n386\n80\n2349\n2.391839\n25702\n466\n124\n1\n32.124352\n1.813088\n20.725389\nreturn_purchasers\naudience_group\n\n\n3\nSeptember\n2016-09-04\nDevelopment\n7\n163.35\n350\n66\n2145\n2.963476\n25647\n356\n114\n1\n32.571429\n1.388077\n18.857143\nreturn_purchasers\naudience_group\n\n\n4\nSeptember\n2016-09-05\nDevelopment\n11\n483.38\n469\n89\n3034\n3.292111\n36007\n563\n167\n1\n35.607676\n1.563585\n18.976546\nreturn_purchasers\naudience_group\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ncolumn\ndtype\nmissing\n\n\n\n\n0\nmonth\nstring[python]\n0\n\n\n1\ndate\nstring[python]\n0\n\n\n2\nmaudience\nstring[python]\n0\n\n\n3\nreturn_purchasers\nInt16\n0\n\n\n4\nrevenue\nFloat64\n0\n\n\n5\nvisitors\nInt64\n0\n\n\n6\nadd_to_cart\nInt64\n0\n\n\n7\npageviews\nInt64\n0\n\n\n8\ntime_on_site\nFloat64\n0\n\n\n9\nproduct_views\nInt64\n0\n\n\n10\nproduct_clicks\nInt64\n0\n\n\n11\nbounces\nInt64\n0\n\n\n12\naudience_strategy\nInt8\n0\n\n\n13\nbounce_rate\nFloat64\n0\n\n\n14\nproduct_clicks_rate\nFloat64\n0\n\n\n15\nadd_to_cart_rate\nFloat64\n0\n\n\n16\nvisitor_type\nstring[python]\n0\n\n\n17\nagg_type\nstring[python]\n0\n\n\n\n\n\n\n\n\n\nDaily Performance Summary in Overall Combined Data\nGet daily metadata overall\n\n\n\n\n\n\n\n\n\nmonth\ndate\nreturn_purchasers\nrevenue\nvisitors\nadd_to_cart\npageviews\ntime_on_site\nproduct_views\nproduct_clicks\nbounces\naudience_strategy\nbounce_rate\nproduct_clicks_rate\nadd_to_cart_rate\nvisitor_type\nagg_type\nmaudience\n\n\n\n\n0\nSeptember\n2016-09-01\n21\n824.71\n718\n180\n4894\n3.087837\n53001\n892\n202\n1\n28.133705\n1.682987\n25.069638\nreturn_purchasers\noverall\nDevelopment\n\n\n1\nSeptember\n2016-09-02\n16\n1087.58\n637\n125\n4314\n3.171245\n49597\n817\n193\n1\n30.298273\n1.647277\n19.623234\nreturn_purchasers\noverall\nDevelopment\n\n\n2\nSeptember\n2016-09-03\n3\n514.88\n386\n80\n2349\n2.391839\n25702\n466\n124\n1\n32.124352\n1.813088\n20.725389\nreturn_purchasers\noverall\nDevelopment\n\n\n3\nSeptember\n2016-09-04\n7\n163.35\n350\n66\n2145\n2.963476\n25647\n356\n114\n1\n32.571429\n1.388077\n18.857143\nreturn_purchasers\noverall\nDevelopment\n\n\n4\nSeptember\n2016-09-05\n11\n483.38\n469\n89\n3034\n3.292111\n36007\n563\n167\n1\n35.607676\n1.563585\n18.976546\nreturn_purchasers\noverall\nDevelopment\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ncolumn\ndtype\nmissing\n\n\n\n\n0\nmonth\nstring[python]\n0\n\n\n1\ndate\nstring[python]\n0\n\n\n2\nreturn_purchasers\nInt64\n0\n\n\n3\nrevenue\nFloat64\n0\n\n\n4\nvisitors\nInt64\n0\n\n\n5\nadd_to_cart\nInt64\n0\n\n\n6\npageviews\nInt64\n0\n\n\n7\ntime_on_site\nFloat64\n0\n\n\n8\nproduct_views\nInt64\n0\n\n\n9\nproduct_clicks\nInt64\n0\n\n\n10\nbounces\nInt64\n0\n\n\n11\naudience_strategy\nInt8\n0\n\n\n12\nbounce_rate\nFloat64\n0\n\n\n13\nproduct_clicks_rate\nFloat64\n0\n\n\n14\nadd_to_cart_rate\nFloat64\n0\n\n\n15\nvisitor_type\nstring[python]\n0\n\n\n16\nagg_type\nstring[python]\n0\n\n\n17\nmaudience\nstring[python]\n0\n\n\n\n\n\n\n\n\n\nCombined Daily Performance Summary\n\ndf_hmap_combo = (\n    pd.concat([df_aud_hmap, df_hmap], ignore_index=True)\n    .astype(\n        {\n            \"month\": pd.StringDtype(),\n            \"date\": pd.StringDtype(),\n            \"return_purchasers\": pd.Int64Dtype(),\n            \"revenue\": pd.Float64Dtype(),\n            \"visitors\": pd.Int64Dtype(),\n            \"add_to_cart\": pd.Int64Dtype(),\n            \"pageviews\": pd.Int64Dtype(),\n            \"time_on_site\": pd.Float64Dtype(),\n            \"product_views\": pd.Int64Dtype(),\n            \"product_clicks\": pd.Int64Dtype(),\n            \"bounces\": pd.Int64Dtype(),\n            'audience_strategy': pd.Int8Dtype(),\n            \"bounce_rate\": pd.Float64Dtype(),\n            \"product_clicks_rate\": pd.Float64Dtype(),\n            \"add_to_cart_rate\": pd.Float64Dtype(),\n            \"visitor_type\": pd.StringDtype(),\n        }\n    )\n)\ndisplay(df_hmap_combo.head())\nsummarize_df(df_hmap_combo)\n\n\n\n\n\n\n\n\nmonth\ndate\nmaudience\nreturn_purchasers\nrevenue\nvisitors\nadd_to_cart\npageviews\ntime_on_site\nproduct_views\nproduct_clicks\nbounces\naudience_strategy\nbounce_rate\nproduct_clicks_rate\nadd_to_cart_rate\nvisitor_type\nagg_type\n\n\n\n\n0\nSeptember\n2016-09-01\nDevelopment\n21\n824.71\n718\n180\n4894\n3.087837\n53001\n892\n202\n1\n28.133705\n1.682987\n25.069638\nreturn_purchasers\naudience_group\n\n\n1\nSeptember\n2016-09-02\nDevelopment\n16\n1087.58\n637\n125\n4314\n3.171245\n49597\n817\n193\n1\n30.298273\n1.647277\n19.623234\nreturn_purchasers\naudience_group\n\n\n2\nSeptember\n2016-09-03\nDevelopment\n3\n514.88\n386\n80\n2349\n2.391839\n25702\n466\n124\n1\n32.124352\n1.813088\n20.725389\nreturn_purchasers\naudience_group\n\n\n3\nSeptember\n2016-09-04\nDevelopment\n7\n163.35\n350\n66\n2145\n2.963476\n25647\n356\n114\n1\n32.571429\n1.388077\n18.857143\nreturn_purchasers\naudience_group\n\n\n4\nSeptember\n2016-09-05\nDevelopment\n11\n483.38\n469\n89\n3034\n3.292111\n36007\n563\n167\n1\n35.607676\n1.563585\n18.976546\nreturn_purchasers\naudience_group\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ncolumn\ndtype\nmissing\n\n\n\n\n0\nmonth\nstring[python]\n0\n\n\n1\ndate\nstring[python]\n0\n\n\n2\nmaudience\nstring[python]\n0\n\n\n3\nreturn_purchasers\nInt64\n0\n\n\n4\nrevenue\nFloat64\n0\n\n\n5\nvisitors\nInt64\n0\n\n\n6\nadd_to_cart\nInt64\n0\n\n\n7\npageviews\nInt64\n0\n\n\n8\ntime_on_site\nFloat64\n0\n\n\n9\nproduct_views\nInt64\n0\n\n\n10\nproduct_clicks\nInt64\n0\n\n\n11\nbounces\nInt64\n0\n\n\n12\naudience_strategy\nInt8\n0\n\n\n13\nbounce_rate\nFloat64\n0\n\n\n14\nproduct_clicks_rate\nFloat64\n0\n\n\n15\nadd_to_cart_rate\nFloat64\n0\n\n\n16\nvisitor_type\nstring[python]\n0\n\n\n17\nagg_type\nstring[python]\n0\n\n\n\n\n\n\n\n\n\nMonthly Performance Summary in Combined Data\nGet aggregated summary of metadata by month\n\n\n\n\n\n\n\n\n\nmonth\nsplit_type\nreturn_purchasers\nrevenue\nvisitors\npageviews\ntime_on_site\nchannelGrouping\ndeviceCategory\nbrowser\nos\naudience_strategy\nbounce_rate\nproduct_clicks_rate\nadd_to_cart_rate\nvisitor_type\nconversion_rate\nvisitors_pct_change\nrevenue_pct_change\npageviews_pct_change\ntime_on_site_pct_change\nbounce_rate_pct_change\nconversion_rate_pct_change\nproduct_clicks_rate_pct_change\nadd_to_cart_rate_pct_change\nvisitors_pct_change_gt_0\nrevenue_pct_change_gt_0\npageviews_pct_change_gt_0\ntime_on_site_pct_change_gt_0\nbounce_rate_pct_change_gt_0\nconversion_rate_pct_change_gt_0\nproduct_clicks_rate_pct_change_gt_0\nadd_to_cart_rate_pct_change_gt_0\n\n\n\n\n0\n9\nTrain+Val\n516\n25347.17\n18610\n122037\n3.154803\nOrganic Search\ndesktop\nChrome\nWindows\n1\n30.209565\n1.754861\n20.45137\nreturn_purchasers\n2.772703\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\nFalse\nFalse\nFalse\nFalse\nFalse\nFalse\nFalse\nFalse\n\n\n1\n10\nTrain+Val\n743\n57900.07\n22605\n137768\n3.191469\nOrganic Search\ndesktop\nChrome\nMacintosh\n1\n30.67463\n2.976927\n18.279142\nreturn_purchasers\n3.286883\n21.466953\n128.428144\n12.890353\n1.162219\n1.539462\n18.544381\n69.638951\n-10.621432\nTrue\nTrue\nTrue\nTrue\nTrue\nTrue\nTrue\nFalse\n\n\n2\n11\nTrain+Val\n1651\n212099.94\n24400\n162373\n3.521508\nOrganic Search\ndesktop\nChrome\nMacintosh\n1\n27.090164\n3.284716\n25.229508\nreturn_purchasers\n6.766393\n7.940721\n266.320697\n17.859735\n10.341304\n-11.68544\n105.860463\n10.33912\n38.023483\nTrue\nTrue\nTrue\nTrue\nFalse\nTrue\nTrue\nTrue\n\n\n3\n12\nTrain+Val\n1340\n188699.98\n26936\n168889\n3.386728\nOrganic Search\ndesktop\nChrome\nMacintosh\n1\n29.284229\n3.131886\n23.492723\nreturn_purchasers\n4.974755\n10.393443\n-11.032516\n4.012982\n-3.827331\n8.099122\n-26.478485\n-4.652734\n-6.883942\nTrue\nFalse\nTrue\nFalse\nTrue\nFalse\nFalse\nFalse\n\n\n4\n1\nTrain+Val\n722\n149074.1\n21177\n125412\n3.241019\nOrganic Search\ndesktop\nChrome\nMacintosh\n1\n33.026397\n3.097427\n20.866978\nreturn_purchasers\n3.409359\n-21.380309\n-20.999409\n-25.742944\n-4.302378\n12.77878\n-31.466791\n-1.100268\n-11.176844\nFalse\nFalse\nFalse\nFalse\nTrue\nFalse\nFalse\nFalse\n\n\n5\n2\nTest\n465\n111202.47\n20164\n106500\n2.981056\nOrganic Search\ndesktop\nChrome\nMacintosh\n1\n35.231105\n2.697265\n18.964491\nreturn_purchasers\n2.30609\n-4.783492\n-25.404567\n-15.079897\n-8.021009\n6.675595\n-32.360015\n-12.919185\n-9.117214\nFalse\nFalse\nFalse\nFalse\nTrue\nFalse\nFalse\nFalse\n\n\n6\n3\nInfer\n&lt;NA&gt;\n136287.37\n21752\n117334\n3.199143\nOrganic Search\ndesktop\nChrome\nMacintosh\n1\n33.357852\n2.918338\n19.657962\nall_visitors\n&lt;NA&gt;\n7.875422\n22.557862\n10.17277\n7.31577\n-5.317042\n0.0\n8.196182\n3.656683\nTrue\nTrue\nTrue\nTrue\nFalse\nFalse\nTrue\nTrue\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ncolumn\ndtype\nmissing\n\n\n\n\n0\nmonth\nInt8\n0\n\n\n1\nsplit_type\nstring[python]\n0\n\n\n2\nreturn_purchasers\nInt64\n1\n\n\n3\nrevenue\nFloat64\n0\n\n\n4\nvisitors\nInt64\n0\n\n\n5\npageviews\nInt64\n0\n\n\n6\ntime_on_site\nFloat64\n0\n\n\n7\nchannelGrouping\nstring[python]\n0\n\n\n8\ndeviceCategory\nstring[python]\n0\n\n\n9\nbrowser\nstring[python]\n0\n\n\n10\nos\nstring[python]\n0\n\n\n11\naudience_strategy\nInt8\n0\n\n\n12\nbounce_rate\nFloat64\n0\n\n\n13\nproduct_clicks_rate\nFloat64\n0\n\n\n14\nadd_to_cart_rate\nFloat64\n0\n\n\n15\nvisitor_type\nstring[python]\n0\n\n\n16\nconversion_rate\nFloat64\n1\n\n\n17\nvisitors_pct_change\nFloat64\n1\n\n\n18\nrevenue_pct_change\nFloat64\n1\n\n\n19\npageviews_pct_change\nFloat64\n1\n\n\n20\ntime_on_site_pct_change\nFloat64\n1\n\n\n21\nbounce_rate_pct_change\nFloat64\n1\n\n\n22\nconversion_rate_pct_change\nFloat64\n1\n\n\n23\nproduct_clicks_rate_pct_change\nFloat64\n1\n\n\n24\nadd_to_cart_rate_pct_change\nFloat64\n1\n\n\n25\nvisitors_pct_change_gt_0\nboolean\n0\n\n\n26\nrevenue_pct_change_gt_0\nboolean\n0\n\n\n27\npageviews_pct_change_gt_0\nboolean\n0\n\n\n28\ntime_on_site_pct_change_gt_0\nboolean\n0\n\n\n29\nbounce_rate_pct_change_gt_0\nboolean\n0\n\n\n30\nconversion_rate_pct_change_gt_0\nboolean\n0\n\n\n31\nproduct_clicks_rate_pct_change_gt_0\nboolean\n0\n\n\n32\nadd_to_cart_rate_pct_change_gt_0\nboolean\n0\n\n\n\n\n\n\n\n\n\nCategorical Feature KPIs\n\n\n\n\n\n\n\n\n\nfeature_name\nfeature_category\nvariable\nvalue\naudience_strategy\nhistorical_data_month\nhistorical_data_size\n\n\n\n\n0\nlast_action\nCheck out\nCTR\n4.867909\n1\nFebruary\n20164\n\n\n1\nlast_action\nRemove product(s) from cart\nCTR\n4.826653\n1\nFebruary\n20164\n\n\n2\nlast_action\nAdd product(s) to cart\nCTR\n4.909087\n1\nFebruary\n20164\n\n\n3\nlast_action\nCompleted purchase\nCTR\n5.215002\n1\nFebruary\n20164\n\n\n4\nlast_action\nProduct detail views\nCTR\n5.382033\n1\nFebruary\n20164\n\n\n5\nlast_action\nUnknown\nCTR\n0.0\n1\nFebruary\n20164\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ncolumn\ndtype\nmissing\n\n\n\n\n0\nfeature_name\nstring[python]\n0\n\n\n1\nfeature_category\nstring[python]\n0\n\n\n2\nvariable\nstring[python]\n0\n\n\n3\nvalue\nFloat64\n0\n\n\n4\naudience_strategy\nInt8\n0\n\n\n5\nhistorical_data_month\nstring[python]\n0\n\n\n6\nhistorical_data_size\nInt64\n0\n\n\n\n\n\n\n\n\n\n\n\n\n\n\naudience_strategy\nhistorical_data_month\nhistorical_data_size\nfeature_name\nfeature_category\nvalue\n\n\nvariable\n\n\n\n\n\nCTR\nConversion Rate\n\n\n\n\n0\n1\nFebruary\n20164\nbrowser\nChrome\n2.877059\n3.009088\n\n\n1\n1\nFebruary\n20164\nbrowser\nSafari\n2.06649\n0.351256\n\n\n2\n1\nFebruary\n20164\nbrowser\nother\n2.301302\n0.310945\n\n\n3\n1\nFebruary\n20164\nchannelGrouping\nAffiliates\n1.399795\n0.34965\n\n\n4\n1\nFebruary\n20164\nchannelGrouping\nDirect\n3.602659\n3.855422\n\n\n5\n1\nFebruary\n20164\nchannelGrouping\nDisplay\n2.531646\n4.62963\n\n\n6\n1\nFebruary\n20164\nchannelGrouping\nOrganic Search\n2.345162\n0.826806\n\n\n7\n1\nFebruary\n20164\nchannelGrouping\nPaid Search\n2.604474\n0.420168\n\n\n8\n1\nFebruary\n20164\nchannelGrouping\nReferral\n3.109836\n6.850829\n\n\n9\n1\nFebruary\n20164\nchannelGrouping\nSocial\n2.114267\n0.0\n\n\n10\n1\nFebruary\n20164\ndeviceCategory\ndesktop\n3.006461\n3.186766\n\n\n11\n1\nFebruary\n20164\ndeviceCategory\nmobile\n1.894861\n0.333519\n\n\n12\n1\nFebruary\n20164\ndeviceCategory\ntablet\n1.726674\n0.249066\n\n\n13\n1\nFebruary\n20164\nlast_action\nAdd product(s) to cart\n4.909087\n12.057416\n\n\n14\n1\nFebruary\n20164\nlast_action\nCheck out\n4.867909\n20.19544\n\n\n15\n1\nFebruary\n20164\nlast_action\nClick through of product lists\n0.961538\n0.0\n\n\n16\n1\nFebruary\n20164\nlast_action\nCompleted purchase\n5.215002\n5.597579\n\n\n17\n1\nFebruary\n20164\nlast_action\nProduct detail views\n5.382033\n3.476946\n\n\n18\n1\nFebruary\n20164\nlast_action\nRemove product(s) from cart\n4.826653\n16.0\n\n\n19\n1\nFebruary\n20164\nlast_action\nUnknown\n0.0\n0.807607\n\n\n20\n1\nFebruary\n20164\nmedium\n(none)\n3.602659\n3.855422\n\n\n21\n1\nFebruary\n20164\nmedium\naffiliate\n1.399795\n0.34965\n\n\n22\n1\nFebruary\n20164\nmedium\ncpc\n2.604474\n0.420168\n\n\n23\n1\nFebruary\n20164\nmedium\ncpm\n2.531646\n4.62963\n\n\n24\n1\nFebruary\n20164\nmedium\norganic\n2.345162\n0.826806\n\n\n25\n1\nFebruary\n20164\nmedium\nreferral\n2.872402\n4.219601\n\n\n26\n1\nFebruary\n20164\nos\n(not set)\n0.0\n0.0\n\n\n27\n1\nFebruary\n20164\nos\nAndroid\n1.999182\n0.478998\n\n\n28\n1\nFebruary\n20164\nos\nChrome OS\n3.037461\n2.797834\n\n\n29\n1\nFebruary\n20164\nos\nFirefox OS\n0.0\n0.0\n\n\n30\n1\nFebruary\n20164\nos\nLinux\n3.64461\n3.091873\n\n\n31\n1\nFebruary\n20164\nos\nMacintosh\n3.307351\n4.969716\n\n\n32\n1\nFebruary\n20164\nos\nNintendo Wii\n0.0\n0.0\n\n\n33\n1\nFebruary\n20164\nos\nWindows\n2.517362\n1.111111\n\n\n34\n1\nFebruary\n20164\nos\niOS\n1.766737\n0.202781\n\n\n35\n1\nFebruary\n20164\nsource\n(direct)\n3.602659\n3.855422\n\n\n36\n1\nFebruary\n20164\nsource\ngoogle\n2.368136\n0.778286\n\n\n37\n1\nFebruary\n20164\nsource\nother\n2.807983\n3.93476\n\n\n\n\n\n\n\n\n\nAudience Sample (Cohort) Size Requirements and Metrics"
  },
  {
    "objectID": "notebooks/04-upload/notebooks/09_upload.html#upload-to-bigquery-tables",
    "href": "notebooks/04-upload/notebooks/09_upload.html#upload-to-bigquery-tables",
    "title": "Upload Audience Data to BigQuery",
    "section": "Upload to BigQuery Tables",
    "text": "Upload to BigQuery Tables\n\nAudience Feature Importances\nDefine BigQuery Table Schema\n\njob_config_feats_imp = bigquery.LoadJobConfig(\n    schema=[\n        bigquery.SchemaField(\"audience_strategy\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"num_observations\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"stat\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"maudience\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"value\", \"FLOAT64\", mode='NULLABLE'),\n    ]\n)\njob_config_feats_imp.write_disposition = 'WRITE_APPEND'\n\nCreate BigQuery table (if it does not exist) and populate\n\nbquh.create_bq_table(gbq_table_fully_resolved_feats_imp, client)\nbquh.append_df_to_bq_table(\n    df_feats, job_config_feats_imp, gbq_table_fully_resolved_feats_imp, client\n)\n\n\n\nAudience Profile\n\njob_config_profiles = bigquery.LoadJobConfig(\n    schema=[\n        bigquery.SchemaField(\"Audience_Strategy\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"Stat_Expanded\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"High\", \"FLOAT64\", mode='NULLABLE'),\n        bigquery.SchemaField(\"Medium\", \"FLOAT64\", mode='NULLABLE'),\n        bigquery.SchemaField(\"Low\", \"FLOAT64\", mode='NULLABLE'),\n    ]\n)\njob_config_profiles.write_disposition = 'WRITE_APPEND'\n\n\nbquh.create_bq_table(gbq_table_fully_resolved_profiles, client)\nbquh.append_df_to_bq_table(\n    df_profile_sliced, job_config_profiles, gbq_table_fully_resolved_profiles, client\n)\n\n\n\nAudience Cohorts\n\njob_config_cohorts = bigquery.LoadJobConfig(\n    schema=[\n        bigquery.SchemaField(\"infer_month\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"fullvisitorid\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"visitId\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"visitNumber\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"visitStartTime\", \"DATETIME\", mode='NULLABLE'),\n        bigquery.SchemaField(\"quarter\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"month\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"day_of_month\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"day_of_week\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"hour\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"minute\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"second\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"source\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"medium\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"channelGrouping\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"hits\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"bounces\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"last_action\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"promos_displayed\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"promos_clicked\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"product_views\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"product_clicks\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"pageviews\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"time_on_site\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"browser\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"os\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"deviceCategory\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"added_to_cart\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"revenue\", \"FLOAT64\", mode='NULLABLE'),\n        bigquery.SchemaField(\"score\", \"FLOAT64\", mode='NULLABLE'),\n        bigquery.SchemaField(\"predicted_score_label\", \"BOOLEAN\", mode='NULLABLE'),\n        bigquery.SchemaField(\"maudience\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"cohort\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"audience_strategy\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"made_purchase_on_future_visit\", \"BOOLEAN\", mode='NULLABLE'),\n        bigquery.SchemaField(\"split_type\", \"STRING\", mode='NULLABLE'),\n    ]\n)\njob_config_cohorts.write_disposition = 'WRITE_APPEND'\n\n\nbquh.create_bq_table(gbq_table_fully_resolved_cohorts, client)\nbquh.append_df_to_bq_table(\n    df_dev_cohorts, job_config_cohorts, gbq_table_fully_resolved_cohorts, client\n)\n\n\n\nMonthly Performance Summary\n\njob_config_summary = bigquery.LoadJobConfig(\n    schema=[\n        bigquery.SchemaField(\"month\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"split_type\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"return_purchasers\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"revenue\", \"FLOAT64\", mode='NULLABLE'),\n        bigquery.SchemaField(\"visitors\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"pageviews\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"time_on_site\", \"FLOAT64\", mode='NULLABLE'),\n        bigquery.SchemaField(\"channelGrouping\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"deviceCategory\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"browser\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"os\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"audience_strategy\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"bounce_rate\", \"FLOAT64\", mode='NULLABLE'),\n        bigquery.SchemaField(\"product_clicks_rate\", \"FLOAT64\", mode='NULLABLE'),\n        bigquery.SchemaField(\"add_to_cart_rate\", \"FLOAT64\", mode='NULLABLE'),\n        bigquery.SchemaField(\"visitor_type\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"conversion_rate\", \"FLOAT64\", mode='NULLABLE'),\n        bigquery.SchemaField(\"visitors_pct_change\", \"FLOAT64\", mode='NULLABLE'),\n        bigquery.SchemaField(\"revenue_pct_change\", \"FLOAT64\", mode='NULLABLE'),\n        bigquery.SchemaField(\"pageviews_pct_change\", \"FLOAT64\", mode='NULLABLE'),\n        bigquery.SchemaField(\"time_on_site_pct_change\", \"FLOAT64\", mode='NULLABLE'),\n        bigquery.SchemaField(\"bounce_rate_pct_change\", \"FLOAT64\", mode='NULLABLE'),\n        bigquery.SchemaField(\"conversion_rate_pct_change\", \"FLOAT64\", mode='NULLABLE'),\n        bigquery.SchemaField(\"product_clicks_rate_pct_change\", \"FLOAT64\", mode='NULLABLE'),\n        bigquery.SchemaField(\"add_to_cart_rate_pct_change\", \"FLOAT64\", mode='NULLABLE'),\n        bigquery.SchemaField(\"visitors_pct_change_gt_0\", \"BOOLEAN\", mode='REQUIRED'),\n        bigquery.SchemaField(\"revenue_pct_change_gt_0\", \"BOOLEAN\", mode='REQUIRED'),\n        bigquery.SchemaField(\"pageviews_pct_change_gt_0\", \"BOOLEAN\", mode='REQUIRED'),\n        bigquery.SchemaField(\"time_on_site_pct_change_gt_0\", \"BOOLEAN\", mode='REQUIRED'),\n        bigquery.SchemaField(\"bounce_rate_pct_change_gt_0\", \"BOOLEAN\", mode='REQUIRED'),\n        bigquery.SchemaField(\"conversion_rate_pct_change_gt_0\", \"BOOLEAN\", mode='REQUIRED'),\n        bigquery.SchemaField(\"product_clicks_rate_pct_change_gt_0\", \"BOOLEAN\", mode='REQUIRED'),\n        bigquery.SchemaField(\"add_to_cart_rate_pct_change_gt_0\", \"BOOLEAN\", mode='REQUIRED'),\n    ]\n)\njob_config_summary.write_disposition = 'WRITE_APPEND'\n\n\nbquh.create_bq_table(gbq_summary_table_id_fully_resolved, client)\nbquh.append_df_to_bq_table(\n    df_summary, job_config_summary, gbq_summary_table_id_fully_resolved, client\n)\n\n\n\nConversion Rates in Development and Inference\n\njob_config_conv_rates = bigquery.LoadJobConfig(\n    schema=[\n        bigquery.SchemaField(\"audience_strategy\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"infer_month\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"maudience\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"pred_conversions\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"total_visitors\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"min_score\", \"FLOAT64\", mode='NULLABLE'),\n        bigquery.SchemaField(\"true_conversions\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"data_type\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"data_size\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"true_conv_rate\", \"FLOAT64\", mode='NULLABLE'),\n        bigquery.SchemaField(\"overall_true_conv_rate\", \"FLOAT64\", mode='NULLABLE'),\n        bigquery.SchemaField(\"pred_conv_rate\", \"FLOAT64\", mode='NULLABLE'),\n        bigquery.SchemaField(\"overall_pred_conv_rate\", \"FLOAT64\", mode='NULLABLE'),\n    ]\n)\njob_config_conv_rates.write_disposition = 'WRITE_APPEND'\n\n\nbquh.create_bq_table(gbq_conv_rates_table_id_fully_resolved, client)\nbquh.append_df_to_bq_table(\n    df_conv_rates, job_config_conv_rates, gbq_conv_rates_table_id_fully_resolved, client\n)\n\n\n\nEstimated and Actual Cohort to Audience Fractions\n\njob_config_sa_frac = bigquery.LoadJobConfig(\n    schema=[\n        bigquery.SchemaField(\"audience_strategy\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"infer_month\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"maudience\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"cohort\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"size\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"group_size\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"uplift\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"power\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"ci_level\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"samp_to_aud_frac\", \"FLOAT64\", mode='NULLABLE'),\n        bigquery.SchemaField(\"size_type\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"data_type\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"data_size\", \"INTEGER\", mode='NULLABLE'),\n    ]\n)\njob_config_sa_frac.write_disposition = 'WRITE_APPEND'\n\n\nbquh.create_bq_table(gbq_sa_fracs_table_id_fully_resolved, client)\nbquh.append_df_to_bq_table(\n    df_sa_frac, job_config_sa_frac, gbq_sa_fracs_table_id_fully_resolved, client\n)\n\n\n\nAggregated Conversion Rates\n\njob_config_conv_rates_combo = bigquery.LoadJobConfig(\n    schema=[\n        bigquery.SchemaField(\"maudience\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"data_type\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"var\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"value\", \"FLOAT64\", mode='NULLABLE'),\n    ]\n)\njob_config_conv_rates_combo.write_disposition = 'WRITE_APPEND'\n\n\nbquh.create_bq_table(gbq_conv_rates_combo_table_id_fully_resolved, client)\nbquh.append_df_to_bq_table(\n    df_conv_rates_agg_combo,\n    job_config_conv_rates_combo,\n    gbq_conv_rates_combo_table_id_fully_resolved,\n    client\n)\n\n\n\nDaily Performance Summary\n\njob_config_daily_perf_combo = bigquery.LoadJobConfig(\n    schema=[\n        bigquery.SchemaField(\"month\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"date\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"maudience\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"return_purchasers\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"revenue\", \"FLOAT64\", mode='NULLABLE'),\n        bigquery.SchemaField(\"visitors\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"add_to_cart\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"pageviews\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"time_on_site\", \"FLOAT64\", mode='NULLABLE'),\n        bigquery.SchemaField(\"product_views\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"product_clicks\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"bounces\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"audience_strategy\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"bounce_rate\", \"FLOAT64\", mode='NULLABLE'),\n        bigquery.SchemaField(\"product_clicks_rate\", \"FLOAT64\", mode='NULLABLE'),\n        bigquery.SchemaField(\"add_to_cart_rate\", \"FLOAT64\", mode='NULLABLE'),\n        bigquery.SchemaField(\"visitor_type\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"agg_type\", \"STRING\", mode='NULLABLE'),\n    ]\n)\njob_config_daily_perf_combo.write_disposition = 'WRITE_APPEND'\n\n\nbquh.create_bq_table(gbq_daily_perf_combo_table_id_fully_resolved, client)\nbquh.append_df_to_bq_table(\n    df_hmap_combo,\n    job_config_daily_perf_combo,\n    gbq_daily_perf_combo_table_id_fully_resolved,\n    client\n)\n\n\n\nCategorical Feature KPIs\n\njob_config_cat_feats_kpis = bigquery.LoadJobConfig(\n    schema=[\n        bigquery.SchemaField(\"feature_name\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"feature_category\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"variable\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"value\", \"FLOAT64\", mode='NULLABLE'),\n        bigquery.SchemaField(\"audience_strategy\", \"INTEGER\", mode='NULLABLE'),\n        bigquery.SchemaField(\"historical_data_month\", \"STRING\", mode='NULLABLE'),\n        bigquery.SchemaField(\"historical_data_size\", \"INTEGER\", mode='NULLABLE'),\n    ]\n)\njob_config_cat_feats_kpis.write_disposition = 'WRITE_APPEND'\n\n\nbquh.create_bq_table(gbq_table_fully_resolved_cat_feat_kpis, client)\nbquh.append_df_to_bq_table(\n    df_development_agg,\n    job_config_cat_feats_kpis,\n    gbq_table_fully_resolved_cat_feat_kpis,\n    client,\n)"
  },
  {
    "objectID": "notebooks/04-upload/notebooks/09_upload.html#next-step",
    "href": "notebooks/04-upload/notebooks/09_upload.html#next-step",
    "title": "Upload Audience Data to BigQuery",
    "section": "Next Step",
    "text": "Next Step\nThe next step will be to create summary charts for an end-user using the contents of these two newly created audience tables."
  },
  {
    "objectID": "notebooks/05-dash/notebooks/10_dash.html",
    "href": "notebooks/05-dash/notebooks/10_dash.html",
    "title": "Create Dashboard Charts and Tables",
    "section": "",
    "text": "This step will create charts and tables to be displayed as part of the dashboard to summarize the audience group(s) for the marketing campaign.\n\n\n\nThe dashboard will be used by the business user (marketing team) to design the campaign so it must show all first-time visitors to the store during the inference period and the ML model’s prediction of their propensity to make a purchase during a return visit to the store.\nThe dashboard will also show the following\n\nmost important features for predicting the propensity, separately for each audience group\nsummary of visit attributes (for first-time visitors) during the inference period and, in order to provide some context, a month-over-month comparison of these attributes starting from the first month of Google Analytics tracking data used during ML model development\n\n\n\n\nThis step can be run prospectively at the end of the inference period, just before the start of the campaign, when all the inference data (first-time visitors to the store) becomes available. This step cab be run after the following BigQuery tables have been created\n\naudience_cohorts\naudience_profiles\nmonthly_summary\n\nThese tables were uploaded to BigQuery in the previous step."
  },
  {
    "objectID": "notebooks/05-dash/notebooks/10_dash.html#about",
    "href": "notebooks/05-dash/notebooks/10_dash.html#about",
    "title": "Create Dashboard Charts and Tables",
    "section": "",
    "text": "This step will create charts and tables to be displayed as part of the dashboard to summarize the audience group(s) for the marketing campaign.\n\n\n\nThe dashboard will be used by the business user (marketing team) to design the campaign so it must show all first-time visitors to the store during the inference period and the ML model’s prediction of their propensity to make a purchase during a return visit to the store.\nThe dashboard will also show the following\n\nmost important features for predicting the propensity, separately for each audience group\nsummary of visit attributes (for first-time visitors) during the inference period and, in order to provide some context, a month-over-month comparison of these attributes starting from the first month of Google Analytics tracking data used during ML model development\n\n\n\n\nThis step can be run prospectively at the end of the inference period, just before the start of the campaign, when all the inference data (first-time visitors to the store) becomes available. This step cab be run after the following BigQuery tables have been created\n\naudience_cohorts\naudience_profiles\nmonthly_summary\n\nThese tables were uploaded to BigQuery in the previous step."
  },
  {
    "objectID": "notebooks/05-dash/notebooks/10_dash.html#user-inputs",
    "href": "notebooks/05-dash/notebooks/10_dash.html#user-inputs",
    "title": "Create Dashboard Charts and Tables",
    "section": "User Inputs",
    "text": "User Inputs\nDefine the following\n\nBigQuery\n\ndataset id\ntable ids for audience\n\ncohorts\nprofile\n\n\nstart and end dates for train, validation and test data\n\n\n# 1. GCP resources\ngbq_dataset_id = 'mydemo2asdf'\ngbq_table_id_cohorts = 'audience_cohorts'\ngbq_table_id_profiles = 'audience_profiles'\ngbq_table_id_feats_imp = 'audience_feats_imp'\ngbq_table_id_summary = 'monthly_summary'\ngbq_table_id_sa_fracs = \"cohort_audience_fractions\"\ngbq_table_id_conv_rates = \"audience_conversion_rates\"\ngbq_table_id_conv_rates_agg_combo = \"conversion_rates_aggregated\"\ngbq_table_id_daily_perf = \"daily_summary\"\ngbq_table_id_cat_feats_kpis = \"categorical_features_kpis\"\n\n# 2. start and end dates\ntrain_start_date = \"20160901\"\ntrain_end_date = \"20161231\"\nval_start_date = \"20170101\"\nval_end_date = \"20170131\"\ntest_start_date = \"20170201\"\ntest_end_date = \"20170228\"\ninfer_start_date = '20170301'\ninfer_end_date = '20170331'\n\nCreate a mapping between action type integer and label, in order to get meaningful names from the audience_strategy column in the profiles data\n\naudience_strategy_mapper = {1: \"Multi-Group\", 2: \"Single Group\"}"
  },
  {
    "objectID": "notebooks/05-dash/notebooks/10_dash.html#get-data",
    "href": "notebooks/05-dash/notebooks/10_dash.html#get-data",
    "title": "Create Dashboard Charts and Tables",
    "section": "Get Data",
    "text": "Get Data\n\nProfiles\n\n\n\n\n\n\n\n\n\nAudience_Strategy\nStat_Expanded\nHigh\nMedium\nLow\n\n\n\n\n0\nMulti-Group\nHour (Mean)\n12.988829\n13.035034\n13.004689\n\n\n1\nMulti-Group\nDay Of Week (Mean)\n4.027858\n3.993793\n3.991036\n\n\n2\nMulti-Group\nHits (Mean)\n6.459109\n6.197655\n6.40822\n\n\n3\nMulti-Group\nPromos Displayed (Mean)\n8.585436\n8.441379\n8.677286\n\n\n4\nMulti-Group\nPromos Clicked (Mean)\n0.000138\n0.0\n0.0\n\n\n5\nMulti-Group\nProduct Views (Mean)\n23.478141\n23.204\n22.888153\n\n\n6\nMulti-Group\nProduct Clicks (Mean)\n0.714108\n0.648828\n0.667356\n\n\n7\nMulti-Group\nPageviews (Mean)\n5.459523\n5.283724\n5.43925\n\n\n8\nMulti-Group\nRevenue (Mean)\n165.179389\n175.877729\n209.059761\n\n\n9\nMulti-Group\nAdded To Cart (Mean)\n0.205765\n0.188\n0.195973\n\n\n10\nMulti-Group\nLast Action Added To Cart\n5.157909\n5.227586\n4.909668\n\n\n11\nMulti-Group\nLast Action Completed Purchase\n3.613295\n3.158621\n3.461592\n\n\n12\nMulti-Group\nLast Action Check Out\n1.296373\n1.406897\n1.37912\n\n\n13\nMulti-Group\nLast Action Removed Products From Cart\n0.855054\n0.758621\n0.813681\n\n\n14\nMulti-Group\nLast Action Clicked Through Product Lists\n0.027582\n0.055172\n0.082747\n\n\n15\nMulti-Group\nUsed Referral\n24.189767\n24.413793\n24.465591\n\n\n16\nMulti-Group\nAdded Gt 1 To Cart\n3.916701\n3.765517\n4.206316\n\n\n17\nMulti-Group\nWeekend Visitors\n17.818232\n18.482759\n17.749276\n\n\n18\nMulti-Group\nBounce Rate\n33.402289\n33.682759\n32.988553\n\n\n19\nMulti-Group\nNum Observations\n7251.0\n7250.0\n7251.0\n\n\n\n\n\n\n\n\n\nFeature Importances\n\n\n\n\n\n\n\n\n\naudience_strategy\nnum_observations\nstat\nmaudience\nvalue\n\n\n\n\n0\nMulti-Group\n500\nos = Windows\nHigh\n0.8126567113798229\n\n\n1\nMulti-Group\n500\nlast action = Click through of product lists\nHigh\n0.7545449514884582\n\n\n2\nMulti-Group\n500\nos = Samsung\nHigh\n0.6662312353186818\n\n\n3\nMulti-Group\n500\nhits\nHigh\n0.5647719631254401\n\n\n4\nMulti-Group\n500\nos = Nokia\nHigh\n0.4463242055564606\n\n\n5\nMulti-Group\n500\nos = FreeBSD\nHigh\n0.4091772385326634\n\n\n6\nMulti-Group\n500\nmedium = (not set)\nHigh\n0.34826767256482605\n\n\n7\nMulti-Group\n500\nmedium = cpc\nHigh\n0.27998660051878554\n\n\n8\nMulti-Group\n500\nbrowser = other\nHigh\n0.06432609495365482\n\n\n9\nMulti-Group\n500\npromos displayed\nHigh\n0.02940106537510878\n\n\n10\nMulti-Group\n500\nmedium = (not set)\nMedium\n0.9830338351033768\n\n\n11\nMulti-Group\n500\nmedium = affiliate\nMedium\n0.7425807196577807\n\n\n12\nMulti-Group\n500\nsource = google\nMedium\n0.6556691506923393\n\n\n13\nMulti-Group\n500\nos = Macintosh\nMedium\n0.5060030027668372\n\n\n14\nMulti-Group\n500\nos = Nintendo Wii\nMedium\n0.34809197461720176\n\n\n15\nMulti-Group\n500\nos = Chrome OS\nMedium\n0.3274330691736894\n\n\n16\nMulti-Group\n500\nos = Firefox OS\nMedium\n0.3043385263355166\n\n\n17\nMulti-Group\n500\nhits\nMedium\n0.10365481174899249\n\n\n18\nMulti-Group\n500\nbounces = True\nMedium\n0.06413215820849161\n\n\n19\nMulti-Group\n500\nos = Windows Phone\nMedium\n0.02044812214462899\n\n\n20\nMulti-Group\n500\nos = Nokia\nLow\n0.8332916579982722\n\n\n21\nMulti-Group\n500\nmedium = (not set)\nLow\n0.814703436715422\n\n\n22\nMulti-Group\n500\nsource = other\nLow\n0.7733057545901313\n\n\n23\nMulti-Group\n500\nbounces = True\nLow\n0.5896238624954269\n\n\n24\nMulti-Group\n500\nos = SunOS\nLow\n0.4135936076372544\n\n\n25\nMulti-Group\n500\nlast action = Remove product(s) from cart\nLow\n0.2623451820598448\n\n\n26\nMulti-Group\n500\nos = BlackBerry\nLow\n0.1822792667754135\n\n\n27\nMulti-Group\n500\nsource = google\nLow\n0.07901065822173592\n\n\n28\nMulti-Group\n500\nos = Macintosh\nLow\n0.07133920176640918\n\n\n29\nMulti-Group\n500\nmedium = affiliate\nLow\n0.054569779935266904\n\n\n\n\n\n\n\n\n\nCohorts\n\n\n\n\n\n\n\n\n\ninfer_month\nfullvisitorid\nvisitId\nvisitNumber\nvisitStartTime\nquarter\nmonth\nday_of_month\nday_of_week\nhour\nminute\nsecond\nsource\nmedium\nchannelGrouping\nhits\nbounces\nlast_action\npromos_displayed\npromos_clicked\nproduct_views\nproduct_clicks\npageviews\ntime_on_site\nbrowser\nos\ndeviceCategory\nadded_to_cart\nrevenue\nscore\npredicted_score_label\nmaudience\ncohort\naudience_strategy\n\n\n\n\n0\nMarch\n2359966058072922045\n1488364905\n1\n2017-03-01 02:41:45\n1\n3\n1\n4\n2\n41\n45\n(direct)\n(none)\nDirect\n2\n0\nUnknown\n0\n0\n15\n0\n2\n18\nChrome\nWindows\ndesktop\n0\nNaN\n0.007478\nFalse\nLow\nNone\nMulti-Group\n\n\n1\nMarch\n7221532448991957109\n1488368674\n1\n2017-03-01 03:44:34\n1\n3\n1\n4\n3\n44\n34\n(direct)\n(none)\nDirect\n1\n1\nUnknown\n0\n0\n12\n0\n1\n0\nSafari\nMacintosh\ndesktop\n0\nNaN\n0.000014\nFalse\nLow\nTest\nMulti-Group\n\n\n2\nMarch\n4385673813050165685\n1488370525\n1\n2017-03-01 04:15:25\n1\n3\n1\n4\n4\n15\n25\n(direct)\n(none)\nDirect\n1\n1\nUnknown\n9\n0\n0\n0\n1\n0\nChrome\nLinux\ndesktop\n0\nNaN\n0.001489\nFalse\nLow\nNone\nMulti-Group\n\n\n3\nMarch\n1998897161334762608\n1488370825\n1\n2017-03-01 04:20:25\n1\n3\n1\n4\n4\n20\n25\n(direct)\n(none)\nDirect\n1\n1\nUnknown\n9\n0\n0\n0\n1\n0\nChrome\nLinux\ndesktop\n0\nNaN\n0.250763\nTrue\nHigh\nControl\nMulti-Group\n\n\n4\nMarch\n633230752572028256\n1488371869\n1\n2017-03-01 04:37:49\n1\n3\n1\n4\n4\n37\n49\n(direct)\n(none)\nDirect\n1\n1\nUnknown\n0\n0\n0\n0\n1\n0\nChrome\nLinux\ndesktop\n0\nNaN\n0.003848\nFalse\nLow\nNone\nMulti-Group\n\n\n\n\n\n\n\n::: {.callout-note title=“Notes”} 1. The true outcome is not known at the end of the inference period. It will only be known after the end of the marketing campaign, which occurs after the inference period.\n\n\nMonthly Performance Summary\n\n\n\n\n\n\n\n\n\nmonth\nsplit_type\nreturn_purchasers\nrevenue\nvisitors\npageviews\ntime_on_site\naudience_strategy\nbounce_rate\nproduct_clicks_rate\nadd_to_cart_rate\nconversion_rate\nvisitors_pct_change\nrevenue_pct_change\npageviews_pct_change\ntime_on_site_pct_change\nbounce_rate_pct_change\nconversion_rate_pct_change\nproduct_clicks_rate_pct_change\nadd_to_cart_rate_pct_change\nvisitors_pct_change_gt_0\nrevenue_pct_change_gt_0\npageviews_pct_change_gt_0\ntime_on_site_pct_change_gt_0\nbounce_rate_pct_change_gt_0\nconversion_rate_pct_change_gt_0\nproduct_clicks_rate_pct_change_gt_0\nadd_to_cart_rate_pct_change_gt_0\n\n\n\n\n0\nSeptember\nTrain+Val\n516\n25347.17\n18610\n122037\n3.154803\nMulti-Group\n30.209565\n1.754861\n20.45137\n2.772703\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\nFalse\nFalse\nFalse\nFalse\nFalse\nFalse\nFalse\nFalse\n\n\n1\nOctober\nTrain+Val\n743\n57900.07\n22605\n137768\n3.191469\nMulti-Group\n30.67463\n2.976927\n18.279142\n3.286883\n21.466953\n128.428144\n12.890353\n1.162219\n1.539462\n18.544381\n69.638951\n-10.621432\nTrue\nTrue\nTrue\nTrue\nTrue\nTrue\nTrue\nFalse\n\n\n2\nNovember\nTrain+Val\n1651\n212099.94\n24400\n162373\n3.521508\nMulti-Group\n27.090164\n3.284716\n25.229508\n6.766393\n7.940721\n266.320697\n17.859735\n10.341304\n-11.68544\n105.860463\n10.33912\n38.023483\nTrue\nTrue\nTrue\nTrue\nFalse\nTrue\nTrue\nTrue\n\n\n3\nDecember\nTrain+Val\n1340\n188699.98\n26936\n168889\n3.386728\nMulti-Group\n29.284229\n3.131886\n23.492723\n4.974755\n10.393443\n-11.032516\n4.012982\n-3.827331\n8.099122\n-26.478485\n-4.652734\n-6.883942\nTrue\nFalse\nTrue\nFalse\nTrue\nFalse\nFalse\nFalse\n\n\n4\nJanuary\nTrain+Val\n722\n149074.1\n21177\n125412\n3.241019\nMulti-Group\n33.026397\n3.097427\n20.866978\n3.409359\n-21.380309\n-20.999409\n-25.742944\n-4.302378\n12.77878\n-31.466791\n-1.100268\n-11.176844\nFalse\nFalse\nFalse\nFalse\nTrue\nFalse\nFalse\nFalse\n\n\n5\nFebruary\nTest\n465\n111202.47\n20164\n106500\n2.981056\nMulti-Group\n35.231105\n2.697265\n18.964491\n2.30609\n-4.783492\n-25.404567\n-15.079897\n-8.021009\n6.675595\n-32.360015\n-12.919185\n-9.117214\nFalse\nFalse\nFalse\nFalse\nTrue\nFalse\nFalse\nFalse\n\n\n6\nMarch\nInfer\n&lt;NA&gt;\n136287.37\n21752\n117334\n3.199143\nMulti-Group\n33.357852\n2.918338\n19.657962\n&lt;NA&gt;\n7.875422\n22.557862\n10.17277\n7.31577\n-5.317042\n0.0\n8.196182\n3.656683\nTrue\nTrue\nTrue\nTrue\nFalse\nFalse\nTrue\nTrue\n\n\n\n\n\n\n\n\n\nDaily Performance Summary by Audience Group\n\n\n\n\n\n\n\n\n\nmaudience\ndate\nrevenue\nproduct_views\nbounce_rate\nproduct_clicks_rate\nadd_to_cart_rate\ntime_on_site\n\n\n\n\n0\nLow\n2017-03-01\n942.01\n5703\n36.734694\n3.927757\n22.857143\n2.746599\n\n\n1\nLow\n2017-03-02\n1190.35\n5847\n28.140704\n2.753549\n21.60804\n3.220184\n\n\n2\nLow\n2017-03-03\n1384.42\n5206\n39.035088\n2.497119\n20.175439\n2.533553\n\n\n3\nLow\n2017-03-04\n2686.98\n4193\n30.0\n2.742666\n38.571429\n3.959286\n\n\n4\nLow\n2017-03-05\n656.51\n5234\n30.481283\n2.521972\n17.647059\n3.55098\n\n\n...\n...\n...\n...\n...\n...\n...\n...\n...\n\n\n269\nDevelopment\n2017-02-24\n3498.65\n16981\n30.864198\n2.691243\n19.753086\n3.143621\n\n\n270\nDevelopment\n2017-02-25\n1522.15\n10860\n34.115139\n2.394107\n16.204691\n2.898969\n\n\n271\nDevelopment\n2017-02-26\n2136.18\n13847\n32.871287\n2.563732\n19.207921\n2.995182\n\n\n272\nDevelopment\n2017-02-27\n5619.72\n17665\n31.306598\n2.666289\n15.006468\n2.897995\n\n\n273\nDevelopment\n2017-02-28\n4066.75\n17431\n36.111111\n2.72503\n17.361111\n2.855116\n\n\n\n\n274 rows × 8 columns\n\n\n\n\n\nDaily Performance Summary Overall\n\n\n\n\n\n\n\n\n\nmaudience\ndate\nrevenue\nproduct_views\nbounce_rate\nproduct_clicks_rate\nadd_to_cart_rate\ntime_on_site\n\n\n\n\n0\nInference\n2017-03-01\n4346.73\n18450\n35.254692\n3.241192\n24.932976\n2.882328\n\n\n1\nInference\n2017-03-02\n5676.86\n18124\n29.279279\n2.907747\n20.27027\n3.02002\n\n\n2\nInference\n2017-03-03\n2911.19\n14904\n37.201908\n2.630166\n15.898251\n2.874483\n\n\n3\nInference\n2017-03-04\n5008.59\n14153\n28.75817\n2.727337\n31.154684\n4.059913\n\n\n4\nInference\n2017-03-05\n3501.67\n15255\n33.80035\n2.766306\n21.190893\n3.223292\n\n\n...\n...\n...\n...\n...\n...\n...\n...\n...\n\n\n207\nDevelopment\n2017-02-24\n3498.65\n16981\n30.864198\n2.691243\n19.753086\n3.143621\n\n\n208\nDevelopment\n2017-02-25\n1522.15\n10860\n34.115139\n2.394107\n16.204691\n2.898969\n\n\n209\nDevelopment\n2017-02-26\n2136.18\n13847\n32.871287\n2.563732\n19.207921\n2.995182\n\n\n210\nDevelopment\n2017-02-27\n5619.72\n17665\n31.306598\n2.666289\n15.006468\n2.897995\n\n\n211\nDevelopment\n2017-02-28\n4066.75\n17431\n36.111111\n2.72503\n17.361111\n2.855116\n\n\n\n\n212 rows × 8 columns\n\n\n\n\n\nConversion Rates\n\n\n\n\n\n\n\n\n\naudience_strategy\ninfer_month\nmaudience\npred_conversions\ntotal_visitors\nmin_score\ntrue_conversions\ndata_type\ndata_size\ntrue_conv_rate\noverall_true_conv_rate\npred_conv_rate\noverall_pred_conv_rate\n\n\n\n\n0\nMulti-Group\n&lt;NA&gt;\nHigh\n850\n6722\n0.095656\n149\nDevelopment\n20164\n2.216602\n2.30609\n12.645046\n4.215433\n\n\n1\nMulti-Group\n&lt;NA&gt;\nLow\n0\n6721\n0.0\n152\nDevelopment\n20164\n2.261568\n2.30609\n0.0\n4.215433\n\n\n2\nMulti-Group\n&lt;NA&gt;\nMedium\n0\n6721\n0.00911\n164\nDevelopment\n20164\n2.440113\n2.30609\n0.0\n4.215433\n\n\n3\nMulti-Group\nMarch\nHigh\n975\n7251\n0.098362\n0\nInference\n21752\n0.0\n0.0\n13.446421\n4.482346\n\n\n4\nMulti-Group\nMarch\nLow\n0\n7251\n0.0\n0\nInference\n21752\n0.0\n0.0\n0.0\n4.482346\n\n\n5\nMulti-Group\nMarch\nMedium\n0\n7250\n0.008815\n0\nInference\n21752\n0.0\n0.0\n0.0\n4.482346\n\n\n\n\n\n\n\n\n\nCohort-to-Audience Size Fractions\n\n\n\n\n\n\n\n\n\naudience_strategy\ninfer_month\nmaudience\ncohort\nsize\ngroup_size\nuplift\npower\nci_level\nsamp_to_aud_frac\nsize_type\ndata_type\ndata_size\n\n\n\n\n0\n1\n&lt;NA&gt;\nHigh\nTest\n2146\n6721\n10\n55\n55\n31.929772\nrequired\ndevelopment\n20164\n\n\n1\n1\n&lt;NA&gt;\nHigh\nControl\n2146\n6721\n10\n55\n55\n31.929772\nrequired\ndevelopment\n20164\n\n\n2\n1\n&lt;NA&gt;\nMedium\nTest\n1945\n6721\n10\n55\n55\n28.939146\nrequired\ndevelopment\n20164\n\n\n3\n1\n&lt;NA&gt;\nMedium\nControl\n1945\n6721\n10\n55\n55\n28.939146\nrequired\ndevelopment\n20164\n\n\n4\n1\n&lt;NA&gt;\nLow\nTest\n2103\n6722\n10\n55\n55\n31.285332\nrequired\ndevelopment\n20164\n\n\n5\n1\n&lt;NA&gt;\nLow\nControl\n2103\n6722\n10\n55\n55\n31.285332\nrequired\ndevelopment\n20164\n\n\n6\n1\nMarch\nHigh\nControl\n2315\n7251\n10\n55\n55\n31.926631\nrandomly selected\ninference\n21752\n\n\n7\n1\nMarch\nHigh\nTest\n2315\n7251\n10\n55\n55\n31.926631\nrandomly selected\ninference\n21752\n\n\n8\n1\nMarch\nLow\nControl\n2268\n7251\n10\n55\n55\n31.278444\nrandomly selected\ninference\n21752\n\n\n9\n1\nMarch\nLow\nTest\n2268\n7251\n10\n55\n55\n31.278444\nrandomly selected\ninference\n21752\n\n\n10\n1\nMarch\nMedium\nControl\n2098\n7250\n10\n55\n55\n28.937931\nrandomly selected\ninference\n21752\n\n\n11\n1\nMarch\nMedium\nTest\n2098\n7250\n10\n55\n55\n28.937931\nrandomly selected\ninference\n21752\n\n\n\n\n\n\n\n\n\nAggregated Conversion Rates (Overall)\n\n\n\n\n\n\n\n\n\nmaudience\ndata_type\nvar\nvalue\n\n\n\n\n0\n&lt;NA&gt;\nInference\nOverall Pred Conv Rate\n4.482346\n\n\n1\n&lt;NA&gt;\nInference\nOverall True Conv Rate\n0.0\n\n\n2\n&lt;NA&gt;\nInference\nData Size\n21752.0\n\n\n3\n&lt;NA&gt;\nDevelopment\nOverall Pred Conv Rate\n4.215433\n\n\n4\n&lt;NA&gt;\nDevelopment\nOverall True Conv Rate\n2.30609\n\n\n5\n&lt;NA&gt;\nDevelopment\nData Size\n20164.0\n\n\n\n\n\n\n\n\n\nAggregated Conversion Rates (per Audience Group)\n\n\n\n\n\n\n\n\n\nmaudience\ndata_type\nvar\nvalue\n\n\n\n\n0\nHigh\nInference\ntrue\n0.0\n\n\n1\nLow\nInference\ntrue\n0.0\n\n\n2\nMedium\nInference\ntrue\n0.0\n\n\n3\nHigh\nInference\npred\n13.446421\n\n\n4\nLow\nInference\npred\n0.0\n\n\n5\nMedium\nInference\npred\n0.0\n\n\n6\nHigh\nDevelopment\ntrue\n2.216602\n\n\n7\nLow\nDevelopment\ntrue\n2.261568\n\n\n8\nMedium\nDevelopment\ntrue\n2.440113\n\n\n9\nHigh\nDevelopment\npred\n12.645046\n\n\n10\nLow\nDevelopment\npred\n0.0\n\n\n11\nMedium\nDevelopment\npred\n0.0\n\n\n\n\n\n\n\n\n\nCategorical Feature KPIs\n\n\n\n\n\n\n\n\n\nfeature_name\nfeature_category\nvariable\nvalue\n\n\n\n\n0\nos\nMacintosh\nCTR\n3.307351\n\n\n1\nos\nLinux\nCTR\n3.64461\n\n\n2\nos\nChrome OS\nCTR\n3.037461\n\n\n3\nos\nWindows\nCTR\n2.517362\n\n\n4\nos\nAndroid\nCTR\n1.999182\n\n\n...\n...\n...\n...\n...\n\n\n71\nchannelGrouping\nDirect\nConversion Rate\n3.855422\n\n\n72\nchannelGrouping\nOrganic Search\nConversion Rate\n0.826806\n\n\n73\nchannelGrouping\nPaid Search\nConversion Rate\n0.420168\n\n\n74\nchannelGrouping\nAffiliates\nConversion Rate\n0.34965\n\n\n75\nchannelGrouping\nSocial\nConversion Rate\n0.0\n\n\n\n\n76 rows × 4 columns"
  },
  {
    "objectID": "notebooks/05-dash/notebooks/10_dash.html#create-charts-and-tables",
    "href": "notebooks/05-dash/notebooks/10_dash.html#create-charts-and-tables",
    "title": "Create Dashboard Charts and Tables",
    "section": "Create Charts and Tables",
    "text": "Create Charts and Tables\n\nConversion Rates During Development and Inference\nShow metrics used to estimate sample sizes\n\n\n\n\n\n\n\n\n\naudience_strategy\ninfer_month\nmaudience\npred_conversions\ntotal_visitors\nmin_score\ntrue_conversions\ndata_type\ndata_size\ntrue_conv_rate\noverall_true_conv_rate\npred_conv_rate\noverall_pred_conv_rate\n\n\n\n\n0\nMulti-Group\n&lt;NA&gt;\nHigh\n850\n6722\n0.095656\n149\nDevelopment\n20164\n2.216602\n2.30609\n12.645046\n4.215433\n\n\n1\nMulti-Group\n&lt;NA&gt;\nLow\n0\n6721\n0.0\n152\nDevelopment\n20164\n2.261568\n2.30609\n0.0\n4.215433\n\n\n2\nMulti-Group\n&lt;NA&gt;\nMedium\n0\n6721\n0.00911\n164\nDevelopment\n20164\n2.440113\n2.30609\n0.0\n4.215433\n\n\n3\nMulti-Group\nMarch\nHigh\n975\n7251\n0.098362\n0\nInference\n21752\n0.0\n0.0\n13.446421\n4.482346\n\n\n4\nMulti-Group\nMarch\nLow\n0\n7251\n0.0\n0\nInference\n21752\n0.0\n0.0\n0.0\n4.482346\n\n\n5\nMulti-Group\nMarch\nMedium\n0\n7250\n0.008815\n0\nInference\n21752\n0.0\n0.0\n0.0\n4.482346\n\n\n\n\n\n\n\n\nCharts\nShow plot comparing true and predicted conversion rates for each audience group\n\n\n\n\n\n\n\n\nShow plot comparing overall statistics\n\n\n\n\n\n\n\n\nShow plot comparing development and inference statistics for each audience group\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nMonthly Summary Stastics About Data\nShow metadata\n\n\n\n\n\n\n\n\n\nmonth\nsplit_type\nreturn_purchasers\nrevenue\nvisitors\npageviews\ntime_on_site\naudience_strategy\nbounce_rate\nproduct_clicks_rate\nadd_to_cart_rate\nconversion_rate\nvisitors_pct_change\nrevenue_pct_change\npageviews_pct_change\ntime_on_site_pct_change\nbounce_rate_pct_change\nconversion_rate_pct_change\nproduct_clicks_rate_pct_change\nadd_to_cart_rate_pct_change\nvisitors_pct_change_gt_0\nrevenue_pct_change_gt_0\npageviews_pct_change_gt_0\ntime_on_site_pct_change_gt_0\nbounce_rate_pct_change_gt_0\nconversion_rate_pct_change_gt_0\nproduct_clicks_rate_pct_change_gt_0\nadd_to_cart_rate_pct_change_gt_0\n\n\n\n\n0\nSeptember\nTrain+Val\n516\n25347.17\n18610\n122037\n3.154803\nMulti-Group\n30.209565\n1.754861\n20.45137\n2.772703\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\n&lt;NA&gt;\nFalse\nFalse\nFalse\nFalse\nFalse\nFalse\nFalse\nFalse\n\n\n1\nOctober\nTrain+Val\n743\n57900.07\n22605\n137768\n3.191469\nMulti-Group\n30.67463\n2.976927\n18.279142\n3.286883\n21.466953\n128.428144\n12.890353\n1.162219\n1.539462\n18.544381\n69.638951\n-10.621432\nTrue\nTrue\nTrue\nTrue\nTrue\nTrue\nTrue\nFalse\n\n\n2\nNovember\nTrain+Val\n1651\n212099.94\n24400\n162373\n3.521508\nMulti-Group\n27.090164\n3.284716\n25.229508\n6.766393\n7.940721\n266.320697\n17.859735\n10.341304\n-11.68544\n105.860463\n10.33912\n38.023483\nTrue\nTrue\nTrue\nTrue\nFalse\nTrue\nTrue\nTrue\n\n\n3\nDecember\nTrain+Val\n1340\n188699.98\n26936\n168889\n3.386728\nMulti-Group\n29.284229\n3.131886\n23.492723\n4.974755\n10.393443\n-11.032516\n4.012982\n-3.827331\n8.099122\n-26.478485\n-4.652734\n-6.883942\nTrue\nFalse\nTrue\nFalse\nTrue\nFalse\nFalse\nFalse\n\n\n4\nJanuary\nTrain+Val\n722\n149074.1\n21177\n125412\n3.241019\nMulti-Group\n33.026397\n3.097427\n20.866978\n3.409359\n-21.380309\n-20.999409\n-25.742944\n-4.302378\n12.77878\n-31.466791\n-1.100268\n-11.176844\nFalse\nFalse\nFalse\nFalse\nTrue\nFalse\nFalse\nFalse\n\n\n5\nFebruary\nTest\n465\n111202.47\n20164\n106500\n2.981056\nMulti-Group\n35.231105\n2.697265\n18.964491\n2.30609\n-4.783492\n-25.404567\n-15.079897\n-8.021009\n6.675595\n-32.360015\n-12.919185\n-9.117214\nFalse\nFalse\nFalse\nFalse\nTrue\nFalse\nFalse\nFalse\n\n\n6\nMarch\nInfer\n&lt;NA&gt;\n136287.37\n21752\n117334\n3.199143\nMulti-Group\n33.357852\n2.918338\n19.657962\n&lt;NA&gt;\n7.875422\n22.557862\n10.17277\n7.31577\n-5.317042\n0.0\n8.196182\n3.656683\nTrue\nTrue\nTrue\nTrue\nFalse\nFalse\nTrue\nTrue\n\n\n\n\n\n\n\n\nChart\nShow plot\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nNotes\n\n\n\n\nThis chart shows a subset of numerical attributes of first-time visitors to the store during the inference (production) period.\nThe bar chart shows the monthly aggregated value of these attributes, separately for each month in the ML training+validation data, ML test data and inference data.\nThe line chart shows the month-over-month percentage change in each attribute.\n\n\n\n\n\n\n\n\n\nObservations\n\n\n\n\nAbsolute performance peaks during the holiday season (November and/or December) and is most variable during September and October.\nAs expected, month-over-month growth drops during the winter after the holiday shopping season has ended (i.e. drops during January and February, relative to November and December).\n\n\n\n\n\n\nKPIs by Categorical Feature\nShow KPIs per categorical\n\n\n\n\n\n\n\n\n\nfeature_name\nfeature_category\nvariable\nvalue\n\n\n\n\n0\nos\nMacintosh\nCTR\n3.307351\n\n\n1\nos\nLinux\nCTR\n3.64461\n\n\n2\nos\nChrome OS\nCTR\n3.037461\n\n\n\n\n\n\n\n\nChart\nShow plot\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFeature Importances by Audience Group\nShow feature importances per audience group\n\n\n\n\n\n\n\n\n\naudience_strategy\nnum_observations\nstat\nmaudience\nvalue\n\n\n\n\n0\nMulti-Group\n500\nos = Windows\nHigh\n0.8126567113798229\n\n\n1\nMulti-Group\n500\nlast action = Click through of product lists\nHigh\n0.7545449514884582\n\n\n2\nMulti-Group\n500\nos = Samsung\nHigh\n0.6662312353186818\n\n\n\n\n\n\n\n\nChart\nShow plot\n\n\n\n\n\n\n\n\nShow the first-visit bounce rate in historical data among first-time visitors\n\n\n\n\n\n\n\n\n\nmaudience\nbounces\nvisitors\nbounce_rate\n\n\n\n\n0\nHigh\n2422\n7251\n33.402289\n\n\n1\nLow\n2392\n7251\n32.988553\n\n\n2\nMedium\n2442\n7250\n33.682759\n\n\n\n\n\n\n\n\n\n\n\n\n\nNotes\n\n\n\n\nThis chart shows the most important features to the prediction of the outcome in the current use-case (i.e. predicting the propensity of a visitor making a purchase during a future visit to the e-commerce store). These importances come from combined SHAPely values that provide global explanations, which allow us to interpret the entire ML model that was trained to make these predictions (link). The chart shows the features which changed the predicted absolute propensity on average by the most more percentage points.\nThe feature importances were calculated and are shown separately for each audience group.\n\n\n\n::: {.callout-tip title=“Observations”} 1. For high propensity visitors, the most important features of their first visit to predict whether they made a purchase during a return visit were - reached the store site through a paid search (medium__cpc) (fourth highest product CTR by medium) or undetermined (medium__(not set)) medium to access the store site - accessed the store site using a Windows based operating system (os__Windows) (fourth highest combination of KPIs by operating system) - accessed the store site using one of the following infrequently used operating systems - FreeBSD (os__FreeBSD) - Nokia- (os__Nokia) or Samsung-based OS (os__Samsung) - this would have to be a mobile (phone or tablet) operating system, since these manufacturers do not offer desktop-based operating systems - interacted with the store site (hits) 2. For medium propensity visitors, the most important first visit features were - used an affiliate (1, 2) (medium__affiliate) or undetermined (medium__(not set)) medium to access the store site - reached the store site using a google search (source__google) as the traffic source - used one of the following frequently used operating systems - Macintosh (os__Macintosh) (highest combination of KPIs by os) - Chrome OS (os__Chrome OS) (third-highest combination of KPIs by os) - used one of the following infrequently used operating systems - Nintendo WII (os__Nintendo Wii) - Firefox OS (os__Firefox OS) 4. For low propensity visitors, the most important features of their first visit were - accessed the store site using one of the following infrequently used operating systems - Nokia- (os__Nokia) or Sun-based OS (os__SunOS) - used an undetermined (medium__(not set)) medium to access the store site - removed product(s) from the visitor’s personal shopping cart at the end of their first visit to the store (last_action__Remove product(s) from cart) (second highest conversion rate by last action performed during the first visit) - bounced from the site (bounced__True) (average bounce rate among predicted low propensity visitors is approx. 33%) :::\n\n\n\nProfile by Audience Group\nShow feature importances per audience group\n\n\n\n\n\n\n\n\n\naudience_strategy\nnum_observations\nstat\nmaudience\nvalue\n\n\n\n\n0\nMulti-Group\n500\nos = Windows\nHigh\n0.8126567113798229\n\n\n1\nMulti-Group\n500\nlast action = Click through of product lists\nHigh\n0.7545449514884582\n\n\n2\nMulti-Group\n500\nos = Samsung\nHigh\n0.6662312353186818\n\n\n\n\n\n\n\n\nTable\nShow the audience group profiles\n\n\n\n\n\n\n\n\n\nAudience_Strategy\nStat_Expanded\nHigh\nMedium\nLow\n\n\n\n\n0\nMulti-Group\nHour (Mean)\n12.988829\n13.035034\n13.004689\n\n\n1\nMulti-Group\nDay Of Week (Mean)\n4.027858\n3.993793\n3.991036\n\n\n2\nMulti-Group\nHits (Mean)\n6.459109\n6.197655\n6.40822\n\n\n3\nMulti-Group\nPromos Displayed (Mean)\n8.585436\n8.441379\n8.677286\n\n\n4\nMulti-Group\nPromos Clicked (Mean)\n0.000138\n0.0\n0.0\n\n\n5\nMulti-Group\nProduct Views (Mean)\n23.478141\n23.204\n22.888153\n\n\n6\nMulti-Group\nProduct Clicks (Mean)\n0.714108\n0.648828\n0.667356\n\n\n7\nMulti-Group\nPageviews (Mean)\n5.459523\n5.283724\n5.43925\n\n\n8\nMulti-Group\nRevenue (Mean)\n165.179389\n175.877729\n209.059761\n\n\n9\nMulti-Group\nAdded To Cart (Mean)\n0.205765\n0.188\n0.195973\n\n\n10\nMulti-Group\nLast Action Added To Cart\n5.157909\n5.227586\n4.909668\n\n\n11\nMulti-Group\nLast Action Completed Purchase\n3.613295\n3.158621\n3.461592\n\n\n12\nMulti-Group\nLast Action Check Out\n1.296373\n1.406897\n1.37912\n\n\n13\nMulti-Group\nLast Action Removed Products From Cart\n0.855054\n0.758621\n0.813681\n\n\n14\nMulti-Group\nLast Action Clicked Through Product Lists\n0.027582\n0.055172\n0.082747\n\n\n15\nMulti-Group\nUsed Referral\n24.189767\n24.413793\n24.465591\n\n\n16\nMulti-Group\nAdded Gt 1 To Cart\n3.916701\n3.765517\n4.206316\n\n\n17\nMulti-Group\nWeekend Visitors\n17.818232\n18.482759\n17.749276\n\n\n18\nMulti-Group\nBounce Rate\n33.402289\n33.682759\n32.988553\n\n\n19\nMulti-Group\nNum Observations\n7251.0\n7250.0\n7251.0\n\n\n\n\n\n\n\n\n\n\n\n\n\nObservations\n\n\n\n\nHigh priority (stronger recommendations)\n\nVisitors predicted to have a low propensity to make a return purchase\n\n(Revenue (Mean)) spent more (higher revenue) on average during their first visit\n(Last Action Clicked Through Product List) clicked through a product list at the end of their first visit more often\n\nthan visitors in the other two groups. We might want to offer stronger discounts or offers (be more aggressive) to the low propensity group as part of the campaign in order to prompt them to make a purchase a return visit to the store (i.e. to maximize campaign response and ROI).\n(Weekend Visitors) There were more medium propensity visitors predicted to make a return purchase who had their first visit on a weekend than medium and low propensity visitors. During the campaign (after the first visit), offers or discounts could be targeted at low &gt; high &gt; medium propensity visitors on weekends, in terms of priority, where low propensity visitors have the highest priority. We could offer more loyalty points on weekends to medium propensity visitors, with fewer to high and even less to low propensity visitors.\n(Last Action Removed Products From Cart) More visitors predicted to have a high propensity to make a return purchase removed an item from the shopping cart at the end of their first visit than visitors in other two groups.\n\nwe should offer discounts on non-shopping cart items to low and medium propensity visitors (to convince them to remove items in their cart as was done by high-propensity visitors, and add items that are discounted, in the hopes they will purchase the new items in the cart)\nwe should offer\n\ndiscounts on shopping cart items\nrecommendations for similar products to shopping cart items\n\nto high propensity visitors to convince them to purchase these during a return visit\n\n\nLow priority (weaker recommendations)\n\n(Last Action Added To Cart) Visitors predicted to have a medium propensity to make a return purchase added an item to their shopping cart at the end of their first visit more often than visitors in other two groups.\n\n\n\n\n\n\n\nDaily Summary\nShow the daily summary data\n\n\n\n\n\n\n\n\n\nmaudience\ndate\nrevenue\nproduct_views\nbounce_rate\nproduct_clicks_rate\nadd_to_cart_rate\ntime_on_site\n\n\n\n\n0\nInference\n2017-03-01\n4346.73\n18450\n35.254692\n3.241192\n24.932976\n2.882328\n\n\n1\nInference\n2017-03-02\n5676.86\n18124\n29.279279\n2.907747\n20.27027\n3.02002\n\n\n2\nInference\n2017-03-03\n2911.19\n14904\n37.201908\n2.630166\n15.898251\n2.874483\n\n\n\n\n\n\n\n\nChart\nShow plot\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nDaily Summary by Audience Group\nShow the daily summary data by audience group\n\n\n\n\n\n\n\n\n\nmaudience\ndate\nrevenue\nproduct_views\nbounce_rate\nproduct_clicks_rate\nadd_to_cart_rate\ntime_on_site\n\n\n\n\n0\nLow\n2017-03-01\n942.01\n5703\n36.734694\n3.927757\n22.857143\n2.746599\n\n\n1\nLow\n2017-03-02\n1190.35\n5847\n28.140704\n2.753549\n21.60804\n3.220184\n\n\n2\nLow\n2017-03-03\n1384.42\n5206\n39.035088\n2.497119\n20.175439\n2.533553\n\n\n3\nLow\n2017-03-04\n2686.98\n4193\n30.0\n2.742666\n38.571429\n3.959286\n\n\n4\nLow\n2017-03-05\n656.51\n5234\n30.481283\n2.521972\n17.647059\n3.55098\n\n\n...\n...\n...\n...\n...\n...\n...\n...\n...\n\n\n269\nDevelopment\n2017-02-24\n3498.65\n16981\n30.864198\n2.691243\n19.753086\n3.143621\n\n\n270\nDevelopment\n2017-02-25\n1522.15\n10860\n34.115139\n2.394107\n16.204691\n2.898969\n\n\n271\nDevelopment\n2017-02-26\n2136.18\n13847\n32.871287\n2.563732\n19.207921\n2.995182\n\n\n272\nDevelopment\n2017-02-27\n5619.72\n17665\n31.306598\n2.666289\n15.006468\n2.897995\n\n\n273\nDevelopment\n2017-02-28\n4066.75\n17431\n36.111111\n2.72503\n17.361111\n2.855116\n\n\n\n\n274 rows × 8 columns\n\n\n\n\nChart\nShow plot\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nObservations\n\n\n\n\nFirst-visit bounce rate is at its lowest during the lead-up to the Christmas holiday season and can be largely attributed to increased store sales due to holiday shopping. The following first-visit attributes\n\nproduct CTR\nadd-to-cart rate\nrevenue\naverage time spent on the store site\n\nare consistently highest during holiday season and this too can be largely attributed to increased visitor activity on the store due to holiday shopping.\n\n\n\n\n\n\nCohorts\n\nTable\nShow inference data with audience and cohort groups assigned\n\n\n\n\n\n\n\n\n\ninfer_month\nfullvisitorid\nvisitId\nvisitNumber\nvisitStartTime\nquarter\nmonth\nday_of_month\nday_of_week\nhour\nminute\nsecond\nsource\nmedium\nchannelGrouping\nhits\nbounces\nlast_action\npromos_displayed\npromos_clicked\nproduct_views\nproduct_clicks\npageviews\ntime_on_site\nbrowser\nos\ndeviceCategory\nadded_to_cart\nrevenue\nscore\npredicted_score_label\nmaudience\ncohort\naudience_strategy\n\n\n\n\n0\nMarch\n2359966058072922045\n1488364905\n1\n2017-03-01 02:41:45\n1\n3\n1\n4\n2\n41\n45\n(direct)\n(none)\nDirect\n2\n0\nUnknown\n0\n0\n15\n0\n2\n18\nChrome\nWindows\ndesktop\n0\nNaN\n0.007478\nFalse\nLow\nNone\nMulti-Group\n\n\n1\nMarch\n7221532448991957109\n1488368674\n1\n2017-03-01 03:44:34\n1\n3\n1\n4\n3\n44\n34\n(direct)\n(none)\nDirect\n1\n1\nUnknown\n0\n0\n12\n0\n1\n0\nSafari\nMacintosh\ndesktop\n0\nNaN\n0.000014\nFalse\nLow\nTest\nMulti-Group\n\n\n2\nMarch\n4385673813050165685\n1488370525\n1\n2017-03-01 04:15:25\n1\n3\n1\n4\n4\n15\n25\n(direct)\n(none)\nDirect\n1\n1\nUnknown\n9\n0\n0\n0\n1\n0\nChrome\nLinux\ndesktop\n0\nNaN\n0.001489\nFalse\nLow\nNone\nMulti-Group\n\n\n3\nMarch\n1998897161334762608\n1488370825\n1\n2017-03-01 04:20:25\n1\n3\n1\n4\n4\n20\n25\n(direct)\n(none)\nDirect\n1\n1\nUnknown\n9\n0\n0\n0\n1\n0\nChrome\nLinux\ndesktop\n0\nNaN\n0.250763\nTrue\nHigh\nControl\nMulti-Group\n\n\n4\nMarch\n633230752572028256\n1488371869\n1\n2017-03-01 04:37:49\n1\n3\n1\n4\n4\n37\n49\n(direct)\n(none)\nDirect\n1\n1\nUnknown\n0\n0\n0\n0\n1\n0\nChrome\nLinux\ndesktop\n0\nNaN\n0.003848\nFalse\nLow\nNone\nMulti-Group\n\n\n\n\n\n\n\n\n\n\n\n\n\nNotes\n\n\n\n\nThe table shows the following for all first-time visitors to the store during the inference (production) period\n\ninference month (infer_month)\nattributes (characteristics) of the first visit (some of these are features used by the ML model)\nthe ML model’s prediction of such visitors’ propensity to make a purchase on a return visit to the store (hard - predicted_score_label - and soft - score - predictions)\nassigned audience group (maudience), based on specified audience strategy (single or multiple audience groups, audience_strategy)\naudience test and control cohorts (cohort).\n\nThe dashboard will contain a button to download this table to a .XLSX table using Python libraries for working with MS Excel files.\nThis table is the main deliverable for this project.\n\n\n\nExport DataFrame with inference data, including the audience cohorts, to XLSX file with the following formatting\n\ncolumns that are sufficiently wide to show the longest value in any row\nbold header row\ncentered cell contents\n\n\nxlh.export_df_to_formatted_spreadsheet(\n    df_dev_cohorts,\n    os.path.join(processed_data_dir, \"Audience_cohorts_predictions.xlsx\"),\n)\n\nExport start time = 2023-07-11 13:10:20.968...done at 2023-07-11 13:10:44.086 (23.118 seconds).\n\n\n\n\n\n\n\n\nNotes\n\n\n\n\nThe worksheet formatting improves the readability of the contents in this file by the end user (business client)."
  },
  {
    "objectID": "notebooks/05-dash/notebooks/10_dash.html#recommendations",
    "href": "notebooks/05-dash/notebooks/10_dash.html#recommendations",
    "title": "Create Dashboard Charts and Tables",
    "section": "Recommendations",
    "text": "Recommendations\nWith the first-time visitors segmented into audience groups, as mentioned in the project scope, in order to best spend available marketing budget this allows greater flexibility in how customized a campaign response can be by using a different marketing approach with a customer that is predicted to have a high, medium or low propensity to make a return purchase. We will now make recommendations for more personalized marketing.\n\nBased on ML Model’s Most Important Features\n\n\n\n\n\n\nNotes\n\n\n\nBased on\n\ndiscoveries made from exploring the data\nthe ML model’s most important features for predicting whether a visitor will make a return purchase\n\nwe should target the following visitor profile to maximize campaign response\n\nHigh propensity visitors\n\nreached the store site using a paid search or undetermined medium\nreached the store site using a Windows based operating system\nused one of the following infrequently used operating systems\n\nFreeBSD\nNokia-based OS\nSamsung-based OS\n\ninteracted with content on the store site\n\nwith an emphasis on visitors who accessed the site\n\nfrom a Windows-based operating system\nusing a paid search\n\nMedium propensity visitors\n\nreached the store site using an affiliate or undetermined medium\nreached the store site using a Google search as the traffic source\nused one of the following frequently used operating systems\n\nMacintosh\nChrome OS\n\nused one of the following infrequently used operating systems\n\nNintendo WII\nFirefox OS\n\n\nwith an emphasis on\n\nvisitors who used a Mac-based operating system to access the store site\nChrome OS users (i.e. chromebook users)\n\nLow propensity visitors\n\nused one of the following infrequently used operating systems to access the store site\n\nNokia OS\nSunOS\n\nused an undetermined medium to access the store site\nended their first visit by removing a product(s) from their shopping cart\nbounced from the site\n\nwith an emphasis on\n\nvisitors who removed a product(s) from their shopping cart at the end of their first visit\nbounced from the site\n\n\nwhere the recommended emphasis is based on factors that produced a good combination of KPIs (CTR and/or conversion rate) among first-time visitors in the closest available month of historical data.\n\n\n\n\nBased on Observed Behavior During Production (Inference) Period\nShow the average number of promotions viewed by high propensity visitors in historical data among first-time visitors\n\n\nAverage number of promotions viewed by visitors in high propensity group = 8.59%\n\n\n\n\n\n\n\n\nNotes\n\n\n\nBased on visitor behavior during their first visit to the store, we should include the following actions to maximize campaign response\n\nLow propensity audience\n\noffer stronger discounts or offers (be more aggressive)\noffer the strongest discounts on weekends\noffer discounts on non-shopping cart items\n\nHigh propensity audience\n\noffer intermediate discounts (lower than low propensity and higher than the medium propensity audience) on weekends\noffer discounts on shopping cart items and recommendations for similar products to shopping cart items\n\nMedium propensity audience\n\noffer the highest discounts on weekends"
  },
  {
    "objectID": "notebooks/05-dash/notebooks/10_dash.html#next-step",
    "href": "notebooks/05-dash/notebooks/10_dash.html#next-step",
    "title": "Create Dashboard Charts and Tables",
    "section": "Next Step",
    "text": "Next Step\nThe next step will delete all MLFlow-related resources created for this project."
  },
  {
    "objectID": "notebooks/07-cleanup/notebooks/13_cleanup_gcloud.html",
    "href": "notebooks/07-cleanup/notebooks/13_cleanup_gcloud.html",
    "title": "Cleanup Google Cloud Resources",
    "section": "",
    "text": "This step deletes all Google Cloud resources that were created during this project. This includes\n\nBigQuery tables in the dataset that was manually created as part of the pre-requisites for this project\nStorage bucket\n\n\n\n\nThis step can be run at the end of the project, after the campaign has ended and its outcomes have been analyzed."
  },
  {
    "objectID": "notebooks/07-cleanup/notebooks/13_cleanup_gcloud.html#about",
    "href": "notebooks/07-cleanup/notebooks/13_cleanup_gcloud.html#about",
    "title": "Cleanup Google Cloud Resources",
    "section": "",
    "text": "This step deletes all Google Cloud resources that were created during this project. This includes\n\nBigQuery tables in the dataset that was manually created as part of the pre-requisites for this project\nStorage bucket\n\n\n\n\nThis step can be run at the end of the project, after the campaign has ended and its outcomes have been analyzed."
  },
  {
    "objectID": "notebooks/07-cleanup/notebooks/13_cleanup_gcloud.html#user-inputs",
    "href": "notebooks/07-cleanup/notebooks/13_cleanup_gcloud.html#user-inputs",
    "title": "Cleanup Google Cloud Resources",
    "section": "User Inputs",
    "text": "User Inputs\nDefine the following GCP resources\n\nBigQuery\n\ndataset id\ntable ids for\n\nraw GA360 data\naudience\n\ncohorts\nprofile\n\n\n\nGCS bucket name\n\n\n# 1. Bigquery resources\ngbq_dataset_id = 'mydemo2asdf'\ngbq_table_id_raw_data = 'ecwa'\ngbq_table_id_cohorts = 'audience_cohorts'\ngbq_table_id_profiles = 'audience_profiles'\n\n# 2. GCS bucket name\nbucket_name = \"ecwa-raw\""
  },
  {
    "objectID": "notebooks/07-cleanup/notebooks/13_cleanup_gcloud.html#cleanup-bigquery",
    "href": "notebooks/07-cleanup/notebooks/13_cleanup_gcloud.html#cleanup-bigquery",
    "title": "Cleanup Google Cloud Resources",
    "section": "Cleanup BigQuery",
    "text": "Cleanup BigQuery\n\nTables\nDelete BigQuery tables\n\nfor gbq_table_id in [\n    gbq_table_id_raw_data, gbq_table_id_cohorts, gbq_table_id_profiles\n]:\n    gbq_table_fully_resolved = f\"{gcp_proj_id}.{gbq_dataset_id}.{gbq_table_id}\"\n    client.delete_table(gbq_table_fully_resolved)\n    print(f\"Deleted table {gbq_table_fully_resolved}\")\n\nDeleted table demoabc-381618.mydemo2asdf.ecwa\nDeleted table demoabc-381618.mydemo2asdf.audience_cohorts\nDeleted table demoabc-381618.mydemo2asdf.audience_profiles"
  },
  {
    "objectID": "notebooks/07-cleanup/notebooks/13_cleanup_gcloud.html#cleanup-storage",
    "href": "notebooks/07-cleanup/notebooks/13_cleanup_gcloud.html#cleanup-storage",
    "title": "Cleanup Google Cloud Resources",
    "section": "Cleanup Storage",
    "text": "Cleanup Storage\n\nFiles\nList files in specified bucket\n\n\nShowing 55 files found in bucket ecwa-raw, taking up 225.4 MB of space\n\n\n\n\n\n\n\n\n\nname\nbucket\nsize_mb\nid\ntime_created\n\n\n\n\n0\nd2i_ecwa__20160801__20160807__20230611_200354.parquet.gzip\necwa-raw\n4.660864\necwa-raw/d2i_ecwa__20160801__20160807__20230611_200354.parquet.gzip/1686584306817844\n2023-06-12 11:38:26.871000-04:00\n\n\n1\nd2i_ecwa__20160808__20160814__20230611_200726.parquet.gzip\necwa-raw\n5.095205\necwa-raw/d2i_ecwa__20160808__20160814__20230611_200726.parquet.gzip/1686584307242229\n2023-06-12 11:38:27.280000-04:00\n\n\n2\nd2i_ecwa__20160815__20160821__20230611_201100.parquet.gzip\necwa-raw\n5.052166\necwa-raw/d2i_ecwa__20160815__20160821__20230611_201100.parquet.gzip/1686584307682931\n2023-06-12 11:38:27.722000-04:00\n\n\n3\nd2i_ecwa__20160822__20160828__20230611_201420.parquet.gzip\necwa-raw\n4.852887\necwa-raw/d2i_ecwa__20160822__20160828__20230611_201420.parquet.gzip/1686584308098322\n2023-06-12 11:38:28.148000-04:00\n\n\n4\nd2i_ecwa__20160829__20160831__20230611_201631.parquet.gzip\necwa-raw\n2.517590\necwa-raw/d2i_ecwa__20160829__20160831__20230611_201631.parquet.gzip/1686584308482404\n2023-06-12 11:38:28.521000-04:00\n\n\n5\nd2i_ecwa__20160901__20160907__20230611_110546.parquet.gzip\necwa-raw\n4.185168\necwa-raw/d2i_ecwa__20160901__20160907__20230611_110546.parquet.gzip/1686584308908315\n2023-06-12 11:38:28.945000-04:00\n\n\n6\nd2i_ecwa__20160908__20160914__20230611_110929.parquet.gzip\necwa-raw\n4.501941\necwa-raw/d2i_ecwa__20160908__20160914__20230611_110929.parquet.gzip/1686584309285385\n2023-06-12 11:38:29.325000-04:00\n\n\n7\nd2i_ecwa__20160915__20160921__20230611_111509.parquet.gzip\necwa-raw\n5.266326\necwa-raw/d2i_ecwa__20160915__20160921__20230611_111509.parquet.gzip/1686584309721621\n2023-06-12 11:38:29.759000-04:00\n\n\n8\nd2i_ecwa__20160922__20160928__20230611_111820.parquet.gzip\necwa-raw\n4.951720\necwa-raw/d2i_ecwa__20160922__20160928__20230611_111820.parquet.gzip/1686584310161748\n2023-06-12 11:38:30.201000-04:00\n\n\n9\nd2i_ecwa__20160929__20160930__20230611_200041.parquet.gzip\necwa-raw\n1.411386\necwa-raw/d2i_ecwa__20160929__20160930__20230611_200041.parquet.gzip/1686584310500825\n2023-06-12 11:38:30.539000-04:00\n\n\n10\nd2i_ecwa__20161001__20161007__20230611_001001.parquet.gzip\necwa-raw\n4.491890\necwa-raw/d2i_ecwa__20161001__20161007__20230611_001001.parquet.gzip/1686584310932051\n2023-06-12 11:38:30.972000-04:00\n\n\n11\nd2i_ecwa__20161008__20161014__20230611_001454.parquet.gzip\necwa-raw\n4.434698\necwa-raw/d2i_ecwa__20161008__20161014__20230611_001454.parquet.gzip/1686584311384286\n2023-06-12 11:38:31.438000-04:00\n\n\n12\nd2i_ecwa__20161015__20161021__20230611_001736.parquet.gzip\necwa-raw\n4.390024\necwa-raw/d2i_ecwa__20161015__20161021__20230611_001736.parquet.gzip/1686584311799184\n2023-06-12 11:38:31.839000-04:00\n\n\n13\nd2i_ecwa__20161022__20161028__20230611_002043.parquet.gzip\necwa-raw\n4.679543\necwa-raw/d2i_ecwa__20161022__20161028__20230611_002043.parquet.gzip/1686584312219119\n2023-06-12 11:38:32.258000-04:00\n\n\n14\nd2i_ecwa__20161029__20161031__20230611_002432.parquet.gzip\necwa-raw\n1.722868\necwa-raw/d2i_ecwa__20161029__20161031__20230611_002432.parquet.gzip/1686584312564016\n2023-06-12 11:38:32.601000-04:00\n\n\n15\nd2i_ecwa__20161101__20161107__20230530_152206.parquet.gzip\necwa-raw\n4.704754\necwa-raw/d2i_ecwa__20161101__20161107__20230530_152206.parquet.gzip/1686584312983405\n2023-06-12 11:38:33.022000-04:00\n\n\n16\nd2i_ecwa__20161108__20161114__20230530_153238.parquet.gzip\necwa-raw\n4.921709\necwa-raw/d2i_ecwa__20161108__20161114__20230530_153238.parquet.gzip/1686584313397218\n2023-06-12 11:38:33.434000-04:00\n\n\n17\nd2i_ecwa__20161115__20161121__20230530_161342.parquet.gzip\necwa-raw\n5.575957\necwa-raw/d2i_ecwa__20161115__20161121__20230530_161342.parquet.gzip/1686584313840582\n2023-06-12 11:38:33.879000-04:00\n\n\n18\nd2i_ecwa__20161122__20161128__20230604_221113.parquet.gzip\necwa-raw\n5.835802\necwa-raw/d2i_ecwa__20161122__20161128__20230604_221113.parquet.gzip/1686584314269019\n2023-06-12 11:38:34.306000-04:00\n\n\n19\nd2i_ecwa__20161129__20161205__20230604_221445.parquet.gzip\necwa-raw\n6.469955\necwa-raw/d2i_ecwa__20161129__20161205__20230604_221445.parquet.gzip/1686584314720930\n2023-06-12 11:38:34.760000-04:00\n\n\n20\nd2i_ecwa__20161206__20161212__20230605_161513.parquet.gzip\necwa-raw\n6.476081\necwa-raw/d2i_ecwa__20161206__20161212__20230605_161513.parquet.gzip/1686584315169404\n2023-06-12 11:38:35.209000-04:00\n\n\n21\nd2i_ecwa__20161213__20161219__20230605_161840.parquet.gzip\necwa-raw\n6.223205\necwa-raw/d2i_ecwa__20161213__20161219__20230605_161840.parquet.gzip/1686584315616496\n2023-06-12 11:38:35.653000-04:00\n\n\n22\nd2i_ecwa__20161220__20161226__20230605_162156.parquet.gzip\necwa-raw\n3.779628\necwa-raw/d2i_ecwa__20161220__20161226__20230605_162156.parquet.gzip/1686584316030315\n2023-06-12 11:38:36.069000-04:00\n\n\n23\nd2i_ecwa__20161227__20170102__20230605_162544.parquet.gzip\necwa-raw\n3.105586\necwa-raw/d2i_ecwa__20161227__20170102__20230605_162544.parquet.gzip/1686584316440304\n2023-06-12 11:38:36.489000-04:00\n\n\n24\nd2i_ecwa__20170103__20170109__20230605_163214.parquet.gzip\necwa-raw\n4.167440\necwa-raw/d2i_ecwa__20170103__20170109__20230605_163214.parquet.gzip/1686584316871632\n2023-06-12 11:38:36.911000-04:00\n\n\n25\nd2i_ecwa__20170110__20170116__20230605_182959.parquet.gzip\necwa-raw\n3.707910\necwa-raw/d2i_ecwa__20170110__20170116__20230605_182959.parquet.gzip/1686584317286942\n2023-06-12 11:38:37.326000-04:00\n\n\n26\nd2i_ecwa__20170117__20170123__20230605_183349.parquet.gzip\necwa-raw\n3.948315\necwa-raw/d2i_ecwa__20170117__20170123__20230605_183349.parquet.gzip/1686584317668186\n2023-06-12 11:38:37.725000-04:00\n\n\n27\nd2i_ecwa__20170124__20170130__20230605_183616.parquet.gzip\necwa-raw\n4.305809\necwa-raw/d2i_ecwa__20170124__20170130__20230605_183616.parquet.gzip/1686584318085183\n2023-06-12 11:38:38.125000-04:00\n\n\n28\nd2i_ecwa__20170131__20170206__20230605_183843.parquet.gzip\necwa-raw\n3.801771\necwa-raw/d2i_ecwa__20170131__20170206__20230605_183843.parquet.gzip/1686584318504090\n2023-06-12 11:38:38.560000-04:00\n\n\n29\nd2i_ecwa__20170207__20170213__20230606_115635.parquet.gzip\necwa-raw\n3.839108\necwa-raw/d2i_ecwa__20170207__20170213__20230606_115635.parquet.gzip/1686584318968918\n2023-06-12 11:38:39.008000-04:00\n\n\n30\nd2i_ecwa__20170214__20170220__20230606_115920.parquet.gzip\necwa-raw\n3.875040\necwa-raw/d2i_ecwa__20170214__20170220__20230606_115920.parquet.gzip/1686584319341220\n2023-06-12 11:38:39.381000-04:00\n\n\n31\nd2i_ecwa__20170221__20170227__20230606_120157.parquet.gzip\necwa-raw\n3.788718\necwa-raw/d2i_ecwa__20170221__20170227__20230606_120157.parquet.gzip/1686584319745029\n2023-06-12 11:38:39.784000-04:00\n\n\n32\nd2i_ecwa__20170228__20170306__20230606_185806.parquet.gzip\necwa-raw\n3.876007\necwa-raw/d2i_ecwa__20170228__20170306__20230606_185806.parquet.gzip/1686584320158404\n2023-06-12 11:38:40.197000-04:00\n\n\n33\nd2i_ecwa__20170307__20170313__20230606_190156.parquet.gzip\necwa-raw\n3.736998\necwa-raw/d2i_ecwa__20170307__20170313__20230606_190156.parquet.gzip/1686584320570630\n2023-06-12 11:38:40.609000-04:00\n\n\n34\nd2i_ecwa__20170314__20170320__20230606_190448.parquet.gzip\necwa-raw\n3.693063\necwa-raw/d2i_ecwa__20170314__20170320__20230606_190448.parquet.gzip/1686584320939741\n2023-06-12 11:38:40.978000-04:00\n\n\n35\nd2i_ecwa__20170321__20170327__20230606_190722.parquet.gzip\necwa-raw\n3.692482\necwa-raw/d2i_ecwa__20170321__20170327__20230606_190722.parquet.gzip/1686584321354011\n2023-06-12 11:38:41.403000-04:00\n\n\n36\nd2i_ecwa__20170328__20170403__20230606_191150.parquet.gzip\necwa-raw\n3.779546\necwa-raw/d2i_ecwa__20170328__20170403__20230606_191150.parquet.gzip/1686584321749640\n2023-06-12 11:38:41.789000-04:00\n\n\n37\nd2i_ecwa__20170404__20170410__20230607_112502.parquet.gzip\necwa-raw\n3.945833\necwa-raw/d2i_ecwa__20170404__20170410__20230607_112502.parquet.gzip/1686584322098198\n2023-06-12 11:38:42.138000-04:00\n\n\n38\nd2i_ecwa__20170411__20170417__20230607_112711.parquet.gzip\necwa-raw\n3.496119\necwa-raw/d2i_ecwa__20170411__20170417__20230607_112711.parquet.gzip/1686584322511962\n2023-06-12 11:38:42.551000-04:00\n\n\n39\nd2i_ecwa__20170418__20170424__20230607_112923.parquet.gzip\necwa-raw\n3.540592\necwa-raw/d2i_ecwa__20170418__20170424__20230607_112923.parquet.gzip/1686584322907791\n2023-06-12 11:38:42.947000-04:00\n\n\n40\nd2i_ecwa__20170425__20170501__20230607_113247.parquet.gzip\necwa-raw\n4.160729\necwa-raw/d2i_ecwa__20170425__20170501__20230607_113247.parquet.gzip/1686584323288507\n2023-06-12 11:38:43.337000-04:00\n\n\n41\nd2i_ecwa__20170502__20170508__20230607_113605.parquet.gzip\necwa-raw\n3.649929\necwa-raw/d2i_ecwa__20170502__20170508__20230607_113605.parquet.gzip/1686584323702310\n2023-06-12 11:38:43.742000-04:00\n\n\n42\nd2i_ecwa__20170509__20170515__20230608_105750.parquet.gzip\necwa-raw\n3.500749\necwa-raw/d2i_ecwa__20170509__20170515__20230608_105750.parquet.gzip/1686584324107593\n2023-06-12 11:38:44.147000-04:00\n\n\n43\nd2i_ecwa__20170516__20170522__20230608_110016.parquet.gzip\necwa-raw\n4.325023\necwa-raw/d2i_ecwa__20170516__20170522__20230608_110016.parquet.gzip/1686584324531986\n2023-06-12 11:38:44.572000-04:00\n\n\n44\nd2i_ecwa__20170523__20170529__20230608_110222.parquet.gzip\necwa-raw\n3.473806\necwa-raw/d2i_ecwa__20170523__20170529__20230608_110222.parquet.gzip/1686584324958119\n2023-06-12 11:38:44.996000-04:00\n\n\n45\nd2i_ecwa__20170530__20170605__20230608_110431.parquet.gzip\necwa-raw\n3.814128\necwa-raw/d2i_ecwa__20170530__20170605__20230608_110431.parquet.gzip/1686584325370779\n2023-06-12 11:38:45.410000-04:00\n\n\n46\nd2i_ecwa__20170606__20170612__20230610_162054.parquet.gzip\necwa-raw\n3.666802\necwa-raw/d2i_ecwa__20170606__20170612__20230610_162054.parquet.gzip/1686584325781649\n2023-06-12 11:38:45.821000-04:00\n\n\n47\nd2i_ecwa__20170613__20170619__20230610_162315.parquet.gzip\necwa-raw\n3.455317\necwa-raw/d2i_ecwa__20170613__20170619__20230610_162315.parquet.gzip/1686584326152441\n2023-06-12 11:38:46.190000-04:00\n\n\n48\nd2i_ecwa__20170620__20170626__20230610_162520.parquet.gzip\necwa-raw\n3.462677\necwa-raw/d2i_ecwa__20170620__20170626__20230610_162520.parquet.gzip/1686584326529349\n2023-06-12 11:38:46.568000-04:00\n\n\n49\nd2i_ecwa__20170627__20170703__20230610_162730.parquet.gzip\necwa-raw\n3.809763\necwa-raw/d2i_ecwa__20170627__20170703__20230610_162730.parquet.gzip/1686584326951720\n2023-06-12 11:38:46.990000-04:00\n\n\n50\nd2i_ecwa__20170704__20170710__20230610_163003.parquet.gzip\necwa-raw\n3.887948\necwa-raw/d2i_ecwa__20170704__20170710__20230610_163003.parquet.gzip/1686584327367125\n2023-06-12 11:38:47.409000-04:00\n\n\n51\nd2i_ecwa__20170711__20170717__20230610_163229.parquet.gzip\necwa-raw\n4.188950\necwa-raw/d2i_ecwa__20170711__20170717__20230610_163229.parquet.gzip/1686584327783546\n2023-06-12 11:38:47.823000-04:00\n\n\n52\nd2i_ecwa__20170718__20170724__20230610_172735.parquet.gzip\necwa-raw\n4.337407\necwa-raw/d2i_ecwa__20170718__20170724__20230610_172735.parquet.gzip/1686584328200170\n2023-06-12 11:38:48.240000-04:00\n\n\n53\nd2i_ecwa__20170725__20170731__20230610_173444.parquet.gzip\necwa-raw\n4.287689\necwa-raw/d2i_ecwa__20170725__20170731__20230610_173444.parquet.gzip/1686584328634761\n2023-06-12 11:38:48.674000-04:00\n\n\n54\nd2i_ecwa__20170801__20170801__20230610_173641.parquet.gzip\necwa-raw\n0.909663\necwa-raw/d2i_ecwa__20170801__20170801__20230610_173641.parquet.gzip/1686584328913263\n2023-06-12 11:38:48.953000-04:00\n\n\n\n\n\n\n\nDelete all files in specified bucket\n\nbucket = storage_client.bucket(bucket_name)\nfor k, row in df_blobs.iterrows():\n    blob = bucket.blob(row['name'])\n    blob.reload()\n    generation_match_precondition = blob.generation\n    blob.delete(if_generation_match=generation_match_precondition)\n    print(f\"Delete blob {k+1}/{len(df_blobs)}, {row['name']}, from bucket {bucket_name}\")\n\nDelete blob d2i_ecwa__20160801__20160807__20230611_200354.parquet.gzip\nDelete blob d2i_ecwa__20160808__20160814__20230611_200726.parquet.gzip\nDelete blob d2i_ecwa__20160815__20160821__20230611_201100.parquet.gzip\nDelete blob d2i_ecwa__20160822__20160828__20230611_201420.parquet.gzip\nDelete blob d2i_ecwa__20160829__20160831__20230611_201631.parquet.gzip\nDelete blob d2i_ecwa__20160901__20160907__20230611_110546.parquet.gzip\nDelete blob d2i_ecwa__20160908__20160914__20230611_110929.parquet.gzip\nDelete blob d2i_ecwa__20160915__20160921__20230611_111509.parquet.gzip\nDelete blob d2i_ecwa__20160922__20160928__20230611_111820.parquet.gzip\nDelete blob d2i_ecwa__20160929__20160930__20230611_200041.parquet.gzip\nDelete blob d2i_ecwa__20161001__20161007__20230611_001001.parquet.gzip\nDelete blob d2i_ecwa__20161008__20161014__20230611_001454.parquet.gzip\nDelete blob d2i_ecwa__20161015__20161021__20230611_001736.parquet.gzip\nDelete blob d2i_ecwa__20161022__20161028__20230611_002043.parquet.gzip\nDelete blob d2i_ecwa__20161029__20161031__20230611_002432.parquet.gzip\nDelete blob d2i_ecwa__20161101__20161107__20230530_152206.parquet.gzip\nDelete blob d2i_ecwa__20161108__20161114__20230530_153238.parquet.gzip\nDelete blob d2i_ecwa__20161115__20161121__20230530_161342.parquet.gzip\nDelete blob d2i_ecwa__20161122__20161128__20230604_221113.parquet.gzip\nDelete blob d2i_ecwa__20161129__20161205__20230604_221445.parquet.gzip\nDelete blob d2i_ecwa__20161206__20161212__20230605_161513.parquet.gzip\nDelete blob d2i_ecwa__20161213__20161219__20230605_161840.parquet.gzip\nDelete blob d2i_ecwa__20161220__20161226__20230605_162156.parquet.gzip\nDelete blob d2i_ecwa__20161227__20170102__20230605_162544.parquet.gzip\nDelete blob d2i_ecwa__20170103__20170109__20230605_163214.parquet.gzip\nDelete blob d2i_ecwa__20170110__20170116__20230605_182959.parquet.gzip\nDelete blob d2i_ecwa__20170117__20170123__20230605_183349.parquet.gzip\nDelete blob d2i_ecwa__20170124__20170130__20230605_183616.parquet.gzip\nDelete blob d2i_ecwa__20170131__20170206__20230605_183843.parquet.gzip\nDelete blob d2i_ecwa__20170207__20170213__20230606_115635.parquet.gzip\nDelete blob d2i_ecwa__20170214__20170220__20230606_115920.parquet.gzip\nDelete blob d2i_ecwa__20170221__20170227__20230606_120157.parquet.gzip\nDelete blob d2i_ecwa__20170228__20170306__20230606_185806.parquet.gzip\nDelete blob d2i_ecwa__20170307__20170313__20230606_190156.parquet.gzip\nDelete blob d2i_ecwa__20170314__20170320__20230606_190448.parquet.gzip\nDelete blob d2i_ecwa__20170321__20170327__20230606_190722.parquet.gzip\nDelete blob d2i_ecwa__20170328__20170403__20230606_191150.parquet.gzip\nDelete blob d2i_ecwa__20170404__20170410__20230607_112502.parquet.gzip\nDelete blob d2i_ecwa__20170411__20170417__20230607_112711.parquet.gzip\nDelete blob d2i_ecwa__20170418__20170424__20230607_112923.parquet.gzip\nDelete blob d2i_ecwa__20170425__20170501__20230607_113247.parquet.gzip\nDelete blob d2i_ecwa__20170502__20170508__20230607_113605.parquet.gzip\nDelete blob d2i_ecwa__20170509__20170515__20230608_105750.parquet.gzip\nDelete blob d2i_ecwa__20170516__20170522__20230608_110016.parquet.gzip\nDelete blob d2i_ecwa__20170523__20170529__20230608_110222.parquet.gzip\nDelete blob d2i_ecwa__20170530__20170605__20230608_110431.parquet.gzip\nDelete blob d2i_ecwa__20170606__20170612__20230610_162054.parquet.gzip\nDelete blob d2i_ecwa__20170613__20170619__20230610_162315.parquet.gzip\nDelete blob d2i_ecwa__20170620__20170626__20230610_162520.parquet.gzip\nDelete blob d2i_ecwa__20170627__20170703__20230610_162730.parquet.gzip\nDelete blob d2i_ecwa__20170704__20170710__20230610_163003.parquet.gzip\nDelete blob d2i_ecwa__20170711__20170717__20230610_163229.parquet.gzip\nDelete blob d2i_ecwa__20170718__20170724__20230610_172735.parquet.gzip\nDelete blob d2i_ecwa__20170725__20170731__20230610_173444.parquet.gzip\nDelete blob d2i_ecwa__20170801__20170801__20230610_173641.parquet.gzip\n\n\nVerify that no files are found in specified bucket\n\nblobs = list(storage_client.list_blobs(bucket_name))\ntry:\n    assert not blobs\n    print(f\"Found no files in bucket {bucket_name}\")\nexcept AssertionError as e:\n    print(f\"{str(e)}Found files in bucket {bucket_name} that were not deleted\")\n\nFound no files in bucket ecwa-raw\n\n\n\n\nBuckets\nDelete specified bucket\n\n\nDeleted bucket ecwa-raw\n\n\nVerify that specified bucket name is not found in list of buckets in Google Cloud project\n\nbuckets = list(storage_client.list_buckets())\nif buckets:\n    df_buckets = pd.DataFrame.from_records(\n        [\n            {\n                \"bucket\": b.name,\n                \"time_created\": b.time_created,\n            }\n            for b in buckets\n        ]\n    )\n    try:\n        assert df_buckets.query(f\"bucket = '{bucket_name}'\").empty\n        print(f\"Did not find bucket {bucket_name}\")\n    except AssertionError as e:\n        print(f\"{str(e)}Found bucket {bucket_name}\")\n        print(\"Showing specified bucket in list of buckets\")\n        display(df_buckets.query(f\"bucket = '{bucket_name}'\"))\nelse:\n    print(\"Found no buckets\")\n\nFound no buckets"
  },
  {
    "objectID": "notebooks/07-cleanup/notebooks/13_cleanup_gcloud.html#local-storage",
    "href": "notebooks/07-cleanup/notebooks/13_cleanup_gcloud.html#local-storage",
    "title": "Cleanup Google Cloud Resources",
    "section": "Local Storage",
    "text": "Local Storage\n\nFiles\n\n\nDeleted local file 1/55 at d2i_ecwa__20160801__20160807__20230611_200354.parquet.gzip\nDeleted local file 2/55 at d2i_ecwa__20160808__20160814__20230611_200726.parquet.gzip\nDeleted local file 3/55 at d2i_ecwa__20160815__20160821__20230611_201100.parquet.gzip\nDeleted local file 4/55 at d2i_ecwa__20160822__20160828__20230611_201420.parquet.gzip\nDeleted local file 5/55 at d2i_ecwa__20160829__20160831__20230611_201631.parquet.gzip\nDeleted local file 6/55 at d2i_ecwa__20160901__20160907__20230611_110546.parquet.gzip\nDeleted local file 7/55 at d2i_ecwa__20160908__20160914__20230611_110929.parquet.gzip\nDeleted local file 8/55 at d2i_ecwa__20160915__20160921__20230611_111509.parquet.gzip\nDeleted local file 9/55 at d2i_ecwa__20160922__20160928__20230611_111820.parquet.gzip\nDeleted local file 10/55 at d2i_ecwa__20160929__20160930__20230611_200041.parquet.gzip\nDeleted local file 11/55 at d2i_ecwa__20161001__20161007__20230611_001001.parquet.gzip\nDeleted local file 12/55 at d2i_ecwa__20161008__20161014__20230611_001454.parquet.gzip\nDeleted local file 13/55 at d2i_ecwa__20161015__20161021__20230611_001736.parquet.gzip\nDeleted local file 14/55 at d2i_ecwa__20161022__20161028__20230611_002043.parquet.gzip\nDeleted local file 15/55 at d2i_ecwa__20161029__20161031__20230611_002432.parquet.gzip\nDeleted local file 16/55 at d2i_ecwa__20161101__20161107__20230530_152206.parquet.gzip\nDeleted local file 17/55 at d2i_ecwa__20161108__20161114__20230530_153238.parquet.gzip\nDeleted local file 18/55 at d2i_ecwa__20161115__20161121__20230530_161342.parquet.gzip\nDeleted local file 19/55 at d2i_ecwa__20161122__20161128__20230604_221113.parquet.gzip\nDeleted local file 20/55 at d2i_ecwa__20161129__20161205__20230604_221445.parquet.gzip\nDeleted local file 21/55 at d2i_ecwa__20161206__20161212__20230605_161513.parquet.gzip\nDeleted local file 22/55 at d2i_ecwa__20161213__20161219__20230605_161840.parquet.gzip\nDeleted local file 23/55 at d2i_ecwa__20161220__20161226__20230605_162156.parquet.gzip\nDeleted local file 24/55 at d2i_ecwa__20161227__20170102__20230605_162544.parquet.gzip\nDeleted local file 25/55 at d2i_ecwa__20170103__20170109__20230605_163214.parquet.gzip\nDeleted local file 26/55 at d2i_ecwa__20170110__20170116__20230605_182959.parquet.gzip\nDeleted local file 27/55 at d2i_ecwa__20170117__20170123__20230605_183349.parquet.gzip\nDeleted local file 28/55 at d2i_ecwa__20170124__20170130__20230605_183616.parquet.gzip\nDeleted local file 29/55 at d2i_ecwa__20170131__20170206__20230605_183843.parquet.gzip\nDeleted local file 30/55 at d2i_ecwa__20170207__20170213__20230606_115635.parquet.gzip\nDeleted local file 31/55 at d2i_ecwa__20170214__20170220__20230606_115920.parquet.gzip\nDeleted local file 32/55 at d2i_ecwa__20170221__20170227__20230606_120157.parquet.gzip\nDeleted local file 33/55 at d2i_ecwa__20170228__20170306__20230606_185806.parquet.gzip\nDeleted local file 34/55 at d2i_ecwa__20170307__20170313__20230606_190156.parquet.gzip\nDeleted local file 35/55 at d2i_ecwa__20170314__20170320__20230606_190448.parquet.gzip\nDeleted local file 36/55 at d2i_ecwa__20170321__20170327__20230606_190722.parquet.gzip\nDeleted local file 37/55 at d2i_ecwa__20170328__20170403__20230606_191150.parquet.gzip\nDeleted local file 38/55 at d2i_ecwa__20170404__20170410__20230607_112502.parquet.gzip\nDeleted local file 39/55 at d2i_ecwa__20170411__20170417__20230607_112711.parquet.gzip\nDeleted local file 40/55 at d2i_ecwa__20170418__20170424__20230607_112923.parquet.gzip\nDeleted local file 41/55 at d2i_ecwa__20170425__20170501__20230607_113247.parquet.gzip\nDeleted local file 42/55 at d2i_ecwa__20170502__20170508__20230607_113605.parquet.gzip\nDeleted local file 43/55 at d2i_ecwa__20170509__20170515__20230608_105750.parquet.gzip\nDeleted local file 44/55 at d2i_ecwa__20170516__20170522__20230608_110016.parquet.gzip\nDeleted local file 45/55 at d2i_ecwa__20170523__20170529__20230608_110222.parquet.gzip\nDeleted local file 46/55 at d2i_ecwa__20170530__20170605__20230608_110431.parquet.gzip\nDeleted local file 47/55 at d2i_ecwa__20170606__20170612__20230610_162054.parquet.gzip\nDeleted local file 48/55 at d2i_ecwa__20170613__20170619__20230610_162315.parquet.gzip\nDeleted local file 49/55 at d2i_ecwa__20170620__20170626__20230610_162520.parquet.gzip\nDeleted local file 50/55 at d2i_ecwa__20170627__20170703__20230610_162730.parquet.gzip\nDeleted local file 51/55 at d2i_ecwa__20170704__20170710__20230610_163003.parquet.gzip\nDeleted local file 52/55 at d2i_ecwa__20170711__20170717__20230610_163229.parquet.gzip\nDeleted local file 53/55 at d2i_ecwa__20170718__20170724__20230610_172735.parquet.gzip\nDeleted local file 54/55 at d2i_ecwa__20170725__20170731__20230610_173444.parquet.gzip\nDeleted local file 55/55 at d2i_ecwa__20170801__20170801__20230610_173641.parquet.gzip"
  }
]