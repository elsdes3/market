<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Machine Learning Project - Upload Audience Data to BigQuery</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../notebooks/05-dash/notebooks/10_dash.html" rel="next">
<link href="../../../notebooks/03-explore/notebooks/08_explore_best_model.html" rel="prev">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Machine Learning Project</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../notebooks/04-upload/notebooks/09_upload.html">Upload Data</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="../../../index.html" class="sidebar-logo-link">
      <img src="../../../images/lorip_square.jpg" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../notebooks/02-train/notebooks/04_train.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Train Model</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../notebooks/02-train/notebooks/05_get_best_model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Register Model</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../notebooks/02-train/notebooks/06_design_experiment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sample Sizes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../notebooks/02-train/notebooks/07_get_audience_cohorts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Get Audience</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../notebooks/03-explore/notebooks/08_explore_best_model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Vital Features</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../notebooks/04-upload/notebooks/09_upload.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Upload Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../notebooks/05-dash/notebooks/10_dash.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dashboard</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../notebooks/02-train/notebooks/11_analyze_campaign_outputs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Post-Campaign</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../notebooks/02-train/notebooks/12_cleanup_mlflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Clean MLFlow</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../notebooks/07-cleanup/notebooks/13_cleanup_gcloud.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Clean GCloud</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="3">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#about" id="toc-about" class="nav-link active" data-scroll-target="#about">About</a></li>
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#order-of-operations" id="toc-order-of-operations" class="nav-link" data-scroll-target="#order-of-operations">Order of Operations</a></li>
  <li><a href="#outputs" id="toc-outputs" class="nav-link" data-scroll-target="#outputs">Outputs</a></li>
  <li><a href="#user-inputs" id="toc-user-inputs" class="nav-link" data-scroll-target="#user-inputs">User Inputs</a></li>
  <li><a href="#get-data" id="toc-get-data" class="nav-link" data-scroll-target="#get-data">Get Data</a>
  <ul class="collapse">
  <li><a href="#feature-importances" id="toc-feature-importances" class="nav-link" data-scroll-target="#feature-importances">Feature Importances</a></li>
  <li><a href="#audience-profiles" id="toc-audience-profiles" class="nav-link" data-scroll-target="#audience-profiles">Audience Profiles</a></li>
  <li><a href="#audience-cohorts" id="toc-audience-cohorts" class="nav-link" data-scroll-target="#audience-cohorts">Audience Cohorts</a></li>
  <li><a href="#audience-sample-cohort-size-requirements-and-metrics" id="toc-audience-sample-cohort-size-requirements-and-metrics" class="nav-link" data-scroll-target="#audience-sample-cohort-size-requirements-and-metrics">Audience Sample (Cohort) Size Requirements and Metrics</a></li>
  <li><a href="#ml-development-data" id="toc-ml-development-data" class="nav-link" data-scroll-target="#ml-development-data">ML Development Data</a></li>
  <li><a href="#conversion-rates-in-development-and-inference" id="toc-conversion-rates-in-development-and-inference" class="nav-link" data-scroll-target="#conversion-rates-in-development-and-inference">Conversion Rates in Development and Inference</a></li>
  <li><a href="#estimated-and-actual-cohort-to-audience-fractions" id="toc-estimated-and-actual-cohort-to-audience-fractions" class="nav-link" data-scroll-target="#estimated-and-actual-cohort-to-audience-fractions">Estimated and Actual Cohort to Audience Fractions</a></li>
  </ul></li>
  <li><a href="#transform-data" id="toc-transform-data" class="nav-link" data-scroll-target="#transform-data">Transform Data</a>
  <ul class="collapse">
  <li><a href="#feature-importances-1" id="toc-feature-importances-1" class="nav-link" data-scroll-target="#feature-importances-1">Feature Importances</a></li>
  <li><a href="#audience-profile" id="toc-audience-profile" class="nav-link" data-scroll-target="#audience-profile">Audience Profile</a></li>
  <li><a href="#audience-cohorts-1" id="toc-audience-cohorts-1" class="nav-link" data-scroll-target="#audience-cohorts-1">Audience Cohorts</a></li>
  <li><a href="#conversion-rates-in-development-and-inference-1" id="toc-conversion-rates-in-development-and-inference-1" class="nav-link" data-scroll-target="#conversion-rates-in-development-and-inference-1">Conversion Rates in Development and Inference</a></li>
  <li><a href="#conversion-rates-aggregated-by-audience-group" id="toc-conversion-rates-aggregated-by-audience-group" class="nav-link" data-scroll-target="#conversion-rates-aggregated-by-audience-group">Conversion Rates Aggregated by Audience Group</a></li>
  <li><a href="#conversion-rates-aggregated-overall" id="toc-conversion-rates-aggregated-overall" class="nav-link" data-scroll-target="#conversion-rates-aggregated-overall">Conversion Rates Aggregated Overall</a></li>
  <li><a href="#combine-aggregated-conversion-rates" id="toc-combine-aggregated-conversion-rates" class="nav-link" data-scroll-target="#combine-aggregated-conversion-rates">Combine Aggregated Conversion Rates</a></li>
  <li><a href="#estimated-and-actual-cohort-to-audience-fractions-1" id="toc-estimated-and-actual-cohort-to-audience-fractions-1" class="nav-link" data-scroll-target="#estimated-and-actual-cohort-to-audience-fractions-1">Estimated and Actual Cohort to Audience Fractions</a></li>
  <li><a href="#ml-development-data-1" id="toc-ml-development-data-1" class="nav-link" data-scroll-target="#ml-development-data-1">ML Development Data</a></li>
  <li><a href="#combine-development-and-cohorts-data" id="toc-combine-development-and-cohorts-data" class="nav-link" data-scroll-target="#combine-development-and-cohorts-data">Combine Development and Cohorts Data</a></li>
  <li><a href="#daily-performance-summary-in-combined-data-by-audience-group" id="toc-daily-performance-summary-in-combined-data-by-audience-group" class="nav-link" data-scroll-target="#daily-performance-summary-in-combined-data-by-audience-group">Daily Performance Summary in Combined Data, by Audience Group</a></li>
  <li><a href="#daily-performance-summary-in-overall-combined-data" id="toc-daily-performance-summary-in-overall-combined-data" class="nav-link" data-scroll-target="#daily-performance-summary-in-overall-combined-data">Daily Performance Summary in Overall Combined Data</a></li>
  <li><a href="#combined-daily-performance-summary" id="toc-combined-daily-performance-summary" class="nav-link" data-scroll-target="#combined-daily-performance-summary">Combined Daily Performance Summary</a></li>
  <li><a href="#monthly-performance-summary-in-combined-data" id="toc-monthly-performance-summary-in-combined-data" class="nav-link" data-scroll-target="#monthly-performance-summary-in-combined-data">Monthly Performance Summary in Combined Data</a></li>
  <li><a href="#categorical-feature-kpis" id="toc-categorical-feature-kpis" class="nav-link" data-scroll-target="#categorical-feature-kpis">Categorical Feature KPIs</a></li>
  <li><a href="#audience-sample-cohort-size-requirements-and-metrics-1" id="toc-audience-sample-cohort-size-requirements-and-metrics-1" class="nav-link" data-scroll-target="#audience-sample-cohort-size-requirements-and-metrics-1">Audience Sample (Cohort) Size Requirements and Metrics</a></li>
  </ul></li>
  <li><a href="#upload-to-bigquery-tables" id="toc-upload-to-bigquery-tables" class="nav-link" data-scroll-target="#upload-to-bigquery-tables">Upload to BigQuery Tables</a>
  <ul class="collapse">
  <li><a href="#audience-feature-importances" id="toc-audience-feature-importances" class="nav-link" data-scroll-target="#audience-feature-importances">Audience Feature Importances</a></li>
  <li><a href="#audience-profile-1" id="toc-audience-profile-1" class="nav-link" data-scroll-target="#audience-profile-1">Audience Profile</a></li>
  <li><a href="#audience-cohorts-2" id="toc-audience-cohorts-2" class="nav-link" data-scroll-target="#audience-cohorts-2">Audience Cohorts</a></li>
  <li><a href="#monthly-performance-summary" id="toc-monthly-performance-summary" class="nav-link" data-scroll-target="#monthly-performance-summary">Monthly Performance Summary</a></li>
  <li><a href="#conversion-rates-in-development-and-inference-2" id="toc-conversion-rates-in-development-and-inference-2" class="nav-link" data-scroll-target="#conversion-rates-in-development-and-inference-2">Conversion Rates in Development and Inference</a></li>
  <li><a href="#estimated-and-actual-cohort-to-audience-fractions-2" id="toc-estimated-and-actual-cohort-to-audience-fractions-2" class="nav-link" data-scroll-target="#estimated-and-actual-cohort-to-audience-fractions-2">Estimated and Actual Cohort to Audience Fractions</a></li>
  <li><a href="#aggregated-conversion-rates" id="toc-aggregated-conversion-rates" class="nav-link" data-scroll-target="#aggregated-conversion-rates">Aggregated Conversion Rates</a></li>
  <li><a href="#daily-performance-summary" id="toc-daily-performance-summary" class="nav-link" data-scroll-target="#daily-performance-summary">Daily Performance Summary</a></li>
  <li><a href="#categorical-feature-kpis-1" id="toc-categorical-feature-kpis-1" class="nav-link" data-scroll-target="#categorical-feature-kpis-1">Categorical Feature KPIs</a></li>
  </ul></li>
  <li><a href="#next-step" id="toc-next-step" class="nav-link" data-scroll-target="#next-step">Next Step</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.dev/elsdes3/market/blob/main/notebooks/04-upload/notebooks/09_upload.ipynb" class="toc-action">Edit this page</a></p><p><a href="https://github.com/elsdes3/market/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Upload Audience Data to BigQuery</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="about" class="level2">
<h2 class="anchored" data-anchor-id="about">About</h2>
</section>
<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>This step will upload the following to separate tables in a private dataset on Google BigQuery</p>
<ol type="1">
<li>predicted audience groups and (test and control) cohorts<sup><a href="#myfootnote1">1</a></sup></li>
<li>audience profiles<sup><a href="#myfootnote1">1</a></sup></li>
<li>monthly performance<sup><a href="#myfootnote1">1</a></sup>, relative to previous months</li>
<li>summary of required sample (cohort) sizes that were estimated in a previous step and metrics per cohort, based on desired inputs (combination of uplift, power, confidence level)</li>
</ol>
<p>These tables will be accessed by the client-facing dashboard.</p>
<p><a name="myfootnote1">1</a>: using inference data</p>
</section>
<section id="order-of-operations" class="level2">
<h2 class="anchored" data-anchor-id="order-of-operations">Order of Operations</h2>
<p>This step can be run prospectively at the end of the inference period, just before the start of the campaign, when all the inference data (first-time visitors to the store) becomes available. This step is needed before the project’s dashboard (main project deliverable) can be created since the dashboard will be populated with the data derived from data uploaded to BigQuery tables in this step.</p>
</section>
<section id="outputs" class="level2">
<h2 class="anchored" data-anchor-id="outputs">Outputs</h2>
<p>The following tables will be created</p>
<ol type="1">
<li>Combined Audience Profile and Feature Importances
<ul>
<li>audience profile consisting of the following for each predicted audience group
<ul>
<li>audience strategy</li>
<li>name of descriptive or behavioral statistic about attribute of first visit</li>
<li>value of statistic in
<ul>
<li>High propensity group of visitors</li>
<li>Medium propensity group of visitors</li>
<li>Low propensity group of visitors</li>
</ul></li>
</ul></li>
<li>ML feature importances
<ul>
<li>audience strategy</li>
<li>number of observations used to learn feature importances</li>
<li>feature name</li>
<li>audience group</li>
<li>feature importance</li>
</ul></li>
</ul></li>
<li>All Available First-Time Visitors and Assigned Audience Groups and Cohorts
<ul>
<li>month during which first-time visitors visited the store site during inference period
<ul>
<li>for development data, no audience or cohorts are assigned</li>
<li>for inference predictions, audience groups and randomly selected cohorts are assigned</li>
</ul></li>
<li>visitor ID from GA360 data</li>
<li>visit ID from GA360 data</li>
<li>visit number from GA360 data</li>
<li>visit start time</li>
<li>quarter of year during which visit occurred</li>
<li>month of year during which visit occurred</li>
<li>day of month during which visit occurred</li>
<li>day of week during which visit occurred</li>
<li>hour of day during which visit occurred</li>
<li>minute of hour during which visit occurred</li>
<li>second of minute during which visit occurred</li>
<li>traffic source from GA360 data</li>
<li>medium from GA360 data</li>
<li>channel from GA360 data</li>
<li>registered hits from GA360 data</li>
<li>bounced visits from GA360 data</li>
<li>last action performed during visit from GA360 data</li>
<li>number of promotions viewed from GA360 data</li>
<li>number of promotions clicked from GA360 data</li>
<li>number of product lists viewed from GA360 data</li>
<li>number of products clicked from GA360 data</li>
<li>pageviews from GA360 data</li>
<li>time spent on store site from GA360 data</li>
<li>browser used to access store site from GA360 data</li>
<li>operating system used to access store site from GA360 data</li>
<li>category of device used to access store site from GA360 data</li>
<li>whether a product was added to the shopping cart during first visit from GA360 data</li>
<li>revenue during first visit from GA360 data</li>
<li>predicted propensity for making a purchase during a return visit</li>
<li>predicted audience group</li>
<li>predicted cohort (test or control)</li>
<li>audience strategy (single- or multiple-audience)</li>
<li>true outcome (whether a purchase was made on a return visit to the store)
<ul>
<li>missing for inference data</li>
</ul></li>
<li>type of data (development - <code>train_val</code>/<code>test</code> - or inference - <code>infer</code>)</li>
</ul></li>
<li>Monthly Summary Statistics (Overall)
<ul>
<li>month during which first-time visitors visited the store site during inference period</li>
<li>type of data (development - <code>train_val</code>/<code>test</code> - or inference - <code>infer</code>)</li>
<li>total number of return purchasers</li>
<li>total revenue</li>
<li>total number of first-time visitors</li>
<li>total pageviews</li>
<li>average time spent on the store site</li>
<li>most populat channel</li>
<li>most popular category of device</li>
<li>most popular browser</li>
<li>most popular operating system</li>
<li>audience strategy (single- or multiple-audience)</li>
<li>bounce rate</li>
<li>product click rate</li>
<li>add-to-cart rate</li>
<li>type of visitor (development or inference)</li>
<li>conversion rate</li>
<li>rate of change in the following relative to the previous month
<ul>
<li>total number of return purchasers (development) or first-time visitors (inference)</li>
<li>total revenue</li>
<li>total pageviews</li>
<li>average time spent on the store site</li>
<li>bounce rate</li>
<li>conversion rate</li>
<li>product click rate</li>
<li>add-to-cart rate</li>
</ul></li>
</ul></li>
<li>Conversion Rates During Development and Inference
<ul>
<li>over the period covering the development and inference data
<ul>
<li>audience strategy (single- or multiple-audience)</li>
<li>month during which first-time visitors visited the store site during inference period</li>
<li>audience group (eg. High, Medium, Low predicted propensity)</li>
<li>predicted conversions</li>
<li>total number of visitors per audience group</li>
<li>minimum score</li>
<li>true number of conversions per audience group</li>
<li>type of visitor (development or inference)</li>
<li>total number of each type of visitor</li>
<li>true conversion rate per audience group</li>
<li>overall true conversion rate</li>
<li>predicted conversion rate per audience group</li>
<li>overall predicted conversion rate</li>
</ul></li>
</ul></li>
<li>Estimated and Actual Fractions of Cohort to Audience Size
<ul>
<li>over the period covering the development and inference data
<ul>
<li>audience strategy (single- or multiple-audience)</li>
<li>month during which first-time visitors visited the store site during inference period</li>
<li>audience group (eg. High, Medium, Low predicted propensity)</li>
<li>cohort (test or control)</li>
<li>cohort size</li>
<li>audience size</li>
<li>required uplift, power and confidence level used to estimate cohort size</li>
<li>ratio of cohort to audience sizes</li>
<li>type of cohort size
<ul>
<li>development (estimated based on required uplift, power and confidence level)</li>
<li>inference (assigned using estimates during development)</li>
</ul></li>
<li>type of visitor (development or inference)</li>
<li>total number of each type of visitor</li>
</ul></li>
</ul></li>
<li>Aggregated Conversion Rates During Development and Inference (by Audience Group &amp; Overall)
<ul>
<li>over the period covering the development and inference data
<ul>
<li>audience group (eg. High, Medium, Low predicted propensity)</li>
<li>data_type (development or inference)</li>
<li>true or predicted conversion rate</li>
</ul></li>
</ul></li>
<li>Daily Summary Statistics by Audience Group and Overall
<ul>
<li>over the period covering the development and inference data
<ul>
<li>total number of return purchasers</li>
<li>total revenue</li>
<li>total number of first-time visitors</li>
<li>total number of add-to-cart actions performed</li>
<li>total pageviews</li>
<li>average time spent on the store site</li>
<li>total product lists viewed</li>
<li>total products clicked on</li>
<li>total number of bounce events</li>
<li>audience strategy (single- or multiple-audience)</li>
<li>bounce rate</li>
<li>product click rate</li>
<li>add-to-cart rate</li>
<li>type of visitor (development or inference)</li>
<li>aggregation type (by audience group or overall)</li>
</ul></li>
</ul></li>
<li>KPIs by categorical feature
<ul>
<li>over the period covering the test split of the development data, show the following by sub-category
<ul>
<li>categorical feature</li>
<li>categorical feature value (sub-category)</li>
<li>number of conversions</li>
<li>number of visitors</li>
<li>average conversion rate</li>
<li>average clickthrough rate</li>
<li>total number of conversions</li>
<li>total number of clicks</li>
<li>total product lists viewed</li>
<li>total products clicked on</li>
<li>total revenue</li>
<li>total number of visitors</li>
</ul></li>
</ul></li>
</ol>
</section>
<section id="user-inputs" class="level2">
<h2 class="anchored" data-anchor-id="user-inputs">User Inputs</h2>
<p>Define the following</p>
<ol type="1">
<li>best MLFlow run ID</li>
<li>list of categorical features</li>
<li>list of numerical features</li>
<li>BigQuery
<ul>
<li>dataset id</li>
<li>table ids for audience
<ul>
<li>cohorts</li>
<li>profile</li>
</ul></li>
</ul></li>
<li>dictionary to map profile statistic type to description</li>
<li>inputs (uplift, power, confidence level) for which random cohort sizes were estimated during an earlier step</li>
<li>type of audience strategy (single- or multi- group) from which cohorts were created during an earlier step</li>
</ol>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>best_run_id <span class="op">=</span> <span class="st">"f805253a6ba64ee6a41bf14310ef16a4"</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. categorical column</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>categorical_features <span class="op">=</span> [</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"bounces"</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"last_action"</span>,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"source"</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"medium"</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"channelGrouping"</span>,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"browser"</span>,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"os"</span>,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"deviceCategory"</span>,</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. numerical columns</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>numerical_features <span class="op">=</span> [</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"hits"</span>,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"promos_displayed"</span>,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"promos_clicked"</span>,</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"product_views"</span>,</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"product_clicks"</span>,</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pageviews"</span>,</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"time_on_site"</span>,</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. GCP resources</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>gbq_dataset_id <span class="op">=</span> <span class="st">'mydemo2asdf'</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>gbq_table_id_cohorts <span class="op">=</span> <span class="st">'audience_cohorts'</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>gbq_table_id_profiles <span class="op">=</span> <span class="st">'audience_profiles'</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>gbq_table_id_sample_sizes <span class="op">=</span> <span class="st">'audience_sample_sizes'</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>gbq_table_feats_imps <span class="op">=</span> <span class="st">'audience_feats_imp'</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>gbq_table_id_summary <span class="op">=</span> <span class="st">'monthly_summary'</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>gbq_table_id_sa_fracs <span class="op">=</span> <span class="st">"cohort_audience_fractions"</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>gbq_table_id_conv_rates <span class="op">=</span> <span class="st">"audience_conversion_rates"</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>gbq_table_id_conv_rates_agg_combo <span class="op">=</span> <span class="st">"conversion_rates_aggregated"</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>gbq_table_id_daily_perf <span class="op">=</span> <span class="st">"daily_summary"</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>gbq_table_id_cat_feats_kpis <span class="op">=</span> <span class="st">"categorical_features_kpis"</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. dictionary to map statistic type to description</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>stat_type_desc_mapper_dict <span class="op">=</span> {</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">"behavior"</span>: <span class="st">"Behavioral"</span>,</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean"</span>: <span class="st">"Descriptive statistics"</span>,</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mode"</span>: <span class="st">"Descriptive statistics"</span>,</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">"max"</span>: <span class="st">"Descriptive statistics"</span>,</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    <span class="st">"feature_importance"</span>: <span class="st">"Most important ML features"</span>,</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. inputs used to estimate sample sizes</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>wanted_inputs <span class="op">=</span> {</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    <span class="st">"uplift_percentage"</span>: <span class="dv">10</span>,</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    <span class="st">"power_percentage"</span>: <span class="dv">55</span>,</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    <span class="st">"confidence_level_percentage"</span>: <span class="dv">55</span>,</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. type of audience strategy to use when creating groups</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>audience_strategy <span class="op">=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="get-data" class="level2">
<h2 class="anchored" data-anchor-id="get-data">Get Data</h2>
<section id="feature-importances" class="level3">
<h3 class="anchored" data-anchor-id="feature-importances">Feature Importances</h3>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df_feats <span class="op">=</span> (</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    pd.read_parquet(fpath_feat_imps)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># select only wanted columns</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    [[<span class="st">'audience_strategy'</span>, <span class="st">'num_observations'</span>, <span class="st">'stat'</span>, <span class="st">'maudience'</span>, <span class="st">'value'</span>]]</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>display(df_feats.head())</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>summarize_df(df_feats)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">audience_strategy</th>
<th data-quarto-table-cell-role="th">num_observations</th>
<th data-quarto-table-cell-role="th">stat</th>
<th data-quarto-table-cell-role="th">maudience</th>
<th data-quarto-table-cell-role="th">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>500</td>
<td>os__Windows</td>
<td>High</td>
<td>0.812657</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>500</td>
<td>last_action__Click through of product lists</td>
<td>High</td>
<td>0.754545</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>500</td>
<td>os__Samsung</td>
<td>High</td>
<td>0.666231</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>500</td>
<td>hits</td>
<td>High</td>
<td>0.564772</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1</td>
<td>500</td>
<td>os__Nokia</td>
<td>High</td>
<td>0.446324</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">column</th>
<th data-quarto-table-cell-role="th">dtype</th>
<th data-quarto-table-cell-role="th">missing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>audience_strategy</td>
<td>Int8</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>num_observations</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>stat</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>maudience</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>value</td>
<td>Float64</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="audience-profiles" class="level3">
<h3 class="anchored" data-anchor-id="audience-profiles">Audience Profiles</h3>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df_profile <span class="op">=</span> pd.read_parquet(fpath_profile)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>display(df_profile.head())</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>summarize_df(df_profile)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">stat</th>
<th data-quarto-table-cell-role="th">stat_type</th>
<th data-quarto-table-cell-role="th">High</th>
<th data-quarto-table-cell-role="th">Low</th>
<th data-quarto-table-cell-role="th">Medium</th>
<th data-quarto-table-cell-role="th">feature</th>
<th data-quarto-table-cell-role="th">audience_strategy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>hour__mean</td>
<td>mean</td>
<td>12.988829127016963</td>
<td>13.004689008412633</td>
<td>13.03503448275862</td>
<td>hour</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>day_of_week__mean</td>
<td>mean</td>
<td>4.027858226451524</td>
<td>3.991035719211143</td>
<td>3.993793103448276</td>
<td>day_of_week</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>source__mode</td>
<td>mode</td>
<td>google</td>
<td>google</td>
<td>google</td>
<td>source</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>medium__mode</td>
<td>mode</td>
<td>organic</td>
<td>organic</td>
<td>organic</td>
<td>medium</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>channelGrouping__mode</td>
<td>mode</td>
<td>Organic Search</td>
<td>Organic Search</td>
<td>Organic Search</td>
<td>channelGrouping</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">column</th>
<th data-quarto-table-cell-role="th">dtype</th>
<th data-quarto-table-cell-role="th">missing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>stat</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>stat_type</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>High</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Low</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Medium</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>feature</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>audience_strategy</td>
<td>Int8</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="audience-cohorts" class="level3">
<h3 class="anchored" data-anchor-id="audience-cohorts">Audience Cohorts</h3>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df_cohorts <span class="op">=</span> pd.read_parquet(fpath_cohorts).astype({<span class="st">"bounces"</span>: pd.Int64Dtype()})</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>display(df_cohorts.head())</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>summarize_df(df_cohorts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">fullvisitorid</th>
<th data-quarto-table-cell-role="th">visitId</th>
<th data-quarto-table-cell-role="th">visitNumber</th>
<th data-quarto-table-cell-role="th">visitStartTime</th>
<th data-quarto-table-cell-role="th">quarter</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">day_of_month</th>
<th data-quarto-table-cell-role="th">day_of_week</th>
<th data-quarto-table-cell-role="th">hour</th>
<th data-quarto-table-cell-role="th">minute</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">browser</th>
<th data-quarto-table-cell-role="th">os</th>
<th data-quarto-table-cell-role="th">deviceCategory</th>
<th data-quarto-table-cell-role="th">added_to_cart</th>
<th data-quarto-table-cell-role="th">revenue</th>
<th data-quarto-table-cell-role="th">score</th>
<th data-quarto-table-cell-role="th">predicted_score_label</th>
<th data-quarto-table-cell-role="th">maudience</th>
<th data-quarto-table-cell-role="th">cohort</th>
<th data-quarto-table-cell-role="th">audience_strategy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>7701350257079842191</td>
<td>1488377334</td>
<td>1</td>
<td>2017-03-01 06:08:54</td>
<td>1</td>
<td>3</td>
<td>1</td>
<td>4</td>
<td>6</td>
<td>8</td>
<td>...</td>
<td>Chrome</td>
<td>Macintosh</td>
<td>desktop</td>
<td>0</td>
<td>&lt;NA&gt;</td>
<td>0.961501</td>
<td>False</td>
<td>High</td>
<td>Control</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1927404893298120774</td>
<td>1489438559</td>
<td>1</td>
<td>2017-03-13 13:55:59</td>
<td>1</td>
<td>3</td>
<td>13</td>
<td>2</td>
<td>13</td>
<td>55</td>
<td>...</td>
<td>Chrome</td>
<td>Windows</td>
<td>desktop</td>
<td>0</td>
<td>&lt;NA&gt;</td>
<td>0.884723</td>
<td>False</td>
<td>High</td>
<td>Control</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>4081311830661383532</td>
<td>1489678740</td>
<td>1</td>
<td>2017-03-16 08:39:00</td>
<td>1</td>
<td>3</td>
<td>16</td>
<td>5</td>
<td>8</td>
<td>39</td>
<td>...</td>
<td>Chrome</td>
<td>Chrome OS</td>
<td>desktop</td>
<td>0</td>
<td>&lt;NA&gt;</td>
<td>0.879829</td>
<td>False</td>
<td>High</td>
<td>Control</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>48980746408094895</td>
<td>1489003955</td>
<td>1</td>
<td>2017-03-08 12:12:35</td>
<td>1</td>
<td>3</td>
<td>8</td>
<td>4</td>
<td>12</td>
<td>12</td>
<td>...</td>
<td>Chrome</td>
<td>Windows</td>
<td>desktop</td>
<td>0</td>
<td>&lt;NA&gt;</td>
<td>0.866037</td>
<td>False</td>
<td>High</td>
<td>Control</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0480615828723852227</td>
<td>1490621968</td>
<td>1</td>
<td>2017-03-27 06:39:28</td>
<td>1</td>
<td>3</td>
<td>27</td>
<td>2</td>
<td>6</td>
<td>39</td>
<td>...</td>
<td>Chrome</td>
<td>Macintosh</td>
<td>desktop</td>
<td>0</td>
<td>&lt;NA&gt;</td>
<td>0.864021</td>
<td>False</td>
<td>High</td>
<td>Control</td>
<td>1</td>
</tr>
</tbody>
</table>

<p>5 rows × 33 columns</p>
</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">column</th>
<th data-quarto-table-cell-role="th">dtype</th>
<th data-quarto-table-cell-role="th">missing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>fullvisitorid</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>visitId</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>visitNumber</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>visitStartTime</td>
<td>datetime64[ns]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>quarter</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>month</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>day_of_month</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>day_of_week</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>hour</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>minute</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>second</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>source</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>medium</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>channelGrouping</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>hits</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>bounces</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>last_action</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>promos_displayed</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>promos_clicked</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>product_views</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>product_clicks</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>pageviews</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>time_on_site</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>browser</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>os</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>deviceCategory</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>added_to_cart</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>revenue</td>
<td>Float64</td>
<td>21010</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>score</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>predicted_score_label</td>
<td>boolean</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>maudience</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>cohort</td>
<td>string[python]</td>
<td>8390</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>audience_strategy</td>
<td>Int8</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="audience-sample-cohort-size-requirements-and-metrics" class="level3">
<h3 class="anchored" data-anchor-id="audience-sample-cohort-size-requirements-and-metrics">Audience Sample (Cohort) Size Requirements and Metrics</h3>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df_required_sample_sizes <span class="op">=</span> (</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    pd.read_parquet(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        fpath_aud_sizes,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="co"># filters=[</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     ('audience_strategy', '=', audience_strategy)</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ]# + [</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     (k, "=", v)</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     for k,v in zip(</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">#         ['uplift', 'power', 'ci_level'],</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">#         list(wanted_inputs.values()),</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     )</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ],</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># select only wanted columns</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span>[<span class="st">'group_number'</span>, <span class="st">'group_size_proportion'</span>])</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>display(df_required_sample_sizes.head())</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>summarize_df(df_required_sample_sizes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">maudience</th>
<th data-quarto-table-cell-role="th">group_size</th>
<th data-quarto-table-cell-role="th">group_min_propensity</th>
<th data-quarto-table-cell-role="th">group_conv_rate</th>
<th data-quarto-table-cell-role="th">ctr</th>
<th data-quarto-table-cell-role="th">revenue</th>
<th data-quarto-table-cell-role="th">bounce_rate</th>
<th data-quarto-table-cell-role="th">uplift</th>
<th data-quarto-table-cell-role="th">power</th>
<th data-quarto-table-cell-role="th">ci_level</th>
<th data-quarto-table-cell-role="th">required_sample_size</th>
<th data-quarto-table-cell-role="th">audience_strategy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>High</td>
<td>6721</td>
<td>0.096287</td>
<td>2.216932</td>
<td>2.653428</td>
<td>37589.59</td>
<td>35.396518</td>
<td>15</td>
<td>90</td>
<td>95</td>
<td>20598</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>High</td>
<td>6721</td>
<td>0.096287</td>
<td>2.216932</td>
<td>2.653428</td>
<td>37589.59</td>
<td>35.396518</td>
<td>10</td>
<td>90</td>
<td>66</td>
<td>21966</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>High</td>
<td>6721</td>
<td>0.096287</td>
<td>2.216932</td>
<td>2.653428</td>
<td>37589.59</td>
<td>35.396518</td>
<td>10</td>
<td>90</td>
<td>67</td>
<td>22372</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>High</td>
<td>6721</td>
<td>0.096287</td>
<td>2.216932</td>
<td>2.653428</td>
<td>37589.59</td>
<td>35.396518</td>
<td>10</td>
<td>90</td>
<td>68</td>
<td>22787</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>High</td>
<td>6721</td>
<td>0.096287</td>
<td>2.216932</td>
<td>2.653428</td>
<td>37589.59</td>
<td>35.396518</td>
<td>10</td>
<td>90</td>
<td>69</td>
<td>23214</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">column</th>
<th data-quarto-table-cell-role="th">dtype</th>
<th data-quarto-table-cell-role="th">missing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>maudience</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>group_size</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>group_min_propensity</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>group_conv_rate</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>ctr</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>revenue</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>bounce_rate</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>uplift</td>
<td>Int8</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>power</td>
<td>Int8</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>ci_level</td>
<td>Int8</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>required_sample_size</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>audience_strategy</td>
<td>int64</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="ml-development-data" class="level3">
<h3 class="anchored" data-anchor-id="ml-development-data">ML Development Data</h3>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df_development <span class="op">=</span> (</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    pd.read_parquet(fpath_development)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    .astype(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">"predicted_label"</span>: pd.Int64Dtype(),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"bounces"</span>: pd.Int64Dtype(),</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>display(df_development.head())</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>summarize_df(df_development)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">fullvisitorid</th>
<th data-quarto-table-cell-role="th">visitId</th>
<th data-quarto-table-cell-role="th">visitNumber</th>
<th data-quarto-table-cell-role="th">visitStartTime</th>
<th data-quarto-table-cell-role="th">quarter</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">day_of_month</th>
<th data-quarto-table-cell-role="th">day_of_week</th>
<th data-quarto-table-cell-role="th">hour</th>
<th data-quarto-table-cell-role="th">minute</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">browser</th>
<th data-quarto-table-cell-role="th">os</th>
<th data-quarto-table-cell-role="th">deviceCategory</th>
<th data-quarto-table-cell-role="th">added_to_cart</th>
<th data-quarto-table-cell-role="th">revenue</th>
<th data-quarto-table-cell-role="th">made_purchase_on_future_visit</th>
<th data-quarto-table-cell-role="th">split_type</th>
<th data-quarto-table-cell-role="th">score</th>
<th data-quarto-table-cell-role="th">predicted_score_label</th>
<th data-quarto-table-cell-role="th">predicted_label</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>4157301099254368232</td>
<td>1476636342</td>
<td>1</td>
<td>2016-10-16 09:45:42</td>
<td>4</td>
<td>10</td>
<td>16</td>
<td>1</td>
<td>9</td>
<td>45</td>
<td>...</td>
<td>Safari</td>
<td>Macintosh</td>
<td>desktop</td>
<td>0</td>
<td>&lt;NA&gt;</td>
<td>1</td>
<td>train_val</td>
<td>0.058666</td>
<td>True</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>786312091291497372</td>
<td>1481408395</td>
<td>1</td>
<td>2016-12-10 14:19:55</td>
<td>4</td>
<td>12</td>
<td>10</td>
<td>7</td>
<td>14</td>
<td>19</td>
<td>...</td>
<td>Chrome</td>
<td>Chrome OS</td>
<td>desktop</td>
<td>0</td>
<td>&lt;NA&gt;</td>
<td>0</td>
<td>train_val</td>
<td>0.130899</td>
<td>True</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>322228537289095245</td>
<td>1482626483</td>
<td>1</td>
<td>2016-12-24 16:41:23</td>
<td>4</td>
<td>12</td>
<td>24</td>
<td>7</td>
<td>16</td>
<td>41</td>
<td>...</td>
<td>Chrome</td>
<td>Windows</td>
<td>desktop</td>
<td>1</td>
<td>52.99</td>
<td>0</td>
<td>train_val</td>
<td>0.000751</td>
<td>True</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7808115684091011900</td>
<td>1482430339</td>
<td>1</td>
<td>2016-12-22 10:12:19</td>
<td>4</td>
<td>12</td>
<td>22</td>
<td>5</td>
<td>10</td>
<td>12</td>
<td>...</td>
<td>Chrome</td>
<td>Windows</td>
<td>desktop</td>
<td>0</td>
<td>&lt;NA&gt;</td>
<td>0</td>
<td>train_val</td>
<td>0.02076</td>
<td>True</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>9442018438865871704</td>
<td>1484757590</td>
<td>1</td>
<td>2017-01-18 08:39:50</td>
<td>1</td>
<td>1</td>
<td>18</td>
<td>4</td>
<td>8</td>
<td>39</td>
<td>...</td>
<td>Chrome</td>
<td>Windows</td>
<td>desktop</td>
<td>0</td>
<td>&lt;NA&gt;</td>
<td>0</td>
<td>train_val</td>
<td>0.202944</td>
<td>True</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>5 rows × 33 columns</p>
</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">column</th>
<th data-quarto-table-cell-role="th">dtype</th>
<th data-quarto-table-cell-role="th">missing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>fullvisitorid</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>visitId</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>visitNumber</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>visitStartTime</td>
<td>datetime64[ns]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>quarter</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>month</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>day_of_month</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>day_of_week</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>hour</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>minute</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>second</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>source</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>medium</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>channelGrouping</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>hits</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>bounces</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>last_action</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>promos_displayed</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>promos_clicked</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>product_views</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>product_clicks</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>pageviews</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>time_on_site</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>browser</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>os</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>deviceCategory</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>added_to_cart</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>revenue</td>
<td>Float64</td>
<td>129291</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>made_purchase_on_future_visit</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>split_type</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>score</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>predicted_score_label</td>
<td>boolean</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>predicted_label</td>
<td>Int64</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="conversion-rates-in-development-and-inference" class="level3">
<h3 class="anchored" data-anchor-id="conversion-rates-in-development-and-inference">Conversion Rates in Development and Inference</h3>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df_conv_rates <span class="op">=</span> pd.read_parquet(fpath_conv_rates)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>display(df_conv_rates.head())</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>summarize_df(df_conv_rates)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">audience_strategy</th>
<th data-quarto-table-cell-role="th">maudience</th>
<th data-quarto-table-cell-role="th">pred_conversions</th>
<th data-quarto-table-cell-role="th">total_visitors</th>
<th data-quarto-table-cell-role="th">min_score</th>
<th data-quarto-table-cell-role="th">true_conversions</th>
<th data-quarto-table-cell-role="th">data_type</th>
<th data-quarto-table-cell-role="th">data_size</th>
<th data-quarto-table-cell-role="th">true_conv_rate</th>
<th data-quarto-table-cell-role="th">overall_true_conv_rate</th>
<th data-quarto-table-cell-role="th">pred_conv_rate</th>
<th data-quarto-table-cell-role="th">overall_pred_conv_rate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>High</td>
<td>850</td>
<td>6722</td>
<td>0.095656</td>
<td>149</td>
<td>development</td>
<td>20164</td>
<td>2.216602</td>
<td>2.30609</td>
<td>12.645046</td>
<td>4.215433</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>Low</td>
<td>0</td>
<td>6721</td>
<td>0.0</td>
<td>152</td>
<td>development</td>
<td>20164</td>
<td>2.261568</td>
<td>2.30609</td>
<td>0.0</td>
<td>4.215433</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>Medium</td>
<td>0</td>
<td>6721</td>
<td>0.00911</td>
<td>164</td>
<td>development</td>
<td>20164</td>
<td>2.440113</td>
<td>2.30609</td>
<td>0.0</td>
<td>4.215433</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>High</td>
<td>975</td>
<td>7251</td>
<td>0.098362</td>
<td>&lt;NA&gt;</td>
<td>inference</td>
<td>21752</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
<td>13.446421</td>
<td>4.482346</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1</td>
<td>Low</td>
<td>0</td>
<td>7251</td>
<td>0.0</td>
<td>&lt;NA&gt;</td>
<td>inference</td>
<td>21752</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
<td>0.0</td>
<td>4.482346</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">column</th>
<th data-quarto-table-cell-role="th">dtype</th>
<th data-quarto-table-cell-role="th">missing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>audience_strategy</td>
<td>Int8</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>maudience</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>pred_conversions</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>total_visitors</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>min_score</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>true_conversions</td>
<td>Int64</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>data_type</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>data_size</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>true_conv_rate</td>
<td>Float64</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>overall_true_conv_rate</td>
<td>Float64</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>pred_conv_rate</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>overall_pred_conv_rate</td>
<td>Float64</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="estimated-and-actual-cohort-to-audience-fractions" class="level3">
<h3 class="anchored" data-anchor-id="estimated-and-actual-cohort-to-audience-fractions">Estimated and Actual Cohort to Audience Fractions</h3>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df_sa_frac <span class="op">=</span> pd.read_parquet(fpath_sa_frac)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>display(df_sa_frac.head())</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>summarize_df(df_sa_frac)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">maudience</th>
<th data-quarto-table-cell-role="th">cohort</th>
<th data-quarto-table-cell-role="th">size</th>
<th data-quarto-table-cell-role="th">group_size</th>
<th data-quarto-table-cell-role="th">uplift</th>
<th data-quarto-table-cell-role="th">power</th>
<th data-quarto-table-cell-role="th">ci_level</th>
<th data-quarto-table-cell-role="th">samp_to_aud_frac</th>
<th data-quarto-table-cell-role="th">size_type</th>
<th data-quarto-table-cell-role="th">data_type</th>
<th data-quarto-table-cell-role="th">data_size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>High</td>
<td>Test</td>
<td>2146</td>
<td>6721</td>
<td>10</td>
<td>55</td>
<td>55</td>
<td>31.929772</td>
<td>required</td>
<td>development</td>
<td>20164</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>High</td>
<td>Control</td>
<td>2146</td>
<td>6721</td>
<td>10</td>
<td>55</td>
<td>55</td>
<td>31.929772</td>
<td>required</td>
<td>development</td>
<td>20164</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Medium</td>
<td>Test</td>
<td>1945</td>
<td>6721</td>
<td>10</td>
<td>55</td>
<td>55</td>
<td>28.939146</td>
<td>required</td>
<td>development</td>
<td>20164</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Medium</td>
<td>Control</td>
<td>1945</td>
<td>6721</td>
<td>10</td>
<td>55</td>
<td>55</td>
<td>28.939146</td>
<td>required</td>
<td>development</td>
<td>20164</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Low</td>
<td>Test</td>
<td>2103</td>
<td>6722</td>
<td>10</td>
<td>55</td>
<td>55</td>
<td>31.285332</td>
<td>required</td>
<td>development</td>
<td>20164</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">column</th>
<th data-quarto-table-cell-role="th">dtype</th>
<th data-quarto-table-cell-role="th">missing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>maudience</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>cohort</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>size</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>group_size</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>uplift</td>
<td>Int8</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>power</td>
<td>Int8</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>ci_level</td>
<td>Int8</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>samp_to_aud_frac</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>size_type</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>data_type</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>data_size</td>
<td>Int64</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="transform-data" class="level2">
<h2 class="anchored" data-anchor-id="transform-data">Transform Data</h2>
<section id="feature-importances-1" class="level3">
<h3 class="anchored" data-anchor-id="feature-importances-1">Feature Importances</h3>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df_feats <span class="op">=</span> (</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    df_feats.assign(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>        stat<span class="op">=</span><span class="kw">lambda</span> df: (</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>            df[<span class="st">"stat"</span>].<span class="bu">str</span>.replace(<span class="st">"__"</span>, <span class="st">" = "</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>            .<span class="bu">str</span>.replace(<span class="st">" = 1"</span>, <span class="st">" = True"</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>            .<span class="bu">str</span>.replace(<span class="st">"_"</span>, <span class="st">" "</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>display(df_feats.head())</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>summarize_df(df_feats)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">audience_strategy</th>
<th data-quarto-table-cell-role="th">num_observations</th>
<th data-quarto-table-cell-role="th">stat</th>
<th data-quarto-table-cell-role="th">maudience</th>
<th data-quarto-table-cell-role="th">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>500</td>
<td>os = Windows</td>
<td>High</td>
<td>0.812657</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>500</td>
<td>last action = Click through of product lists</td>
<td>High</td>
<td>0.754545</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>500</td>
<td>os = Samsung</td>
<td>High</td>
<td>0.666231</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>500</td>
<td>hits</td>
<td>High</td>
<td>0.564772</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1</td>
<td>500</td>
<td>os = Nokia</td>
<td>High</td>
<td>0.446324</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">column</th>
<th data-quarto-table-cell-role="th">dtype</th>
<th data-quarto-table-cell-role="th">missing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>audience_strategy</td>
<td>Int8</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>num_observations</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>stat</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>maudience</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>value</td>
<td>Float64</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="audience-profile" class="level3">
<h3 class="anchored" data-anchor-id="audience-profile">Audience Profile</h3>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df_profile_sliced <span class="op">=</span> (</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    df_profile</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get behavioral and (average) descriptive statistics</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    .query(<span class="st">"(stat_type == 'behavior') | (stat.str.endswith('mean'))"</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make stat column more reader friendly</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    .assign(</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        stat_expanded<span class="op">=</span><span class="kw">lambda</span> df: (</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>            df[<span class="st">"stat"</span>]</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>            .<span class="bu">str</span>.replace(<span class="st">"__1"</span>, <span class="st">" = True"</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>            .<span class="bu">str</span>.replace(<span class="st">"__0"</span>, <span class="st">" = False"</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>            .<span class="bu">str</span>.replace(<span class="st">"__"</span>, <span class="st">" = "</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>            .<span class="bu">str</span>.replace(<span class="st">"_"</span>, <span class="st">" "</span>)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>            .<span class="bu">str</span>.replace(<span class="st">"= mean"</span>, <span class="st">"(Mean)"</span>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>            .<span class="bu">str</span>.title()</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># drop unwanted columns</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span>[<span class="st">'stat'</span>])</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># rename columns to titlecase</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    .rename(columns<span class="op">=</span><span class="bu">str</span>.title)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># set datatypes</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    .astype(</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Audience_Strategy'</span>: pd.Int8Dtype(),</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Stat_Expanded"</span>: pd.StringDtype(),</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">"High"</span>: pd.Float64Dtype(),  <span class="co"># Float32Dtype</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Medium"</span>: pd.Float64Dtype(),  <span class="co"># Float32Dtype</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Low"</span>: pd.Float64Dtype(),  <span class="co"># Float32Dtype</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># select only wanted columns</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    [[<span class="st">'Audience_Strategy'</span>, <span class="st">'Stat_Expanded'</span>, <span class="st">'High'</span>, <span class="st">'Medium'</span>, <span class="st">'Low'</span>]]</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>display(df_profile_sliced.head())</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>summarize_df(df_profile_sliced)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Audience_Strategy</th>
<th data-quarto-table-cell-role="th">Stat_Expanded</th>
<th data-quarto-table-cell-role="th">High</th>
<th data-quarto-table-cell-role="th">Medium</th>
<th data-quarto-table-cell-role="th">Low</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>Hour (Mean)</td>
<td>12.988829</td>
<td>13.035034</td>
<td>13.004689</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>Day Of Week (Mean)</td>
<td>4.027858</td>
<td>3.993793</td>
<td>3.991036</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>Hits (Mean)</td>
<td>6.459109</td>
<td>6.197655</td>
<td>6.40822</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>Promos Displayed (Mean)</td>
<td>8.585436</td>
<td>8.441379</td>
<td>8.677286</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1</td>
<td>Promos Clicked (Mean)</td>
<td>0.000138</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">column</th>
<th data-quarto-table-cell-role="th">dtype</th>
<th data-quarto-table-cell-role="th">missing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Audience_Strategy</td>
<td>Int8</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Stat_Expanded</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>High</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Medium</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Low</td>
<td>Float64</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="audience-cohorts-1" class="level3">
<h3 class="anchored" data-anchor-id="audience-cohorts-1">Audience Cohorts</h3>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df_cohorts <span class="op">=</span> (</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    df_cohorts</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    .assign(made_purchase_on_future_visit<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    .assign(split_type<span class="op">=</span><span class="st">'infer'</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    .assign(infer_month<span class="op">=</span>infer_month_feats)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    .astype(</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">'split_type'</span>: pd.StringDtype(),</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"infer_month"</span>: pd.StringDtype(),</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"made_purchase_on_future_visit"</span>: pd.BooleanDtype(),</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>col <span class="op">=</span> df_cohorts.pop(<span class="st">"infer_month"</span>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>df_cohorts.insert(<span class="dv">0</span>, col.name, col)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> pd.option_context(<span class="st">'display.max_columns'</span>, <span class="va">None</span>):</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    display(df_cohorts.head())</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>summarize_df(df_cohorts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">infer_month</th>
<th data-quarto-table-cell-role="th">fullvisitorid</th>
<th data-quarto-table-cell-role="th">visitId</th>
<th data-quarto-table-cell-role="th">visitNumber</th>
<th data-quarto-table-cell-role="th">visitStartTime</th>
<th data-quarto-table-cell-role="th">quarter</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">day_of_month</th>
<th data-quarto-table-cell-role="th">day_of_week</th>
<th data-quarto-table-cell-role="th">hour</th>
<th data-quarto-table-cell-role="th">minute</th>
<th data-quarto-table-cell-role="th">second</th>
<th data-quarto-table-cell-role="th">source</th>
<th data-quarto-table-cell-role="th">medium</th>
<th data-quarto-table-cell-role="th">channelGrouping</th>
<th data-quarto-table-cell-role="th">hits</th>
<th data-quarto-table-cell-role="th">bounces</th>
<th data-quarto-table-cell-role="th">last_action</th>
<th data-quarto-table-cell-role="th">promos_displayed</th>
<th data-quarto-table-cell-role="th">promos_clicked</th>
<th data-quarto-table-cell-role="th">product_views</th>
<th data-quarto-table-cell-role="th">product_clicks</th>
<th data-quarto-table-cell-role="th">pageviews</th>
<th data-quarto-table-cell-role="th">time_on_site</th>
<th data-quarto-table-cell-role="th">browser</th>
<th data-quarto-table-cell-role="th">os</th>
<th data-quarto-table-cell-role="th">deviceCategory</th>
<th data-quarto-table-cell-role="th">added_to_cart</th>
<th data-quarto-table-cell-role="th">revenue</th>
<th data-quarto-table-cell-role="th">score</th>
<th data-quarto-table-cell-role="th">predicted_score_label</th>
<th data-quarto-table-cell-role="th">maudience</th>
<th data-quarto-table-cell-role="th">cohort</th>
<th data-quarto-table-cell-role="th">audience_strategy</th>
<th data-quarto-table-cell-role="th">made_purchase_on_future_visit</th>
<th data-quarto-table-cell-role="th">split_type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>March</td>
<td>7701350257079842191</td>
<td>1488377334</td>
<td>1</td>
<td>2017-03-01 06:08:54</td>
<td>1</td>
<td>3</td>
<td>1</td>
<td>4</td>
<td>6</td>
<td>8</td>
<td>54</td>
<td>learn.temple.edu</td>
<td>referral</td>
<td>Referral</td>
<td>1</td>
<td>1</td>
<td>Unknown</td>
<td>9</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>Chrome</td>
<td>Macintosh</td>
<td>desktop</td>
<td>0</td>
<td>&lt;NA&gt;</td>
<td>0.961501</td>
<td>False</td>
<td>High</td>
<td>Control</td>
<td>1</td>
<td>&lt;NA&gt;</td>
<td>infer</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>March</td>
<td>1927404893298120774</td>
<td>1489438559</td>
<td>1</td>
<td>2017-03-13 13:55:59</td>
<td>1</td>
<td>3</td>
<td>13</td>
<td>2</td>
<td>13</td>
<td>55</td>
<td>59</td>
<td>google</td>
<td>organic</td>
<td>Organic Search</td>
<td>2</td>
<td>0</td>
<td>Unknown</td>
<td>0</td>
<td>0</td>
<td>12</td>
<td>0</td>
<td>2</td>
<td>14</td>
<td>Chrome</td>
<td>Windows</td>
<td>desktop</td>
<td>0</td>
<td>&lt;NA&gt;</td>
<td>0.884723</td>
<td>False</td>
<td>High</td>
<td>Control</td>
<td>1</td>
<td>&lt;NA&gt;</td>
<td>infer</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>March</td>
<td>4081311830661383532</td>
<td>1489678740</td>
<td>1</td>
<td>2017-03-16 08:39:00</td>
<td>1</td>
<td>3</td>
<td>16</td>
<td>5</td>
<td>8</td>
<td>39</td>
<td>0</td>
<td>google</td>
<td>organic</td>
<td>Organic Search</td>
<td>1</td>
<td>1</td>
<td>Unknown</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>Chrome</td>
<td>Chrome OS</td>
<td>desktop</td>
<td>0</td>
<td>&lt;NA&gt;</td>
<td>0.879829</td>
<td>False</td>
<td>High</td>
<td>Control</td>
<td>1</td>
<td>&lt;NA&gt;</td>
<td>infer</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>March</td>
<td>48980746408094895</td>
<td>1489003955</td>
<td>1</td>
<td>2017-03-08 12:12:35</td>
<td>1</td>
<td>3</td>
<td>8</td>
<td>4</td>
<td>12</td>
<td>12</td>
<td>35</td>
<td>google</td>
<td>organic</td>
<td>Organic Search</td>
<td>27</td>
<td>0</td>
<td>Product detail views</td>
<td>0</td>
<td>0</td>
<td>166</td>
<td>4</td>
<td>23</td>
<td>928</td>
<td>Chrome</td>
<td>Windows</td>
<td>desktop</td>
<td>0</td>
<td>&lt;NA&gt;</td>
<td>0.866037</td>
<td>False</td>
<td>High</td>
<td>Control</td>
<td>1</td>
<td>&lt;NA&gt;</td>
<td>infer</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>March</td>
<td>0480615828723852227</td>
<td>1490621968</td>
<td>1</td>
<td>2017-03-27 06:39:28</td>
<td>1</td>
<td>3</td>
<td>27</td>
<td>2</td>
<td>6</td>
<td>39</td>
<td>28</td>
<td>google</td>
<td>organic</td>
<td>Organic Search</td>
<td>2</td>
<td>0</td>
<td>Unknown</td>
<td>9</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>8</td>
<td>Chrome</td>
<td>Macintosh</td>
<td>desktop</td>
<td>0</td>
<td>&lt;NA&gt;</td>
<td>0.864021</td>
<td>False</td>
<td>High</td>
<td>Control</td>
<td>1</td>
<td>&lt;NA&gt;</td>
<td>infer</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">column</th>
<th data-quarto-table-cell-role="th">dtype</th>
<th data-quarto-table-cell-role="th">missing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>infer_month</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>fullvisitorid</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>visitId</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>visitNumber</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>visitStartTime</td>
<td>datetime64[ns]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>quarter</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>month</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>day_of_month</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>day_of_week</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>hour</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>minute</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>second</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>source</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>medium</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>channelGrouping</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>hits</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>bounces</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>last_action</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>promos_displayed</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>promos_clicked</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>product_views</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>product_clicks</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>pageviews</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>time_on_site</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>browser</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>os</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>deviceCategory</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>added_to_cart</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>revenue</td>
<td>Float64</td>
<td>21010</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>score</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>predicted_score_label</td>
<td>boolean</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>maudience</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>cohort</td>
<td>string[python]</td>
<td>8390</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">33</td>
<td>audience_strategy</td>
<td>Int8</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34</td>
<td>made_purchase_on_future_visit</td>
<td>boolean</td>
<td>21752</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35</td>
<td>split_type</td>
<td>string[python]</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="conversion-rates-in-development-and-inference-1" class="level3">
<h3 class="anchored" data-anchor-id="conversion-rates-in-development-and-inference-1">Conversion Rates in Development and Inference</h3>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df_conv_rates <span class="op">=</span> (</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    df_conv_rates</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    .assign(infer_month<span class="op">=</span>[<span class="va">None</span>]<span class="op">*</span><span class="dv">3</span> <span class="op">+</span> [infer_month_conv_rates]<span class="op">*</span><span class="dv">3</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    .assign(audience_strategy<span class="op">=</span>audience_strategy)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    .astype(</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"infer_month"</span>: pd.StringDtype(),</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"audience_strategy"</span>: pd.Int8Dtype(),</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    .assign(</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        data_type<span class="op">=</span><span class="kw">lambda</span> df: df[<span class="st">'data_type'</span>].<span class="bu">str</span>.replace(<span class="st">'_'</span>, <span class="st">' '</span>).<span class="bu">str</span>.title()</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    .fillna(</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">"true_conv_rate"</span>: <span class="dv">0</span>,</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">"overall_true_conv_rate"</span>: <span class="dv">0</span>,</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">"true_conversions"</span>: <span class="dv">0</span>,</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">"pred_conv_rate"</span>: <span class="dv">0</span>,</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">"total_visitors"</span>: <span class="dv">0</span>,</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">'min_score'</span>: <span class="dv">0</span>,</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>col <span class="op">=</span> df_conv_rates.pop(<span class="st">"infer_month"</span>)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>df_conv_rates.insert(<span class="dv">0</span>, col.name, col)</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>col <span class="op">=</span> df_conv_rates.pop(<span class="st">"audience_strategy"</span>)</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>df_conv_rates.insert(<span class="dv">0</span>, col.name, col)</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>display(df_conv_rates)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>summarize_df(df_conv_rates)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">audience_strategy</th>
<th data-quarto-table-cell-role="th">infer_month</th>
<th data-quarto-table-cell-role="th">maudience</th>
<th data-quarto-table-cell-role="th">pred_conversions</th>
<th data-quarto-table-cell-role="th">total_visitors</th>
<th data-quarto-table-cell-role="th">min_score</th>
<th data-quarto-table-cell-role="th">true_conversions</th>
<th data-quarto-table-cell-role="th">data_type</th>
<th data-quarto-table-cell-role="th">data_size</th>
<th data-quarto-table-cell-role="th">true_conv_rate</th>
<th data-quarto-table-cell-role="th">overall_true_conv_rate</th>
<th data-quarto-table-cell-role="th">pred_conv_rate</th>
<th data-quarto-table-cell-role="th">overall_pred_conv_rate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>&lt;NA&gt;</td>
<td>High</td>
<td>850</td>
<td>6722</td>
<td>0.095656</td>
<td>149</td>
<td>Development</td>
<td>20164</td>
<td>2.216602</td>
<td>2.30609</td>
<td>12.645046</td>
<td>4.215433</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>&lt;NA&gt;</td>
<td>Low</td>
<td>0</td>
<td>6721</td>
<td>0.0</td>
<td>152</td>
<td>Development</td>
<td>20164</td>
<td>2.261568</td>
<td>2.30609</td>
<td>0.0</td>
<td>4.215433</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>&lt;NA&gt;</td>
<td>Medium</td>
<td>0</td>
<td>6721</td>
<td>0.00911</td>
<td>164</td>
<td>Development</td>
<td>20164</td>
<td>2.440113</td>
<td>2.30609</td>
<td>0.0</td>
<td>4.215433</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>March</td>
<td>High</td>
<td>975</td>
<td>7251</td>
<td>0.098362</td>
<td>0</td>
<td>Inference</td>
<td>21752</td>
<td>0.0</td>
<td>0.0</td>
<td>13.446421</td>
<td>4.482346</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1</td>
<td>March</td>
<td>Low</td>
<td>0</td>
<td>7251</td>
<td>0.0</td>
<td>0</td>
<td>Inference</td>
<td>21752</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>4.482346</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>1</td>
<td>March</td>
<td>Medium</td>
<td>0</td>
<td>7250</td>
<td>0.008815</td>
<td>0</td>
<td>Inference</td>
<td>21752</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>4.482346</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">column</th>
<th data-quarto-table-cell-role="th">dtype</th>
<th data-quarto-table-cell-role="th">missing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>audience_strategy</td>
<td>Int8</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>infer_month</td>
<td>string[python]</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>maudience</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>pred_conversions</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>total_visitors</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>min_score</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>true_conversions</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>data_type</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>data_size</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>true_conv_rate</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>overall_true_conv_rate</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>pred_conv_rate</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>overall_pred_conv_rate</td>
<td>Float64</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="conversion-rates-aggregated-by-audience-group" class="level3">
<h3 class="anchored" data-anchor-id="conversion-rates-aggregated-by-audience-group">Conversion Rates Aggregated by Audience Group</h3>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df_conv_rates_by_aud <span class="op">=</span> (</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    df_conv_rates[[<span class="st">'maudience'</span>, <span class="st">'data_type'</span>, <span class="st">'true_conv_rate'</span>, <span class="st">'pred_conv_rate'</span>]].melt(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>        id_vars<span class="op">=</span>[<span class="st">'maudience'</span>, <span class="st">'data_type'</span>],</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>        value_vars<span class="op">=</span>[<span class="st">'true_conv_rate'</span>, <span class="st">'pred_conv_rate'</span>],</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>        value_name<span class="op">=</span><span class="st">'value'</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>        var_name<span class="op">=</span><span class="st">'var'</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    .assign(var<span class="op">=</span><span class="kw">lambda</span> df: df[<span class="st">'var'</span>].<span class="bu">str</span>.replace(<span class="st">"_conv_rate"</span>, <span class="st">""</span>))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    .astype(</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">"maudience"</span>: pd.StringDtype(),</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">'data_type'</span>: pd.StringDtype(),</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">"var"</span>: pd.StringDtype(),</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">"value"</span>: pd.Float64Dtype(),  <span class="co"># Float32Dtype</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>display(df_conv_rates_by_aud)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>summarize_df(df_conv_rates_by_aud)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">maudience</th>
<th data-quarto-table-cell-role="th">data_type</th>
<th data-quarto-table-cell-role="th">var</th>
<th data-quarto-table-cell-role="th">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>High</td>
<td>Development</td>
<td>true</td>
<td>2.216602</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Low</td>
<td>Development</td>
<td>true</td>
<td>2.261568</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Medium</td>
<td>Development</td>
<td>true</td>
<td>2.440113</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>High</td>
<td>Inference</td>
<td>true</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Low</td>
<td>Inference</td>
<td>true</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Medium</td>
<td>Inference</td>
<td>true</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>High</td>
<td>Development</td>
<td>pred</td>
<td>12.645046</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Low</td>
<td>Development</td>
<td>pred</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>Medium</td>
<td>Development</td>
<td>pred</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>High</td>
<td>Inference</td>
<td>pred</td>
<td>13.446421</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>Low</td>
<td>Inference</td>
<td>pred</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>Medium</td>
<td>Inference</td>
<td>pred</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">column</th>
<th data-quarto-table-cell-role="th">dtype</th>
<th data-quarto-table-cell-role="th">missing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>maudience</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>data_type</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>var</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>value</td>
<td>Float64</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="conversion-rates-aggregated-overall" class="level3">
<h3 class="anchored" data-anchor-id="conversion-rates-aggregated-overall">Conversion Rates Aggregated Overall</h3>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df_conv_rates_overall <span class="op">=</span> (</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    df_conv_rates[[<span class="st">'data_type'</span>, <span class="st">'overall_true_conv_rate'</span>, <span class="st">'overall_pred_conv_rate'</span>, <span class="st">'data_size'</span>]]</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">'data_type'</span>], as_index<span class="op">=</span><span class="va">False</span>).mean()</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    .melt(</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>        id_vars<span class="op">=</span>[<span class="st">'data_type'</span>],</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>        value_vars<span class="op">=</span>[<span class="st">'overall_pred_conv_rate'</span>, <span class="st">'overall_true_conv_rate'</span>, <span class="st">'data_size'</span>],</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>        value_name<span class="op">=</span><span class="st">'value'</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>        var_name<span class="op">=</span><span class="st">'var'</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    .assign(var<span class="op">=</span><span class="kw">lambda</span> df: df[<span class="st">'var'</span>].<span class="bu">str</span>.replace(<span class="st">"_"</span>, <span class="st">" "</span>).<span class="bu">str</span>.title())</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    .astype(</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">"data_type"</span>: pd.StringDtype(),</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">"var"</span>: pd.StringDtype(),</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">"value"</span>: pd.Float64Dtype(),  <span class="co"># Float32Dtype</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    .assign(maudience<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    .astype({<span class="st">"maudience"</span>: pd.StringDtype()})</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>display(df_conv_rates_overall)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>summarize_df(df_conv_rates_overall)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">data_type</th>
<th data-quarto-table-cell-role="th">var</th>
<th data-quarto-table-cell-role="th">value</th>
<th data-quarto-table-cell-role="th">maudience</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Development</td>
<td>Overall Pred Conv Rate</td>
<td>4.215433</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Inference</td>
<td>Overall Pred Conv Rate</td>
<td>4.482346</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Development</td>
<td>Overall True Conv Rate</td>
<td>2.30609</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Inference</td>
<td>Overall True Conv Rate</td>
<td>0.0</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Development</td>
<td>Data Size</td>
<td>20164.0</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Inference</td>
<td>Data Size</td>
<td>21752.0</td>
<td>&lt;NA&gt;</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">column</th>
<th data-quarto-table-cell-role="th">dtype</th>
<th data-quarto-table-cell-role="th">missing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>data_type</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>var</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>value</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>maudience</td>
<td>string[python]</td>
<td>6</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="combine-aggregated-conversion-rates" class="level3">
<h3 class="anchored" data-anchor-id="combine-aggregated-conversion-rates">Combine Aggregated Conversion Rates</h3>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df_conv_rates_agg_combo <span class="op">=</span> (</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    pd.concat(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>        [df_conv_rates_by_aud, df_conv_rates_overall],</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>        ignore_index<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    .astype({<span class="st">"value"</span>: pd.Float64Dtype()})</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>display(df_conv_rates_agg_combo)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>summarize_df(df_conv_rates_agg_combo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">maudience</th>
<th data-quarto-table-cell-role="th">data_type</th>
<th data-quarto-table-cell-role="th">var</th>
<th data-quarto-table-cell-role="th">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>High</td>
<td>Development</td>
<td>true</td>
<td>2.216602</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Low</td>
<td>Development</td>
<td>true</td>
<td>2.261568</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Medium</td>
<td>Development</td>
<td>true</td>
<td>2.440113</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>High</td>
<td>Inference</td>
<td>true</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Low</td>
<td>Inference</td>
<td>true</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Medium</td>
<td>Inference</td>
<td>true</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>High</td>
<td>Development</td>
<td>pred</td>
<td>12.645046</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Low</td>
<td>Development</td>
<td>pred</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>Medium</td>
<td>Development</td>
<td>pred</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>High</td>
<td>Inference</td>
<td>pred</td>
<td>13.446421</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>Low</td>
<td>Inference</td>
<td>pred</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>Medium</td>
<td>Inference</td>
<td>pred</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>&lt;NA&gt;</td>
<td>Development</td>
<td>Overall Pred Conv Rate</td>
<td>4.215433</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>&lt;NA&gt;</td>
<td>Inference</td>
<td>Overall Pred Conv Rate</td>
<td>4.482346</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>&lt;NA&gt;</td>
<td>Development</td>
<td>Overall True Conv Rate</td>
<td>2.30609</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>&lt;NA&gt;</td>
<td>Inference</td>
<td>Overall True Conv Rate</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>&lt;NA&gt;</td>
<td>Development</td>
<td>Data Size</td>
<td>20164.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>&lt;NA&gt;</td>
<td>Inference</td>
<td>Data Size</td>
<td>21752.0</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">column</th>
<th data-quarto-table-cell-role="th">dtype</th>
<th data-quarto-table-cell-role="th">missing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>maudience</td>
<td>string[python]</td>
<td>6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>data_type</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>var</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>value</td>
<td>Float64</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="estimated-and-actual-cohort-to-audience-fractions-1" class="level3">
<h3 class="anchored" data-anchor-id="estimated-and-actual-cohort-to-audience-fractions-1">Estimated and Actual Cohort to Audience Fractions</h3>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df_sa_frac <span class="op">=</span> (</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    df_sa_frac</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    .assign(infer_month<span class="op">=</span>[<span class="va">None</span>]<span class="op">*</span><span class="dv">6</span> <span class="op">+</span> [infer_month_frac]<span class="op">*</span><span class="dv">6</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    .assign(audience_strategy<span class="op">=</span>audience_strategy)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    .astype(</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"infer_month"</span>: pd.StringDtype(),</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"audience_strategy"</span>: pd.Int8Dtype(),</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>col <span class="op">=</span> df_sa_frac.pop(<span class="st">"infer_month"</span>)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>df_sa_frac.insert(<span class="dv">0</span>, col.name, col)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>col <span class="op">=</span> df_sa_frac.pop(<span class="st">"audience_strategy"</span>)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>df_sa_frac.insert(<span class="dv">0</span>, col.name, col)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>display(df_sa_frac)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>summarize_df(df_sa_frac)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">audience_strategy</th>
<th data-quarto-table-cell-role="th">infer_month</th>
<th data-quarto-table-cell-role="th">maudience</th>
<th data-quarto-table-cell-role="th">cohort</th>
<th data-quarto-table-cell-role="th">size</th>
<th data-quarto-table-cell-role="th">group_size</th>
<th data-quarto-table-cell-role="th">uplift</th>
<th data-quarto-table-cell-role="th">power</th>
<th data-quarto-table-cell-role="th">ci_level</th>
<th data-quarto-table-cell-role="th">samp_to_aud_frac</th>
<th data-quarto-table-cell-role="th">size_type</th>
<th data-quarto-table-cell-role="th">data_type</th>
<th data-quarto-table-cell-role="th">data_size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>&lt;NA&gt;</td>
<td>High</td>
<td>Test</td>
<td>2146</td>
<td>6721</td>
<td>10</td>
<td>55</td>
<td>55</td>
<td>31.929772</td>
<td>required</td>
<td>development</td>
<td>20164</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>&lt;NA&gt;</td>
<td>High</td>
<td>Control</td>
<td>2146</td>
<td>6721</td>
<td>10</td>
<td>55</td>
<td>55</td>
<td>31.929772</td>
<td>required</td>
<td>development</td>
<td>20164</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>&lt;NA&gt;</td>
<td>Medium</td>
<td>Test</td>
<td>1945</td>
<td>6721</td>
<td>10</td>
<td>55</td>
<td>55</td>
<td>28.939146</td>
<td>required</td>
<td>development</td>
<td>20164</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>&lt;NA&gt;</td>
<td>Medium</td>
<td>Control</td>
<td>1945</td>
<td>6721</td>
<td>10</td>
<td>55</td>
<td>55</td>
<td>28.939146</td>
<td>required</td>
<td>development</td>
<td>20164</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1</td>
<td>&lt;NA&gt;</td>
<td>Low</td>
<td>Test</td>
<td>2103</td>
<td>6722</td>
<td>10</td>
<td>55</td>
<td>55</td>
<td>31.285332</td>
<td>required</td>
<td>development</td>
<td>20164</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>1</td>
<td>&lt;NA&gt;</td>
<td>Low</td>
<td>Control</td>
<td>2103</td>
<td>6722</td>
<td>10</td>
<td>55</td>
<td>55</td>
<td>31.285332</td>
<td>required</td>
<td>development</td>
<td>20164</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>1</td>
<td>March</td>
<td>High</td>
<td>Control</td>
<td>2315</td>
<td>7251</td>
<td>10</td>
<td>55</td>
<td>55</td>
<td>31.926631</td>
<td>randomly selected</td>
<td>inference</td>
<td>21752</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>1</td>
<td>March</td>
<td>High</td>
<td>Test</td>
<td>2315</td>
<td>7251</td>
<td>10</td>
<td>55</td>
<td>55</td>
<td>31.926631</td>
<td>randomly selected</td>
<td>inference</td>
<td>21752</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>1</td>
<td>March</td>
<td>Low</td>
<td>Control</td>
<td>2268</td>
<td>7251</td>
<td>10</td>
<td>55</td>
<td>55</td>
<td>31.278444</td>
<td>randomly selected</td>
<td>inference</td>
<td>21752</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>1</td>
<td>March</td>
<td>Low</td>
<td>Test</td>
<td>2268</td>
<td>7251</td>
<td>10</td>
<td>55</td>
<td>55</td>
<td>31.278444</td>
<td>randomly selected</td>
<td>inference</td>
<td>21752</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>1</td>
<td>March</td>
<td>Medium</td>
<td>Control</td>
<td>2098</td>
<td>7250</td>
<td>10</td>
<td>55</td>
<td>55</td>
<td>28.937931</td>
<td>randomly selected</td>
<td>inference</td>
<td>21752</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>1</td>
<td>March</td>
<td>Medium</td>
<td>Test</td>
<td>2098</td>
<td>7250</td>
<td>10</td>
<td>55</td>
<td>55</td>
<td>28.937931</td>
<td>randomly selected</td>
<td>inference</td>
<td>21752</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">column</th>
<th data-quarto-table-cell-role="th">dtype</th>
<th data-quarto-table-cell-role="th">missing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>audience_strategy</td>
<td>Int8</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>infer_month</td>
<td>string[python]</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>maudience</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>cohort</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>size</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>group_size</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>uplift</td>
<td>Int8</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>power</td>
<td>Int8</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>ci_level</td>
<td>Int8</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>samp_to_aud_frac</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>size_type</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>data_type</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>data_size</td>
<td>Int64</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Notes">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Notes
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>The accuracy of the predicted propensities are different between the <code>inference</code> and <code>test_split</code> datasets. The model performance is relatively worse on the unseen data (<code>inference</code>) compared to the data seen during development (<code>test_split</code>). Audience groups (bins) are created based on these predicted propensities. So, this ML model inaccuracy can create bins with different sizes between these two datasets. Additionally, if the number of visitors in the <code>inference</code> and <code>test_split</code> datasets are different, then this also contributes to differently sized bins. Both of these factors (inaccuracy and differently sized datasets - see the <code>data_size</code> column) are present here and this explains why the following columns
<ul>
<li>predicted conversion rate (<code>pred_conv_rate</code>)</li>
<li>cohort size (<code>size</code>)</li>
<li>cohort-to-audience fraction (<code>sample_to_audience_frac</code>)</li>
</ul>
are different between the test split (during ML model development) and inference (during production).</li>
<li>Similarly, the predicted (<code>pred_conv_rate</code>) and true (<code>true_conv_rate</code>) conversion rates are for the test split due to the poor accuracy of the ML model’s predictions.</li>
</ol>
</div>
</div>
</section>
<section id="ml-development-data-1" class="level3">
<h3 class="anchored" data-anchor-id="ml-development-data-1">ML Development Data</h3>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df_development <span class="op">=</span> (</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    df_development</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    .assign(infer_month<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    .drop(columns<span class="op">=</span>[<span class="st">'predicted_label'</span>])</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    .assign(maudience<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    .assign(cohort<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    .assign(audience_strategy<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    .astype(</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"infer_month"</span>: pd.StringDtype(),</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">"maudience"</span>: pd.StringDtype(),</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">"cohort"</span>: pd.StringDtype(),</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">"audience_strategy"</span>: pd.Int8Dtype(),</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>col <span class="op">=</span> df_development.pop(<span class="st">"infer_month"</span>)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>df_development.insert(<span class="dv">0</span>, col.name, col)</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> pd.option_context(<span class="st">'display.max_columns'</span>, <span class="va">None</span>):</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    display(df_development.head())</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>summarize_df(df_development)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">infer_month</th>
<th data-quarto-table-cell-role="th">fullvisitorid</th>
<th data-quarto-table-cell-role="th">visitId</th>
<th data-quarto-table-cell-role="th">visitNumber</th>
<th data-quarto-table-cell-role="th">visitStartTime</th>
<th data-quarto-table-cell-role="th">quarter</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">day_of_month</th>
<th data-quarto-table-cell-role="th">day_of_week</th>
<th data-quarto-table-cell-role="th">hour</th>
<th data-quarto-table-cell-role="th">minute</th>
<th data-quarto-table-cell-role="th">second</th>
<th data-quarto-table-cell-role="th">source</th>
<th data-quarto-table-cell-role="th">medium</th>
<th data-quarto-table-cell-role="th">channelGrouping</th>
<th data-quarto-table-cell-role="th">hits</th>
<th data-quarto-table-cell-role="th">bounces</th>
<th data-quarto-table-cell-role="th">last_action</th>
<th data-quarto-table-cell-role="th">promos_displayed</th>
<th data-quarto-table-cell-role="th">promos_clicked</th>
<th data-quarto-table-cell-role="th">product_views</th>
<th data-quarto-table-cell-role="th">product_clicks</th>
<th data-quarto-table-cell-role="th">pageviews</th>
<th data-quarto-table-cell-role="th">time_on_site</th>
<th data-quarto-table-cell-role="th">browser</th>
<th data-quarto-table-cell-role="th">os</th>
<th data-quarto-table-cell-role="th">deviceCategory</th>
<th data-quarto-table-cell-role="th">added_to_cart</th>
<th data-quarto-table-cell-role="th">revenue</th>
<th data-quarto-table-cell-role="th">made_purchase_on_future_visit</th>
<th data-quarto-table-cell-role="th">split_type</th>
<th data-quarto-table-cell-role="th">score</th>
<th data-quarto-table-cell-role="th">predicted_score_label</th>
<th data-quarto-table-cell-role="th">maudience</th>
<th data-quarto-table-cell-role="th">cohort</th>
<th data-quarto-table-cell-role="th">audience_strategy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>&lt;NA&gt;</td>
<td>4157301099254368232</td>
<td>1476636342</td>
<td>1</td>
<td>2016-10-16 09:45:42</td>
<td>4</td>
<td>10</td>
<td>16</td>
<td>1</td>
<td>9</td>
<td>45</td>
<td>42</td>
<td>google</td>
<td>organic</td>
<td>Organic Search</td>
<td>15</td>
<td>0</td>
<td>Product detail views</td>
<td>18</td>
<td>0</td>
<td>30</td>
<td>4</td>
<td>11</td>
<td>1650</td>
<td>Safari</td>
<td>Macintosh</td>
<td>desktop</td>
<td>0</td>
<td>&lt;NA&gt;</td>
<td>1</td>
<td>train_val</td>
<td>0.058666</td>
<td>True</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>&lt;NA&gt;</td>
<td>786312091291497372</td>
<td>1481408395</td>
<td>1</td>
<td>2016-12-10 14:19:55</td>
<td>4</td>
<td>12</td>
<td>10</td>
<td>7</td>
<td>14</td>
<td>19</td>
<td>55</td>
<td>mall.googleplex.com</td>
<td>referral</td>
<td>Referral</td>
<td>7</td>
<td>0</td>
<td>Unknown</td>
<td>18</td>
<td>0</td>
<td>55</td>
<td>0</td>
<td>7</td>
<td>484</td>
<td>Chrome</td>
<td>Chrome OS</td>
<td>desktop</td>
<td>0</td>
<td>&lt;NA&gt;</td>
<td>0</td>
<td>train_val</td>
<td>0.130899</td>
<td>True</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>&lt;NA&gt;</td>
<td>322228537289095245</td>
<td>1482626483</td>
<td>1</td>
<td>2016-12-24 16:41:23</td>
<td>4</td>
<td>12</td>
<td>24</td>
<td>7</td>
<td>16</td>
<td>41</td>
<td>23</td>
<td>google</td>
<td>organic</td>
<td>Organic Search</td>
<td>23</td>
<td>0</td>
<td>Completed purchase</td>
<td>18</td>
<td>0</td>
<td>72</td>
<td>2</td>
<td>20</td>
<td>339</td>
<td>Chrome</td>
<td>Windows</td>
<td>desktop</td>
<td>1</td>
<td>52.99</td>
<td>0</td>
<td>train_val</td>
<td>0.000751</td>
<td>True</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>&lt;NA&gt;</td>
<td>7808115684091011900</td>
<td>1482430339</td>
<td>1</td>
<td>2016-12-22 10:12:19</td>
<td>4</td>
<td>12</td>
<td>22</td>
<td>5</td>
<td>10</td>
<td>12</td>
<td>19</td>
<td>google</td>
<td>organic</td>
<td>Organic Search</td>
<td>1</td>
<td>1</td>
<td>Unknown</td>
<td>9</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>Chrome</td>
<td>Windows</td>
<td>desktop</td>
<td>0</td>
<td>&lt;NA&gt;</td>
<td>0</td>
<td>train_val</td>
<td>0.02076</td>
<td>True</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>&lt;NA&gt;</td>
<td>9442018438865871704</td>
<td>1484757590</td>
<td>1</td>
<td>2017-01-18 08:39:50</td>
<td>1</td>
<td>1</td>
<td>18</td>
<td>4</td>
<td>8</td>
<td>39</td>
<td>50</td>
<td>(direct)</td>
<td>(none)</td>
<td>Direct</td>
<td>3</td>
<td>0</td>
<td>Unknown</td>
<td>9</td>
<td>0</td>
<td>10</td>
<td>0</td>
<td>3</td>
<td>12</td>
<td>Chrome</td>
<td>Windows</td>
<td>desktop</td>
<td>0</td>
<td>&lt;NA&gt;</td>
<td>0</td>
<td>train_val</td>
<td>0.202944</td>
<td>True</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">column</th>
<th data-quarto-table-cell-role="th">dtype</th>
<th data-quarto-table-cell-role="th">missing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>infer_month</td>
<td>string[python]</td>
<td>133892</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>fullvisitorid</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>visitId</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>visitNumber</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>visitStartTime</td>
<td>datetime64[ns]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>quarter</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>month</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>day_of_month</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>day_of_week</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>hour</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>minute</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>second</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>source</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>medium</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>channelGrouping</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>hits</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>bounces</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>last_action</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>promos_displayed</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>promos_clicked</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>product_views</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>product_clicks</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>pageviews</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>time_on_site</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>browser</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>os</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>deviceCategory</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>added_to_cart</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>revenue</td>
<td>Float64</td>
<td>129291</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>made_purchase_on_future_visit</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>split_type</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>score</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>predicted_score_label</td>
<td>boolean</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">33</td>
<td>maudience</td>
<td>string[python]</td>
<td>133892</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34</td>
<td>cohort</td>
<td>string[python]</td>
<td>133892</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35</td>
<td>audience_strategy</td>
<td>Int8</td>
<td>133892</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="combine-development-and-cohorts-data" class="level3">
<h3 class="anchored" data-anchor-id="combine-development-and-cohorts-data">Combine Development and Cohorts Data</h3>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df_dev_cohorts <span class="op">=</span> (</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    pd.concat([df_development[<span class="bu">list</span>(df_cohorts)], df_cohorts])</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    .astype(</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">"source"</span>: pd.CategoricalDtype(),</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"medium"</span>: pd.CategoricalDtype(),</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"channelGrouping"</span>: pd.CategoricalDtype(),</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"browser"</span>: pd.CategoricalDtype(),</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"os"</span>: pd.CategoricalDtype(),</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"made_purchase_on_future_visit"</span>: pd.BooleanDtype(),</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">"split_type"</span>: pd.StringDtype(),</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> pd.option_context(<span class="st">'display.max_columns'</span>, <span class="va">None</span>):</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    display(df_dev_cohorts.head())</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>summarize_df(df_dev_cohorts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">infer_month</th>
<th data-quarto-table-cell-role="th">fullvisitorid</th>
<th data-quarto-table-cell-role="th">visitId</th>
<th data-quarto-table-cell-role="th">visitNumber</th>
<th data-quarto-table-cell-role="th">visitStartTime</th>
<th data-quarto-table-cell-role="th">quarter</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">day_of_month</th>
<th data-quarto-table-cell-role="th">day_of_week</th>
<th data-quarto-table-cell-role="th">hour</th>
<th data-quarto-table-cell-role="th">minute</th>
<th data-quarto-table-cell-role="th">second</th>
<th data-quarto-table-cell-role="th">source</th>
<th data-quarto-table-cell-role="th">medium</th>
<th data-quarto-table-cell-role="th">channelGrouping</th>
<th data-quarto-table-cell-role="th">hits</th>
<th data-quarto-table-cell-role="th">bounces</th>
<th data-quarto-table-cell-role="th">last_action</th>
<th data-quarto-table-cell-role="th">promos_displayed</th>
<th data-quarto-table-cell-role="th">promos_clicked</th>
<th data-quarto-table-cell-role="th">product_views</th>
<th data-quarto-table-cell-role="th">product_clicks</th>
<th data-quarto-table-cell-role="th">pageviews</th>
<th data-quarto-table-cell-role="th">time_on_site</th>
<th data-quarto-table-cell-role="th">browser</th>
<th data-quarto-table-cell-role="th">os</th>
<th data-quarto-table-cell-role="th">deviceCategory</th>
<th data-quarto-table-cell-role="th">added_to_cart</th>
<th data-quarto-table-cell-role="th">revenue</th>
<th data-quarto-table-cell-role="th">score</th>
<th data-quarto-table-cell-role="th">predicted_score_label</th>
<th data-quarto-table-cell-role="th">maudience</th>
<th data-quarto-table-cell-role="th">cohort</th>
<th data-quarto-table-cell-role="th">audience_strategy</th>
<th data-quarto-table-cell-role="th">made_purchase_on_future_visit</th>
<th data-quarto-table-cell-role="th">split_type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>&lt;NA&gt;</td>
<td>4157301099254368232</td>
<td>1476636342</td>
<td>1</td>
<td>2016-10-16 09:45:42</td>
<td>4</td>
<td>10</td>
<td>16</td>
<td>1</td>
<td>9</td>
<td>45</td>
<td>42</td>
<td>google</td>
<td>organic</td>
<td>Organic Search</td>
<td>15</td>
<td>0</td>
<td>Product detail views</td>
<td>18</td>
<td>0</td>
<td>30</td>
<td>4</td>
<td>11</td>
<td>1650</td>
<td>Safari</td>
<td>Macintosh</td>
<td>desktop</td>
<td>0</td>
<td>&lt;NA&gt;</td>
<td>0.058666</td>
<td>True</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
<td>True</td>
<td>train_val</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>&lt;NA&gt;</td>
<td>786312091291497372</td>
<td>1481408395</td>
<td>1</td>
<td>2016-12-10 14:19:55</td>
<td>4</td>
<td>12</td>
<td>10</td>
<td>7</td>
<td>14</td>
<td>19</td>
<td>55</td>
<td>mall.googleplex.com</td>
<td>referral</td>
<td>Referral</td>
<td>7</td>
<td>0</td>
<td>Unknown</td>
<td>18</td>
<td>0</td>
<td>55</td>
<td>0</td>
<td>7</td>
<td>484</td>
<td>Chrome</td>
<td>Chrome OS</td>
<td>desktop</td>
<td>0</td>
<td>&lt;NA&gt;</td>
<td>0.130899</td>
<td>True</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
<td>False</td>
<td>train_val</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>&lt;NA&gt;</td>
<td>322228537289095245</td>
<td>1482626483</td>
<td>1</td>
<td>2016-12-24 16:41:23</td>
<td>4</td>
<td>12</td>
<td>24</td>
<td>7</td>
<td>16</td>
<td>41</td>
<td>23</td>
<td>google</td>
<td>organic</td>
<td>Organic Search</td>
<td>23</td>
<td>0</td>
<td>Completed purchase</td>
<td>18</td>
<td>0</td>
<td>72</td>
<td>2</td>
<td>20</td>
<td>339</td>
<td>Chrome</td>
<td>Windows</td>
<td>desktop</td>
<td>1</td>
<td>52.99</td>
<td>0.000751</td>
<td>True</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
<td>False</td>
<td>train_val</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>&lt;NA&gt;</td>
<td>7808115684091011900</td>
<td>1482430339</td>
<td>1</td>
<td>2016-12-22 10:12:19</td>
<td>4</td>
<td>12</td>
<td>22</td>
<td>5</td>
<td>10</td>
<td>12</td>
<td>19</td>
<td>google</td>
<td>organic</td>
<td>Organic Search</td>
<td>1</td>
<td>1</td>
<td>Unknown</td>
<td>9</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>Chrome</td>
<td>Windows</td>
<td>desktop</td>
<td>0</td>
<td>&lt;NA&gt;</td>
<td>0.02076</td>
<td>True</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
<td>False</td>
<td>train_val</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>&lt;NA&gt;</td>
<td>9442018438865871704</td>
<td>1484757590</td>
<td>1</td>
<td>2017-01-18 08:39:50</td>
<td>1</td>
<td>1</td>
<td>18</td>
<td>4</td>
<td>8</td>
<td>39</td>
<td>50</td>
<td>(direct)</td>
<td>(none)</td>
<td>Direct</td>
<td>3</td>
<td>0</td>
<td>Unknown</td>
<td>9</td>
<td>0</td>
<td>10</td>
<td>0</td>
<td>3</td>
<td>12</td>
<td>Chrome</td>
<td>Windows</td>
<td>desktop</td>
<td>0</td>
<td>&lt;NA&gt;</td>
<td>0.202944</td>
<td>True</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
<td>False</td>
<td>train_val</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">column</th>
<th data-quarto-table-cell-role="th">dtype</th>
<th data-quarto-table-cell-role="th">missing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>infer_month</td>
<td>string[python]</td>
<td>133892</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>fullvisitorid</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>visitId</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>visitNumber</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>visitStartTime</td>
<td>datetime64[ns]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>quarter</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>month</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>day_of_month</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>day_of_week</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>hour</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>minute</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>second</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>source</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>medium</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>channelGrouping</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>hits</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>bounces</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>last_action</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>promos_displayed</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>promos_clicked</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>product_views</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>product_clicks</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>pageviews</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>time_on_site</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>browser</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>os</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>deviceCategory</td>
<td>category</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>added_to_cart</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>revenue</td>
<td>Float64</td>
<td>150301</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>score</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>predicted_score_label</td>
<td>boolean</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>maudience</td>
<td>string[python]</td>
<td>133892</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>cohort</td>
<td>string[python]</td>
<td>142282</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">33</td>
<td>audience_strategy</td>
<td>Int8</td>
<td>133892</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34</td>
<td>made_purchase_on_future_visit</td>
<td>boolean</td>
<td>21752</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35</td>
<td>split_type</td>
<td>string[python]</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="daily-performance-summary-in-combined-data-by-audience-group" class="level3">
<h3 class="anchored" data-anchor-id="daily-performance-summary-in-combined-data-by-audience-group">Daily Performance Summary in Combined Data, by Audience Group</h3>
<p>Get daily metadata by audience group</p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>df_aud_hmap <span class="op">=</span> (</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    trh.perform_custom_aggregation(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>        (</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>            df_dev_cohorts</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>            .sort_values(by<span class="op">=</span>[<span class="st">'visitStartTime'</span>], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>            .assign(date<span class="op">=</span><span class="kw">lambda</span> df: pd.to_datetime(df[<span class="st">'visitStartTime'</span>]).dt.date)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>            .assign(maudience<span class="op">=</span><span class="kw">lambda</span> df: df[<span class="st">'maudience'</span>].fillna(<span class="st">"Development"</span>))</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>        groupby_cols<span class="op">=</span>[<span class="st">'month'</span>, <span class="st">'date'</span>, <span class="st">'maudience'</span>],</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>        agg_dict<span class="op">=</span>{</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">"made_purchase_on_future_visit"</span>: [<span class="st">"sum"</span>],</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">"revenue"</span>: <span class="st">"sum"</span>,</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">"fullvisitorid"</span>: <span class="st">"count"</span>,</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">"added_to_cart"</span>: <span class="st">"sum"</span>,</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">"pageviews"</span>: <span class="st">"sum"</span>,</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">"time_on_site"</span>: <span class="st">"mean"</span>,</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">"product_views"</span>: <span class="st">"sum"</span>,</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">"product_clicks"</span>: <span class="st">"sum"</span>,</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">"bounces"</span>: <span class="st">"sum"</span>,</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>        audience_strategy<span class="op">=</span>df_cohorts[<span class="st">'audience_strategy'</span>].unique().tolist()[<span class="dv">0</span>],</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>        column_renamer<span class="op">=</span>{</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">"made_purchase_on_future_visit_sum"</span>: <span class="st">"return_purchasers"</span>,</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>            <span class="st">"revenue_sum"</span>: <span class="st">"revenue"</span>,</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>            <span class="st">"added_to_cart_sum"</span>: <span class="st">"add_to_cart"</span>,</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>            <span class="st">"fullvisitorid_count"</span>: <span class="st">"visitors"</span>,</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">"product_views_sum"</span>: <span class="st">"product_views"</span>,</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>            <span class="st">"product_clicks_sum"</span>: <span class="st">"product_clicks"</span>,</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>            <span class="st">"pageviews_sum"</span>: <span class="st">"pageviews"</span>,</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>            <span class="st">"bounces_sum"</span>: <span class="st">"bounces"</span>,</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>            <span class="st">"time_on_site_mean"</span>: <span class="st">"time_on_site"</span>,</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>        visitor_type_mapper<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>            <span class="bu">zip</span>(</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>                [<span class="st">'Development'</span>, <span class="st">'High'</span>, <span class="st">'Medium'</span>, <span class="st">'Low'</span>],</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>                [<span class="st">'return_purchasers'</span>, <span class="st">'all_visitors'</span>, <span class="st">'all_visitors'</span>, <span class="st">'all_visitors'</span>]</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>        dtypes_out<span class="op">=</span>{</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>            <span class="st">"month"</span>: pd.StringDtype(),</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>            <span class="st">"date"</span>: pd.StringDtype(),</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>            <span class="st">"maudience"</span>: pd.StringDtype(),</span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>            <span class="st">"return_purchasers"</span>: pd.Int16Dtype(),</span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>            <span class="st">"revenue"</span>: pd.Float64Dtype(),  <span class="co"># Float32Dtype</span></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>            <span class="st">"visitors"</span>: pd.Int64Dtype(),  <span class="co"># Int16Dtype</span></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>            <span class="st">"add_to_cart"</span>: pd.Int64Dtype(),  <span class="co"># Int32Dtype</span></span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>            <span class="st">"pageviews"</span>: pd.Int64Dtype(),  <span class="co"># Int32Dtype</span></span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>            <span class="st">"time_on_site"</span>: pd.Float64Dtype(),  <span class="co"># Float32Dtype</span></span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>            <span class="st">"product_views"</span>: pd.Int64Dtype(),  <span class="co"># Int32Dtype</span></span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>            <span class="st">"product_clicks"</span>: pd.Int64Dtype(),  <span class="co"># Int32Dtype</span></span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>            <span class="st">"bounces"</span>: pd.Int64Dtype(),  <span class="co"># Int32Dtype</span></span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>            <span class="st">'audience_strategy'</span>: pd.Int8Dtype(),</span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>            <span class="st">"bounce_rate"</span>: pd.Float64Dtype(),  <span class="co"># Float32Dtype</span></span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>            <span class="st">"product_clicks_rate"</span>: pd.Float64Dtype(),  <span class="co"># Float32Dtype</span></span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>            <span class="st">"add_to_cart_rate"</span>: pd.Float64Dtype(),  <span class="co"># Float32Dtype</span></span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>            <span class="st">"visitor_type"</span>: pd.StringDtype(),</span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>    .assign(agg_type<span class="op">=</span><span class="st">'audience_group'</span>)</span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a>    .astype({<span class="st">"agg_type"</span>: pd.StringDtype()})</span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a>display(df_aud_hmap.head())</span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a>summarize_df(df_aud_hmap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">maudience</th>
<th data-quarto-table-cell-role="th">return_purchasers</th>
<th data-quarto-table-cell-role="th">revenue</th>
<th data-quarto-table-cell-role="th">visitors</th>
<th data-quarto-table-cell-role="th">add_to_cart</th>
<th data-quarto-table-cell-role="th">pageviews</th>
<th data-quarto-table-cell-role="th">time_on_site</th>
<th data-quarto-table-cell-role="th">product_views</th>
<th data-quarto-table-cell-role="th">product_clicks</th>
<th data-quarto-table-cell-role="th">bounces</th>
<th data-quarto-table-cell-role="th">audience_strategy</th>
<th data-quarto-table-cell-role="th">bounce_rate</th>
<th data-quarto-table-cell-role="th">product_clicks_rate</th>
<th data-quarto-table-cell-role="th">add_to_cart_rate</th>
<th data-quarto-table-cell-role="th">visitor_type</th>
<th data-quarto-table-cell-role="th">agg_type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>September</td>
<td>2016-09-01</td>
<td>Development</td>
<td>21</td>
<td>824.71</td>
<td>718</td>
<td>180</td>
<td>4894</td>
<td>3.087837</td>
<td>53001</td>
<td>892</td>
<td>202</td>
<td>1</td>
<td>28.133705</td>
<td>1.682987</td>
<td>25.069638</td>
<td>return_purchasers</td>
<td>audience_group</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>September</td>
<td>2016-09-02</td>
<td>Development</td>
<td>16</td>
<td>1087.58</td>
<td>637</td>
<td>125</td>
<td>4314</td>
<td>3.171245</td>
<td>49597</td>
<td>817</td>
<td>193</td>
<td>1</td>
<td>30.298273</td>
<td>1.647277</td>
<td>19.623234</td>
<td>return_purchasers</td>
<td>audience_group</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>September</td>
<td>2016-09-03</td>
<td>Development</td>
<td>3</td>
<td>514.88</td>
<td>386</td>
<td>80</td>
<td>2349</td>
<td>2.391839</td>
<td>25702</td>
<td>466</td>
<td>124</td>
<td>1</td>
<td>32.124352</td>
<td>1.813088</td>
<td>20.725389</td>
<td>return_purchasers</td>
<td>audience_group</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>September</td>
<td>2016-09-04</td>
<td>Development</td>
<td>7</td>
<td>163.35</td>
<td>350</td>
<td>66</td>
<td>2145</td>
<td>2.963476</td>
<td>25647</td>
<td>356</td>
<td>114</td>
<td>1</td>
<td>32.571429</td>
<td>1.388077</td>
<td>18.857143</td>
<td>return_purchasers</td>
<td>audience_group</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>September</td>
<td>2016-09-05</td>
<td>Development</td>
<td>11</td>
<td>483.38</td>
<td>469</td>
<td>89</td>
<td>3034</td>
<td>3.292111</td>
<td>36007</td>
<td>563</td>
<td>167</td>
<td>1</td>
<td>35.607676</td>
<td>1.563585</td>
<td>18.976546</td>
<td>return_purchasers</td>
<td>audience_group</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">column</th>
<th data-quarto-table-cell-role="th">dtype</th>
<th data-quarto-table-cell-role="th">missing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>month</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>date</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>maudience</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>return_purchasers</td>
<td>Int16</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>revenue</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>visitors</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>add_to_cart</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>pageviews</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>time_on_site</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>product_views</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>product_clicks</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>bounces</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>audience_strategy</td>
<td>Int8</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>bounce_rate</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>product_clicks_rate</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>add_to_cart_rate</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>visitor_type</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>agg_type</td>
<td>string[python]</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="daily-performance-summary-in-overall-combined-data" class="level3">
<h3 class="anchored" data-anchor-id="daily-performance-summary-in-overall-combined-data">Daily Performance Summary in Overall Combined Data</h3>
<p>Get daily metadata overall</p>
<div class="cell" data-execution_count="34">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">return_purchasers</th>
<th data-quarto-table-cell-role="th">revenue</th>
<th data-quarto-table-cell-role="th">visitors</th>
<th data-quarto-table-cell-role="th">add_to_cart</th>
<th data-quarto-table-cell-role="th">pageviews</th>
<th data-quarto-table-cell-role="th">time_on_site</th>
<th data-quarto-table-cell-role="th">product_views</th>
<th data-quarto-table-cell-role="th">product_clicks</th>
<th data-quarto-table-cell-role="th">bounces</th>
<th data-quarto-table-cell-role="th">audience_strategy</th>
<th data-quarto-table-cell-role="th">bounce_rate</th>
<th data-quarto-table-cell-role="th">product_clicks_rate</th>
<th data-quarto-table-cell-role="th">add_to_cart_rate</th>
<th data-quarto-table-cell-role="th">visitor_type</th>
<th data-quarto-table-cell-role="th">agg_type</th>
<th data-quarto-table-cell-role="th">maudience</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>September</td>
<td>2016-09-01</td>
<td>21</td>
<td>824.71</td>
<td>718</td>
<td>180</td>
<td>4894</td>
<td>3.087837</td>
<td>53001</td>
<td>892</td>
<td>202</td>
<td>1</td>
<td>28.133705</td>
<td>1.682987</td>
<td>25.069638</td>
<td>return_purchasers</td>
<td>overall</td>
<td>Development</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>September</td>
<td>2016-09-02</td>
<td>16</td>
<td>1087.58</td>
<td>637</td>
<td>125</td>
<td>4314</td>
<td>3.171245</td>
<td>49597</td>
<td>817</td>
<td>193</td>
<td>1</td>
<td>30.298273</td>
<td>1.647277</td>
<td>19.623234</td>
<td>return_purchasers</td>
<td>overall</td>
<td>Development</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>September</td>
<td>2016-09-03</td>
<td>3</td>
<td>514.88</td>
<td>386</td>
<td>80</td>
<td>2349</td>
<td>2.391839</td>
<td>25702</td>
<td>466</td>
<td>124</td>
<td>1</td>
<td>32.124352</td>
<td>1.813088</td>
<td>20.725389</td>
<td>return_purchasers</td>
<td>overall</td>
<td>Development</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>September</td>
<td>2016-09-04</td>
<td>7</td>
<td>163.35</td>
<td>350</td>
<td>66</td>
<td>2145</td>
<td>2.963476</td>
<td>25647</td>
<td>356</td>
<td>114</td>
<td>1</td>
<td>32.571429</td>
<td>1.388077</td>
<td>18.857143</td>
<td>return_purchasers</td>
<td>overall</td>
<td>Development</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>September</td>
<td>2016-09-05</td>
<td>11</td>
<td>483.38</td>
<td>469</td>
<td>89</td>
<td>3034</td>
<td>3.292111</td>
<td>36007</td>
<td>563</td>
<td>167</td>
<td>1</td>
<td>35.607676</td>
<td>1.563585</td>
<td>18.976546</td>
<td>return_purchasers</td>
<td>overall</td>
<td>Development</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">column</th>
<th data-quarto-table-cell-role="th">dtype</th>
<th data-quarto-table-cell-role="th">missing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>month</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>date</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>return_purchasers</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>revenue</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>visitors</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>add_to_cart</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>pageviews</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>time_on_site</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>product_views</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>product_clicks</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>bounces</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>audience_strategy</td>
<td>Int8</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>bounce_rate</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>product_clicks_rate</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>add_to_cart_rate</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>visitor_type</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>agg_type</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>maudience</td>
<td>string[python]</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="combined-daily-performance-summary" class="level3">
<h3 class="anchored" data-anchor-id="combined-daily-performance-summary">Combined Daily Performance Summary</h3>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df_hmap_combo <span class="op">=</span> (</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    pd.concat([df_aud_hmap, df_hmap], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    .astype(</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">"month"</span>: pd.StringDtype(),</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"date"</span>: pd.StringDtype(),</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"return_purchasers"</span>: pd.Int64Dtype(),</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"revenue"</span>: pd.Float64Dtype(),</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"visitors"</span>: pd.Int64Dtype(),</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"add_to_cart"</span>: pd.Int64Dtype(),</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">"pageviews"</span>: pd.Int64Dtype(),</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">"time_on_site"</span>: pd.Float64Dtype(),</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">"product_views"</span>: pd.Int64Dtype(),</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">"product_clicks"</span>: pd.Int64Dtype(),</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">"bounces"</span>: pd.Int64Dtype(),</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">'audience_strategy'</span>: pd.Int8Dtype(),</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">"bounce_rate"</span>: pd.Float64Dtype(),</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">"product_clicks_rate"</span>: pd.Float64Dtype(),</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">"add_to_cart_rate"</span>: pd.Float64Dtype(),</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">"visitor_type"</span>: pd.StringDtype(),</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>display(df_hmap_combo.head())</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>summarize_df(df_hmap_combo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">maudience</th>
<th data-quarto-table-cell-role="th">return_purchasers</th>
<th data-quarto-table-cell-role="th">revenue</th>
<th data-quarto-table-cell-role="th">visitors</th>
<th data-quarto-table-cell-role="th">add_to_cart</th>
<th data-quarto-table-cell-role="th">pageviews</th>
<th data-quarto-table-cell-role="th">time_on_site</th>
<th data-quarto-table-cell-role="th">product_views</th>
<th data-quarto-table-cell-role="th">product_clicks</th>
<th data-quarto-table-cell-role="th">bounces</th>
<th data-quarto-table-cell-role="th">audience_strategy</th>
<th data-quarto-table-cell-role="th">bounce_rate</th>
<th data-quarto-table-cell-role="th">product_clicks_rate</th>
<th data-quarto-table-cell-role="th">add_to_cart_rate</th>
<th data-quarto-table-cell-role="th">visitor_type</th>
<th data-quarto-table-cell-role="th">agg_type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>September</td>
<td>2016-09-01</td>
<td>Development</td>
<td>21</td>
<td>824.71</td>
<td>718</td>
<td>180</td>
<td>4894</td>
<td>3.087837</td>
<td>53001</td>
<td>892</td>
<td>202</td>
<td>1</td>
<td>28.133705</td>
<td>1.682987</td>
<td>25.069638</td>
<td>return_purchasers</td>
<td>audience_group</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>September</td>
<td>2016-09-02</td>
<td>Development</td>
<td>16</td>
<td>1087.58</td>
<td>637</td>
<td>125</td>
<td>4314</td>
<td>3.171245</td>
<td>49597</td>
<td>817</td>
<td>193</td>
<td>1</td>
<td>30.298273</td>
<td>1.647277</td>
<td>19.623234</td>
<td>return_purchasers</td>
<td>audience_group</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>September</td>
<td>2016-09-03</td>
<td>Development</td>
<td>3</td>
<td>514.88</td>
<td>386</td>
<td>80</td>
<td>2349</td>
<td>2.391839</td>
<td>25702</td>
<td>466</td>
<td>124</td>
<td>1</td>
<td>32.124352</td>
<td>1.813088</td>
<td>20.725389</td>
<td>return_purchasers</td>
<td>audience_group</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>September</td>
<td>2016-09-04</td>
<td>Development</td>
<td>7</td>
<td>163.35</td>
<td>350</td>
<td>66</td>
<td>2145</td>
<td>2.963476</td>
<td>25647</td>
<td>356</td>
<td>114</td>
<td>1</td>
<td>32.571429</td>
<td>1.388077</td>
<td>18.857143</td>
<td>return_purchasers</td>
<td>audience_group</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>September</td>
<td>2016-09-05</td>
<td>Development</td>
<td>11</td>
<td>483.38</td>
<td>469</td>
<td>89</td>
<td>3034</td>
<td>3.292111</td>
<td>36007</td>
<td>563</td>
<td>167</td>
<td>1</td>
<td>35.607676</td>
<td>1.563585</td>
<td>18.976546</td>
<td>return_purchasers</td>
<td>audience_group</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">column</th>
<th data-quarto-table-cell-role="th">dtype</th>
<th data-quarto-table-cell-role="th">missing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>month</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>date</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>maudience</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>return_purchasers</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>revenue</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>visitors</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>add_to_cart</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>pageviews</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>time_on_site</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>product_views</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>product_clicks</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>bounces</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>audience_strategy</td>
<td>Int8</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>bounce_rate</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>product_clicks_rate</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>add_to_cart_rate</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>visitor_type</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>agg_type</td>
<td>string[python]</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="monthly-performance-summary-in-combined-data" class="level3">
<h3 class="anchored" data-anchor-id="monthly-performance-summary-in-combined-data">Monthly Performance Summary in Combined Data</h3>
<p>Get aggregated summary of metadata by month</p>
<div class="cell" data-execution_count="38">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">split_type</th>
<th data-quarto-table-cell-role="th">return_purchasers</th>
<th data-quarto-table-cell-role="th">revenue</th>
<th data-quarto-table-cell-role="th">visitors</th>
<th data-quarto-table-cell-role="th">pageviews</th>
<th data-quarto-table-cell-role="th">time_on_site</th>
<th data-quarto-table-cell-role="th">channelGrouping</th>
<th data-quarto-table-cell-role="th">deviceCategory</th>
<th data-quarto-table-cell-role="th">browser</th>
<th data-quarto-table-cell-role="th">os</th>
<th data-quarto-table-cell-role="th">audience_strategy</th>
<th data-quarto-table-cell-role="th">bounce_rate</th>
<th data-quarto-table-cell-role="th">product_clicks_rate</th>
<th data-quarto-table-cell-role="th">add_to_cart_rate</th>
<th data-quarto-table-cell-role="th">visitor_type</th>
<th data-quarto-table-cell-role="th">conversion_rate</th>
<th data-quarto-table-cell-role="th">visitors_pct_change</th>
<th data-quarto-table-cell-role="th">revenue_pct_change</th>
<th data-quarto-table-cell-role="th">pageviews_pct_change</th>
<th data-quarto-table-cell-role="th">time_on_site_pct_change</th>
<th data-quarto-table-cell-role="th">bounce_rate_pct_change</th>
<th data-quarto-table-cell-role="th">conversion_rate_pct_change</th>
<th data-quarto-table-cell-role="th">product_clicks_rate_pct_change</th>
<th data-quarto-table-cell-role="th">add_to_cart_rate_pct_change</th>
<th data-quarto-table-cell-role="th">visitors_pct_change_gt_0</th>
<th data-quarto-table-cell-role="th">revenue_pct_change_gt_0</th>
<th data-quarto-table-cell-role="th">pageviews_pct_change_gt_0</th>
<th data-quarto-table-cell-role="th">time_on_site_pct_change_gt_0</th>
<th data-quarto-table-cell-role="th">bounce_rate_pct_change_gt_0</th>
<th data-quarto-table-cell-role="th">conversion_rate_pct_change_gt_0</th>
<th data-quarto-table-cell-role="th">product_clicks_rate_pct_change_gt_0</th>
<th data-quarto-table-cell-role="th">add_to_cart_rate_pct_change_gt_0</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>9</td>
<td>Train+Val</td>
<td>516</td>
<td>25347.17</td>
<td>18610</td>
<td>122037</td>
<td>3.154803</td>
<td>Organic Search</td>
<td>desktop</td>
<td>Chrome</td>
<td>Windows</td>
<td>1</td>
<td>30.209565</td>
<td>1.754861</td>
<td>20.45137</td>
<td>return_purchasers</td>
<td>2.772703</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
<td>&lt;NA&gt;</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>10</td>
<td>Train+Val</td>
<td>743</td>
<td>57900.07</td>
<td>22605</td>
<td>137768</td>
<td>3.191469</td>
<td>Organic Search</td>
<td>desktop</td>
<td>Chrome</td>
<td>Macintosh</td>
<td>1</td>
<td>30.67463</td>
<td>2.976927</td>
<td>18.279142</td>
<td>return_purchasers</td>
<td>3.286883</td>
<td>21.466953</td>
<td>128.428144</td>
<td>12.890353</td>
<td>1.162219</td>
<td>1.539462</td>
<td>18.544381</td>
<td>69.638951</td>
<td>-10.621432</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>11</td>
<td>Train+Val</td>
<td>1651</td>
<td>212099.94</td>
<td>24400</td>
<td>162373</td>
<td>3.521508</td>
<td>Organic Search</td>
<td>desktop</td>
<td>Chrome</td>
<td>Macintosh</td>
<td>1</td>
<td>27.090164</td>
<td>3.284716</td>
<td>25.229508</td>
<td>return_purchasers</td>
<td>6.766393</td>
<td>7.940721</td>
<td>266.320697</td>
<td>17.859735</td>
<td>10.341304</td>
<td>-11.68544</td>
<td>105.860463</td>
<td>10.33912</td>
<td>38.023483</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>False</td>
<td>True</td>
<td>True</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>12</td>
<td>Train+Val</td>
<td>1340</td>
<td>188699.98</td>
<td>26936</td>
<td>168889</td>
<td>3.386728</td>
<td>Organic Search</td>
<td>desktop</td>
<td>Chrome</td>
<td>Macintosh</td>
<td>1</td>
<td>29.284229</td>
<td>3.131886</td>
<td>23.492723</td>
<td>return_purchasers</td>
<td>4.974755</td>
<td>10.393443</td>
<td>-11.032516</td>
<td>4.012982</td>
<td>-3.827331</td>
<td>8.099122</td>
<td>-26.478485</td>
<td>-4.652734</td>
<td>-6.883942</td>
<td>True</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1</td>
<td>Train+Val</td>
<td>722</td>
<td>149074.1</td>
<td>21177</td>
<td>125412</td>
<td>3.241019</td>
<td>Organic Search</td>
<td>desktop</td>
<td>Chrome</td>
<td>Macintosh</td>
<td>1</td>
<td>33.026397</td>
<td>3.097427</td>
<td>20.866978</td>
<td>return_purchasers</td>
<td>3.409359</td>
<td>-21.380309</td>
<td>-20.999409</td>
<td>-25.742944</td>
<td>-4.302378</td>
<td>12.77878</td>
<td>-31.466791</td>
<td>-1.100268</td>
<td>-11.176844</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>2</td>
<td>Test</td>
<td>465</td>
<td>111202.47</td>
<td>20164</td>
<td>106500</td>
<td>2.981056</td>
<td>Organic Search</td>
<td>desktop</td>
<td>Chrome</td>
<td>Macintosh</td>
<td>1</td>
<td>35.231105</td>
<td>2.697265</td>
<td>18.964491</td>
<td>return_purchasers</td>
<td>2.30609</td>
<td>-4.783492</td>
<td>-25.404567</td>
<td>-15.079897</td>
<td>-8.021009</td>
<td>6.675595</td>
<td>-32.360015</td>
<td>-12.919185</td>
<td>-9.117214</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>3</td>
<td>Infer</td>
<td>&lt;NA&gt;</td>
<td>136287.37</td>
<td>21752</td>
<td>117334</td>
<td>3.199143</td>
<td>Organic Search</td>
<td>desktop</td>
<td>Chrome</td>
<td>Macintosh</td>
<td>1</td>
<td>33.357852</td>
<td>2.918338</td>
<td>19.657962</td>
<td>all_visitors</td>
<td>&lt;NA&gt;</td>
<td>7.875422</td>
<td>22.557862</td>
<td>10.17277</td>
<td>7.31577</td>
<td>-5.317042</td>
<td>0.0</td>
<td>8.196182</td>
<td>3.656683</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>True</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">column</th>
<th data-quarto-table-cell-role="th">dtype</th>
<th data-quarto-table-cell-role="th">missing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>month</td>
<td>Int8</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>split_type</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>return_purchasers</td>
<td>Int64</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>revenue</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>visitors</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>pageviews</td>
<td>Int64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>time_on_site</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>channelGrouping</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>deviceCategory</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>browser</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>os</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>audience_strategy</td>
<td>Int8</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>bounce_rate</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>product_clicks_rate</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>add_to_cart_rate</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>visitor_type</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>conversion_rate</td>
<td>Float64</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>visitors_pct_change</td>
<td>Float64</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>revenue_pct_change</td>
<td>Float64</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>pageviews_pct_change</td>
<td>Float64</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>time_on_site_pct_change</td>
<td>Float64</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>bounce_rate_pct_change</td>
<td>Float64</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>conversion_rate_pct_change</td>
<td>Float64</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>product_clicks_rate_pct_change</td>
<td>Float64</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>add_to_cart_rate_pct_change</td>
<td>Float64</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>visitors_pct_change_gt_0</td>
<td>boolean</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>revenue_pct_change_gt_0</td>
<td>boolean</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>pageviews_pct_change_gt_0</td>
<td>boolean</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>time_on_site_pct_change_gt_0</td>
<td>boolean</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>bounce_rate_pct_change_gt_0</td>
<td>boolean</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>conversion_rate_pct_change_gt_0</td>
<td>boolean</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>product_clicks_rate_pct_change_gt_0</td>
<td>boolean</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>add_to_cart_rate_pct_change_gt_0</td>
<td>boolean</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="categorical-feature-kpis" class="level3">
<h3 class="anchored" data-anchor-id="categorical-feature-kpis">Categorical Feature KPIs</h3>
<div class="cell" data-execution_count="39">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">feature_name</th>
<th data-quarto-table-cell-role="th">feature_category</th>
<th data-quarto-table-cell-role="th">variable</th>
<th data-quarto-table-cell-role="th">value</th>
<th data-quarto-table-cell-role="th">audience_strategy</th>
<th data-quarto-table-cell-role="th">historical_data_month</th>
<th data-quarto-table-cell-role="th">historical_data_size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>last_action</td>
<td>Check out</td>
<td>CTR</td>
<td>4.867909</td>
<td>1</td>
<td>February</td>
<td>20164</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>last_action</td>
<td>Remove product(s) from cart</td>
<td>CTR</td>
<td>4.826653</td>
<td>1</td>
<td>February</td>
<td>20164</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>last_action</td>
<td>Add product(s) to cart</td>
<td>CTR</td>
<td>4.909087</td>
<td>1</td>
<td>February</td>
<td>20164</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>last_action</td>
<td>Completed purchase</td>
<td>CTR</td>
<td>5.215002</td>
<td>1</td>
<td>February</td>
<td>20164</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>last_action</td>
<td>Product detail views</td>
<td>CTR</td>
<td>5.382033</td>
<td>1</td>
<td>February</td>
<td>20164</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>last_action</td>
<td>Unknown</td>
<td>CTR</td>
<td>0.0</td>
<td>1</td>
<td>February</td>
<td>20164</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">column</th>
<th data-quarto-table-cell-role="th">dtype</th>
<th data-quarto-table-cell-role="th">missing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>feature_name</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>feature_category</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>variable</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>value</td>
<td>Float64</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>audience_strategy</td>
<td>Int8</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>historical_data_month</td>
<td>string[python]</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>historical_data_size</td>
<td>Int64</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">audience_strategy</th>
<th data-quarto-table-cell-role="th">historical_data_month</th>
<th data-quarto-table-cell-role="th">historical_data_size</th>
<th data-quarto-table-cell-role="th">feature_name</th>
<th data-quarto-table-cell-role="th">feature_category</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">value</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">variable</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">CTR</th>
<th data-quarto-table-cell-role="th">Conversion Rate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>browser</td>
<td>Chrome</td>
<td>2.877059</td>
<td>3.009088</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>browser</td>
<td>Safari</td>
<td>2.06649</td>
<td>0.351256</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>browser</td>
<td>other</td>
<td>2.301302</td>
<td>0.310945</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>channelGrouping</td>
<td>Affiliates</td>
<td>1.399795</td>
<td>0.34965</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>channelGrouping</td>
<td>Direct</td>
<td>3.602659</td>
<td>3.855422</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>channelGrouping</td>
<td>Display</td>
<td>2.531646</td>
<td>4.62963</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>channelGrouping</td>
<td>Organic Search</td>
<td>2.345162</td>
<td>0.826806</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>channelGrouping</td>
<td>Paid Search</td>
<td>2.604474</td>
<td>0.420168</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>channelGrouping</td>
<td>Referral</td>
<td>3.109836</td>
<td>6.850829</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>channelGrouping</td>
<td>Social</td>
<td>2.114267</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>deviceCategory</td>
<td>desktop</td>
<td>3.006461</td>
<td>3.186766</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>deviceCategory</td>
<td>mobile</td>
<td>1.894861</td>
<td>0.333519</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>deviceCategory</td>
<td>tablet</td>
<td>1.726674</td>
<td>0.249066</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>last_action</td>
<td>Add product(s) to cart</td>
<td>4.909087</td>
<td>12.057416</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>last_action</td>
<td>Check out</td>
<td>4.867909</td>
<td>20.19544</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>last_action</td>
<td>Click through of product lists</td>
<td>0.961538</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>last_action</td>
<td>Completed purchase</td>
<td>5.215002</td>
<td>5.597579</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>last_action</td>
<td>Product detail views</td>
<td>5.382033</td>
<td>3.476946</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>last_action</td>
<td>Remove product(s) from cart</td>
<td>4.826653</td>
<td>16.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>last_action</td>
<td>Unknown</td>
<td>0.0</td>
<td>0.807607</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>medium</td>
<td>(none)</td>
<td>3.602659</td>
<td>3.855422</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>medium</td>
<td>affiliate</td>
<td>1.399795</td>
<td>0.34965</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>medium</td>
<td>cpc</td>
<td>2.604474</td>
<td>0.420168</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>medium</td>
<td>cpm</td>
<td>2.531646</td>
<td>4.62963</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>medium</td>
<td>organic</td>
<td>2.345162</td>
<td>0.826806</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>medium</td>
<td>referral</td>
<td>2.872402</td>
<td>4.219601</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>os</td>
<td>(not set)</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>os</td>
<td>Android</td>
<td>1.999182</td>
<td>0.478998</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>os</td>
<td>Chrome OS</td>
<td>3.037461</td>
<td>2.797834</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>os</td>
<td>Firefox OS</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>os</td>
<td>Linux</td>
<td>3.64461</td>
<td>3.091873</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>os</td>
<td>Macintosh</td>
<td>3.307351</td>
<td>4.969716</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>os</td>
<td>Nintendo Wii</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">33</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>os</td>
<td>Windows</td>
<td>2.517362</td>
<td>1.111111</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>os</td>
<td>iOS</td>
<td>1.766737</td>
<td>0.202781</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>source</td>
<td>(direct)</td>
<td>3.602659</td>
<td>3.855422</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>source</td>
<td>google</td>
<td>2.368136</td>
<td>0.778286</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">37</td>
<td>1</td>
<td>February</td>
<td>20164</td>
<td>source</td>
<td>other</td>
<td>2.807983</td>
<td>3.93476</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="audience-sample-cohort-size-requirements-and-metrics-1" class="level3">
<h3 class="anchored" data-anchor-id="audience-sample-cohort-size-requirements-and-metrics-1">Audience Sample (Cohort) Size Requirements and Metrics</h3>
</section>
</section>
<section id="upload-to-bigquery-tables" class="level2">
<h2 class="anchored" data-anchor-id="upload-to-bigquery-tables">Upload to BigQuery Tables</h2>
<section id="audience-feature-importances" class="level3">
<h3 class="anchored" data-anchor-id="audience-feature-importances">Audience Feature Importances</h3>
<p>Define BigQuery Table Schema</p>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>job_config_feats_imp <span class="op">=</span> bigquery.LoadJobConfig(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    schema<span class="op">=</span>[</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"audience_strategy"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"num_observations"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"stat"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"maudience"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"value"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>job_config_feats_imp.write_disposition <span class="op">=</span> <span class="st">'WRITE_APPEND'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create BigQuery table (if it does not exist) and populate</p>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>bquh.create_bq_table(gbq_table_fully_resolved_feats_imp, client)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>bquh.append_df_to_bq_table(</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    df_feats, job_config_feats_imp, gbq_table_fully_resolved_feats_imp, client</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="audience-profile-1" class="level3">
<h3 class="anchored" data-anchor-id="audience-profile-1">Audience Profile</h3>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>job_config_profiles <span class="op">=</span> bigquery.LoadJobConfig(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    schema<span class="op">=</span>[</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"Audience_Strategy"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"Stat_Expanded"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"High"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"Medium"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"Low"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>job_config_profiles.write_disposition <span class="op">=</span> <span class="st">'WRITE_APPEND'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>bquh.create_bq_table(gbq_table_fully_resolved_profiles, client)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>bquh.append_df_to_bq_table(</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    df_profile_sliced, job_config_profiles, gbq_table_fully_resolved_profiles, client</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="audience-cohorts-2" class="level3">
<h3 class="anchored" data-anchor-id="audience-cohorts-2">Audience Cohorts</h3>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>job_config_cohorts <span class="op">=</span> bigquery.LoadJobConfig(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    schema<span class="op">=</span>[</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"infer_month"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"fullvisitorid"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"visitId"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"visitNumber"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"visitStartTime"</span>, <span class="st">"DATETIME"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"quarter"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"month"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"day_of_month"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"day_of_week"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"hour"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"minute"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"second"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"source"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"medium"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"channelGrouping"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"hits"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"bounces"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"last_action"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"promos_displayed"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"promos_clicked"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"product_views"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"product_clicks"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"pageviews"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"time_on_site"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"browser"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"os"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"deviceCategory"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"added_to_cart"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"revenue"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"score"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"predicted_score_label"</span>, <span class="st">"BOOLEAN"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"maudience"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"cohort"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"audience_strategy"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"made_purchase_on_future_visit"</span>, <span class="st">"BOOLEAN"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"split_type"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>job_config_cohorts.write_disposition <span class="op">=</span> <span class="st">'WRITE_APPEND'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>bquh.create_bq_table(gbq_table_fully_resolved_cohorts, client)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>bquh.append_df_to_bq_table(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    df_dev_cohorts, job_config_cohorts, gbq_table_fully_resolved_cohorts, client</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="monthly-performance-summary" class="level3">
<h3 class="anchored" data-anchor-id="monthly-performance-summary">Monthly Performance Summary</h3>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>job_config_summary <span class="op">=</span> bigquery.LoadJobConfig(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    schema<span class="op">=</span>[</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"month"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"split_type"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"return_purchasers"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"revenue"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"visitors"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"pageviews"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"time_on_site"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"channelGrouping"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"deviceCategory"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"browser"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"os"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"audience_strategy"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"bounce_rate"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"product_clicks_rate"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"add_to_cart_rate"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"visitor_type"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"conversion_rate"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"visitors_pct_change"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"revenue_pct_change"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"pageviews_pct_change"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"time_on_site_pct_change"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"bounce_rate_pct_change"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"conversion_rate_pct_change"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"product_clicks_rate_pct_change"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"add_to_cart_rate_pct_change"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"visitors_pct_change_gt_0"</span>, <span class="st">"BOOLEAN"</span>, mode<span class="op">=</span><span class="st">'REQUIRED'</span>),</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"revenue_pct_change_gt_0"</span>, <span class="st">"BOOLEAN"</span>, mode<span class="op">=</span><span class="st">'REQUIRED'</span>),</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"pageviews_pct_change_gt_0"</span>, <span class="st">"BOOLEAN"</span>, mode<span class="op">=</span><span class="st">'REQUIRED'</span>),</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"time_on_site_pct_change_gt_0"</span>, <span class="st">"BOOLEAN"</span>, mode<span class="op">=</span><span class="st">'REQUIRED'</span>),</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"bounce_rate_pct_change_gt_0"</span>, <span class="st">"BOOLEAN"</span>, mode<span class="op">=</span><span class="st">'REQUIRED'</span>),</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"conversion_rate_pct_change_gt_0"</span>, <span class="st">"BOOLEAN"</span>, mode<span class="op">=</span><span class="st">'REQUIRED'</span>),</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"product_clicks_rate_pct_change_gt_0"</span>, <span class="st">"BOOLEAN"</span>, mode<span class="op">=</span><span class="st">'REQUIRED'</span>),</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"add_to_cart_rate_pct_change_gt_0"</span>, <span class="st">"BOOLEAN"</span>, mode<span class="op">=</span><span class="st">'REQUIRED'</span>),</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>job_config_summary.write_disposition <span class="op">=</span> <span class="st">'WRITE_APPEND'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>bquh.create_bq_table(gbq_summary_table_id_fully_resolved, client)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>bquh.append_df_to_bq_table(</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    df_summary, job_config_summary, gbq_summary_table_id_fully_resolved, client</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="conversion-rates-in-development-and-inference-2" class="level3">
<h3 class="anchored" data-anchor-id="conversion-rates-in-development-and-inference-2">Conversion Rates in Development and Inference</h3>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>job_config_conv_rates <span class="op">=</span> bigquery.LoadJobConfig(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    schema<span class="op">=</span>[</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"audience_strategy"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"infer_month"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"maudience"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"pred_conversions"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"total_visitors"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"min_score"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"true_conversions"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"data_type"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"data_size"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"true_conv_rate"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"overall_true_conv_rate"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"pred_conv_rate"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"overall_pred_conv_rate"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>job_config_conv_rates.write_disposition <span class="op">=</span> <span class="st">'WRITE_APPEND'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>bquh.create_bq_table(gbq_conv_rates_table_id_fully_resolved, client)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>bquh.append_df_to_bq_table(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    df_conv_rates, job_config_conv_rates, gbq_conv_rates_table_id_fully_resolved, client</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="estimated-and-actual-cohort-to-audience-fractions-2" class="level3">
<h3 class="anchored" data-anchor-id="estimated-and-actual-cohort-to-audience-fractions-2">Estimated and Actual Cohort to Audience Fractions</h3>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>job_config_sa_frac <span class="op">=</span> bigquery.LoadJobConfig(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    schema<span class="op">=</span>[</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"audience_strategy"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"infer_month"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"maudience"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"cohort"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"size"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"group_size"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"uplift"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"power"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"ci_level"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"samp_to_aud_frac"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"size_type"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"data_type"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"data_size"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>job_config_sa_frac.write_disposition <span class="op">=</span> <span class="st">'WRITE_APPEND'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>bquh.create_bq_table(gbq_sa_fracs_table_id_fully_resolved, client)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>bquh.append_df_to_bq_table(</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    df_sa_frac, job_config_sa_frac, gbq_sa_fracs_table_id_fully_resolved, client</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="aggregated-conversion-rates" class="level3">
<h3 class="anchored" data-anchor-id="aggregated-conversion-rates">Aggregated Conversion Rates</h3>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>job_config_conv_rates_combo <span class="op">=</span> bigquery.LoadJobConfig(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    schema<span class="op">=</span>[</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"maudience"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"data_type"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"var"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"value"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>job_config_conv_rates_combo.write_disposition <span class="op">=</span> <span class="st">'WRITE_APPEND'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>bquh.create_bq_table(gbq_conv_rates_combo_table_id_fully_resolved, client)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>bquh.append_df_to_bq_table(</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    df_conv_rates_agg_combo,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    job_config_conv_rates_combo,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    gbq_conv_rates_combo_table_id_fully_resolved,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    client</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="daily-performance-summary" class="level3">
<h3 class="anchored" data-anchor-id="daily-performance-summary">Daily Performance Summary</h3>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>job_config_daily_perf_combo <span class="op">=</span> bigquery.LoadJobConfig(</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    schema<span class="op">=</span>[</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"month"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"date"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"maudience"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"return_purchasers"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"revenue"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"visitors"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"add_to_cart"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"pageviews"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"time_on_site"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"product_views"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"product_clicks"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"bounces"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"audience_strategy"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"bounce_rate"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"product_clicks_rate"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"add_to_cart_rate"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"visitor_type"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"agg_type"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>job_config_daily_perf_combo.write_disposition <span class="op">=</span> <span class="st">'WRITE_APPEND'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>bquh.create_bq_table(gbq_daily_perf_combo_table_id_fully_resolved, client)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>bquh.append_df_to_bq_table(</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    df_hmap_combo,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    job_config_daily_perf_combo,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    gbq_daily_perf_combo_table_id_fully_resolved,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    client</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="categorical-feature-kpis-1" class="level3">
<h3 class="anchored" data-anchor-id="categorical-feature-kpis-1">Categorical Feature KPIs</h3>
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>job_config_cat_feats_kpis <span class="op">=</span> bigquery.LoadJobConfig(</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    schema<span class="op">=</span>[</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"feature_name"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"feature_category"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"variable"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"value"</span>, <span class="st">"FLOAT64"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"audience_strategy"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"historical_data_month"</span>, <span class="st">"STRING"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>        bigquery.SchemaField(<span class="st">"historical_data_size"</span>, <span class="st">"INTEGER"</span>, mode<span class="op">=</span><span class="st">'NULLABLE'</span>),</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>job_config_cat_feats_kpis.write_disposition <span class="op">=</span> <span class="st">'WRITE_APPEND'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>bquh.create_bq_table(gbq_table_fully_resolved_cat_feat_kpis, client)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>bquh.append_df_to_bq_table(</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    df_development_agg,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    job_config_cat_feats_kpis,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    gbq_table_fully_resolved_cat_feat_kpis,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    client,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="next-step" class="level2">
<h2 class="anchored" data-anchor-id="next-step">Next Step</h2>
<p>The next step will be to create summary charts for an end-user using the contents of these two newly created audience tables.</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp("^(?:http:|https:)\/\/www\.quarto\.org\/custom");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="../../../notebooks/03-explore/notebooks/08_explore_best_model.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Vital Features</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../../notebooks/05-dash/notebooks/10_dash.html" class="pagination-link">
        <span class="nav-page-text">Dashboard</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>